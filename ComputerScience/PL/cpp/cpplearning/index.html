
<!DOCTYPE html>

<html class="no-js" lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1" name="viewport"/>
<meta content="个人网站..." name="description"/>
<meta content="xestray" name="author"/>
<link href="https://xestray.cc/ComputerScience/PL/cpp/cpplearning/" rel="canonical"/>
<link href="../../" rel="prev"/>
<link href="../../../ADS/" rel="next"/>
<link href="../../../../assets/images/favicon.png" rel="icon"/>
<meta content="mkdocs-1.6.1, mkdocs-material-9.7.1" name="generator"/>
<title>C++ - xestray's website</title>
<link href="../../../../assets/stylesheets/main.484c7ddc.min.css" rel="stylesheet"/>
<link href="../../../../assets/stylesheets/palette.ab4e12ef.min.css" rel="stylesheet"/>
<style>:root{--md-admonition-icon--info:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%20576%20512%22%3E%3C%21--%21%20Font%20Awesome%20Free%207.1.0%20by%20%40fontawesome%20-%20https%3A//fontawesome.com%20License%20-%20https%3A//fontawesome.com/license/free%20%28Icons%3A%20CC%20BY%204.0%2C%20Fonts%3A%20SIL%20OFL%201.1%2C%20Code%3A%20MIT%20License%29%20Copyright%202025%20Fonticons%2C%20Inc.--%3E%3Cpath%20d%3D%22M288%2064a32%2032%200%201%200%200%2064%2032%2032%200%201%200%200-64m-96%2032c0-53%2043-96%2096-96s96%2043%2096%2096c0%2041.8-26.7%2077.4-64%2090.5v257.9c62.9-14.3%20110.2-69.7%20111.9-136.5L415.8%20322c-10%208.7-25.1%207.7-33.9-2.3s-7.7-25.1%202.3-33.9l64-56c9-7.9%2022.6-7.9%2031.6%200l64%2056c10%208.7%2011%2023.9%202.3%2033.9s-23.9%2011-33.9%202.3L496%20307.9C493.9%20421%20401.6%20512%20288%20512S82.1%20421%2080%20307.9l-16.2%2014.2c-10%208.7-25.1%207.7-33.9-2.3s-7.7-25.1%202.3-33.9l64-56c9-7.9%2022.6-7.9%2031.6%200l64%2056c10%208.7%2011%2023.9%202.3%2033.9s-23.9%2011-33.9%202.3L144.1%20308c1.8%2066.8%2049.1%20122.2%20111.9%20136.5V186.6c-37.3-13.2-64-48.7-64-90.5z%22/%3E%3C/svg%3E');--md-admonition-icon--note:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%20512%20512%22%3E%3C%21--%21%20Font%20Awesome%20Free%207.1.0%20by%20%40fontawesome%20-%20https%3A//fontawesome.com%20License%20-%20https%3A//fontawesome.com/license/free%20%28Icons%3A%20CC%20BY%204.0%2C%20Fonts%3A%20SIL%20OFL%201.1%2C%20Code%3A%20MIT%20License%29%20Copyright%202025%20Fonticons%2C%20Inc.--%3E%3Cpath%20d%3D%22m368.5%2018.3-50.1%2050.1%20125.3%20125.3%2050.1-50.1c21.9-21.9%2021.9-57.3%200-79.2l-46.1-46.1c-21.9-21.9-57.3-21.9-79.2%200m-89.2%2078.9-.5.1-144.1%2043.2c-19.9%206-35.7%2021.2-42.3%2041L3.8%20445.8c-2.9%208.7-1.9%2018.2%202.5%2026l155.4-155.4c-1.1-4-1.6-8.1-1.6-12.4%200-26.5%2021.5-48%2048-48s48%2021.5%2048%2048-21.5%2048-48%2048c-4.3%200-8.5-.6-12.4-1.6L40.3%20505.7c7.8%204.4%2017.2%205.4%2026%202.5l264.3-88.6c19.7-6.6%2035-22.4%2041-42.3l43.2-144.1.1-.5L279.4%2097.2z%22/%3E%3C/svg%3E');--md-admonition-icon--abstract:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%20512%20512%22%3E%3C%21--%21%20Font%20Awesome%20Free%207.1.0%20by%20%40fontawesome%20-%20https%3A//fontawesome.com%20License%20-%20https%3A//fontawesome.com/license/free%20%28Icons%3A%20CC%20BY%204.0%2C%20Fonts%3A%20SIL%20OFL%201.1%2C%20Code%3A%20MIT%20License%29%20Copyright%202025%20Fonticons%2C%20Inc.--%3E%3Cpath%20d%3D%22M40%2048c-13.3%200-24%2010.7-24%2024v48c0%2013.3%2010.7%2024%2024%2024h48c13.3%200%2024-10.7%2024-24V72c0-13.3-10.7-24-24-24zm152%2016c-17.7%200-32%2014.3-32%2032s14.3%2032%2032%2032h288c17.7%200%2032-14.3%2032-32s-14.3-32-32-32zm0%20160c-17.7%200-32%2014.3-32%2032s14.3%2032%2032%2032h288c17.7%200%2032-14.3%2032-32s-14.3-32-32-32zm0%20160c-17.7%200-32%2014.3-32%2032s14.3%2032%2032%2032h288c17.7%200%2032-14.3%2032-32s-14.3-32-32-32zM16%20232v48c0%2013.3%2010.7%2024%2024%2024h48c13.3%200%2024-10.7%2024-24v-48c0-13.3-10.7-24-24-24H40c-13.3%200-24%2010.7-24%2024m24%20136c-13.3%200-24%2010.7-24%2024v48c0%2013.3%2010.7%2024%2024%2024h48c13.3%200%2024-10.7%2024-24v-48c0-13.3-10.7-24-24-24z%22/%3E%3C/svg%3E');--md-admonition-icon--tip:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%20384%20512%22%3E%3C%21--%21%20Font%20Awesome%20Free%207.1.0%20by%20%40fontawesome%20-%20https%3A//fontawesome.com%20License%20-%20https%3A//fontawesome.com/license/free%20%28Icons%3A%20CC%20BY%204.0%2C%20Fonts%3A%20SIL%20OFL%201.1%2C%20Code%3A%20MIT%20License%29%20Copyright%202025%20Fonticons%2C%20Inc.--%3E%3Cpath%20d%3D%22M292.9%20384c7.3-22.3%2021.9-42.5%2038.4-59.9C364%20289.7%20384%20243.2%20384%20192%20384%2086%20298%200%20192%200S0%2086%200%20192c0%2051.2%2020%2097.7%2052.7%20132.1%2016.5%2017.4%2031.2%2037.6%2038.4%2059.9h201.7zm-4.9%2048H96v16c0%2044.2%2035.8%2080%2080%2080h32c44.2%200%2080-35.8%2080-80zM184%20112c-39.8%200-72%2032.2-72%2072%200%2013.3-10.7%2024-24%2024s-24-10.7-24-24c0-66.3%2053.7-120%20120-120%2013.3%200%2024%2010.7%2024%2024s-10.7%2024-24%2024%22/%3E%3C/svg%3E');--md-admonition-icon--success:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%20448%20512%22%3E%3C%21--%21%20Font%20Awesome%20Free%207.1.0%20by%20%40fontawesome%20-%20https%3A//fontawesome.com%20License%20-%20https%3A//fontawesome.com/license/free%20%28Icons%3A%20CC%20BY%204.0%2C%20Fonts%3A%20SIL%20OFL%201.1%2C%20Code%3A%20MIT%20License%29%20Copyright%202025%20Fonticons%2C%20Inc.--%3E%3Cpath%20d%3D%22M434.8%2070.1c14.3%2010.4%2017.5%2030.4%207.1%2044.7l-256%20352c-5.5%207.6-14%2012.3-23.4%2013.1s-18.5-2.7-25.1-9.3l-128-128c-12.5-12.5-12.5-32.8%200-45.3s32.8-12.5%2045.3%200l101.5%20101.5%20234-321.7c10.4-14.3%2030.4-17.5%2044.7-7.1z%22/%3E%3C/svg%3E');--md-admonition-icon--question:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%20512%20512%22%3E%3C%21--%21%20Font%20Awesome%20Free%207.1.0%20by%20%40fontawesome%20-%20https%3A//fontawesome.com%20License%20-%20https%3A//fontawesome.com/license/free%20%28Icons%3A%20CC%20BY%204.0%2C%20Fonts%3A%20SIL%20OFL%201.1%2C%20Code%3A%20MIT%20License%29%20Copyright%202025%20Fonticons%2C%20Inc.--%3E%3Cpath%20d%3D%22M256%20512a256%20256%200%201%200%200-512%20256%20256%200%201%200%200%20512m0-336c-17.7%200-32%2014.3-32%2032%200%2013.3-10.7%2024-24%2024s-24-10.7-24-24c0-44.2%2035.8-80%2080-80s80%2035.8%2080%2080c0%2047.2-36%2067.2-56%2074.5v3.8c0%2013.3-10.7%2024-24%2024s-24-10.7-24-24v-8.1c0-20.5%2014.8-35.2%2030.1-40.2%206.4-2.1%2013.2-5.5%2018.2-10.3%204.3-4.2%207.7-10%207.7-19.6%200-17.7-14.3-32-32-32zm-32%20192a32%2032%200%201%201%2064%200%2032%2032%200%201%201-64%200%22/%3E%3C/svg%3E');--md-admonition-icon--warning:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%20512%20512%22%3E%3C%21--%21%20Font%20Awesome%20Free%207.1.0%20by%20%40fontawesome%20-%20https%3A//fontawesome.com%20License%20-%20https%3A//fontawesome.com/license/free%20%28Icons%3A%20CC%20BY%204.0%2C%20Fonts%3A%20SIL%20OFL%201.1%2C%20Code%3A%20MIT%20License%29%20Copyright%202025%20Fonticons%2C%20Inc.--%3E%3Cpath%20d%3D%22M256%200c14.7%200%2028.2%208.1%2035.2%2021l216%20400c6.7%2012.4%206.4%2027.4-.8%2039.5S486.1%20480%20472%20480H40c-14.1%200-27.2-7.4-34.4-19.5s-7.5-27.1-.8-39.5l216-400c7-12.9%2020.5-21%2035.2-21m0%20352a32%2032%200%201%200%200%2064%2032%2032%200%201%200%200-64m0-192c-18.2%200-32.7%2015.5-31.4%2033.7l7.4%20104c.9%2012.5%2011.4%2022.3%2023.9%2022.3%2012.6%200%2023-9.7%2023.9-22.3l7.4-104c1.3-18.2-13.1-33.7-31.4-33.7z%22/%3E%3C/svg%3E');--md-admonition-icon--failure:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2024%2024%22%3E%3Cpath%20d%3D%22M12%203c4.97%200%209%203.58%209%208s-6%2010-9%2010-9-5.58-9-10%204.03-8%209-8m-1.69%207.93C9.29%209.29%207.47%208.58%206.25%209.34s-1.38%202.71-.36%204.35c1.03%201.64%202.85%202.35%204.07%201.59%201.22-.78%201.37-2.71.35-4.35m3.38%200c-1.02%201.64-.87%203.57.35%204.35%201.22.76%203.04.05%204.07-1.59%201.02-1.64.86-3.59-.36-4.35s-3.04-.05-4.06%201.59M12%2017.75c-2%200-2.5-.75-2.5-.75%200%20.03.5%202%202.5%202s2.5-2%202.5-2-.5.75-2.5.75%22/%3E%3C/svg%3E');--md-admonition-icon--danger:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%20512%20512%22%3E%3C%21--%21%20Font%20Awesome%20Free%207.1.0%20by%20%40fontawesome%20-%20https%3A//fontawesome.com%20License%20-%20https%3A//fontawesome.com/license/free%20%28Icons%3A%20CC%20BY%204.0%2C%20Fonts%3A%20SIL%20OFL%201.1%2C%20Code%3A%20MIT%20License%29%20Copyright%202025%20Fonticons%2C%20Inc.--%3E%3Cpath%20d%3D%22M296%2040c0-22.1-17.9-40-40-40s-40%2017.9-40%2040c0%2044.1-53.3%2066.1-84.5%2035-15.6-15.6-40.9-15.6-56.6%200s-15.6%2040.9%200%2056.6c31.2%2031.2%209.1%2084.5-35%2084.5-22.1%200-40%2017.9-40%2040s17.9%2040%2040%2040c44.1%200%2066.1%2053.3%2035%2084.5-15.6%2015.6-15.6%2040.9%200%2056.6s40.9%2015.6%2056.6%200c31.2-31.2%2084.5-9.1%2084.5%2035%200%2022.1%2017.9%2040%2040%2040s40-17.9%2040-40c0-44.1%2053.3-66.1%2084.5-35%2015.6%2015.6%2040.9%2015.6%2056.6%200s15.6-40.9%200-56.6c-31.2-31.2-9.1-84.5%2035-84.5%2022.1%200%2040-17.9%2040-40s-17.9-40-40-40c-44.1%200-66.1-53.3-35-84.5%2015.6-15.6%2015.6-40.9%200-56.6s-40.9-15.6-56.6%200c-31.2%2031.1-84.5%209.1-84.5-35M160%20224a32%2032%200%201%201%2064%200%2032%2032%200%201%201-64%200m160%2032a32%2032%200%201%201%200%2064%2032%2032%200%201%201%200-64%22/%3E%3C/svg%3E');--md-admonition-icon--bug:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%20640%20512%22%3E%3C%21--%21%20Font%20Awesome%20Free%207.1.0%20by%20%40fontawesome%20-%20https%3A//fontawesome.com%20License%20-%20https%3A//fontawesome.com/license/free%20%28Icons%3A%20CC%20BY%204.0%2C%20Fonts%3A%20SIL%20OFL%201.1%2C%20Code%3A%20MIT%20License%29%20Copyright%202025%20Fonticons%2C%20Inc.--%3E%3Cpath%20d%3D%22M352%200c0-17.7-14.3-32-32-32s-32%2014.3-32%2032v64h-96c-53%200-96%2043-96%2096v224c0%2053%2043%2096%2096%2096h256c53%200%2096-43%2096-96V160c0-53-43-96-96-96h-96zM160%20368c0-13.3%2010.7-24%2024-24h32c13.3%200%2024%2010.7%2024%2024s-10.7%2024-24%2024h-32c-13.3%200-24-10.7-24-24m120%200c0-13.3%2010.7-24%2024-24h32c13.3%200%2024%2010.7%2024%2024s-10.7%2024-24%2024h-32c-13.3%200-24-10.7-24-24m120%200c0-13.3%2010.7-24%2024-24h32c13.3%200%2024%2010.7%2024%2024s-10.7%2024-24%2024h-32c-13.3%200-24-10.7-24-24M224%20176a48%2048%200%201%201%200%2096%2048%2048%200%201%201%200-96m144%2048a48%2048%200%201%201%2096%200%2048%2048%200%201%201-96%200m-304%200c0-17.7-14.3-32-32-32S0%20206.3%200%20224v96c0%2017.7%2014.3%2032%2032%2032s32-14.3%2032-32zm544-32c-17.7%200-32%2014.3-32%2032v96c0%2017.7%2014.3%2032%2032%2032s32-14.3%2032-32v-96c0-17.7-14.3-32-32-32%22/%3E%3C/svg%3E');--md-admonition-icon--example:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%20448%20512%22%3E%3C%21--%21%20Font%20Awesome%20Free%207.1.0%20by%20%40fontawesome%20-%20https%3A//fontawesome.com%20License%20-%20https%3A//fontawesome.com/license/free%20%28Icons%3A%20CC%20BY%204.0%2C%20Fonts%3A%20SIL%20OFL%201.1%2C%20Code%3A%20MIT%20License%29%20Copyright%202025%20Fonticons%2C%20Inc.--%3E%3Cpath%20d%3D%22M288%200H128c-17.7%200-32%2014.3-32%2032s14.3%2032%2032%2032v151.5L7.5%20426.3C2.6%20435%200%20444.7%200%20454.7%200%20486.4%2025.6%20512%2057.3%20512h333.4c31.6%200%2057.3-25.6%2057.3-57.3%200-10-2.6-19.8-7.5-28.4L320%20215.5V64c17.7%200%2032-14.3%2032-32S337.7%200%20320%200zm-96%20215.5V64h64v151.5c0%2011.1%202.9%2022.1%208.4%2031.8L306%20320H142l41.6-72.7c5.5-9.7%208.4-20.6%208.4-31.8%22/%3E%3C/svg%3E');--md-admonition-icon--quote:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%20576%20512%22%3E%3C%21--%21%20Font%20Awesome%20Free%207.1.0%20by%20%40fontawesome%20-%20https%3A//fontawesome.com%20License%20-%20https%3A//fontawesome.com/license/free%20%28Icons%3A%20CC%20BY%204.0%2C%20Fonts%3A%20SIL%20OFL%201.1%2C%20Code%3A%20MIT%20License%29%20Copyright%202025%20Fonticons%2C%20Inc.--%3E%3Cpath%20d%3D%22M419.5%2096c-16.6%200-32.7%204.5-46.8%2012.7-15.8-16-34.2-29.4-54.5-39.5%2028.2-24%2064.1-37.2%20101.3-37.2C505.9%2032%20576%20102%20576%20188.5c0%2041.5-16.5%2081.3-45.8%20110.6l-71.1%2071.1C429.8%20399.5%20390%20416%20348.5%20416%20262.1%20416%20192%20346%20192%20259.5c0-1.5%200-3%20.1-4.5.5-17.7%2015.2-31.6%2032.9-31.1s31.6%2015.2%2031.1%2032.9v2.6c0%2051.1%2041.4%2092.5%2092.5%2092.5%2024.5%200%2048-9.7%2065.4-27.1l71.1-71.1c17.3-17.3%2027.1-40.9%2027.1-65.4%200-51.1-41.4-92.5-92.5-92.5zm-144.3%2077.3c-1.9-.8-3.8-1.9-5.5-3.1-12.6-6.5-27-10.2-42.1-10.2-24.5%200-48%209.7-65.4%2027.1l-71.1%2071.1C73.8%20275.5%2064%20299.1%2064%20323.6c0%2051.1%2041.4%2092.5%2092.5%2092.5%2016.5%200%2032.6-4.4%2046.7-12.6%2015.8%2016%2034.2%2029.4%2054.6%2039.5-28.2%2023.9-64%2037.2-101.3%2037.2C70.1%20480.2%200%20410.2%200%20323.7c0-41.5%2016.5-81.3%2045.8-110.6l71.1-71.1c29.3-29.3%2069.1-45.8%20110.6-45.8%2086.6%200%20156.5%2070.6%20156.5%20156.9v3.9c-.4%2017.7-15.1%2031.6-32.8%2031.2s-31.6-15.1-31.2-32.8v-2.3c0-33.7-18-63.3-44.8-79.6z%22/%3E%3C/svg%3E');}</style>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css?family=LXGW+WenKai+Screen:300,300i,400,400i,700,700i%7CJetBrains+Mono:400,400i,700,700i&amp;display=fallback" rel="stylesheet"/>
<style>:root{--md-text-font:"LXGW WenKai Screen";--md-code-font:"JetBrains Mono"}</style>
<link href="../../../../css/print-site.css" rel="stylesheet"/>
<link href="../../../../css/print-site-material.css" rel="stylesheet"/>
<link href="../../../../css/toc_extra.css" rel="stylesheet"/>
<link href="../../../../css/timeline.css" rel="stylesheet"/>
<link href="https://fonts.font.im/css2?family=Noto+Serif+SC" rel="stylesheet"/>
<link href="https://fonts.font.im/css?family=Gloria+Hallelujah" rel="stylesheet"/>
<link href="https://cdn.jsdelivr.net/npm/katex@0.16.7/dist/katex.min.css" rel="stylesheet"/>
<link href="https://cdn.jsdelivr.net/npm/jetbrains-mono@1.0.6/css/jetbrains-mono.css" rel="stylesheet"/>
<link href="https://cdn.jsdelivr.net/npm/lxgw-wenkai-screen-webfont@1.1.0/style.css" rel="stylesheet"/>
<link href="../../../../css/changelogs.css" rel="stylesheet"/>
<link href="../../../../css/newadmonitions.css" rel="stylesheet"/>
<link href="../../../../css/cards.css" rel="stylesheet"/>
<link href="../../../../css/card.css" rel="stylesheet"/>
<link href="../../../../css/custom.css" rel="stylesheet"/>
<link href="../../../../css/changelog_extra.css" rel="stylesheet"/>
<link href="../../../../css/counter.css" rel="stylesheet"/>
<link href="../../../../css/fold_toc.css" rel="stylesheet"/>
<link href="../../../../css/flink.css" rel="stylesheet"/>
<script>__md_scope=new URL("../../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
<script id="__analytics">function __md_analytics(){function e(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],e("js",new Date),e("config",""),document.addEventListener("DOMContentLoaded",(function(){document.forms.search&&document.forms.search.query.addEventListener("blur",(function(){this.value&&e("event","search",{search_term:this.value})}));document$.subscribe((function(){var t=document.forms.feedback;if(void 0!==t)for(var a of t.querySelectorAll("[type=submit]"))a.addEventListener("click",(function(a){a.preventDefault();var n=document.location.pathname,d=this.getAttribute("data-md-value");e("event","feedback",{page:n,data:d}),t.firstElementChild.disabled=!0;var r=t.querySelector(".md-feedback__note [data-md-value='"+d+"']");r&&(r.hidden=!1)})),t.hidden=!1})),location$.subscribe((function(t){e("config","",{page_path:t.pathname})}))}));var t=document.createElement("script");t.async=!0,t.src="https://www.googletagmanager.com/gtag/js?id=",document.getElementById("__analytics").insertAdjacentElement("afterEnd",t)}</script>
<script>"undefined"!=typeof __md_analytics&&__md_analytics()</script>
</head>
<body data-md-color-accent="indigo" data-md-color-primary="light-blue" data-md-color-scheme="default" dir="ltr">
<input autocomplete="off" class="md-toggle" data-md-toggle="drawer" id="__drawer" type="checkbox"/>
<input autocomplete="off" class="md-toggle" data-md-toggle="search" id="__search" type="checkbox"/>
<label class="md-overlay" for="__drawer"></label>
<div data-md-component="skip">
<a class="md-skip" href="#c">
          Skip to content
        </a>
</div>
<div data-md-component="announce">
</div>
<header class="md-header" data-md-component="header">
<nav aria-label="Header" class="md-header__inner md-grid">
<a aria-label="xestray's website" class="md-header__button md-logo" data-md-component="logo" href="../../../.." title="xestray's website">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 7V5h2V4a2 2 0 0 1 2-2h6v7l2.5-1.5L18 9V2h1c1.05 0 2 .95 2 2v16c0 1.05-.95 2-2 2H7c-1.05 0-2-.95-2-2v-1H3v-2h2v-4H3v-2h2V7zm4 4H5v2h2zm0-4V5H5v2zm0 12v-2H5v2z"></path></svg>
</a>
<label class="md-header__button md-icon" for="__drawer">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"></path></svg>
</label>
<div class="md-header__title" data-md-component="header-title">
<div class="md-header__ellipsis">
<div class="md-header__topic">
<span class="md-ellipsis">
            xestray's website
          </span>
</div>
<div class="md-header__topic" data-md-component="header-topic">
<span class="md-ellipsis">
            
              C++
            
          </span>
</div>
</div>
</div>
<form class="md-header__option" data-md-component="palette">
<input aria-label="太耀眼了" class="md-option" data-md-color-accent="indigo" data-md-color-media="(prefers-color-scheme: light)" data-md-color-primary="light-blue" data-md-color-scheme="default" id="__palette_0" name="__palette" type="radio"/>
<label class="md-header__button md-icon" for="__palette_1" hidden="" title="太耀眼了">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"></path></svg>
</label>
<input aria-label="要有光" class="md-option" data-md-color-accent="indigo" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-primary="1bdbe9b0" data-md-color-scheme="slate" id="__palette_1" name="__palette" type="radio"/>
<label class="md-header__button md-icon" for="__palette_0" hidden="" title="要有光">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"></path></svg>
</label>
</form>
<script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
<label class="md-header__button md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg>
</label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input aria-label="Search" autocapitalize="off" autocomplete="off" autocorrect="off" class="md-search__input" data-md-component="search-query" name="query" placeholder="Search" required="" spellcheck="false" type="text"/>
<label class="md-search__icon md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg>
<svg viewbox="0 0 256 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M9.4 233.4c-12.5 12.5-12.5 32.8 0 45.3l160 160c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L77.3 256l137.3-137.4c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-160 160z"></path></svg>
</label>
<nav aria-label="Search" class="md-search__options">
<a aria-label="Share" class="md-search__icon md-icon" data-clipboard="" data-clipboard-text="" data-md-component="search-share" href="javascript:void(0)" tabindex="-1" title="Share">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"></path></svg>
</a>
<button aria-label="Clear" class="md-search__icon md-icon" tabindex="-1" title="Clear" type="reset">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"></path></svg>
</button>
</nav>
<div class="md-search__suggest" data-md-component="search-suggest"></div>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix="" tabindex="0">
<div class="md-search-result" data-md-component="search-result">
<div class="md-search-result__meta">
            Initializing search
          </div>
<ol class="md-search-result__list" role="presentation"></ol>
</div>
</div>
</div>
</div>
</div>
<div class="md-header__source">
<a class="md-source" data-md-component="source" href="https://github.com/xestray/xestray.github.io/" title="Go to repository">
<div class="md-source__icon md-icon">
<svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"></path></svg>
</div>
<div class="md-source__repository">
    xestray
  </div>
</a>
</div>
</nav>
</header>
<div class="md-container" data-md-component="container">
<nav aria-label="Tabs" class="md-tabs" data-md-component="tabs">
<div class="md-grid">
<ul class="md-tabs__list">
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../../..">
          
  
  
    
  
  Home

        </a>
</li>
<li class="md-tabs__item md-tabs__item--active">
<a class="md-tabs__link" href="../../../">
          
  
  
    
  
  Computer Science

        </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../../../MathematicsAndPhysics/MA/MA/">
          
  
  
    
  
  数理

        </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../../../others/WhatToDo/">
          
  
  
    
  
  Others

        </a>
</li>
</ul>
</div>
</nav>
<main class="md-main" data-md-component="main">
<div class="md-main__inner md-grid">
<div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Navigation" class="md-nav md-nav--primary md-nav--lifted" data-md-level="0">
<label class="md-nav__title" for="__drawer">
<a aria-label="xestray's website" class="md-nav__button md-logo" data-md-component="logo" href="../../../.." title="xestray's website">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 7V5h2V4a2 2 0 0 1 2-2h6v7l2.5-1.5L18 9V2h1c1.05 0 2 .95 2 2v16c0 1.05-.95 2-2 2H7c-1.05 0-2-.95-2-2v-1H3v-2h2v-4H3v-2h2V7zm4 4H5v2h2zm0-4V5H5v2zm0 12v-2H5v2z"></path></svg>
</a>
    xestray's website
  </label>
<div class="md-nav__source">
<a class="md-source" data-md-component="source" href="https://github.com/xestray/xestray.github.io/" title="Go to repository">
<div class="md-source__icon md-icon">
<svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"></path></svg>
</div>
<div class="md-source__repository">
    xestray
  </div>
</a>
</div>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_1" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../../..">
<span class="md-ellipsis">
    
  
    Home
  

    
  </span>
</a>
<label class="md-nav__link" for="__nav_1" id="__nav_1_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_1_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_1">
<span class="md-nav__icon md-icon"></span>
            
  
    Home
  

          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../changelog/">
<span class="md-ellipsis">
    
  
    更新记录
  

    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" id="__nav_2" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../../">
<span class="md-ellipsis">
    
  
    Computer Science
  

    
  </span>
</a>
<label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="true" aria-labelledby="__nav_2_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_2">
<span class="md-nav__icon md-icon"></span>
            
  
    Computer Science
  

          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--active md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" id="__nav_2_2" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../">
<span class="md-ellipsis">
    
  
    编程语言
  

    
  </span>
</a>
<label class="md-nav__link" for="__nav_2_2" id="__nav_2_2_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="true" aria-labelledby="__nav_2_2_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_2_2">
<span class="md-nav__icon md-icon"></span>
            
  
    编程语言
  

          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--active">
<input class="md-nav__toggle md-toggle" id="__toc" type="checkbox"/>
<label class="md-nav__link md-nav__link--active" for="__toc">
<span class="md-ellipsis">
    
  
    C++
  

    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<a class="md-nav__link md-nav__link--active" href="./">
<span class="md-ellipsis">
    
  
    C++
  

    
  </span>
</a>
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#_1">
<span class="md-ellipsis">
      
        变量
      
    </span>
</a>
<nav aria-label="变量" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#_2">
<span class="md-ellipsis">
      
        初始化
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#constexpr">
<span class="md-ellipsis">
      
        constexpr
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#constexpr_1">
<span class="md-ellipsis">
      
        constexpr 函数
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_3">
<span class="md-ellipsis">
      
        多文件程序与全局变量
      
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#stdstring">
<span class="md-ellipsis">
      
        std::string
      
    </span>
</a>
<nav aria-label="std::string" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#_4">
<span class="md-ellipsis">
      
        输入字符串
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#stdstring_1">
<span class="md-ellipsis">
      
        std::string 的长度
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#stdstring_2">
<span class="md-ellipsis">
      
        函数与 std::string
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#literals-for-stdstring">
<span class="md-ellipsis">
      
        Literals for std::string
      
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#stdstring_view">
<span class="md-ellipsis">
      
        std::string_view
      
    </span>
</a>
<nav aria-label="std::string_view" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#_5">
<span class="md-ellipsis">
      
        赋值
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#literals-for-stdstring_view">
<span class="md-ellipsis">
      
        Literals for std::string_view
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#viewer">
<span class="md-ellipsis">
      
        viewer
      
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_6">
<span class="md-ellipsis">
      
        类型
      
    </span>
</a>
<nav aria-label="类型" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#_7">
<span class="md-ellipsis">
      
        类型转换
      
    </span>
</a>
<nav aria-label="类型转换" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#numeric-promotions">
<span class="md-ellipsis">
      
        Numeric promotions
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#numeric-conversions">
<span class="md-ellipsis">
      
        Numeric conversions
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#arithmetic-conversions">
<span class="md-ellipsis">
      
        Arithmetic conversions
      
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_8">
<span class="md-ellipsis">
      
        类型别名
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_9">
<span class="md-ellipsis">
      
        类型推导
      
    </span>
</a>
<nav aria-label="类型推导" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#const">
<span class="md-ellipsis">
      
        类型推导会删除 const
      
    </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_10">
<span class="md-ellipsis">
      
        命名空间
      
    </span>
</a>
<nav aria-label="命名空间" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#_11">
<span class="md-ellipsis">
      
        作用域解析运算符
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_12">
<span class="md-ellipsis">
      
        命名空间的标识符解析
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_13">
<span class="md-ellipsis">
      
        命名空间中的前向声明
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_14">
<span class="md-ellipsis">
      
        嵌套命名空间
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#namespace-alias">
<span class="md-ellipsis">
      
        命名空间别名（namespace alias）
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_15">
<span class="md-ellipsis">
      
        未命名（匿名）命名空间
      
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_16">
<span class="md-ellipsis">
      
        函数
      
    </span>
</a>
<nav aria-label="函数" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#_17">
<span class="md-ellipsis">
      
        函数重载
      
    </span>
</a>
<nav aria-label="函数重载" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#_18">
<span class="md-ellipsis">
      
        函数重载解析与模糊匹配
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#ambiguous-match">
<span class="md-ellipsis">
      
        ambiguous match
      
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_19">
<span class="md-ellipsis">
      
        删除函数
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_20">
<span class="md-ellipsis">
      
        默认参数
      
    </span>
</a>
<nav aria-label="默认参数" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#_21">
<span class="md-ellipsis">
      
        默认参数可能导致模糊匹配
      
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_22">
<span class="md-ellipsis">
      
        函数模板
      
    </span>
</a>
<nav aria-label="函数模板" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#_23">
<span class="md-ellipsis">
      
        具有多个模板参数的函数模板
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_24">
<span class="md-ellipsis">
      
        非类型模板参数
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_25">
<span class="md-ellipsis">
      
        多文件程序中使用函数模板
      
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#constexpr_2">
<span class="md-ellipsis">
      
        constexpr 函数
      
    </span>
</a>
<nav aria-label="constexpr 函数" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#constexpr_3">
<span class="md-ellipsis">
      
        constexpr 函数是隐式内联的
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#consteval">
<span class="md-ellipsis">
      
        consteval
      
    </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_26">
<span class="md-ellipsis">
      
        引用
      
    </span>
</a>
<nav aria-label="引用" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#_27">
<span class="md-ellipsis">
      
        左值引用
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_28">
<span class="md-ellipsis">
      
        引用的生命周期
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#const_1">
<span class="md-ellipsis">
      
        const 左值引用
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_29">
<span class="md-ellipsis">
      
        按引用传递参数
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_30">
<span class="md-ellipsis">
      
        按引用返回
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_31">
<span class="md-ellipsis">
      
        关于引用的类型推导
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_32">
<span class="md-ellipsis">
      
        右值引用
      
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_33">
<span class="md-ellipsis">
      
        类模板
      
    </span>
</a>
<nav aria-label="类模板" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#_34">
<span class="md-ellipsis">
      
        函数中的类模板
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#ctad">
<span class="md-ellipsis">
      
        类模板参数推导（CTAD）
      
    </span>
</a>
<nav aria-label="类模板参数推导（CTAD）" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#c17">
<span class="md-ellipsis">
      
        模板参数推导指南（C++17）
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_35">
<span class="md-ellipsis">
      
        模板参数的默认值
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_36">
<span class="md-ellipsis">
      
        别名模板
      
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_37">
<span class="md-ellipsis">
      
        具有成员函数的类模板
      
    </span>
</a>
<nav aria-label="具有成员函数的类模板" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#_38">
<span class="md-ellipsis">
      
        注入类名
      
    </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_39">
<span class="md-ellipsis">
      
        类
      
    </span>
</a>
<nav aria-label="类" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#class-invariant">
<span class="md-ellipsis">
      
        类不变式（class invariant）
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_40">
<span class="md-ellipsis">
      
        成员函数
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#const-const">
<span class="md-ellipsis">
      
        const 对象和 const 成员函数
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_41">
<span class="md-ellipsis">
      
        访问说明符
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_42">
<span class="md-ellipsis">
      
        访问函数
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_43">
<span class="md-ellipsis">
      
        类成员的声明顺序
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_44">
<span class="md-ellipsis">
      
        构造函数
      
    </span>
</a>
<nav aria-label="构造函数" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#_45">
<span class="md-ellipsis">
      
        构造函数引入
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_46">
<span class="md-ellipsis">
      
        成员初始化列表
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_47">
<span class="md-ellipsis">
      
        默认构造函数
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_48">
<span class="md-ellipsis">
      
        委托构造函数
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_49">
<span class="md-ellipsis">
      
        复制构造函数
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_50">
<span class="md-ellipsis">
      
        转换构造函数
      
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#this">
<span class="md-ellipsis">
      
        this 关键字
      
    </span>
</a>
<nav aria-label="this 关键字" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#this_1">
<span class="md-ellipsis">
      
        this 是被如何设置的
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#this_2">
<span class="md-ellipsis">
      
        函数返回 *this
      
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_51">
<span class="md-ellipsis">
      
        析构函数
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_52">
<span class="md-ellipsis">
      
        友元函数和友元类
      
    </span>
</a>
<nav aria-label="友元函数和友元类" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#_53">
<span class="md-ellipsis">
      
        友元非成员函数
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_54">
<span class="md-ellipsis">
      
        友元类
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_55">
<span class="md-ellipsis">
      
        友元成员函数
      
    </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#lambda">
<span class="md-ellipsis">
      
        lambda 表达式
      
    </span>
</a>
<nav aria-label="lambda 表达式" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#_56">
<span class="md-ellipsis">
      
        简单引入
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_57">
<span class="md-ellipsis">
      
        捕获子句
      
    </span>
</a>
<nav aria-label="捕获子句" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#_58">
<span class="md-ellipsis">
      
        默认捕获
      
    </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_59">
<span class="md-ellipsis">
      
        运算符重载
      
    </span>
</a>
<nav aria-label="运算符重载" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#_60">
<span class="md-ellipsis">
      
        简单的运算符重载
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_61">
<span class="md-ellipsis">
      
        使用友元函数重载操作符
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_62">
<span class="md-ellipsis">
      
        使用普通函数重载运算符
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_63">
<span class="md-ellipsis">
      
        使用成员函数重载运算符
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#-">
<span class="md-ellipsis">
      
        重载 ++ 和 -- 运算符
      
    </span>
</a>
<nav aria-label="重载 ++ 和 -- 运算符" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#_64">
<span class="md-ellipsis">
      
        前缀递增和递减
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_65">
<span class="md-ellipsis">
      
        后缀递增和递减
      
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_66">
<span class="md-ellipsis">
      
        重载括号运算符 ()
      
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_67">
<span class="md-ellipsis">
      
        智能指针和移动语义
      
    </span>
</a>
<nav aria-label="智能指针和移动语义" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#_68">
<span class="md-ellipsis">
      
        简单概念和引入
      
    </span>
</a>
<nav aria-label="简单概念和引入" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#_69">
<span class="md-ellipsis">
      
        智能指针
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_70">
<span class="md-ellipsis">
      
        移动语义
      
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_71">
<span class="md-ellipsis">
      
        移动构造函数和移动赋值运算符
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#stdmove">
<span class="md-ellipsis">
      
        std::move
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#stdunique_ptr">
<span class="md-ellipsis">
      
        std::unique_ptr
      
    </span>
</a>
<nav aria-label="std::unique_ptr" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#stdmake_unique">
<span class="md-ellipsis">
      
        std::make_unique
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#stdunique_ptr_1">
<span class="md-ellipsis">
      
        std::unique_ptr 的实际应用
      
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#stdshared_ptr">
<span class="md-ellipsis">
      
        std::shared_ptr
      
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_72">
<span class="md-ellipsis">
      
        继承
      
    </span>
</a>
<nav aria-label="继承" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#_73">
<span class="md-ellipsis">
      
        派生类的初始化
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_74">
<span class="md-ellipsis">
      
        访问说明符
      
    </span>
</a>
<nav aria-label="访问说明符" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#public-inheritance">
<span class="md-ellipsis">
      
        public inheritance
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#protected-inheritance">
<span class="md-ellipsis">
      
        protected inheritance
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#private-inheritance">
<span class="md-ellipsis">
      
        private inheritance
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_75">
<span class="md-ellipsis">
      
        一个例子
      
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_76">
<span class="md-ellipsis">
      
        调用与覆盖继承的函数
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_77">
<span class="md-ellipsis">
      
        多重继承（多继承）
      
    </span>
</a>
<nav aria-label="多重继承（多继承）" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#_78">
<span class="md-ellipsis">
      
        多继承导致的问题
      
    </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_79">
<span class="md-ellipsis">
      
        虚函数（虚拟函数）
      
    </span>
</a>
<nav aria-label="虚函数（虚拟函数）" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#overridefinal-covariant">
<span class="md-ellipsis">
      
        override、final 和 covariant 返回类型
      
    </span>
</a>
<nav aria-label="override、final 和 covariant 返回类型" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#override">
<span class="md-ellipsis">
      
        override
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#final">
<span class="md-ellipsis">
      
        final
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_80">
<span class="md-ellipsis">
      
        协变返回类型
      
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_81">
<span class="md-ellipsis">
      
        虚析构函数
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_82">
<span class="md-ellipsis">
      
        纯虚函数、抽象类和接口类
      
    </span>
</a>
<nav aria-label="纯虚函数、抽象类和接口类" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#_83">
<span class="md-ellipsis">
      
        纯虚函数和抽象基类
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_84">
<span class="md-ellipsis">
      
        接口类
      
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#dynamic-casting">
<span class="md-ellipsis">
      
        dynamic casting
      
    </span>
</a>
<nav aria-label="dynamic casting" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#dynamic_cast">
<span class="md-ellipsis">
      
        dynamic_cast
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#static_cast-downcasting">
<span class="md-ellipsis">
      
        使用 static_cast 进行 downcasting
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#dynamic_cast_1">
<span class="md-ellipsis">
      
        dynamic_cast 与参考
      
    </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_85">
<span class="md-ellipsis">
      
        异常
      
    </span>
</a>
<nav aria-label="异常" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#_86">
<span class="md-ellipsis">
      
        基本的异常处理
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_87">
<span class="md-ellipsis">
      
        异常处理的堆栈展开
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_88">
<span class="md-ellipsis">
      
        异常类与派生
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_89">
<span class="md-ellipsis">
      
        重新抛出异常
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#noexcept">
<span class="md-ellipsis">
      
        noexcept 说明符
      
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_90">
<span class="md-ellipsis">
      
        其他
      
    </span>
</a>
<nav aria-label="其他" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#_91">
<span class="md-ellipsis">
      
        头文件
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_92">
<span class="md-ellipsis">
      
        输入输出
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_93">
<span class="md-ellipsis">
      
        逻辑异或
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#if-constexpr-statement">
<span class="md-ellipsis">
      
        if constexpr statement
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#assert">
<span class="md-ellipsis">
      
        assert
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#for-each-loop">
<span class="md-ellipsis">
      
        for-each loop
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_94">
<span class="md-ellipsis">
      
        注释
      
    </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_2_3" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../../ADS/">
<span class="md-ellipsis">
    
  
    高级数据结构与算法分析
  

    
  </span>
</a>
<label class="md-nav__link" for="__nav_2_3" id="__nav_2_3_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_2_3_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_2_3">
<span class="md-nav__icon md-icon"></span>
            
  
    高级数据结构与算法分析
  

          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../ADS/lec-1/">
<span class="md-ellipsis">
    
  
    AVL树与Splay树与摊还分析
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../ADS/lec-2/">
<span class="md-ellipsis">
    
  
    红黑树与B+树
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../ADS/lec-3/">
<span class="md-ellipsis">
    
  
    倒排文件索引
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../ADS/lec-4/">
<span class="md-ellipsis">
    
  
    左倾堆与斜堆
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../ADS/lec-5/">
<span class="md-ellipsis">
    
  
    二项堆
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../ADS/lec-6/">
<span class="md-ellipsis">
    
  
    回溯法
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../ADS/lec-7/">
<span class="md-ellipsis">
    
  
    分治法
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../ADS/lec-8/">
<span class="md-ellipsis">
    
  
    动态规划
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../ADS/lec-9/">
<span class="md-ellipsis">
    
  
    贪心算法
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../ADS/lec-10/">
<span class="md-ellipsis">
    
  
    NP完全性
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../ADS/lec-11/">
<span class="md-ellipsis">
    
  
    近似算法
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../ADS/lec-12/">
<span class="md-ellipsis">
    
  
    局部搜索
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../ADS/lec-13/">
<span class="md-ellipsis">
    
  
    随机算法
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../ADS/lec-14/">
<span class="md-ellipsis">
    
  
    并行算法
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../ADS/lec-15/">
<span class="md-ellipsis">
    
  
    外部排序
  

    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_2_4" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../../COD/">
<span class="md-ellipsis">
    
  
    计算机组成与设计
  

    
  </span>
</a>
<label class="md-nav__link" for="__nav_2_4" id="__nav_2_4_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_2_4_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_2_4">
<span class="md-nav__icon md-icon"></span>
            
  
    计算机组成与设计
  

          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../COD/chap-1/">
<span class="md-ellipsis">
    
  
    计算机概要与技术
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../COD/chap-2/">
<span class="md-ellipsis">
    
  
    指令：计算机的语言
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../COD/chap-3/">
<span class="md-ellipsis">
    
  
    计算机的算数运算
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../COD/chap-4/">
<span class="md-ellipsis">
    
  
    处理器
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../COD/chap-5/">
<span class="md-ellipsis">
    
  
    内存层次架构
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../COD/chap-6/">
<span class="md-ellipsis">
    
  
    储存和 IO
  

    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_2_5" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../../CA/">
<span class="md-ellipsis">
    
  
    计算机体系结构
  

    
  </span>
</a>
<label class="md-nav__link" for="__nav_2_5" id="__nav_2_5_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_2_5_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_2_5">
<span class="md-nav__icon md-icon"></span>
            
  
    计算机体系结构
  

          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../CA/chap-1/">
<span class="md-ellipsis">
    
  
    计算机设计基础
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../CA/chap-2/">
<span class="md-ellipsis">
    
  
    流水线
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../CA/chap-3/">
<span class="md-ellipsis">
    
  
    内存层次
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../CA/chap-4/">
<span class="md-ellipsis">
    
  
    指令级并行
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../CA/chap-5/">
<span class="md-ellipsis">
    
  
    DLP 和 TLP
  

    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_2_6" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../../DB/">
<span class="md-ellipsis">
    
  
    数据库系统
  

    
  </span>
</a>
<label class="md-nav__link" for="__nav_2_6" id="__nav_2_6_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_2_6_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_2_6">
<span class="md-nav__icon md-icon"></span>
            
  
    数据库系统
  

          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../DB/lec-1/">
<span class="md-ellipsis">
    
  
    数据库介绍
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../DB/lec-2/">
<span class="md-ellipsis">
    
  
    关系模型
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../DB/lec-3/">
<span class="md-ellipsis">
    
  
    SQL
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../DB/lec-4/">
<span class="md-ellipsis">
    
  
    SQL 进阶
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../DB/lec-5/">
<span class="md-ellipsis">
    
  
    E-R 模型
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../DB/lec-6/">
<span class="md-ellipsis">
    
  
    关系数据库设计
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../DB/lec-7/">
<span class="md-ellipsis">
    
  
    存储与文件结构
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../DB/lec-8/">
<span class="md-ellipsis">
    
  
    索引与哈希
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../DB/lec-9/">
<span class="md-ellipsis">
    
  
    查询处理
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../DB/lec-10/">
<span class="md-ellipsis">
    
  
    查询优化
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../DB/lec-11/">
<span class="md-ellipsis">
    
  
    事务管理
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../DB/lec-12/">
<span class="md-ellipsis">
    
  
    并发控制
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../DB/lec-13/">
<span class="md-ellipsis">
    
  
    数据库恢复
  

    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_2_7" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../../OOP/">
<span class="md-ellipsis">
    
  
    面向对象程序设计
  

    
  </span>
</a>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_2_7_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_2_7">
<span class="md-nav__icon md-icon"></span>
            
  
    面向对象程序设计
  

          </label>
<ul class="md-nav__list" data-md-scrollfix="">
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_2_8" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../../CV/">
<span class="md-ellipsis">
    
  
    计算机视觉
  

    
  </span>
</a>
<label class="md-nav__link" for="__nav_2_8" id="__nav_2_8_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_2_8_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_2_8">
<span class="md-nav__icon md-icon"></span>
            
  
    计算机视觉
  

          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../CV/lec1/">
<span class="md-ellipsis">
    
  
    二值图像
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../CV/lec2/">
<span class="md-ellipsis">
    
  
    边缘检测
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../CV/lec3/">
<span class="md-ellipsis">
    
  
    轮廓拟合
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../CV/lec4/">
<span class="md-ellipsis">
    
  
    图像特征
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../CV/lec5/">
<span class="md-ellipsis">
    
  
    特征人脸
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../CV/lec6/">
<span class="md-ellipsis">
    
  
    单目视觉
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../CV/lec7/">
<span class="md-ellipsis">
    
  
    运动估计 &amp; 图像分割
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../CV/lec8/">
<span class="md-ellipsis">
    
  
    图像分类 &amp; CNN
  

    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_2_9" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../../IDV/">
<span class="md-ellipsis">
    
  
    数据可视化导论
  

    
  </span>
</a>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_2_9_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_2_9">
<span class="md-nav__icon md-icon"></span>
            
  
    数据可视化导论
  

          </label>
<ul class="md-nav__list" data-md-scrollfix="">
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_2_10" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../../NA/">
<span class="md-ellipsis">
    
  
    数值分析
  

    
  </span>
</a>
<label class="md-nav__link" for="__nav_2_10" id="__nav_2_10_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_2_10_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_2_10">
<span class="md-nav__icon md-icon"></span>
            
  
    数值分析
  

          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../NA/chap-1/">
<span class="md-ellipsis">
    
  
    Chap 1 数学基础
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../NA/chap-2/">
<span class="md-ellipsis">
    
  
    Chap 2 单变量方程的解
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../NA/chap-3/">
<span class="md-ellipsis">
    
  
    Chap 3 插值与多项式逼近
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../NA/chap-4/">
<span class="md-ellipsis">
    
  
    Chap 4 数值微分与积分
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../NA/chap-5/">
<span class="md-ellipsis">
    
  
    Chap 5 常微分方程的初值问题
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../NA/chap-6/">
<span class="md-ellipsis">
    
  
    Chap 6 解线性系统的直接方法
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../NA/chap-7/">
<span class="md-ellipsis">
    
  
    Chap 7 矩阵代数中的迭代方法
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../NA/chap-8/">
<span class="md-ellipsis">
    
  
    Chap 8 逼近理论
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../NA/chap-9/">
<span class="md-ellipsis">
    
  
    Chap 9 逼近特征值
  

    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_2_11" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../../ASM/">
<span class="md-ellipsis">
    
  
    汇编与接口
  

    
  </span>
</a>
<label class="md-nav__link" for="__nav_2_11" id="__nav_2_11_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_2_11_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_2_11">
<span class="md-nav__icon md-icon"></span>
            
  
    汇编与接口
  

          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../ASM/chap-1/">
<span class="md-ellipsis">
    
  
    Chap 1
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../ASM/chap-2/">
<span class="md-ellipsis">
    
  
    Chap 2
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../ASM/chap-3/">
<span class="md-ellipsis">
    
  
    Chap 3
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../ASM/chap-4/">
<span class="md-ellipsis">
    
  
    Chap 4
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../ASM/chap-5/">
<span class="md-ellipsis">
    
  
    Chap 5
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../ASM/chap-6/">
<span class="md-ellipsis">
    
  
    Chap 6
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../ASM/chap-9/">
<span class="md-ellipsis">
    
  
    Chap 9
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../ASM/chap-11/">
<span class="md-ellipsis">
    
  
    Chap 11
  

    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_2_12" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../../OS/">
<span class="md-ellipsis">
    
  
    操作系统
  

    
  </span>
</a>
<label class="md-nav__link" for="__nav_2_12" id="__nav_2_12_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_2_12_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_2_12">
<span class="md-nav__icon md-icon"></span>
            
  
    操作系统
  

          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../OS/chap01/">
<span class="md-ellipsis">
    
  
    引言
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../OS/chap02/">
<span class="md-ellipsis">
    
  
    OS 结构
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../OS/chap03/">
<span class="md-ellipsis">
    
  
    进程
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../OS/chap04/">
<span class="md-ellipsis">
    
  
    线程
  

    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_2_13" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../../selfstudy/">
<span class="md-ellipsis">
    
  
    自学课程
  

    
  </span>
</a>
<label class="md-nav__link" for="__nav_2_13" id="__nav_2_13_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_2_13_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_2_13">
<span class="md-nav__icon md-icon"></span>
            
  
    自学课程
  

          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../selfstudy/CS106L/cs106l/">
<span class="md-ellipsis">
    
  
    CS106L
  

    
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_2_13_3" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../../selfstudy/EECS498/">
<span class="md-ellipsis">
    
  
    EECS498
  

    
  </span>
</a>
<label class="md-nav__link" for="__nav_2_13_3" id="__nav_2_13_3_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_2_13_3_label" class="md-nav" data-md-level="3">
<label class="md-nav__title" for="__nav_2_13_3">
<span class="md-nav__icon md-icon"></span>
            
  
    EECS498
  

          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../selfstudy/EECS498/lec1/">
<span class="md-ellipsis">
    
  
    Image Classification
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../selfstudy/EECS498/lec2/">
<span class="md-ellipsis">
    
  
    Linear Classification
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../selfstudy/EECS498/lec3/">
<span class="md-ellipsis">
    
  
    Regularization + Optimization
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../selfstudy/EECS498/lec4/">
<span class="md-ellipsis">
    
  
    Neural Networks
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../selfstudy/EECS498/lec5/">
<span class="md-ellipsis">
    
  
    Backpropagation
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../selfstudy/EECS498/lec6/">
<span class="md-ellipsis">
    
  
    Convolutional Neural Networks
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../selfstudy/EECS498/lec7/">
<span class="md-ellipsis">
    
  
    CNN Architectures Ⅰ
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../selfstudy/EECS498/lec8/">
<span class="md-ellipsis">
    
  
    Training Neural Networks Ⅰ
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../selfstudy/EECS498/lec9/">
<span class="md-ellipsis">
    
  
    Training Neural Networks Ⅱ
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../selfstudy/EECS498/lec10/">
<span class="md-ellipsis">
    
  
    CNN Architectures Ⅱ
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../selfstudy/EECS498/lec11/">
<span class="md-ellipsis">
    
  
    Deep Learning Software
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../selfstudy/EECS498/lec12/">
<span class="md-ellipsis">
    
  
    Object Detection
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../selfstudy/EECS498/lec13/">
<span class="md-ellipsis">
    
  
    Image Segmentation
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../selfstudy/EECS498/lec14/">
<span class="md-ellipsis">
    
  
    Recurrent Networks
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../selfstudy/EECS498/lec15/">
<span class="md-ellipsis">
    
  
    Attention
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../selfstudy/EECS498/lec16/">
<span class="md-ellipsis">
    
  
    Generative Models Ⅰ
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../selfstudy/EECS498/lec17/">
<span class="md-ellipsis">
    
  
    Generative Models Ⅱ
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../selfstudy/EECS498/lec18/">
<span class="md-ellipsis">
    
  
    Visualizing Models and Generating Images
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../selfstudy/EECS498/lec19/">
<span class="md-ellipsis">
    
  
    3D vision
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../selfstudy/EECS498/lec20/">
<span class="md-ellipsis">
    
  
    Videos
  

    
  </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_2_14" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../../Misc/">
<span class="md-ellipsis">
    
  
    杂项
  

    
  </span>
</a>
<label class="md-nav__link" for="__nav_2_14" id="__nav_2_14_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_2_14_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_2_14">
<span class="md-nav__icon md-icon"></span>
            
  
    杂项
  

          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../Misc/makefile/">
<span class="md-ellipsis">
    
  
    Makefile
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../Misc/cmake/">
<span class="md-ellipsis">
    
  
    CMake
  

    
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_2_14_4" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../../Misc/TMS/">
<span class="md-ellipsis">
    
  
    The Missing Semester
  

    
  </span>
</a>
<label class="md-nav__link" for="__nav_2_14_4" id="__nav_2_14_4_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_2_14_4_label" class="md-nav" data-md-level="3">
<label class="md-nav__title" for="__nav_2_14_4">
<span class="md-nav__icon md-icon"></span>
            
  
    The Missing Semester
  

          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../Misc/TMS/shell/">
<span class="md-ellipsis">
    
  
    Shell
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../Misc/TMS/vim/">
<span class="md-ellipsis">
    
  
    Vim
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../Misc/TMS/data-wrangling/">
<span class="md-ellipsis">
    
  
    数据整理
  

    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_2_14_5" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../../../CTF/">
<span class="md-ellipsis">
    
  
    CTF
  

    
  </span>
</a>
<label class="md-nav__link" for="__nav_2_14_5" id="__nav_2_14_5_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_2_14_5_label" class="md-nav" data-md-level="3">
<label class="md-nav__title" for="__nav_2_14_5">
<span class="md-nav__icon md-icon"></span>
            
  
    CTF
  

          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_2_14_5_2" type="checkbox"/>
<label class="md-nav__link" for="__nav_2_14_5_2" id="__nav_2_14_5_2_label" tabindex="0">
<span class="md-ellipsis">
    
  
    基础周
  

    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_2_14_5_2_label" class="md-nav" data-md-level="4">
<label class="md-nav__title" for="__nav_2_14_5_2">
<span class="md-nav__icon md-icon"></span>
            
  
    基础周
  

          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../CTF/fundament/lec1-Intro/">
<span class="md-ellipsis">
    
  
    lec1-Intro
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../CTF/fundament/lec2-Web/">
<span class="md-ellipsis">
    
  
    lec2-Web
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../CTF/fundament/lec3-Misc/">
<span class="md-ellipsis">
    
  
    lec3-Misc
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../CTF/fundament/lec4-Rev/">
<span class="md-ellipsis">
    
  
    lec4-Reverse
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../CTF/fundament/lec5-Pwn/">
<span class="md-ellipsis">
    
  
    lec5-Pwn
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../CTF/fundament/lec6-Crypto/">
<span class="md-ellipsis">
    
  
    lec6-Crypto
  

    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_2_14_5_3" type="checkbox"/>
<label class="md-nav__link" for="__nav_2_14_5_3" id="__nav_2_14_5_3_label" tabindex="0">
<span class="md-ellipsis">
    
  
    专题周
  

    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_2_14_5_3_label" class="md-nav" data-md-level="4">
<label class="md-nav__title" for="__nav_2_14_5_3">
<span class="md-nav__icon md-icon"></span>
            
  
    专题周
  

          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_2_14_5_3_1" type="checkbox"/>
<label class="md-nav__link" for="__nav_2_14_5_3_1" id="__nav_2_14_5_3_1_label" tabindex="0">
<span class="md-ellipsis">
    
  
    Web
  

    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_2_14_5_3_1_label" class="md-nav" data-md-level="5">
<label class="md-nav__title" for="__nav_2_14_5_3_1">
<span class="md-nav__icon md-icon"></span>
            
  
    Web
  

          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../CTF/Web/Web-1/">
<span class="md-ellipsis">
    
  
    Web-1
  

    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_2_14_5_3_2" type="checkbox"/>
<label class="md-nav__link" for="__nav_2_14_5_3_2" id="__nav_2_14_5_3_2_label" tabindex="0">
<span class="md-ellipsis">
    
  
    Misc
  

    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_2_14_5_3_2_label" class="md-nav" data-md-level="5">
<label class="md-nav__title" for="__nav_2_14_5_3_2">
<span class="md-nav__icon md-icon"></span>
            
  
    Misc
  

          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../CTF/Misc/Misc-1/">
<span class="md-ellipsis">
    
  
    Misc-1
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../CTF/Misc/Misc-2/">
<span class="md-ellipsis">
    
  
    Misc-2
  

    
  </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_2_14_6" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../../datamarket/">
<span class="md-ellipsis">
    
  
    数据要素交易基础
  

    
  </span>
</a>
<label class="md-nav__link" for="__nav_2_14_6" id="__nav_2_14_6_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_2_14_6_label" class="md-nav" data-md-level="3">
<label class="md-nav__title" for="__nav_2_14_6">
<span class="md-nav__icon md-icon"></span>
            
  
    数据要素交易基础
  

          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../datamarket/game-theory1/">
<span class="md-ellipsis">
    
  
    博弈论基础1
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../datamarket/game-theory2/">
<span class="md-ellipsis">
    
  
    博弈论基础2
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../datamarket/Shapley/">
<span class="md-ellipsis">
    
  
    沙普利值
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../datamarket/mab/">
<span class="md-ellipsis">
    
  
    多臂老虎机算法
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../datamarket/auction/">
<span class="md-ellipsis">
    
  
    拍卖与机制设计基础
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../datamarket/opt/">
<span class="md-ellipsis">
    
  
    最优机制
  

    
  </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_3" type="checkbox"/>
<label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
<span class="md-ellipsis">
    
  
    数理
  

    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_3_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_3">
<span class="md-nav__icon md-icon"></span>
            
  
    数理
  

          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../MathematicsAndPhysics/MA/MA/">
<span class="md-ellipsis">
    
  
    数学分析
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../MathematicsAndPhysics/LA/LA/">
<span class="md-ellipsis">
    
  
    线性代数
  

    
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_3_3" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../../../MathematicsAndPhysics/Phy2/">
<span class="md-ellipsis">
    
  
    普通物理学Ⅱ
  

    
  </span>
</a>
<label class="md-nav__link" for="__nav_3_3" id="__nav_3_3_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_3_3_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_3_3">
<span class="md-nav__icon md-icon"></span>
            
  
    普通物理学Ⅱ
  

          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../MathematicsAndPhysics/Phy2/electrostatics/">
<span class="md-ellipsis">
    
  
    电学
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../MathematicsAndPhysics/Phy2/magnetostatics/">
<span class="md-ellipsis">
    
  
    磁学
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../MathematicsAndPhysics/Phy2/electrodynamics/">
<span class="md-ellipsis">
    
  
    电动力学
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../MathematicsAndPhysics/Phy2/maxwell/">
<span class="md-ellipsis">
    
  
    麦克斯韦方程组与电磁波
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../MathematicsAndPhysics/Phy2/geometrical_optics/">
<span class="md-ellipsis">
    
  
    几何光学
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../MathematicsAndPhysics/Phy2/wave_optics/">
<span class="md-ellipsis">
    
  
    波动光学
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../MathematicsAndPhysics/Phy2/quantum/">
<span class="md-ellipsis">
    
  
    量子力学
  

    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_3_4" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../../../MathematicsAndPhysics/Probability/">
<span class="md-ellipsis">
    
  
    概率论
  

    
  </span>
</a>
<label class="md-nav__link" for="__nav_3_4" id="__nav_3_4_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_3_4_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_3_4">
<span class="md-nav__icon md-icon"></span>
            
  
    概率论
  

          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../MathematicsAndPhysics/Probability/chap-1/">
<span class="md-ellipsis">
    
  
    事件及其概率
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../MathematicsAndPhysics/Probability/chap-2/">
<span class="md-ellipsis">
    
  
    随机变量与分布函数
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../MathematicsAndPhysics/Probability/chap-3/">
<span class="md-ellipsis">
    
  
    数字特征与特征函数
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../MathematicsAndPhysics/Probability/chap-4/">
<span class="md-ellipsis">
    
  
    极限定理
  

    
  </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_4" type="checkbox"/>
<label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
<span class="md-ellipsis">
    
  
    Others
  

    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_4_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_4">
<span class="md-nav__icon md-icon"></span>
            
  
    Others
  

          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../others/WhatToDo/">
<span class="md-ellipsis">
    
  
    干点啥
  

    
  </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#_1">
<span class="md-ellipsis">
      
        变量
      
    </span>
</a>
<nav aria-label="变量" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#_2">
<span class="md-ellipsis">
      
        初始化
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#constexpr">
<span class="md-ellipsis">
      
        constexpr
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#constexpr_1">
<span class="md-ellipsis">
      
        constexpr 函数
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_3">
<span class="md-ellipsis">
      
        多文件程序与全局变量
      
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#stdstring">
<span class="md-ellipsis">
      
        std::string
      
    </span>
</a>
<nav aria-label="std::string" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#_4">
<span class="md-ellipsis">
      
        输入字符串
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#stdstring_1">
<span class="md-ellipsis">
      
        std::string 的长度
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#stdstring_2">
<span class="md-ellipsis">
      
        函数与 std::string
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#literals-for-stdstring">
<span class="md-ellipsis">
      
        Literals for std::string
      
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#stdstring_view">
<span class="md-ellipsis">
      
        std::string_view
      
    </span>
</a>
<nav aria-label="std::string_view" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#_5">
<span class="md-ellipsis">
      
        赋值
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#literals-for-stdstring_view">
<span class="md-ellipsis">
      
        Literals for std::string_view
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#viewer">
<span class="md-ellipsis">
      
        viewer
      
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_6">
<span class="md-ellipsis">
      
        类型
      
    </span>
</a>
<nav aria-label="类型" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#_7">
<span class="md-ellipsis">
      
        类型转换
      
    </span>
</a>
<nav aria-label="类型转换" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#numeric-promotions">
<span class="md-ellipsis">
      
        Numeric promotions
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#numeric-conversions">
<span class="md-ellipsis">
      
        Numeric conversions
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#arithmetic-conversions">
<span class="md-ellipsis">
      
        Arithmetic conversions
      
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_8">
<span class="md-ellipsis">
      
        类型别名
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_9">
<span class="md-ellipsis">
      
        类型推导
      
    </span>
</a>
<nav aria-label="类型推导" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#const">
<span class="md-ellipsis">
      
        类型推导会删除 const
      
    </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_10">
<span class="md-ellipsis">
      
        命名空间
      
    </span>
</a>
<nav aria-label="命名空间" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#_11">
<span class="md-ellipsis">
      
        作用域解析运算符
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_12">
<span class="md-ellipsis">
      
        命名空间的标识符解析
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_13">
<span class="md-ellipsis">
      
        命名空间中的前向声明
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_14">
<span class="md-ellipsis">
      
        嵌套命名空间
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#namespace-alias">
<span class="md-ellipsis">
      
        命名空间别名（namespace alias）
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_15">
<span class="md-ellipsis">
      
        未命名（匿名）命名空间
      
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_16">
<span class="md-ellipsis">
      
        函数
      
    </span>
</a>
<nav aria-label="函数" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#_17">
<span class="md-ellipsis">
      
        函数重载
      
    </span>
</a>
<nav aria-label="函数重载" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#_18">
<span class="md-ellipsis">
      
        函数重载解析与模糊匹配
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#ambiguous-match">
<span class="md-ellipsis">
      
        ambiguous match
      
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_19">
<span class="md-ellipsis">
      
        删除函数
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_20">
<span class="md-ellipsis">
      
        默认参数
      
    </span>
</a>
<nav aria-label="默认参数" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#_21">
<span class="md-ellipsis">
      
        默认参数可能导致模糊匹配
      
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_22">
<span class="md-ellipsis">
      
        函数模板
      
    </span>
</a>
<nav aria-label="函数模板" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#_23">
<span class="md-ellipsis">
      
        具有多个模板参数的函数模板
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_24">
<span class="md-ellipsis">
      
        非类型模板参数
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_25">
<span class="md-ellipsis">
      
        多文件程序中使用函数模板
      
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#constexpr_2">
<span class="md-ellipsis">
      
        constexpr 函数
      
    </span>
</a>
<nav aria-label="constexpr 函数" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#constexpr_3">
<span class="md-ellipsis">
      
        constexpr 函数是隐式内联的
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#consteval">
<span class="md-ellipsis">
      
        consteval
      
    </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_26">
<span class="md-ellipsis">
      
        引用
      
    </span>
</a>
<nav aria-label="引用" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#_27">
<span class="md-ellipsis">
      
        左值引用
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_28">
<span class="md-ellipsis">
      
        引用的生命周期
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#const_1">
<span class="md-ellipsis">
      
        const 左值引用
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_29">
<span class="md-ellipsis">
      
        按引用传递参数
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_30">
<span class="md-ellipsis">
      
        按引用返回
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_31">
<span class="md-ellipsis">
      
        关于引用的类型推导
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_32">
<span class="md-ellipsis">
      
        右值引用
      
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_33">
<span class="md-ellipsis">
      
        类模板
      
    </span>
</a>
<nav aria-label="类模板" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#_34">
<span class="md-ellipsis">
      
        函数中的类模板
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#ctad">
<span class="md-ellipsis">
      
        类模板参数推导（CTAD）
      
    </span>
</a>
<nav aria-label="类模板参数推导（CTAD）" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#c17">
<span class="md-ellipsis">
      
        模板参数推导指南（C++17）
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_35">
<span class="md-ellipsis">
      
        模板参数的默认值
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_36">
<span class="md-ellipsis">
      
        别名模板
      
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_37">
<span class="md-ellipsis">
      
        具有成员函数的类模板
      
    </span>
</a>
<nav aria-label="具有成员函数的类模板" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#_38">
<span class="md-ellipsis">
      
        注入类名
      
    </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_39">
<span class="md-ellipsis">
      
        类
      
    </span>
</a>
<nav aria-label="类" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#class-invariant">
<span class="md-ellipsis">
      
        类不变式（class invariant）
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_40">
<span class="md-ellipsis">
      
        成员函数
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#const-const">
<span class="md-ellipsis">
      
        const 对象和 const 成员函数
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_41">
<span class="md-ellipsis">
      
        访问说明符
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_42">
<span class="md-ellipsis">
      
        访问函数
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_43">
<span class="md-ellipsis">
      
        类成员的声明顺序
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_44">
<span class="md-ellipsis">
      
        构造函数
      
    </span>
</a>
<nav aria-label="构造函数" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#_45">
<span class="md-ellipsis">
      
        构造函数引入
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_46">
<span class="md-ellipsis">
      
        成员初始化列表
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_47">
<span class="md-ellipsis">
      
        默认构造函数
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_48">
<span class="md-ellipsis">
      
        委托构造函数
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_49">
<span class="md-ellipsis">
      
        复制构造函数
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_50">
<span class="md-ellipsis">
      
        转换构造函数
      
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#this">
<span class="md-ellipsis">
      
        this 关键字
      
    </span>
</a>
<nav aria-label="this 关键字" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#this_1">
<span class="md-ellipsis">
      
        this 是被如何设置的
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#this_2">
<span class="md-ellipsis">
      
        函数返回 *this
      
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_51">
<span class="md-ellipsis">
      
        析构函数
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_52">
<span class="md-ellipsis">
      
        友元函数和友元类
      
    </span>
</a>
<nav aria-label="友元函数和友元类" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#_53">
<span class="md-ellipsis">
      
        友元非成员函数
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_54">
<span class="md-ellipsis">
      
        友元类
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_55">
<span class="md-ellipsis">
      
        友元成员函数
      
    </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#lambda">
<span class="md-ellipsis">
      
        lambda 表达式
      
    </span>
</a>
<nav aria-label="lambda 表达式" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#_56">
<span class="md-ellipsis">
      
        简单引入
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_57">
<span class="md-ellipsis">
      
        捕获子句
      
    </span>
</a>
<nav aria-label="捕获子句" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#_58">
<span class="md-ellipsis">
      
        默认捕获
      
    </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_59">
<span class="md-ellipsis">
      
        运算符重载
      
    </span>
</a>
<nav aria-label="运算符重载" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#_60">
<span class="md-ellipsis">
      
        简单的运算符重载
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_61">
<span class="md-ellipsis">
      
        使用友元函数重载操作符
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_62">
<span class="md-ellipsis">
      
        使用普通函数重载运算符
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_63">
<span class="md-ellipsis">
      
        使用成员函数重载运算符
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#-">
<span class="md-ellipsis">
      
        重载 ++ 和 -- 运算符
      
    </span>
</a>
<nav aria-label="重载 ++ 和 -- 运算符" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#_64">
<span class="md-ellipsis">
      
        前缀递增和递减
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_65">
<span class="md-ellipsis">
      
        后缀递增和递减
      
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_66">
<span class="md-ellipsis">
      
        重载括号运算符 ()
      
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_67">
<span class="md-ellipsis">
      
        智能指针和移动语义
      
    </span>
</a>
<nav aria-label="智能指针和移动语义" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#_68">
<span class="md-ellipsis">
      
        简单概念和引入
      
    </span>
</a>
<nav aria-label="简单概念和引入" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#_69">
<span class="md-ellipsis">
      
        智能指针
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_70">
<span class="md-ellipsis">
      
        移动语义
      
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_71">
<span class="md-ellipsis">
      
        移动构造函数和移动赋值运算符
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#stdmove">
<span class="md-ellipsis">
      
        std::move
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#stdunique_ptr">
<span class="md-ellipsis">
      
        std::unique_ptr
      
    </span>
</a>
<nav aria-label="std::unique_ptr" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#stdmake_unique">
<span class="md-ellipsis">
      
        std::make_unique
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#stdunique_ptr_1">
<span class="md-ellipsis">
      
        std::unique_ptr 的实际应用
      
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#stdshared_ptr">
<span class="md-ellipsis">
      
        std::shared_ptr
      
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_72">
<span class="md-ellipsis">
      
        继承
      
    </span>
</a>
<nav aria-label="继承" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#_73">
<span class="md-ellipsis">
      
        派生类的初始化
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_74">
<span class="md-ellipsis">
      
        访问说明符
      
    </span>
</a>
<nav aria-label="访问说明符" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#public-inheritance">
<span class="md-ellipsis">
      
        public inheritance
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#protected-inheritance">
<span class="md-ellipsis">
      
        protected inheritance
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#private-inheritance">
<span class="md-ellipsis">
      
        private inheritance
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_75">
<span class="md-ellipsis">
      
        一个例子
      
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_76">
<span class="md-ellipsis">
      
        调用与覆盖继承的函数
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_77">
<span class="md-ellipsis">
      
        多重继承（多继承）
      
    </span>
</a>
<nav aria-label="多重继承（多继承）" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#_78">
<span class="md-ellipsis">
      
        多继承导致的问题
      
    </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_79">
<span class="md-ellipsis">
      
        虚函数（虚拟函数）
      
    </span>
</a>
<nav aria-label="虚函数（虚拟函数）" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#overridefinal-covariant">
<span class="md-ellipsis">
      
        override、final 和 covariant 返回类型
      
    </span>
</a>
<nav aria-label="override、final 和 covariant 返回类型" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#override">
<span class="md-ellipsis">
      
        override
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#final">
<span class="md-ellipsis">
      
        final
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_80">
<span class="md-ellipsis">
      
        协变返回类型
      
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_81">
<span class="md-ellipsis">
      
        虚析构函数
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_82">
<span class="md-ellipsis">
      
        纯虚函数、抽象类和接口类
      
    </span>
</a>
<nav aria-label="纯虚函数、抽象类和接口类" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#_83">
<span class="md-ellipsis">
      
        纯虚函数和抽象基类
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_84">
<span class="md-ellipsis">
      
        接口类
      
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#dynamic-casting">
<span class="md-ellipsis">
      
        dynamic casting
      
    </span>
</a>
<nav aria-label="dynamic casting" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#dynamic_cast">
<span class="md-ellipsis">
      
        dynamic_cast
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#static_cast-downcasting">
<span class="md-ellipsis">
      
        使用 static_cast 进行 downcasting
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#dynamic_cast_1">
<span class="md-ellipsis">
      
        dynamic_cast 与参考
      
    </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_85">
<span class="md-ellipsis">
      
        异常
      
    </span>
</a>
<nav aria-label="异常" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#_86">
<span class="md-ellipsis">
      
        基本的异常处理
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_87">
<span class="md-ellipsis">
      
        异常处理的堆栈展开
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_88">
<span class="md-ellipsis">
      
        异常类与派生
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_89">
<span class="md-ellipsis">
      
        重新抛出异常
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#noexcept">
<span class="md-ellipsis">
      
        noexcept 说明符
      
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_90">
<span class="md-ellipsis">
      
        其他
      
    </span>
</a>
<nav aria-label="其他" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#_91">
<span class="md-ellipsis">
      
        头文件
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_92">
<span class="md-ellipsis">
      
        输入输出
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_93">
<span class="md-ellipsis">
      
        逻辑异或
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#if-constexpr-statement">
<span class="md-ellipsis">
      
        if constexpr statement
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#assert">
<span class="md-ellipsis">
      
        assert
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#for-each-loop">
<span class="md-ellipsis">
      
        for-each loop
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_94">
<span class="md-ellipsis">
      
        注释
      
    </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-content" data-md-component="content">
<nav aria-label="Navigation" class="md-path">
<ol class="md-path__list">
<li class="md-path__item">
<a class="md-path__link" href="../../../">
<span class="md-ellipsis">
    Computer Science
  </span>
</a>
</li>
<li class="md-path__item">
<a class="md-path__link" href="../../">
<span class="md-ellipsis">
    编程语言
  </span>
</a>
</li>
</ol>
</nav>
<article class="md-content__inner md-typeset">
<h1 id="c">C++ 笔记<a class="headerlink" href="#c" title="Permanent link">¶</a></h1>
<div style="margin-top: -30px; font-size: 0.75em; opacity: 0.7;">
<p><span class="twemoji"><svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 2A10 10 0 0 0 2 12a10 10 0 0 0 10 10 10 10 0 0 0 10-10h-2a8 8 0 0 1-8 8 8 8 0 0 1-8-8 8 8 0 0 1 8-8zm6.78 1a.7.7 0 0 0-.48.2l-1.22 1.21 2.5 2.5L20.8 5.7c.26-.26.26-.7 0-.95L19.25 3.2c-.13-.13-.3-.2-.47-.2m-2.41 2.12L9 12.5V15h2.5l7.37-7.38z"></path></svg></span> 约 38568 个字 <span class="twemoji"><svg viewbox="0 0 576 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M360.8 1.2c-17-4.9-34.7 5-39.6 22l-128 448c-4.9 17 5 34.7 22 39.6s34.7-5 39.6-22l128-448c4.9-17-5-34.7-22-39.6m64.6 136.1c-12.5 12.5-12.5 32.8 0 45.3l73.4 73.4-73.4 73.4c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0l96-96c12.5-12.5 12.5-32.8 0-45.3l-96-96c-12.5-12.5-32.8-12.5-45.3 0zm-274.7 0c-12.5-12.5-32.8-12.5-45.3 0l-96 96c-12.5 12.5-12.5 32.8 0 45.3l96 96c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L77.3 256l73.3-73.4c12.5-12.5 12.5-32.8 0-45.3z"></path></svg></span> 4285 行代码 <span class="twemoji"><svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 20c4.42 0 8-3.58 8-8s-3.58-8-8-8-8 3.58-8 8 3.58 8 8 8m0-18c5.5 0 10 4.5 10 10s-4.5 10-10 10C6.47 22 2 17.5 2 12S6.5 2 12 2m.5 11H11V7h1.5v4.26l3.7-2.13.75 1.3z"></path></svg></span> 预计阅读时间 208 分钟</p>
</div>
<div class="admonition quote">
<p class="admonition-title">写在前面的话</p>
<p>虽然之前已经在一定程度上了解并使用 C++ 了，但还未系统地学习过，这个页面主要用于记录我在学习 C++ 过程中的遇见的值得记忆和有意思的知识点（至少我是这么认为的）。</p>
<p>笔记主要来自于我在学习 <a href="https://www.learncpp.com/">www.learncpp.com</a> 和《C++ primer》过程中的一些总结，同时也会参考一些其他来自互联网的资料。</p>
<ul>
<li>笔记的初衷是在我本人遗忘某个知识点时可以快速地查阅，因此可能会有一些我认为是常识的内容没有记录在这里。</li>
<li>写这篇笔记的过程是不停往现有的笔记中加新东西，因此显得比较杂乱无章，也许将来某一天会把这些知识点系统性地整理一遍（会，会吗？）。</li>
</ul>
</div>
<h2 id="_1">变量<a class="headerlink" href="#_1" title="Permanent link">¶</a></h2>
<h3 id="_2">初始化<a class="headerlink" href="#_2" title="Permanent link">¶</a></h3>
<p>C++中有 5 种常见的初始化形式：
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1">1</a></span>
<span class="normal"><a href="#__codelineno-0-2">2</a></span>
<span class="normal"><a href="#__codelineno-0-3">3</a></span>
<span class="normal"><a href="#__codelineno-0-4">4</a></span>
<span class="normal"><a href="#__codelineno-0-5">5</a></span>
<span class="normal"><a href="#__codelineno-0-6">6</a></span>
<span class="normal"><a href="#__codelineno-0-7">7</a></span>
<span class="normal"><a href="#__codelineno-0-8">8</a></span>
<span class="normal"><a href="#__codelineno-0-9">9</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1"></a><span class="kt">int</span><span class="w"> </span><span class="n">a</span><span class="p">;</span><span class="w">         </span><span class="c1">// default-initialization     (no initializer)</span>
<a id="__codelineno-0-2" name="__codelineno-0-2"></a>
<a id="__codelineno-0-3" name="__codelineno-0-3"></a><span class="c1">// Traditional initialization forms:</span>
<a id="__codelineno-0-4" name="__codelineno-0-4"></a><span class="kt">int</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span><span class="p">;</span><span class="w">     </span><span class="c1">// copy-initialization        (initial value after equals sign)</span>
<a id="__codelineno-0-5" name="__codelineno-0-5"></a><span class="kt">int</span><span class="w"> </span><span class="nf">c</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="mi">6</span><span class="w"> </span><span class="p">);</span><span class="w">   </span><span class="c1">// direct-initialization      (initial value in parenthesis)</span>
<a id="__codelineno-0-6" name="__codelineno-0-6"></a>
<a id="__codelineno-0-7" name="__codelineno-0-7"></a><span class="c1">// Modern initialization forms (preferred):</span>
<a id="__codelineno-0-8" name="__codelineno-0-8"></a><span class="kt">int</span><span class="w"> </span><span class="n">d</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="mi">7</span><span class="w"> </span><span class="p">};</span><span class="w">   </span><span class="c1">// direct-list-initialization (initial value in braces)</span>
<a id="__codelineno-0-9" name="__codelineno-0-9"></a><span class="kt">int</span><span class="w"> </span><span class="n">e</span><span class="w"> </span><span class="p">{};</span><span class="w">      </span><span class="c1">// value-initialization       (empty braces)</span>
</code></pre></div></td></tr></table></div>
在第 4 种初始化方法中，<code>{}</code>被称为初始化器，它可以防止窄化（narrowing）的发生，是一种更加安全的初始化方法。
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-1-1">1</a></span>
<span class="normal"><a href="#__codelineno-1-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1"></a><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">5.3</span><span class="p">;</span><span class="w">   </span><span class="c1">// x = 5</span>
<a id="__codelineno-1-2" name="__codelineno-1-2"></a><span class="kt">int</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="mf">5.3</span><span class="w"> </span><span class="p">};</span><span class="w"> </span><span class="c1">// error: narrowing conversion of '5.3' from 'double' to 'int' inside { } [-Wnarrowing]</span>
</code></pre></div></td></tr></table></div>
除此之外，列表初始化也可以写成<code>int x = {5};</code>的形式，称为复制列表初始化（copy list initialization），但这种方法比较少见。</p>
<div class="admonition note">
<p class="admonition-title">何时使用<code>{ 0 }</code>和<code>{}</code>进行初始化？</p>
<ul>
<li>
<p>当我们希望初始化一个变量的值为 0 时，应该使用<code>{ 0 }</code>，如</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-2-1">1</a></span>
<span class="normal"><a href="#__codelineno-2-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1"></a><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">};</span>
<a id="__codelineno-2-2" name="__codelineno-2-2"></a><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">x</span><span class="p">;</span>
</code></pre></div></td></tr></table></div>
</li>
<li>
<p>当变量的初始化值是临时存在的，并且将要被替换时，应该使用<code>{}</code>，如</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-3-1">1</a></span>
<span class="normal"><a href="#__codelineno-3-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1"></a><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="p">{};</span>
<a id="__codelineno-3-2" name="__codelineno-3-2"></a><span class="n">std</span><span class="o">::</span><span class="n">cin</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">x</span><span class="p">;</span>
</code></pre></div></td></tr></table></div>
</li>
</ul>
</div>
<div class="admonition note">
<p class="admonition-title">未被使用的初始化变量</p>
<p>当我们初始化一个变量但未使用时，编译器会发出警告</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-4-1">1</a></span>
<span class="normal"><a href="#__codelineno-4-2">2</a></span>
<span class="normal"><a href="#__codelineno-4-3">3</a></span>
<span class="normal"><a href="#__codelineno-4-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-4-2" name="__codelineno-4-2"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="p">};</span>
<a id="__codelineno-4-3" name="__codelineno-4-3"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-4-4" name="__codelineno-4-4"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>一般而言我们可以通过直接删除掉或注释掉这个变量的声明来消除警告，但如果我们只是当前用不到这个变量，在将来可能会用到，我们可以通过在变量名前加上<code>[[maybe_unused]]</code>来消除警告。</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-5-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1"></a><span class="p">[[</span><span class="n">maybe_unused</span><span class="p">]]</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="p">};</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>此外，编译器在编译后可能会优化程序中的这些变量，因此通常来说它们不会影响性能。</li>
</ul>
</div>
<h3 id="constexpr">constexpr<a class="headerlink" href="#constexpr" title="Permanent link">¶</a></h3>
<p>编译器在编译时可能会对程序中一些常量进行优化，例如</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-6-1">1</a></span>
<span class="normal"><a href="#__codelineno-6-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1"></a><span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="p">};</span>
<a id="__codelineno-6-2" name="__codelineno-6-2"></a><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">x</span><span class="p">;</span>
</code></pre></div></td></tr></table></div>
<p>就可能会被编译器直接优化为</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-7-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1"></a><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="mi">5</span><span class="p">;</span>
</code></pre></div></td></tr></table></div>
<p>要实现上面这个程序在编译层面的<strong>优化</strong>，就需要编译器在<strong>编译时</strong>就得知这个变量是一个常量，并且知道这个常量的值是多少。但是对于上面的这个例子而言，编译器可能优化，也可能不优化，因为它通常并不能确定能否实现<strong>编译时优化</strong>（compile-time optimization）。</p>
<p>如果我们希望编译器总能在编译时优化这个常量，我们可以使用 <code>constexpr</code> 关键字提示编译器这个变量是一个在编译时就可以确定值的常量，格式为</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-8-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1"></a><span class="k">constexpr</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">expr</span><span class="w"> </span><span class="p">};</span>
</code></pre></div></td></tr></table></div>
<p>其中 <code>expr</code> 是一个在编译时就可计算出结果的表达式，称为常量表达式（constant expression）。</p>
<div class="admonition info">
<p class="admonition-title">常量表达式</p>
<p>通常而言，常量表达式包含以下内容：（较常见的内容）</p>
<ul>
<li>
<p>字面值常量（literal constants）</p>
<p>例如 <code>5</code>、<code>3.14</code>、<code>'a'</code>、<code>"hello"</code> 等</p>
</li>
<li>
<p>以常量表达式作为操作数的运算符</p>
<p>例如 <code>5 + 3</code>、<code>2 * sizeof(int)</code> 等</p>
</li>
<li>
<p><code>constexpr</code> 变量</p>
</li>
<li>
<p>被常量表达式初始化的常量整形变量</p>
<p>例如 <code>constexpr int x { 5 };</code>，这是一个来自于历史原因的例外——在现代 C++ 中，constexpr variable 是更优选</p>
</li>
<li>
<p>constexpr function calls with constant expression arguments </p>
<p>调用常量表达式作为参数的 constexpr 函数</p>
</li>
</ul>
<p>以下内容不能作为常量表达式被使用</p>
<ul>
<li>
<p>Non-const variables </p>
<p>非常量变量</p>
</li>
<li>
<p>操作数不是常量表达式的运算符</p>
</li>
<li>
<p>Const non-integral variables </p>
<p>非整型的常量变量（即使它是被一个 constexpr variable 初始化的）</p>
</li>
<li>
<p>调用 non-constexpr 函数的函数（即使函数的返回值是常量表达式）</p>
</li>
<li>函数的参数（即使是 constexpr 函数）</li>
<li>运算符 <code>new</code>，<code>delete</code>，<code>throw</code>，<code>typeid</code>，<code>operator,</code>（逗号运算符）</li>
</ul>
<p>包含以上任意一个的表达式都是运行时表达式（runtime expression）。</p>
</div>
<div class="admonition note">
<p class="admonition-title">const vs. constexpr</p>
<ul>
<li><code>const</code> 意味着变量的值在被初始化后不可改变。initializer 的值可以在编译时已知或运行时已知，这个变量在运行时才可被计算出来。</li>
<li><code>constexpr</code> 意味个变量可以在常量表达式中使用，它的值在编译时就已知，initializer 的值必须在编译时就已知，这个变量可在编译时或运行时被计算出来。</li>
</ul>
</div>
<div class="admonition extra">
<p class="admonition-title">Extra</p>
<p>一个常量表达式可以在编译时求值，但编译器不一定会这么做。编译器可能会选择在运行时求值，这样可以减少编译时间。</p>
<ul>
<li><strong>编译器只在需要常量表达式时才被要求在编译时计算常量表达式的值</strong>，也就是说，在不刚需常量表达式的语句中，编译器可以选择在编译时还是在运行时计算常量表达式的值。</li>
</ul>
<p>例如</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-9-1">1</a></span>
<span class="normal"><a href="#__codelineno-9-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1"></a><span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">4</span><span class="w"> </span><span class="p">};</span>
<a id="__codelineno-9-2" name="__codelineno-9-2"></a><span class="kt">int</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">4</span><span class="w"> </span><span class="p">};</span><span class="w"> </span>
</code></pre></div></td></tr></table></div>
<p>上面的 <code>x</code> 是一个常量变量，它的初始值必须在编译时就确定，因此编译器一定会在编译时就计算 <code>3 + 4</code> 的值。而 <code>y</code> 是一个非常量变量，编译器可以选择在编译时计算 <code>3 + 4</code> 的值，也可以选择在运行时计算。</p>
</div>
<h3 id="constexpr_1">constexpr 函数<a class="headerlink" href="#constexpr_1" title="Permanent link">¶</a></h3>
<p>constexpr 函数是可以在常量表达式中调用的函数。当 constexpr 函数需要在编译时就计算出结果时（例如它的返回值是一个 constexpr variable 的 initializer），它必须在编译时就运行；否则，它可以在程序编译时或运行时运行。</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-10-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-10-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-10-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-10-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-10-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-10-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-10-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-10-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-10-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-10-10">10</a></span>
<span class="normal"><a href="#__codelineno-10-11">11</a></span>
<span class="normal"><a href="#__codelineno-10-12">12</a></span>
<span class="normal"><a href="#__codelineno-10-13">13</a></span>
<span class="normal"><a href="#__codelineno-10-14">14</a></span>
<span class="normal"><a href="#__codelineno-10-15">15</a></span>
<span class="normal"><a href="#__codelineno-10-16">16</a></span>
<span class="normal"><a href="#__codelineno-10-17">17</a></span>
<span class="normal"><a href="#__codelineno-10-18">18</a></span>
<span class="normal"><a href="#__codelineno-10-19">19</a></span>
<span class="normal"><a href="#__codelineno-10-20">20</a></span>
<span class="normal"><a href="#__codelineno-10-21">21</a></span>
<span class="normal"><a href="#__codelineno-10-22">22</a></span>
<span class="normal"><a href="#__codelineno-10-23">23</a></span>
<span class="normal"><a href="#__codelineno-10-24">24</a></span>
<span class="normal"><a href="#__codelineno-10-25">25</a></span>
<span class="normal"><a href="#__codelineno-10-26">26</a></span>
<span class="normal"><a href="#__codelineno-10-27">27</a></span>
<span class="normal"><a href="#__codelineno-10-28">28</a></span>
<span class="normal"><a href="#__codelineno-10-29">29</a></span>
<span class="normal"><a href="#__codelineno-10-30">30</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span>
<a id="__codelineno-10-2" name="__codelineno-10-2"></a>
<a id="__codelineno-10-3" name="__codelineno-10-3"></a><span class="kt">int</span><span class="w"> </span><span class="nf">max</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">y</span><span class="p">)</span><span class="w"> </span><span class="c1">// this is a non-constexpr function</span>
<a id="__codelineno-10-4" name="__codelineno-10-4"></a><span class="p">{</span>
<a id="__codelineno-10-5" name="__codelineno-10-5"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">y</span><span class="p">)</span>
<a id="__codelineno-10-6" name="__codelineno-10-6"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">x</span><span class="p">;</span>
<a id="__codelineno-10-7" name="__codelineno-10-7"></a><span class="w">    </span><span class="k">else</span>
<a id="__codelineno-10-8" name="__codelineno-10-8"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">y</span><span class="p">;</span>
<a id="__codelineno-10-9" name="__codelineno-10-9"></a><span class="p">}</span>
<a id="__codelineno-10-10" name="__codelineno-10-10"></a>
<a id="__codelineno-10-11" name="__codelineno-10-11"></a><span class="k">constexpr</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">cmax</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">y</span><span class="p">)</span><span class="w"> </span><span class="c1">// this is a constexpr function</span>
<a id="__codelineno-10-12" name="__codelineno-10-12"></a><span class="p">{</span>
<a id="__codelineno-10-13" name="__codelineno-10-13"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">y</span><span class="p">)</span>
<a id="__codelineno-10-14" name="__codelineno-10-14"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">x</span><span class="p">;</span>
<a id="__codelineno-10-15" name="__codelineno-10-15"></a><span class="w">    </span><span class="k">else</span>
<a id="__codelineno-10-16" name="__codelineno-10-16"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">y</span><span class="p">;</span>
<a id="__codelineno-10-17" name="__codelineno-10-17"></a><span class="p">}</span>
<a id="__codelineno-10-18" name="__codelineno-10-18"></a>
<a id="__codelineno-10-19" name="__codelineno-10-19"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span>
<a id="__codelineno-10-20" name="__codelineno-10-20"></a><span class="p">{</span>
<a id="__codelineno-10-21" name="__codelineno-10-21"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">m1</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">max</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="p">)</span><span class="w"> </span><span class="p">};</span><span class="w">            </span><span class="c1">// ok</span>
<a id="__codelineno-10-22" name="__codelineno-10-22"></a><span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">m2</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">max</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="p">)</span><span class="w"> </span><span class="p">};</span><span class="w">      </span><span class="c1">// ok</span>
<a id="__codelineno-10-23" name="__codelineno-10-23"></a><span class="w">    </span><span class="k">constexpr</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">m3</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">max</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="p">)</span><span class="w"> </span><span class="p">};</span><span class="w">  </span><span class="c1">// compile error: max(5, 6) not a constant expression</span>
<a id="__codelineno-10-24" name="__codelineno-10-24"></a>
<a id="__codelineno-10-25" name="__codelineno-10-25"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">m1</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">cmax</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="p">)</span><span class="w"> </span><span class="p">};</span><span class="w">           </span><span class="c1">// ok: may evaluate at compile-time or runtime</span>
<a id="__codelineno-10-26" name="__codelineno-10-26"></a><span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">m2</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">cmax</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="p">)</span><span class="w"> </span><span class="p">};</span><span class="w">     </span><span class="c1">// ok: may evaluate at compile-time or runtime</span>
<a id="__codelineno-10-27" name="__codelineno-10-27"></a><span class="w">    </span><span class="k">constexpr</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">m3</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">cmax</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="p">)</span><span class="w"> </span><span class="p">};</span><span class="w"> </span><span class="c1">// okay: must evaluate at compile-time</span>
<a id="__codelineno-10-28" name="__codelineno-10-28"></a>
<a id="__codelineno-10-29" name="__codelineno-10-29"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-10-30" name="__codelineno-10-30"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h3 id="_3">多文件程序与全局变量<a class="headerlink" href="#_3" title="Permanent link">¶</a></h3>
<ul>
<li>非 const 的全局变量被认为是 <code>extern</code> 的，即它可以被其他文件访问。如果我们在一个文件中定义了一个全局变量，而在另一个文件中使用这个全局变量，我们需要在使用的文件中前向声明这个全局变量。</li>
<li>const 的全局变量会被默认是 <code>static</code> 的，即它只能被当前的文件访问和使用。如果我们希望在另一个文件中使用这个 const 全局变量，我们需要在定义的文件中使用 <code>extern</code> 关键字来定义这个 const 全局变量，同时在使用它的文件中前向声明这个 const 全局变量。</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><th class="filename" colspan="2"><span class="filename">main.cpp</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-11-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-11-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-11-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-11-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-11-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-11-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-11-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-11-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-11-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-11-10">10</a></span>
<span class="normal"><a href="#__codelineno-11-11">11</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span>
<a id="__codelineno-11-2" name="__codelineno-11-2"></a>
<a id="__codelineno-11-3" name="__codelineno-11-3"></a><span class="k">extern</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">g_x</span><span class="p">;</span><span class="w">       </span><span class="c1">// this extern is a forward declaration of a variable named g_x that is defined somewhere else</span>
<a id="__codelineno-11-4" name="__codelineno-11-4"></a><span class="k">extern</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">g_y</span><span class="p">;</span><span class="w"> </span><span class="c1">// this extern is a forward declaration of a const variable named g_y that is defined somewhere else</span>
<a id="__codelineno-11-5" name="__codelineno-11-5"></a>
<a id="__codelineno-11-6" name="__codelineno-11-6"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span>
<a id="__codelineno-11-7" name="__codelineno-11-7"></a><span class="p">{</span>
<a id="__codelineno-11-8" name="__codelineno-11-8"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">g_x</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="sc">' '</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">g_y</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="sc">'\n'</span><span class="p">;</span><span class="w"> </span><span class="c1">// prints 2 3</span>
<a id="__codelineno-11-9" name="__codelineno-11-9"></a>
<a id="__codelineno-11-10" name="__codelineno-11-10"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-11-11" name="__codelineno-11-11"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<div class="highlight"><table class="highlighttable"><tr><th class="filename" colspan="2"><span class="filename">a.cpp</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-12-1">1</a></span>
<span class="normal"><a href="#__codelineno-12-2">2</a></span>
<span class="normal"><a href="#__codelineno-12-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1"></a><span class="c1">// global variable definitions</span>
<a id="__codelineno-12-2" name="__codelineno-12-2"></a><span class="kt">int</span><span class="w"> </span><span class="n">g_x</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">};</span><span class="w">              </span><span class="c1">// non-constant globals have external linkage by default</span>
<a id="__codelineno-12-3" name="__codelineno-12-3"></a><span class="k">extern</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">g_y</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="p">};</span><span class="w"> </span><span class="c1">// this extern gives g_y external linkage</span>
</code></pre></div></td></tr></table></div>
<div class="admonition abstract">
<p class="admonition-title">Abstract</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-13-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-13-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-13-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-13-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-13-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-13-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-13-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-13-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-13-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-13-10">10</a></span>
<span class="normal"><a href="#__codelineno-13-11">11</a></span>
<span class="normal"><a href="#__codelineno-13-12">12</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1"></a><span class="c1">// Global variable forward declarations (extern w/ no initializer):</span>
<a id="__codelineno-13-2" name="__codelineno-13-2"></a><span class="k">extern</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">g_y</span><span class="p">;</span><span class="w">                 </span><span class="c1">// forward declaration for non-constant global variable</span>
<a id="__codelineno-13-3" name="__codelineno-13-3"></a><span class="k">extern</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">g_y</span><span class="p">;</span><span class="w">           </span><span class="c1">// forward declaration for const global variable</span>
<a id="__codelineno-13-4" name="__codelineno-13-4"></a><span class="k">extern</span><span class="w"> </span><span class="k">constexpr</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">g_y</span><span class="p">;</span><span class="w">       </span><span class="c1">// not allowed: constexpr variables can't be forward declared</span>
<a id="__codelineno-13-5" name="__codelineno-13-5"></a>
<a id="__codelineno-13-6" name="__codelineno-13-6"></a><span class="c1">// External global variable definitions (no extern)</span>
<a id="__codelineno-13-7" name="__codelineno-13-7"></a><span class="kt">int</span><span class="w"> </span><span class="n">g_x</span><span class="p">;</span><span class="w">                        </span><span class="c1">// defines non-initialized external global variable (zero initialized by default)</span>
<a id="__codelineno-13-8" name="__codelineno-13-8"></a><span class="kt">int</span><span class="w"> </span><span class="n">g_x</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">};</span><span class="w">                  </span><span class="c1">// defines initialized external global variable</span>
<a id="__codelineno-13-9" name="__codelineno-13-9"></a>
<a id="__codelineno-13-10" name="__codelineno-13-10"></a><span class="c1">// External const global variable definitions (extern w/ initializer)</span>
<a id="__codelineno-13-11" name="__codelineno-13-11"></a><span class="k">extern</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">g_x</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">};</span><span class="w">     </span><span class="c1">// defines initialized const external global variable</span>
<a id="__codelineno-13-12" name="__codelineno-13-12"></a><span class="k">extern</span><span class="w"> </span><span class="k">constexpr</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">g_x</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="p">};</span><span class="w"> </span><span class="c1">// defines initialized constexpr external global variable</span>
</code></pre></div></td></tr></table></div>
</div>
<h2 id="stdstring">std::string<a class="headerlink" href="#stdstring" title="Permanent link">¶</a></h2>
<p>传统的 C 风格字符串是一个字符数组，以空字符 <code>'\0'</code> 结尾，它在一些情况下使用并不方便（例如不能通过赋值来为字符串分配新的值）。为此 C++17 引入了两种额外的字符串类型：<code>std::string</code>（需要 <code>#include &lt;string&gt;</code>） 和 <code>std::string_view</code>需要 <code>#include &lt;string_view&gt;</code>）。它们并不是 fundamental type 而是 class type，因此它们有一些额外的功能。</p>
<p><code>std::string</code> 可以通过赋值语句来更新字符串的值，也可以储存不同大小的字符串</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-14-1">1</a></span>
<span class="normal"><a href="#__codelineno-14-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1"></a><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">name1</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s">"Chihaya"</span><span class="w"> </span><span class="p">};</span>
<a id="__codelineno-14-2" name="__codelineno-14-2"></a><span class="n">name1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"Nagasaki"</span><span class="p">;</span>
</code></pre></div></td></tr></table></div>
<p>在上面的例子中，我们使用长度为 8 的 C 风格字符串 <code>"Chihaya"</code> 初始化了 <code>name1</code>（包括空字符 <code>'\0'</code>），但 <code>std::string</code> 也可以使用其他的 <code>std::string</code> 对象来初始化或赋值</p>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>如果 <code>std::string</code> 没有足够的内存来存储字符串，它将使用动态内存分配来请求额外的内存空间存储字符串。这意味着 <code>std::string</code> 可以存储任意长度的字符串，只要系统内存足够，但也意味着 <code>std::string</code> 的操作可能会比 C 风格字符串慢。</p>
</div>
<h3 id="_4">输入字符串<a class="headerlink" href="#_4" title="Permanent link">¶</a></h3>
<p>当我们直接使用 <code>std::cin</code> 来输入字符串时，它会在遇到空白字符（空格、制表符、换行符等）时停止输入，因此我们无法输入包含空白字符的字符串。</p>
<p>对于这种情况，我们可以使用 <code>std::getline()</code> 来读取整行的输入。<code>std::getline()</code> 需要两个参数：第一个是 <code>std::cin</code>，第二个是一个 <code>std::string</code> 对象，它会读取整行的输入并存储到这个 <code>std::string</code> 对象中。</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-15-1">1</a></span>
<span class="normal"><a href="#__codelineno-15-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1"></a><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">name</span><span class="p">{};</span>
<a id="__codelineno-15-2" name="__codelineno-15-2"></a><span class="n">std</span><span class="o">::</span><span class="n">getline</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">cin</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">ws</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="p">);</span>
</code></pre></div></td></tr></table></div>
<p>上面这个程序会把整行的输入 <code>Nagasaki Soyo</code> 都存储到 <code>name</code> 中，而如果直接用 <code>std::cin</code> 的话，只会存储 <code>Nagasaki</code>。  </p>
<div class="admonition question">
<p class="admonition-title"><code>std::ws</code> 是啥</p>
<p><code>std::ws</code> 是一个操纵符（manipulator），它会告诉 <code>std::cin</code> 忽略输入流中的前导空白字符（空格、制表符、换行符等）。</p>
<p>在上面的例子中，我们使用 <code>std::ws</code> 来忽略 <code>std::cin</code> 中的前导空白字符，这样可以保证 <code>std::getline()</code> 不会读取到有效信息之前的空白字符，直到遇到换行符为止才会停止读取。</p>
</div>
<h3 id="stdstring_1">std::string 的长度<a class="headerlink" href="#stdstring_1" title="Permanent link">¶</a></h3>
<p><code>std::string</code> 是一个类类型，我们可以直接调用它的成员函数 <code>length()</code> 来获取字符串的长度，比如 </p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-16-1">1</a></span>
<span class="normal"><a href="#__codelineno-16-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1"></a><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s">"Chihaya"</span><span class="w"> </span><span class="p">};</span>
<a id="__codelineno-16-2" name="__codelineno-16-2"></a><span class="n">name</span><span class="p">.</span><span class="n">length</span><span class="p">();</span><span class="w"> </span><span class="c1">// 7</span>
</code></pre></div></td></tr></table></div>
<p>尽管 <code>std::string</code> 要求以 null 字符结尾（从 C++11 开始），但 <code>length()</code> 并不会把 null 终止字符计算在内。</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p><code>std::string::length()</code> 返回的是一个无符号整数值（很可能是 <code>size_t</code>），因此如果我们想要把字符串的长度分配给一个 <code>int</code> 变量，最好使用 <code>static_cast</code> 来避免编译器出现有关有符号/无符号转换警告。</p>
</div>
<div class="admonition extra">
<p class="admonition-title">获取字符串长度的其他方法</p>
<p>在 C++20 中，我们还可以使用 <code>std::ssize()</code> 函数来用一个大的有符号整数来获取 <code>std::string</code> 的长度（通常为 <code>std::ptrdiff_t</code>）</p>
<p>由于 <code>std::ptrdiff_t</code> 可能大于 <code>int</code>，因此如果我们要用一个 <code>int</code> 变量来保存长度，也要使用 <code>static_cast</code> 来避免警告。</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-17-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-17-1" name="__codelineno-17-1"></a><span class="kt">int</span><span class="w"> </span><span class="n">len</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">ssize</span><span class="p">(</span><span class="n">name</span><span class="p">))</span><span class="w"> </span><span class="p">};</span>
</code></pre></div></td></tr></table></div>
</div>
<h3 id="stdstring_2">函数与 std::string<a class="headerlink" href="#stdstring_2" title="Permanent link">¶</a></h3>
<p>由于 <code>std::string</code> 的初始化成本很高，当我们把 <code>std::string</code> 作为函数的参数时，我们应该尽量避免使用按值传递，因为这会导致函数参数的拷贝初始化，在大部分情况下，我们应该使用引用传递或是改用 <code>std::string_view</code> 作为参数。</p>
<p>类似地，在大多数情况下，我们也应该避免在函数中按值返回 <code>std::string</code>，因为这同样会产生一个昂贵的副本。</p>
<h3 id="literals-for-stdstring">Literals for std::string<a class="headerlink" href="#literals-for-stdstring" title="Permanent link">¶</a></h3>
<p>默认情况下，<code>"Hello"</code> 会被认为是一个 C 风格字符串，它的类型是 <code>const char[6]</code>，是一个字面量常量（literal constant）。</p>
<p>如果我们想要创建一个 <code>std::string</code> 类型的字面量，我们可以在双引号后添加一个 <code>s</code> 后缀，其中 <code>s</code> 必须小写，例如 <code>"Hello"s</code>。</p>
<ul>
<li><code>s</code> 后缀在命名空间 <code>std::literals::string_literals</code> 中定义，我们可以使用 <code>using namespace std::literals::string_literals;</code> 来使用它。因为这个命名空间中的定义几乎不会和任何其他代码发生冲突，因此我们直接 <code>using</code> 是安全的。</li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><code>"Hello"s</code> 会被解析为 <code>std::string { "Hello", 5 }</code>，它创建一个临时的使用 C 风格字符串字面量来初始化的 <code>std::string</code> 对象（长度为 5，不包括隐式 null 终止符）。 </p>
</div>
<h2 id="stdstring_view">std::string_view<a class="headerlink" href="#stdstring_view" title="Permanent link">¶</a></h2>
<p>我们上面提到过 <code>std::string</code> 进行初始化（或复制）的开销很大，例如下面的例子中，为了输出一个字符串，我们不得不制作了 <code>"Hello, world!"</code> 的两个副本：一个是在 <code>main()</code> 中初始化 <code>std::string</code> 对象 <code>s</code>，另一个是在 <code>printString()</code> 中初始化参数 <code>str</code>。</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-18-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-18-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-18-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-18-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-18-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-18-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-18-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-18-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-18-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-18-10">10</a></span>
<span class="normal"><a href="#__codelineno-18-11">11</a></span>
<span class="normal"><a href="#__codelineno-18-12">12</a></span>
<span class="normal"><a href="#__codelineno-18-13">13</a></span>
<span class="normal"><a href="#__codelineno-18-14">14</a></span>
<span class="normal"><a href="#__codelineno-18-15">15</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-18-1" name="__codelineno-18-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span>
<a id="__codelineno-18-2" name="__codelineno-18-2"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;string&gt;</span>
<a id="__codelineno-18-3" name="__codelineno-18-3"></a>
<a id="__codelineno-18-4" name="__codelineno-18-4"></a><span class="kt">void</span><span class="w"> </span><span class="nf">printString</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">str</span><span class="p">)</span><span class="w"> </span><span class="c1">// str makes a copy of its initializer</span>
<a id="__codelineno-18-5" name="__codelineno-18-5"></a><span class="p">{</span>
<a id="__codelineno-18-6" name="__codelineno-18-6"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">str</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="sc">'\n'</span><span class="p">;</span>
<a id="__codelineno-18-7" name="__codelineno-18-7"></a><span class="p">}</span>
<a id="__codelineno-18-8" name="__codelineno-18-8"></a>
<a id="__codelineno-18-9" name="__codelineno-18-9"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span>
<a id="__codelineno-18-10" name="__codelineno-18-10"></a><span class="p">{</span>
<a id="__codelineno-18-11" name="__codelineno-18-11"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">s</span><span class="p">{</span><span class="w"> </span><span class="s">"Hello, world!"</span><span class="w"> </span><span class="p">};</span><span class="w"> </span><span class="c1">// s makes a copy of its initializer</span>
<a id="__codelineno-18-12" name="__codelineno-18-12"></a><span class="w">    </span><span class="n">printString</span><span class="p">(</span><span class="n">s</span><span class="p">);</span>
<a id="__codelineno-18-13" name="__codelineno-18-13"></a>
<a id="__codelineno-18-14" name="__codelineno-18-14"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-18-15" name="__codelineno-18-15"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>为了避免初始化带来的开销，我们可以使用 <code>std::string_view</code> 来对一个<strong>现有</strong>字符串（C 风格字符串、<code>std::string</code> 对象或另一个 <code>std::string_view</code> 对象）的只读访问——可以访问和使用字符串的内容，但不能修改它。</p>
<div class="admonition tip">
<p class="admonition-title">如何理解 <code>std::string_view</code></p>
<p>“view” 的含义可以理解为它只是一个指向现有字符串的“视图”——比起直接制作一个完全相同的物体，我们拍一张照片带走以便于后续的观看显然更方便也更经济。</p>
</div>
<p>在下面的例子中我们在函数的参数声明中使用 <code>std::string_view</code> 来代替 <code>std::string</code>，从而避免了初始化 <code>std::string</code> 带来的开销。</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-19-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-19-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-19-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-19-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-19-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-19-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-19-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-19-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-19-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-19-10">10</a></span>
<span class="normal"><a href="#__codelineno-19-11">11</a></span>
<span class="normal"><a href="#__codelineno-19-12">12</a></span>
<span class="normal"><a href="#__codelineno-19-13">13</a></span>
<span class="normal"><a href="#__codelineno-19-14">14</a></span>
<span class="normal"><a href="#__codelineno-19-15">15</a></span>
<span class="normal"><a href="#__codelineno-19-16">16</a></span>
<span class="normal"><a href="#__codelineno-19-17">17</a></span>
<span class="normal"><a href="#__codelineno-19-18">18</a></span>
<span class="normal"><a href="#__codelineno-19-19">19</a></span>
<span class="normal"><a href="#__codelineno-19-20">20</a></span>
<span class="normal"><a href="#__codelineno-19-21">21</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-19-1" name="__codelineno-19-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span>
<a id="__codelineno-19-2" name="__codelineno-19-2"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;string&gt;</span>
<a id="__codelineno-19-3" name="__codelineno-19-3"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;string_view&gt;</span>
<a id="__codelineno-19-4" name="__codelineno-19-4"></a>
<a id="__codelineno-19-5" name="__codelineno-19-5"></a><span class="kt">void</span><span class="w"> </span><span class="nf">printSV</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">string_view</span><span class="w"> </span><span class="n">str</span><span class="p">)</span>
<a id="__codelineno-19-6" name="__codelineno-19-6"></a><span class="p">{</span>
<a id="__codelineno-19-7" name="__codelineno-19-7"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">str</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="sc">'\n'</span><span class="p">;</span>
<a id="__codelineno-19-8" name="__codelineno-19-8"></a><span class="p">}</span>
<a id="__codelineno-19-9" name="__codelineno-19-9"></a>
<a id="__codelineno-19-10" name="__codelineno-19-10"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span>
<a id="__codelineno-19-11" name="__codelineno-19-11"></a><span class="p">{</span>
<a id="__codelineno-19-12" name="__codelineno-19-12"></a><span class="w">    </span><span class="n">printSV</span><span class="p">(</span><span class="s">"Hello, world!"</span><span class="p">);</span><span class="w"> </span><span class="c1">// call with C-style string literal</span>
<a id="__codelineno-19-13" name="__codelineno-19-13"></a>
<a id="__codelineno-19-14" name="__codelineno-19-14"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">s2</span><span class="p">{</span><span class="w"> </span><span class="s">"Hello, world!"</span><span class="w"> </span><span class="p">};</span>
<a id="__codelineno-19-15" name="__codelineno-19-15"></a><span class="w">    </span><span class="n">printSV</span><span class="p">(</span><span class="n">s2</span><span class="p">);</span><span class="w"> </span><span class="c1">// call with std::string</span>
<a id="__codelineno-19-16" name="__codelineno-19-16"></a>
<a id="__codelineno-19-17" name="__codelineno-19-17"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">string_view</span><span class="w"> </span><span class="n">s3</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">s2</span><span class="w"> </span><span class="p">};</span>
<a id="__codelineno-19-18" name="__codelineno-19-18"></a><span class="w">    </span><span class="n">printSV</span><span class="p">(</span><span class="n">s3</span><span class="p">);</span><span class="w"> </span><span class="c1">// call with std::string_view</span>
<a id="__codelineno-19-19" name="__codelineno-19-19"></a>
<a id="__codelineno-19-20" name="__codelineno-19-20"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-19-21" name="__codelineno-19-21"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>我们还可以从上面的例子中得知一些关于 <code>std::string_view</code> 的特点：</p>
<ul>
<li><code>std::string_view</code> 可以用许多不同类型的字符串进行初始化，包括C 风格字符串、<code>std::string</code> 对象或另一个 <code>std::string_view</code> 对象。</li>
<li>当函数使用 <code>std::string_view</code> 作为参数时，我们可以直接传递 C 风格字符串、<code>std::string</code> 对象或另一个 <code>std::string_view</code> 对象，在传参过程中 C 风格字符串和 <code>std::string</code> 将会被隐式转换为 <code>std::string_view</code>。</li>
</ul>
<h3 id="_5">赋值<a class="headerlink" href="#_5" title="Permanent link">¶</a></h3>
<p>对 <code>std::string_view</code> 对象的赋值只会改变它查看的字符串，而不会改变原先查看字符串的任何内容。</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-20-1">1</a></span>
<span class="normal"><a href="#__codelineno-20-2">2</a></span>
<span class="normal"><a href="#__codelineno-20-3">3</a></span>
<span class="normal"><a href="#__codelineno-20-4">4</a></span>
<span class="normal"><a href="#__codelineno-20-5">5</a></span>
<span class="normal"><a href="#__codelineno-20-6">6</a></span>
<span class="normal"><a href="#__codelineno-20-7">7</a></span>
<span class="normal"><a href="#__codelineno-20-8">8</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-20-1" name="__codelineno-20-1"></a><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s">"Alex"</span><span class="w"> </span><span class="p">};</span>
<a id="__codelineno-20-2" name="__codelineno-20-2"></a><span class="n">std</span><span class="o">::</span><span class="n">string_view</span><span class="w"> </span><span class="n">sv</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="p">};</span>
<a id="__codelineno-20-3" name="__codelineno-20-3"></a><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">sv</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="sc">'\n'</span><span class="p">;</span><span class="w">    </span><span class="c1">// prints Alex</span>
<a id="__codelineno-20-4" name="__codelineno-20-4"></a>
<a id="__codelineno-20-5" name="__codelineno-20-5"></a><span class="n">sv</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"John"</span><span class="p">;</span>
<a id="__codelineno-20-6" name="__codelineno-20-6"></a><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">sv</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="sc">'\n'</span><span class="p">;</span><span class="w">    </span><span class="c1">// prints John</span>
<a id="__codelineno-20-7" name="__codelineno-20-7"></a>
<a id="__codelineno-20-8" name="__codelineno-20-8"></a><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="sc">'\n'</span><span class="p">;</span><span class="w">  </span><span class="c1">// prints Alex</span>
</code></pre></div></td></tr></table></div>
<p>上面的例子中，<code>sv = "John"</code> 会使 <code>sv</code> 转向查看字符串 <code>"John"</code>，但不会改变 <code>name</code> 的值。</p>
<h3 id="literals-for-stdstring_view">Literals for std::string_view<a class="headerlink" href="#literals-for-stdstring_view" title="Permanent link">¶</a></h3>
<p><code>std::string_view</code> 的字面量后缀是 <code>sv</code>，例如 <code>"Hello"sv</code>。它的定义在命名空间 <code>std::literals::string_view_literals</code> 中，我们也可以直接使用 <code>using namespace std::literals::string_view_literals;</code> 来使用它，原因和 <code>std::string</code> 的字面量后缀一样。</p>
<h3 id="viewer">viewer<a class="headerlink" href="#viewer" title="Permanent link">¶</a></h3>
<p><code>std::string_view</code> 在它的整个生命周期中都依赖于它所查看的字符串的存在，如果这个字符串被销毁了，那么 <code>std::string_view</code> 将会指向一个无效的内存地址，这会导致未定义行为。</p>
<div class="admonition note">
<p class="admonition-title">dangling view</p>
<p>当 <code>std::string_view</code> 指向一个已经被销毁的字符串时，我们称这个 <code>std::string_view</code> 为悬空视图（dangling view）。</p>
<ul>
<li>可以和悬空指针类比</li>
</ul>
<p>例如在下面几种情况中，<code>sv</code> 都会成为一个悬空视图：</p>
<div class="tabbed-set tabbed-alternate" data-tabs="1:3"><input checked="checked" id="__tabbed_1_1" name="__tabbed_1" type="radio"><input id="__tabbed_1_2" name="__tabbed_1" type="radio"><input id="__tabbed_1_3" name="__tabbed_1" type="radio"><div class="tabbed-labels"><label for="__tabbed_1_1">case 1</label><label for="__tabbed_1_2">case 2</label><label for="__tabbed_1_3">case 3</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><table class="highlighttable"><tr><th class="filename" colspan="2"><span class="filename">case 1</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-21-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-21-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-21-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-21-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-21-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-21-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-21-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-21-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-21-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-21-10">10</a></span>
<span class="normal"><a href="#__codelineno-21-11">11</a></span>
<span class="normal"><a href="#__codelineno-21-12">12</a></span>
<span class="normal"><a href="#__codelineno-21-13">13</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-21-1" name="__codelineno-21-1"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span>
<a id="__codelineno-21-2" name="__codelineno-21-2"></a><span class="p">{</span>
<a id="__codelineno-21-3" name="__codelineno-21-3"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">string_view</span><span class="w"> </span><span class="n">sv</span><span class="p">{};</span>
<a id="__codelineno-21-4" name="__codelineno-21-4"></a>
<a id="__codelineno-21-5" name="__codelineno-21-5"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-21-6" name="__codelineno-21-6"></a><span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">s</span><span class="p">{</span><span class="w"> </span><span class="s">"Hello, world!"</span><span class="w"> </span><span class="p">};</span>
<a id="__codelineno-21-7" name="__codelineno-21-7"></a><span class="w">        </span><span class="n">sv</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">s</span><span class="p">;</span>
<a id="__codelineno-21-8" name="__codelineno-21-8"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="c1">// s is destroyed here, so sv is now viewing an invalid string</span>
<a id="__codelineno-21-9" name="__codelineno-21-9"></a>
<a id="__codelineno-21-10" name="__codelineno-21-10"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">sv</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="sc">'\n'</span><span class="p">;</span><span class="w"> </span><span class="c1">// undefined behavior</span>
<a id="__codelineno-21-11" name="__codelineno-21-11"></a>
<a id="__codelineno-21-12" name="__codelineno-21-12"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-21-13" name="__codelineno-21-13"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>在第一种情况中，我们使用局部变量 <code>s</code> 初始化了 <code>sv</code>，但当 <code>s</code> 超出作用域时，它会被销毁，因此 <code>sv</code> 将会成为一个悬空视图。</p>
</div>
<div class="tabbed-block">
<div class="highlight"><table class="highlighttable"><tr><th class="filename" colspan="2"><span class="filename">case 2</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-22-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-22-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-22-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-22-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-22-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-22-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-22-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-22-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-22-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-22-10">10</a></span>
<span class="normal"><a href="#__codelineno-22-11">11</a></span>
<span class="normal"><a href="#__codelineno-22-12">12</a></span>
<span class="normal"><a href="#__codelineno-22-13">13</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-22-1" name="__codelineno-22-1"></a><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="nf">getName</span><span class="p">()</span>
<a id="__codelineno-22-2" name="__codelineno-22-2"></a><span class="p">{</span>
<a id="__codelineno-22-3" name="__codelineno-22-3"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s">"Alex"</span><span class="w"> </span><span class="p">};</span>
<a id="__codelineno-22-4" name="__codelineno-22-4"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">s</span><span class="p">;</span>
<a id="__codelineno-22-5" name="__codelineno-22-5"></a><span class="p">}</span>
<a id="__codelineno-22-6" name="__codelineno-22-6"></a>
<a id="__codelineno-22-7" name="__codelineno-22-7"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span>
<a id="__codelineno-22-8" name="__codelineno-22-8"></a><span class="p">{</span>
<a id="__codelineno-22-9" name="__codelineno-22-9"></a><span class="n">std</span><span class="o">::</span><span class="n">string_view</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">getName</span><span class="p">()</span><span class="w"> </span><span class="p">};</span><span class="w"> </span><span class="c1">// name initialized with return value of function</span>
<a id="__codelineno-22-10" name="__codelineno-22-10"></a><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="sc">'\n'</span><span class="p">;</span><span class="w"> </span><span class="c1">// undefined behavior</span>
<a id="__codelineno-22-11" name="__codelineno-22-11"></a>
<a id="__codelineno-22-12" name="__codelineno-22-12"></a><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-22-13" name="__codelineno-22-13"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>在第二种情况中，函数的返回值会存储在一个临时变量中，这个临时变量会被用于初始化 <code>name</code>，但这个初始化语句结束后，这个临时变量就会被销毁，因此 <code>name</code> 将会成为一个悬空视图。</p>
</div>
<div class="tabbed-block">
<div class="highlight"><table class="highlighttable"><tr><th class="filename" colspan="2"><span class="filename">case 3</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-23-1">1</a></span>
<span class="normal"><a href="#__codelineno-23-2">2</a></span>
<span class="normal"><a href="#__codelineno-23-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-23-1" name="__codelineno-23-1"></a><span class="k">using</span><span class="w"> </span><span class="k">namespace</span><span class="w"> </span><span class="nn">std</span><span class="o">::</span><span class="nn">string_literals</span><span class="p">;</span>
<a id="__codelineno-23-2" name="__codelineno-23-2"></a><span class="n">std</span><span class="o">::</span><span class="n">string_view</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s">"Alex"</span><span class="n">s</span><span class="w"> </span><span class="p">};</span><span class="w"> </span><span class="c1">// "Alex"s creates a temporary std::string</span>
<a id="__codelineno-23-3" name="__codelineno-23-3"></a><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="sc">'\n'</span><span class="p">;</span><span class="w"> </span><span class="c1">// undefined behavior</span>
</code></pre></div></td></tr></table></div>
<p>这种情况比较特别：<code>"Alex"s</code> 会创建一个临时的 <code>std::string</code> 对象，这个对象会被用于初始化 <code>name</code>，但这个初始化语句结束后，这个临时变量就会被销毁， <code>name</code> 就成为一个悬空视图了。</p>
</div>
</div>
</input></input></input></div>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<ul>
<li>不要使用 <code>std::string</code> 字面量来初始化一个 <code>std::string_view</code>。</li>
<li>使用 C 风格字符串字面量或者 <code>std::string_view</code> 字面量来初始化 <code>std::string_view</code> 是安全的，因为它们在整个程序的生命周期中都是有效的。</li>
<li>只要我们能够保证 C 风格字符串对象、<code>std::string</code> 对象或者 <code>std::string_view</code> 对象在 <code>std::string_view</code> 的整个生命周期中都是有效的，那么我们就可以使用它们来初始化 <code>std::string_view</code>。</li>
</ul>
</div>
<p>当 <code>std::string_view</code> 所指向的字符串对象被修改时，会导致未定义的行为</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-24-1">1</a></span>
<span class="normal"><a href="#__codelineno-24-2">2</a></span>
<span class="normal"><a href="#__codelineno-24-3">3</a></span>
<span class="normal"><a href="#__codelineno-24-4">4</a></span>
<span class="normal"><a href="#__codelineno-24-5">5</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-24-1" name="__codelineno-24-1"></a><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s">"Hello, world!"</span><span class="w"> </span><span class="p">};</span>
<a id="__codelineno-24-2" name="__codelineno-24-2"></a><span class="n">std</span><span class="o">::</span><span class="n">string_view</span><span class="w"> </span><span class="n">sv</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="p">};</span><span class="w"> </span><span class="c1">// sv is now viewing s</span>
<a id="__codelineno-24-3" name="__codelineno-24-3"></a>
<a id="__codelineno-24-4" name="__codelineno-24-4"></a><span class="n">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"Hello, a!"</span><span class="p">;</span><span class="w">    </span><span class="c1">// modifies s, which invalidates sv (s is still valid)</span>
<a id="__codelineno-24-5" name="__codelineno-24-5"></a><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">sv</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="sc">'\n'</span><span class="p">;</span><span class="w">   </span><span class="c1">// undefined behavior</span>
</code></pre></div></td></tr></table></div>
<p>上面的例子中，可能出现两种情况：</p>
<ul>
<li>当 <code>s</code> 重新分配内存以存储新的字符串数据时，它会把原先的内存释放掉，这会导致 <code>sv</code> 指向的内存地址无效</li>
<li>
<p>当 <code>s</code> 仍然使用原先的内存地址来存储新的字符串数据时，<code>s</code> 会用新的字符串数据覆盖原先的字符串数据，<code>std::string_view</code> 会查看新的字符串</p>
<ul>
<li>如果新字符串比原先的字符串长，那么 <code>std::string_view</code> 查看到的是新字符串的子串</li>
<li>如果新字符串比原先的字符串短，那么 <code>std::string_view</code> 查看到的是新字符串加上一些随机的垃圾字符</li>
</ul>
</li>
</ul>
<div class="admonition tip">
<p class="admonition-title"><code>std::string_view</code> 未必以 <code>'\0'</code> 结尾</p>
<p>由于 <code>std::string_view</code> 可以查看一个字符串的子串，因此它的结尾不一定是 <code>'\0'</code>，这意味着在绝大多数情况下我们不能把 <code>std::string_view</code> 当作 C 风格字符串来使用。当我们需要一个以 <code>'\0'</code> 结尾的字符串时，我们应该使用 <code>std::string</code>。</p>
</div>
<div class="admonition abstract">
<p class="admonition-title">Abstract</p>
<ul>
<li>
<p><code>std::string</code></p>
<ul>
<li>初始化和复制 <code>std::string</code> 的成本很高，应尽量避免</li>
<li>尽可能避免按值传递 <code>std::string</code>，应该使用引用传递或 <code>std::string_view</code></li>
<li>对 <code>std::string</code> 的任何修改都会使得对应的 <code>std::string_view</code> 称为悬空视图</li>
<li>可以按值返回一个本地的 <code>std::string</code> 对象</li>
</ul>
</li>
<li>
<p><code>std::string_view</code></p>
<ul>
<li><code>std::string_view</code> 是一个只读的字符串视图</li>
<li>由于 C 风格字符串在整个程序的生命周期中都是有效的，因此总可以使用 C 风格字符串来初始化 <code>std::string_view</code></li>
<li>使用一个已经无效了的（dangling） <code>std::string_view</code> 会导致未定义行为</li>
</ul>
</li>
</ul>
</div>
<hr/>
<h2 id="_6">类型<a class="headerlink" href="#_6" title="Permanent link">¶</a></h2>
<h3 id="_7">类型转换<a class="headerlink" href="#_7" title="Permanent link">¶</a></h3>
<p>C++ 标准定义了将不同的基本类型（以及某些情况下的复合类型）转换为其他类型的规则，称为标准类型转换（standard type conversions）。标准转换可大致分为 4 类，</p>
<ul>
<li>Numeric promotions</li>
<li>Numeric conversions</li>
<li>Arithmetic conversions</li>
<li>Other conversions</li>
</ul>
<h4 id="numeric-promotions">Numeric promotions<a class="headerlink" href="#numeric-promotions" title="Permanent link">¶</a></h4>
<p>numeric promotion 指的是将<em>较小（或称较窄）</em>的整数类型转换为<em>较大（或称较宽）</em>的整数类型，在转换的过程中不会出现数据的丢失。</p>
<p>numeric promotion 包括两大类：</p>
<ol>
<li>
<p>浮点数提升（floating-point promotion）</p>
<p>将 <code>float</code> 类型转换为 <code>double</code> 类型</p>
</li>
<li>
<p>整型提升（integer promotion）</p>
<p>常见的整型提升包括</p>
<ul>
<li>有符号的 <code>char</code> 或有符号的 <code>short</code> 转换为 <code>int</code></li>
<li>如果 <code>int</code> 能保存 <code>unsigned char</code>、<code>char8_t</code>、<code>unsigned short</code> 的整个范围，那么就转换为 <code>int</code>，否则转换为 <code>unsigned int</code></li>
<li><code>bool</code> 可以被转换为 <code>int</code>，其中 <code>true</code> 转换为 <code>1</code>，<code>false</code> 转换为 <code>0</code></li>
</ul>
</li>
</ol>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>一些类型转换并不被认为是 numeric promotion，而被认为是 numeric conversion，例如 <code>char</code> 到 <code>short</code>，因为 <code>int</code> 到 <code>long</code> 在大多数系统中都是相同大小的。</p>
</div>
<h4 id="numeric-conversions">Numeric conversions<a class="headerlink" href="#numeric-conversions" title="Permanent link">¶</a></h4>
<p>数值转换（numeric conversion）有五种基本类型</p>
<ol>
<li>
<p>将一种整型数据转换为任何其他的整型数据（不包括整型提升）</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-25-1">1</a></span>
<span class="normal"><a href="#__codelineno-25-2">2</a></span>
<span class="normal"><a href="#__codelineno-25-3">3</a></span>
<span class="normal"><a href="#__codelineno-25-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-25-1" name="__codelineno-25-1"></a><span class="kt">short</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="p">;</span><span class="w">        </span><span class="c1">// convert int to short</span>
<a id="__codelineno-25-2" name="__codelineno-25-2"></a><span class="kt">long</span><span class="w"> </span><span class="n">l</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="p">;</span><span class="w">         </span><span class="c1">// convert int to long</span>
<a id="__codelineno-25-3" name="__codelineno-25-3"></a><span class="kt">char</span><span class="w"> </span><span class="n">ch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">s</span><span class="p">;</span><span class="w">        </span><span class="c1">// convert short to char</span>
<a id="__codelineno-25-4" name="__codelineno-25-4"></a><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">u</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="p">;</span><span class="w"> </span><span class="c1">// convert int to unsigned int</span>
</code></pre></div></td></tr></table></div>
</li>
<li>
<p>将一种浮点类型数据转换为任意其他的浮点类型（不包括浮点提升）</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-26-1">1</a></span>
<span class="normal"><a href="#__codelineno-26-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-26-1" name="__codelineno-26-1"></a><span class="kt">float</span><span class="w"> </span><span class="n">f</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">3.0</span><span class="p">;</span><span class="w">        </span><span class="c1">// convert double to float</span>
<a id="__codelineno-26-2" name="__codelineno-26-2"></a><span class="kt">long</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">ld</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">3.0</span><span class="p">;</span><span class="w"> </span><span class="c1">// convert double to long double</span>
</code></pre></div></td></tr></table></div>
</li>
<li>
<p>将一种浮点类型转换为任意整型</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-27-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-27-1" name="__codelineno-27-1"></a><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">3.14</span><span class="p">;</span><span class="w"> </span><span class="c1">// convert double to int</span>
</code></pre></div></td></tr></table></div>
</li>
<li>
<p>将一种整型转换为浮点类型</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-28-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-28-1" name="__codelineno-28-1"></a><span class="kt">double</span><span class="w"> </span><span class="n">d</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="p">;</span><span class="w"> </span><span class="c1">// convert int to double</span>
</code></pre></div></td></tr></table></div>
</li>
<li>
<p>将整型或浮点类型转换为 bool</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-29-1">1</a></span>
<span class="normal"><a href="#__codelineno-29-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-29-1" name="__codelineno-29-1"></a><span class="kt">bool</span><span class="w"> </span><span class="n">b1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="p">;</span><span class="w">    </span><span class="c1">// convert int to bool</span>
<a id="__codelineno-29-2" name="__codelineno-29-2"></a><span class="kt">bool</span><span class="w"> </span><span class="n">b2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">3.14</span><span class="p">;</span><span class="w"> </span><span class="c1">// convert double to bool</span>
</code></pre></div></td></tr></table></div>
</li>
</ol>
<h4 id="arithmetic-conversions">Arithmetic conversions<a class="headerlink" href="#arithmetic-conversions" title="Permanent link">¶</a></h4>
<p>以下运算符要求它的操作数具有相同的类型，当操作数的类型不同时，会发生隐式类型转换，称为算术转换（arithmetic conversion）。</p>
<ul>
<li>二元算数运算符 <code>+</code>、<code>-</code>、<code>*</code>、<code>/</code>、<code>%</code></li>
<li>二元关系运算符 <code>==</code>、<code>!=</code>、<code>&lt;</code>、<code>&gt;</code>、<code>&lt;=</code>、<code>&gt;=</code></li>
<li>二进制按位算术运算符 <code>&amp;</code>、<code>|</code>、<code>^</code></li>
<li>
<p>条件运算符 <code>? :</code></p>
<p>条件运算符的第一个参数会被认为是布尔类型，因此不要求它与后两个参数类型相同。</p>
</li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>重载运算符不受通常的算术转换规则的约束。</p>
</div>
<p>算术转换的规则较为复杂，因此我们这里只介绍化简过后的规则。</p>
<p>编译器会对各种类型进行一个排名</p>
<ul>
<li>long double</li>
<li>double</li>
<li>float</li>
<li>long long</li>
<li>long</li>
<li>int</li>
<li>short</li>
</ul>
<p>它会参考以下的规则来决定如何进行算术转换</p>
<ol>
<li>
<p>将两种类型进行简单转换</p>
<ul>
<li>如果一个是整型另一个是浮点型，那么整型将会被转换为浮点型</li>
<li>如果两种类型同为整型或同为浮点型，那么会先进行数值提升（numeric promotion）</li>
</ul>
</li>
<li>
<p>将两种类型变为相同的类型</p>
<ul>
<li>如果此时两种类型一个是有符号的，另一个是无符号的，则参考下面的特殊规则</li>
<li>否则，排名较低的操作数将会转换为排名较高的操作数的类型</li>
</ul>
</li>
</ol>
<div class="admonition note">
<p class="admonition-title">无符号数与有符号数的转换</p>
<ul>
<li>如果无符号操作数的排名大于等于有符号操作数的排名，那么有符号操作数将会被转换为无符号操作数的类型。</li>
<li>如果有符号操作数的类型可以表示无符号操作数类型中的所有值，则无符号操作数将会被转换为有符号操作数的类型。</li>
<li>否则，两个操作数都转换为有符号操作数相应的无符号类型。</li>
</ul>
</div>
<h3 id="_8">类型别名<a class="headerlink" href="#_8" title="Permanent link">¶</a></h3>
<p>在 C 中，我们使用 <code>typedef</code> 来为一个类型定义一个别名，而在 C++ 中，我们可以使用 <code>using</code> 关键字来定义类型别名。</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-30-1">1</a></span>
<span class="normal"><a href="#__codelineno-30-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-30-1" name="__codelineno-30-1"></a><span class="k">typedef</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">score</span><span class="p">;</span>
<a id="__codelineno-30-2" name="__codelineno-30-2"></a><span class="k">using</span><span class="w"> </span><span class="n">score</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">int</span><span class="p">;</span>
</code></pre></div></td></tr></table></div>
<p>这两种方法是等价的，但 <code>using</code> 更好用的地方在于我们不仅不容易出现在使用 <code>typedef</code> 时类型和类型的新名字的顺序相反的错误（<code>typedef score int;</code>），而且对于一些复杂的类型别名，<code>using</code> 更加直观。</p>
<p>比如下面的例子中，如果我们使用 <code>typedef</code> 时，就会得到一个相当丑陋并且难以理解的别名，而使用 <code>using</code> 就直观多了</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-31-1">1</a></span>
<span class="normal"><a href="#__codelineno-31-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-31-1" name="__codelineno-31-1"></a><span class="k">typedef</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="n">FcnType</span><span class="p">)(</span><span class="kt">double</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="p">);</span><span class="w"> </span><span class="c1">// FcnType hard to find</span>
<a id="__codelineno-31-2" name="__codelineno-31-2"></a><span class="k">using</span><span class="w"> </span><span class="n">FcnType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">int</span><span class="p">(</span><span class="o">*</span><span class="p">)(</span><span class="kt">double</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="p">);</span><span class="w"> </span><span class="c1">// FcnType easier to find</span>
</code></pre></div></td></tr></table></div>
<h3 id="_9">类型推导<a class="headerlink" href="#_9" title="Permanent link">¶</a></h3>
<p>类型推导（type deduction，type inference）是指编译器根据变量的初始化表达式来推导变量的类型。我们可以是同 <code>auto</code> 关键字进行类型推导。</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-32-1">1</a></span>
<span class="normal"><a href="#__codelineno-32-2">2</a></span>
<span class="normal"><a href="#__codelineno-32-3">3</a></span>
<span class="normal"><a href="#__codelineno-32-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-32-1" name="__codelineno-32-1"></a><span class="k">auto</span><span class="w"> </span><span class="n">d</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="mf">5.0</span><span class="w"> </span><span class="p">};</span><span class="w">   </span><span class="c1">// 5.0 is a double literal, so d will be deduced as a double</span>
<a id="__codelineno-32-2" name="__codelineno-32-2"></a><span class="k">auto</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">};</span><span class="w"> </span><span class="c1">// 1 + 2 evaluates to an int, so i will be deduced as an int</span>
<a id="__codelineno-32-3" name="__codelineno-32-3"></a><span class="k">auto</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="p">};</span><span class="w">     </span><span class="c1">// i is an int, so x will be deduced as an int</span>
<a id="__codelineno-32-4" name="__codelineno-32-4"></a><span class="k">auto</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="mf">3.5f</span><span class="w"> </span><span class="p">};</span><span class="w">  </span><span class="c1">// 3.5f is a float literal, so y will be deduced as a float</span>
</code></pre></div></td></tr></table></div>
<p>因为函数调用也可用于变量的初始化，所以我们也可以使用 <code>auto</code> 来推导变量类型为函数的返回类型（函数返回类型不能为 <code>void</code>）。</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-33-1">1</a></span>
<span class="normal"><a href="#__codelineno-33-2">2</a></span>
<span class="normal"><a href="#__codelineno-33-3">3</a></span>
<span class="normal"><a href="#__codelineno-33-4">4</a></span>
<span class="normal"><a href="#__codelineno-33-5">5</a></span>
<span class="normal"><a href="#__codelineno-33-6">6</a></span>
<span class="normal"><a href="#__codelineno-33-7">7</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-33-1" name="__codelineno-33-1"></a><span class="kt">int</span><span class="w"> </span><span class="nf">add</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">y</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-33-2" name="__codelineno-33-2"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">y</span><span class="p">;</span>
<a id="__codelineno-33-3" name="__codelineno-33-3"></a><span class="p">}</span>
<a id="__codelineno-33-4" name="__codelineno-33-4"></a>
<a id="__codelineno-33-5" name="__codelineno-33-5"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-33-6" name="__codelineno-33-6"></a><span class="w">    </span><span class="k">auto</span><span class="w"> </span><span class="n">sum</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">add</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="p">)</span><span class="w"> </span><span class="p">};</span><span class="w"> </span><span class="c1">// add() returns an int, so sum's type will be deduced as an int</span>
<a id="__codelineno-33-7" name="__codelineno-33-7"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h4 id="const">类型推导会删除 const<a class="headerlink" href="#const" title="Permanent link">¶</a></h4>
<p>在大多数情况下，类型推导会删除（drop）推导类型中的 <code>const</code> 。例如：</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-34-1">1</a></span>
<span class="normal"><a href="#__codelineno-34-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-34-1" name="__codelineno-34-1"></a><span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="p">};</span><span class="w"> </span><span class="c1">// a has type const int</span>
<a id="__codelineno-34-2" name="__codelineno-34-2"></a><span class="k">auto</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="p">};</span><span class="w">      </span><span class="c1">// b has type int (const dropped)</span>
</code></pre></div></td></tr></table></div>
<p>如果我们想让 <code>b</code> 也是 <code>const int</code> 类型，我们可以使用 <code>const auto</code> </p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-35-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-35-1" name="__codelineno-35-1"></a><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="p">};</span><span class="w"> </span><span class="c1">// b has type const int (const dropped but reapplied)</span>
</code></pre></div></td></tr></table></div>
<p>由于 <code>constexpr</code> 并不是类型系统的一部分，因此它不能进行类型推导。但值得一提的是 <code>constexpr</code> 是隐式的 <code>const</code>，也同样会在推导时把 <code>const</code> 删除。</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-36-1">1</a></span>
<span class="normal"><a href="#__codelineno-36-2">2</a></span>
<span class="normal"><a href="#__codelineno-36-3">3</a></span>
<span class="normal"><a href="#__codelineno-36-4">4</a></span>
<span class="normal"><a href="#__codelineno-36-5">5</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-36-1" name="__codelineno-36-1"></a><span class="k">constexpr</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="mf">3.4</span><span class="w"> </span><span class="p">};</span><span class="w">  </span><span class="c1">// a has type const double (constexpr not part of type, const is implicit)</span>
<a id="__codelineno-36-2" name="__codelineno-36-2"></a>
<a id="__codelineno-36-3" name="__codelineno-36-3"></a><span class="k">auto</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="p">};</span><span class="w">                </span><span class="c1">// b has type double (const dropped)</span>
<a id="__codelineno-36-4" name="__codelineno-36-4"></a><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="p">};</span><span class="w">          </span><span class="c1">// c has type const double (const dropped but reapplied)</span>
<a id="__codelineno-36-5" name="__codelineno-36-5"></a><span class="k">constexpr</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="n">d</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="p">};</span><span class="w">      </span><span class="c1">// d has type const double (const dropped but implicitly reapplied by constexpr)</span>
</code></pre></div></td></tr></table></div>
<hr/>
<h2 id="_10">命名空间<a class="headerlink" href="#_10" title="Permanent link">¶</a></h2>
<p>我们可以通过 <code>namespace</code> 关键字来创建命名空间，命名空间可以包含变量、函数、类等。通常来说，<strong>命名空间的名称以大写字母为开头</strong></p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-37-1">1</a></span>
<span class="normal"><a href="#__codelineno-37-2">2</a></span>
<span class="normal"><a href="#__codelineno-37-3">3</a></span>
<span class="normal"><a href="#__codelineno-37-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-37-1" name="__codelineno-37-1"></a><span class="k">namespace</span><span class="w"> </span><span class="nn">NamespaceIdentifier</span>
<a id="__codelineno-37-2" name="__codelineno-37-2"></a><span class="p">{</span>
<a id="__codelineno-37-3" name="__codelineno-37-3"></a><span class="w">    </span><span class="c1">// content of namespace here</span>
<a id="__codelineno-37-4" name="__codelineno-37-4"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>只有声明和定义可以出现在命名空间中，而不能包含赋值语句、函数调用等</li>
<li>命名空间里的函数定义可以包含函数所执行的语句</li>
<li>命名空间可以嵌套</li>
</ul>
<h3 id="_11">作用域解析运算符<a class="headerlink" href="#_11" title="Permanent link">¶</a></h3>
<p><code>::</code> 被称为作用域解析运算符（scope resolution operator），它可以用于访问命名空间中的变量、函数等。</p>
<ul>
<li><code>::</code> 的左侧是命名空间的名称，右侧是命名空间中的变量或函数</li>
<li>假如 <code>::</code> 左侧为空，则假定解析的是全局命名空间</li>
</ul>
<div class="admonition warning">
<p class="admonition-title">不要使用 <code>using namespace std</code> 😡👊</p>
<p>使用 <code>using namespace std</code> 可能会导致命名空间 <code>std</code> 中定义的变量和函数与我们自己定义的变量和函数发生冲突，因此不推荐使用。</p>
</div>
<h3 id="_12">命名空间的标识符解析<a class="headerlink" href="#_12" title="Permanent link">¶</a></h3>
<p>如果我们在一个命名空间中使用标识符（变量或函数的名称）时没有提供解析范围，编译器会先尝试在本地命名空间中寻找匹配的标识符，如果没有找到则逐一向上查找直到找到匹配的标识符，或到达全局命名空间。</p>
<p>我们知道，在 <code>::</code> 左侧为空时，假定解析的是全局命名空间，虽然这在多数情况下是多余的，因为全局命名空间是默认的，但在某些情况下，我们可能需要使用 <code>::</code> 来明确指出我们要访问的是全局命名空间中的变量或函数。</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-38-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-38-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-38-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-38-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-38-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-38-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-38-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-38-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-38-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-38-10">10</a></span>
<span class="normal"><a href="#__codelineno-38-11">11</a></span>
<span class="normal"><a href="#__codelineno-38-12">12</a></span>
<span class="normal"><a href="#__codelineno-38-13">13</a></span>
<span class="normal"><a href="#__codelineno-38-14">14</a></span>
<span class="normal"><a href="#__codelineno-38-15">15</a></span>
<span class="normal"><a href="#__codelineno-38-16">16</a></span>
<span class="normal"><a href="#__codelineno-38-17">17</a></span>
<span class="normal"><a href="#__codelineno-38-18">18</a></span>
<span class="normal"><a href="#__codelineno-38-19">19</a></span>
<span class="normal"><a href="#__codelineno-38-20">20</a></span>
<span class="normal"><a href="#__codelineno-38-21">21</a></span>
<span class="normal"><a href="#__codelineno-38-22">22</a></span>
<span class="normal"><a href="#__codelineno-38-23">23</a></span>
<span class="normal"><a href="#__codelineno-38-24">24</a></span>
<span class="normal"><a href="#__codelineno-38-25">25</a></span>
<span class="normal"><a href="#__codelineno-38-26">26</a></span>
<span class="normal"><a href="#__codelineno-38-27">27</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-38-1" name="__codelineno-38-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span>
<a id="__codelineno-38-2" name="__codelineno-38-2"></a>
<a id="__codelineno-38-3" name="__codelineno-38-3"></a><span class="kt">void</span><span class="w"> </span><span class="nf">print</span><span class="p">()</span><span class="w"> </span><span class="c1">// this print() lives in the global namespace</span>
<a id="__codelineno-38-4" name="__codelineno-38-4"></a><span class="p">{</span>
<a id="__codelineno-38-5" name="__codelineno-38-5"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">" there</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
<a id="__codelineno-38-6" name="__codelineno-38-6"></a><span class="p">}</span>
<a id="__codelineno-38-7" name="__codelineno-38-7"></a>
<a id="__codelineno-38-8" name="__codelineno-38-8"></a><span class="k">namespace</span><span class="w"> </span><span class="nn">Foo</span>
<a id="__codelineno-38-9" name="__codelineno-38-9"></a><span class="p">{</span>
<a id="__codelineno-38-10" name="__codelineno-38-10"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">print</span><span class="p">()</span><span class="w"> </span><span class="c1">// this print() lives in the Foo namespace</span>
<a id="__codelineno-38-11" name="__codelineno-38-11"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-38-12" name="__codelineno-38-12"></a><span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"Hello"</span><span class="p">;</span>
<a id="__codelineno-38-13" name="__codelineno-38-13"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-38-14" name="__codelineno-38-14"></a>
<a id="__codelineno-38-15" name="__codelineno-38-15"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">printHelloThere</span><span class="p">()</span>
<a id="__codelineno-38-16" name="__codelineno-38-16"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-38-17" name="__codelineno-38-17"></a><span class="w">        </span><span class="n">print</span><span class="p">();</span><span class="w">   </span><span class="c1">// calls print() in Foo namespace</span>
<a id="__codelineno-38-18" name="__codelineno-38-18"></a><span class="w">        </span><span class="o">::</span><span class="n">print</span><span class="p">();</span><span class="w"> </span><span class="c1">// calls print() in global namespace</span>
<a id="__codelineno-38-19" name="__codelineno-38-19"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-38-20" name="__codelineno-38-20"></a><span class="p">}</span>
<a id="__codelineno-38-21" name="__codelineno-38-21"></a>
<a id="__codelineno-38-22" name="__codelineno-38-22"></a><span class="kt">int</span><span class="w"> </span><span class="n">main</span><span class="p">()</span>
<a id="__codelineno-38-23" name="__codelineno-38-23"></a><span class="p">{</span>
<a id="__codelineno-38-24" name="__codelineno-38-24"></a><span class="w">    </span><span class="n">Foo</span><span class="o">::</span><span class="n">printHelloThere</span><span class="p">();</span>
<a id="__codelineno-38-25" name="__codelineno-38-25"></a>
<a id="__codelineno-38-26" name="__codelineno-38-26"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-38-27" name="__codelineno-38-27"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h3 id="_13">命名空间中的前向声明<a class="headerlink" href="#_13" title="Permanent link">¶</a></h3>
<p>当我们使用一个命名空间中的函数时，也需要进行前向声明，通常而言我们可以直接 <code>#include</code> 命名空间所在的 <code>.h</code> 文件</p>
<div class="highlight"><table class="highlighttable"><tr><th class="filename" colspan="2"><span class="filename">add.h</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-39-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-39-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-39-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-39-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-39-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-39-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-39-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-39-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-39-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-39-10">10</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-39-1" name="__codelineno-39-1"></a><span class="cp">#ifndef ADD_H</span>
<a id="__codelineno-39-2" name="__codelineno-39-2"></a><span class="cp">#define ADD_H</span>
<a id="__codelineno-39-3" name="__codelineno-39-3"></a>
<a id="__codelineno-39-4" name="__codelineno-39-4"></a><span class="k">namespace</span><span class="w"> </span><span class="nn">BasicMath</span>
<a id="__codelineno-39-5" name="__codelineno-39-5"></a><span class="p">{</span>
<a id="__codelineno-39-6" name="__codelineno-39-6"></a><span class="w">    </span><span class="c1">// function add() is part of namespace BasicMath</span>
<a id="__codelineno-39-7" name="__codelineno-39-7"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="nf">add</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">y</span><span class="p">);</span>
<a id="__codelineno-39-8" name="__codelineno-39-8"></a><span class="p">}</span>
<a id="__codelineno-39-9" name="__codelineno-39-9"></a>
<a id="__codelineno-39-10" name="__codelineno-39-10"></a><span class="cp">#endif</span>
</code></pre></div></td></tr></table></div>
<div class="highlight"><table class="highlighttable"><tr><th class="filename" colspan="2"><span class="filename">add.cpp</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-40-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-40-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-40-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-40-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-40-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-40-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-40-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-40-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-40-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-40-10">10</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-40-1" name="__codelineno-40-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">"add.h"</span>
<a id="__codelineno-40-2" name="__codelineno-40-2"></a>
<a id="__codelineno-40-3" name="__codelineno-40-3"></a><span class="k">namespace</span><span class="w"> </span><span class="nn">BasicMath</span>
<a id="__codelineno-40-4" name="__codelineno-40-4"></a><span class="p">{</span>
<a id="__codelineno-40-5" name="__codelineno-40-5"></a><span class="w">    </span><span class="c1">// define the function add() inside namespace BasicMath</span>
<a id="__codelineno-40-6" name="__codelineno-40-6"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="nf">add</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">y</span><span class="p">)</span>
<a id="__codelineno-40-7" name="__codelineno-40-7"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-40-8" name="__codelineno-40-8"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">y</span><span class="p">;</span>
<a id="__codelineno-40-9" name="__codelineno-40-9"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-40-10" name="__codelineno-40-10"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<div class="highlight"><table class="highlighttable"><tr><th class="filename" colspan="2"><span class="filename">main.cpp</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-41-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-41-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-41-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-41-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-41-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-41-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-41-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-41-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-41-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-41-10">10</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-41-1" name="__codelineno-41-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">"add.h"</span><span class="c1"> // for BasicMath::add()</span>
<a id="__codelineno-41-2" name="__codelineno-41-2"></a>
<a id="__codelineno-41-3" name="__codelineno-41-3"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span>
<a id="__codelineno-41-4" name="__codelineno-41-4"></a>
<a id="__codelineno-41-5" name="__codelineno-41-5"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span>
<a id="__codelineno-41-6" name="__codelineno-41-6"></a><span class="p">{</span>
<a id="__codelineno-41-7" name="__codelineno-41-7"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">BasicMath</span><span class="o">::</span><span class="n">add</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="sc">'\n'</span><span class="p">;</span>
<a id="__codelineno-41-8" name="__codelineno-41-8"></a>
<a id="__codelineno-41-9" name="__codelineno-41-9"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-41-10" name="__codelineno-41-10"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>编译时使用 <code>g++/clang main.cpp add.cpp -o main</code></p>
<h3 id="_14">嵌套命名空间<a class="headerlink" href="#_14" title="Permanent link">¶</a></h3>
<p>命名空间可以在另一个命名空间中定义，例如</p>
<div class="highlight"><table class="highlighttable"><tr><th class="filename" colspan="2"><span class="filename">C++17 之前</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-42-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-42-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-42-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-42-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-42-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-42-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-42-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-42-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-42-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-42-10">10</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-42-1" name="__codelineno-42-1"></a><span class="k">namespace</span><span class="w"> </span><span class="nn">Foo</span>
<a id="__codelineno-42-2" name="__codelineno-42-2"></a><span class="p">{</span>
<a id="__codelineno-42-3" name="__codelineno-42-3"></a><span class="w">    </span><span class="k">namespace</span><span class="w"> </span><span class="nn">Goo</span><span class="w"> </span><span class="c1">// Goo is a namespace inside the Foo namespace</span>
<a id="__codelineno-42-4" name="__codelineno-42-4"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-42-5" name="__codelineno-42-5"></a><span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="nf">add</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">y</span><span class="p">)</span>
<a id="__codelineno-42-6" name="__codelineno-42-6"></a><span class="w">        </span><span class="p">{</span>
<a id="__codelineno-42-7" name="__codelineno-42-7"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">y</span><span class="p">;</span>
<a id="__codelineno-42-8" name="__codelineno-42-8"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-42-9" name="__codelineno-42-9"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-42-10" name="__codelineno-42-10"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>从 C++17 开始，我们也可以这样定义：</p>
<div class="highlight"><table class="highlighttable"><tr><th class="filename" colspan="2"><span class="filename">C++17 及之后</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-43-1">1</a></span>
<span class="normal"><a href="#__codelineno-43-2">2</a></span>
<span class="normal"><a href="#__codelineno-43-3">3</a></span>
<span class="normal"><a href="#__codelineno-43-4">4</a></span>
<span class="normal"><a href="#__codelineno-43-5">5</a></span>
<span class="normal"><a href="#__codelineno-43-6">6</a></span>
<span class="normal"><a href="#__codelineno-43-7">7</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-43-1" name="__codelineno-43-1"></a><span class="k">namespace</span><span class="w"> </span><span class="nn">Foo</span><span class="o">::</span><span class="nn">Goo</span><span class="w"> </span><span class="c1">// Goo is a namespace inside the Foo namespace (C++17 style)</span>
<a id="__codelineno-43-2" name="__codelineno-43-2"></a><span class="p">{</span>
<a id="__codelineno-43-3" name="__codelineno-43-3"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="nf">add</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">y</span><span class="p">)</span>
<a id="__codelineno-43-4" name="__codelineno-43-4"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-43-5" name="__codelineno-43-5"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">y</span><span class="p">;</span>
<a id="__codelineno-43-6" name="__codelineno-43-6"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-43-7" name="__codelineno-43-7"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h3 id="namespace-alias">命名空间别名（namespace alias）<a class="headerlink" href="#namespace-alias" title="Permanent link">¶</a></h3>
<p>由于使用嵌套命名空间中的变量或者函数会很冗长，因此我们可以选择创建一个命名空间别名来简化代码。</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-44-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-44-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-44-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-44-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-44-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-44-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-44-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-44-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-44-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-44-10">10</a></span>
<span class="normal"><a href="#__codelineno-44-11">11</a></span>
<span class="normal"><a href="#__codelineno-44-12">12</a></span>
<span class="normal"><a href="#__codelineno-44-13">13</a></span>
<span class="normal"><a href="#__codelineno-44-14">14</a></span>
<span class="normal"><a href="#__codelineno-44-15">15</a></span>
<span class="normal"><a href="#__codelineno-44-16">16</a></span>
<span class="normal"><a href="#__codelineno-44-17">17</a></span>
<span class="normal"><a href="#__codelineno-44-18">18</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-44-1" name="__codelineno-44-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span>
<a id="__codelineno-44-2" name="__codelineno-44-2"></a>
<a id="__codelineno-44-3" name="__codelineno-44-3"></a><span class="k">namespace</span><span class="w"> </span><span class="nn">Foo</span><span class="o">::</span><span class="nn">Goo</span>
<a id="__codelineno-44-4" name="__codelineno-44-4"></a><span class="p">{</span>
<a id="__codelineno-44-5" name="__codelineno-44-5"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="nf">add</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">y</span><span class="p">)</span>
<a id="__codelineno-44-6" name="__codelineno-44-6"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-44-7" name="__codelineno-44-7"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">y</span><span class="p">;</span>
<a id="__codelineno-44-8" name="__codelineno-44-8"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-44-9" name="__codelineno-44-9"></a><span class="p">}</span>
<a id="__codelineno-44-10" name="__codelineno-44-10"></a>
<a id="__codelineno-44-11" name="__codelineno-44-11"></a><span class="kt">int</span><span class="w"> </span><span class="n">main</span><span class="p">()</span>
<a id="__codelineno-44-12" name="__codelineno-44-12"></a><span class="p">{</span>
<a id="__codelineno-44-13" name="__codelineno-44-13"></a><span class="w">    </span><span class="k">namespace</span><span class="w"> </span><span class="nn">Active</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nn">Foo</span><span class="o">::</span><span class="nn">Goo</span><span class="p">;</span><span class="w"> </span><span class="c1">// active now refers to Foo::Goo</span>
<a id="__codelineno-44-14" name="__codelineno-44-14"></a>
<a id="__codelineno-44-15" name="__codelineno-44-15"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">Active</span><span class="o">::</span><span class="n">add</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="sc">'\n'</span><span class="p">;</span><span class="w"> </span><span class="c1">// This is really Foo::Goo::add()</span>
<a id="__codelineno-44-16" name="__codelineno-44-16"></a>
<a id="__codelineno-44-17" name="__codelineno-44-17"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-44-18" name="__codelineno-44-18"></a><span class="p">}</span><span class="w"> </span><span class="c1">// The Active alias ends here</span>
</code></pre></div></td></tr></table></div>
<div class="admonition info">
<p class="admonition-title">命名空间的使用</p>
<p>向大众分发的代码应该使用命名空间，以避免其与其他代码发生冲突，通常一个顶级命名空间就足够了（例如 <code>MyProject</code>）。</p>
<p>这么做还有一个优点：在绝大多数代码编辑器中键入命名空间的名称之后，再输入 <code>::</code> 编辑器就会自动显示该命名空间中的所有函数和变量作为补全的候选项。</p>
</div>
<h3 id="_15">未命名（匿名）命名空间<a class="headerlink" href="#_15" title="Permanent link">¶</a></h3>
<p><strong>未命名命名空间</strong>（也称为<strong>匿名命名空间</strong>）是没有名称定义的命名空间，如下所示：</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-45-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-45-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-45-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-45-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-45-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-45-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-45-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-45-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-45-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-45-10">10</a></span>
<span class="normal"><a href="#__codelineno-45-11">11</a></span>
<span class="normal"><a href="#__codelineno-45-12">12</a></span>
<span class="normal"><a href="#__codelineno-45-13">13</a></span>
<span class="normal"><a href="#__codelineno-45-14">14</a></span>
<span class="normal"><a href="#__codelineno-45-15">15</a></span>
<span class="normal"><a href="#__codelineno-45-16">16</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-45-1" name="__codelineno-45-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span>
<a id="__codelineno-45-2" name="__codelineno-45-2"></a>
<a id="__codelineno-45-3" name="__codelineno-45-3"></a><span class="k">namespace</span><span class="w"> </span><span class="c1">// unnamed namespace</span>
<a id="__codelineno-45-4" name="__codelineno-45-4"></a><span class="p">{</span>
<a id="__codelineno-45-5" name="__codelineno-45-5"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">doSomething</span><span class="p">()</span><span class="w"> </span><span class="c1">// can only be accessed in this file</span>
<a id="__codelineno-45-6" name="__codelineno-45-6"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-45-7" name="__codelineno-45-7"></a><span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"v1</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
<a id="__codelineno-45-8" name="__codelineno-45-8"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-45-9" name="__codelineno-45-9"></a><span class="p">}</span>
<a id="__codelineno-45-10" name="__codelineno-45-10"></a>
<a id="__codelineno-45-11" name="__codelineno-45-11"></a><span class="kt">int</span><span class="w"> </span><span class="n">main</span><span class="p">()</span>
<a id="__codelineno-45-12" name="__codelineno-45-12"></a><span class="p">{</span>
<a id="__codelineno-45-13" name="__codelineno-45-13"></a><span class="w">    </span><span class="n">doSomething</span><span class="p">();</span><span class="w"> </span><span class="c1">// we can call doSomething() without a namespace prefix</span>
<a id="__codelineno-45-14" name="__codelineno-45-14"></a>
<a id="__codelineno-45-15" name="__codelineno-45-15"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-45-16" name="__codelineno-45-16"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>在未命名命名空间中声明的所有内容都被视为父命名空间的一部分，因此函数或变量即使是在未命名命名空间中声明的，也可以在父命名空间（上例时全局命名空间）中访问。</p>
<p>这看起来似乎没什么用处，但未命名命名空间中的所有标识符都不可以被其他文件访问（或者说具有<em>内部链接</em>），效果相当于 <code>static</code> 关键字。</p>
<p>当我们有大量内容仅允许当前的翻译单元使用时，使用匿名命名空间显然要比给所有的标识符都加上 <code>static</code> 更加方便。</p>
<hr/>
<h2 id="_16">函数<a class="headerlink" href="#_16" title="Permanent link">¶</a></h2>
<h3 id="_17">函数重载<a class="headerlink" href="#_17" title="Permanent link">¶</a></h3>
<p>我们把两个或多个函数的名称相同，但是参数列表不同的函数称为<strong>函数重载</strong>（function overloading）。</p>
<p>当对已重载的函数进行调用时，编译器将尝试根据函数调用中使用的参数将函数调用与适当的重载函数相匹配，这称为<strong>重载解析</strong>（overload resolution）。</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>编译器可以通过<strong>参数的数量</strong>、<strong>参数的类型</strong>进行重载解析，但不能通过<strong>函数返回值类型</strong>进行重载解析。</p>
</div>
<p>对于按值传递的参数，编译器不会考虑 const 限定符，因此下面这两个函数不能被编译器所区分</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-46-1">1</a></span>
<span class="normal"><a href="#__codelineno-46-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-46-1" name="__codelineno-46-1"></a><span class="kt">void</span><span class="w"> </span><span class="nf">print</span><span class="p">(</span><span class="kt">int</span><span class="p">);</span>
<a id="__codelineno-46-2" name="__codelineno-46-2"></a><span class="kt">void</span><span class="w"> </span><span class="nf">print</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="p">);</span><span class="w"> </span><span class="c1">// not differentiated from print(int)</span>
</code></pre></div></td></tr></table></div>
<div class="admonition info">
<p class="admonition-title">函数的类型签名</p>
<p>函数的类型签名（function signature）是指函数头中用于区分不同函数的部分，在 C++ 中，这包括函数名称、参数数量、参数类型和函数级限定符，不包括函数返回值类型。函数的类型签名可用于重载解析。</p>
</div>
<h4 id="_18">函数重载解析与模糊匹配<a class="headerlink" href="#_18" title="Permanent link">¶</a></h4>
<p>当调用一个已被重载的函数时，编译器将逐步执行一系列规则可，以寻找一个最佳的匹配。</p>
<ol>
<li>
<p>编译器将尝试寻找最佳匹配。</p>
<ul>
<li>首先，编译器将查看是否存在一个参数列表与函数调用中的参数列表完全一致的重载函数，如果有，那么这个函数就是最佳匹配，编译器将调用这个函数。</li>
<li>
<p>接着，编译器将尝试采用一些简单转换（trivial conversions）来匹配参数，包括：</p>
<ul>
<li>左值到右值的转换</li>
<li>限定符的转换（例如非 const 到 const）</li>
<li>非引用到引用的转换</li>
</ul>
</li>
</ul>
</li>
<li>
<p>如果没有找到最佳匹配，编译器将会尝试通过对参数应用 numeric promotion 来寻找匹配的重载函数。</p>
</li>
<li>如果 numeric promotion 也没有找到匹配的重载函数，编译器则会尝试 numeric conversion。</li>
<li>
<p>如果 numeric conversion 也没能让编译器找到匹配项，那么编译器将尝试通过用户定义的类型转换（user-defined type conversion）来寻找匹配的重载函数。</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-47-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-47-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-47-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-47-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-47-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-47-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-47-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-47-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-47-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-47-10">10</a></span>
<span class="normal"><a href="#__codelineno-47-11">11</a></span>
<span class="normal"><a href="#__codelineno-47-12">12</a></span>
<span class="normal"><a href="#__codelineno-47-13">13</a></span>
<span class="normal"><a href="#__codelineno-47-14">14</a></span>
<span class="normal"><a href="#__codelineno-47-15">15</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-47-1" name="__codelineno-47-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">X</span><span class="w"> </span>
<a id="__codelineno-47-2" name="__codelineno-47-2"></a><span class="p">{</span>
<a id="__codelineno-47-3" name="__codelineno-47-3"></a><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-47-4" name="__codelineno-47-4"></a><span class="w">    </span><span class="k">operator</span><span class="w"> </span><span class="kt">int</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="c1">// Here's a user-defined conversion from X to int</span>
<a id="__codelineno-47-5" name="__codelineno-47-5"></a><span class="p">};</span>
<a id="__codelineno-47-6" name="__codelineno-47-6"></a>
<a id="__codelineno-47-7" name="__codelineno-47-7"></a><span class="kt">void</span><span class="w"> </span><span class="nf">foo</span><span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span>
<a id="__codelineno-47-8" name="__codelineno-47-8"></a><span class="kt">void</span><span class="w"> </span><span class="nf">foo</span><span class="p">(</span><span class="kt">double</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span>
<a id="__codelineno-47-9" name="__codelineno-47-9"></a>
<a id="__codelineno-47-10" name="__codelineno-47-10"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span>
<a id="__codelineno-47-11" name="__codelineno-47-11"></a><span class="p">{</span>
<a id="__codelineno-47-12" name="__codelineno-47-12"></a><span class="w">    </span><span class="n">X</span><span class="w"> </span><span class="n">x</span><span class="p">;</span><span class="w"> </span>
<a id="__codelineno-47-13" name="__codelineno-47-13"></a><span class="w">    </span><span class="n">foo</span><span class="p">(</span><span class="n">x</span><span class="p">);</span><span class="w"> </span><span class="c1">// x is converted to type int using the user-defined conversion from X to int</span>
<a id="__codelineno-47-14" name="__codelineno-47-14"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-47-15" name="__codelineno-47-15"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>在上例中，编译器首先发现没有能和 <code>foo(X)</code> 完全匹配的重载函数，接着它依次尝试数值提升和数值转换，但都没有找到匹配的重载函数。最后编译器找到了一个用户定义的类型转换，它将 <code>X</code> 转换为 <code>int</code>，因此 <code>foo(int)</code> 就成为了最佳匹配。</p>
<ul>
<li>如果用户定义的类型转换是 <code>X</code> 转换到 <code>char</code> 的，那么编译器会先把它转换为 <code>char</code>，然后把 <code>char</code> 提升为 <code>int</code>。</li>
</ul>
</li>
<li>
<p>如果通过用户定义的转换也没能找到匹配项，编译器就会尝试查找使用省略号（<code>...</code>）的重载函数。</p>
</li>
<li>如果此时还未找到匹配项，编译器将放弃并报告无法找到匹配函数的错误。</li>
</ol>
<div class="admonition property">
<p class="admonition-title">函数重载解析</p>
<p>在上面的每一个步骤中，编译器都会尝试对函数调用中的参数应用一大堆不同的类型转换，每次转换后，编译器都会检查是否有重载函数与之匹配，其结果有 3 种：</p>
<ul>
<li>没有找到匹配的函数。编译器按顺序移动到下一步。</li>
<li>找到了一个最佳匹配，至此重载解析结束，后续步骤不再执行。</li>
<li>找到了多个可能匹配的函数，编译器将会报告一个模糊匹配（或称不明确匹配，ambiguous match）的编译错误。</li>
</ul>
</div>
<h4 id="ambiguous-match">ambiguous match<a class="headerlink" href="#ambiguous-match" title="Permanent link">¶</a></h4>
<p>当编译器在同一步骤中发现多个可以匹配的函数时，编译器将停止匹配并发出编译错误，指出它发现了不明确的函数调用。</p>
<div class="admonition example">
<p class="admonition-title">ambiguous match</p>
<div class="tabbed-set tabbed-alternate" data-tabs="2:2"><input checked="checked" id="__tabbed_2_1" name="__tabbed_2" type="radio"><input id="__tabbed_2_2" name="__tabbed_2" type="radio"><div class="tabbed-labels"><label for="__tabbed_2_1">example 1</label><label for="__tabbed_2_2">example 2</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><table class="highlighttable"><tr><th class="filename" colspan="2"><span class="filename">ambiguous match 1</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-48-1">1</a></span>
<span class="normal"><a href="#__codelineno-48-2">2</a></span>
<span class="normal"><a href="#__codelineno-48-3">3</a></span>
<span class="normal"><a href="#__codelineno-48-4">4</a></span>
<span class="normal"><a href="#__codelineno-48-5">5</a></span>
<span class="normal"><a href="#__codelineno-48-6">6</a></span>
<span class="normal"><a href="#__codelineno-48-7">7</a></span>
<span class="normal"><a href="#__codelineno-48-8">8</a></span>
<span class="normal"><a href="#__codelineno-48-9">9</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-48-1" name="__codelineno-48-1"></a><span class="kt">void</span><span class="w"> </span><span class="nf">foo</span><span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span>
<a id="__codelineno-48-2" name="__codelineno-48-2"></a><span class="kt">void</span><span class="w"> </span><span class="nf">foo</span><span class="p">(</span><span class="kt">double</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span>
<a id="__codelineno-48-3" name="__codelineno-48-3"></a>
<a id="__codelineno-48-4" name="__codelineno-48-4"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span>
<a id="__codelineno-48-5" name="__codelineno-48-5"></a><span class="p">{</span>
<a id="__codelineno-48-6" name="__codelineno-48-6"></a><span class="w">    </span><span class="n">foo</span><span class="p">(</span><span class="mf">5L</span><span class="p">);</span><span class="w"> </span><span class="c1">// 5L is type long</span>
<a id="__codelineno-48-7" name="__codelineno-48-7"></a>
<a id="__codelineno-48-8" name="__codelineno-48-8"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-48-9" name="__codelineno-48-9"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>编译器在发现找不到 <code>foo(long)</code> 之后会尝试 numeric promotion，但 <code>long</code> 不能提升（暂时不考虑 <code>long long</code>），因此编译器会尝试数值转换。</p>
<p>但在检查所有数值转换规则的过程中，编译器发现 <code>foo(int)</code> 和 <code>foo(double)</code> 都可以通过数值转换匹配 <code>foo(5L)</code>，因此这里的函数调用被认为是模糊的。</p>
</div>
<div class="tabbed-block">
<div class="highlight"><table class="highlighttable"><tr><th class="filename" colspan="2"><span class="filename">ambiguous match 2</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-49-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-49-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-49-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-49-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-49-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-49-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-49-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-49-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-49-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-49-10">10</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-49-1" name="__codelineno-49-1"></a><span class="kt">void</span><span class="w"> </span><span class="nf">foo</span><span class="p">(</span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span>
<a id="__codelineno-49-2" name="__codelineno-49-2"></a><span class="kt">void</span><span class="w"> </span><span class="nf">foo</span><span class="p">(</span><span class="kt">float</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span>
<a id="__codelineno-49-3" name="__codelineno-49-3"></a>
<a id="__codelineno-49-4" name="__codelineno-49-4"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span>
<a id="__codelineno-49-5" name="__codelineno-49-5"></a><span class="p">{</span>
<a id="__codelineno-49-6" name="__codelineno-49-6"></a><span class="w">    </span><span class="n">foo</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span><span class="w">       </span><span class="c1">// int can be numerically converted to unsigned int or to float</span>
<a id="__codelineno-49-7" name="__codelineno-49-7"></a><span class="w">    </span><span class="n">foo</span><span class="p">(</span><span class="mf">3.14159</span><span class="p">);</span><span class="w"> </span><span class="c1">// double can be numerically converted to unsigned int or to float</span>
<a id="__codelineno-49-8" name="__codelineno-49-8"></a>
<a id="__codelineno-49-9" name="__codelineno-49-9"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-49-10" name="__codelineno-49-10"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>尽管我们可能主观地认为 <code>foo(0)</code> 应该调用 <code>foo(unsigned int)</code>，而 <code>foo(3.14159)</code> 应该调用 <code>foo(float)</code>，但编译器并不会这样认为。因为 <code>0</code> 是一个 <code>int</code> 类型的字面量，它可以被转换为 <code>unsigned int</code>或<code>float</code> ；而 <code>3.14159</code> 是一个 <code>double</code> 类型的字面量，它也可以被转换为 <code>unsigned int</code> 或 <code>float</code>。因此两次调用都是不明确的。</p>
</div>
</div>
</input></input></div>
</div>
<div class="admonition extra">
<p class="admonition-title">多个参数的重载函数匹配</p>
<p>如果有多个参数，编译器将依次将匹配规则应用于每个参数。最终选择的函数至少有一个参数比其他所有函数都更好，并且剩余参数至少不会比其他函数更差。</p>
<div class="highlight"><table class="highlighttable"><tr><th class="filename" colspan="2"><span class="filename">example 1</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-50-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-50-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-50-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-50-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-50-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-50-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-50-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-50-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-50-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-50-10">10</a></span>
<span class="normal"><a href="#__codelineno-50-11">11</a></span>
<span class="normal"><a href="#__codelineno-50-12">12</a></span>
<span class="normal"><a href="#__codelineno-50-13">13</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-50-1" name="__codelineno-50-1"></a><span class="kt">void</span><span class="w"> </span><span class="nf">print</span><span class="p">(</span><span class="kt">char</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-50-2" name="__codelineno-50-2"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="sc">'a'</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="sc">'\n'</span><span class="p">;</span>
<a id="__codelineno-50-3" name="__codelineno-50-3"></a><span class="p">}</span>
<a id="__codelineno-50-4" name="__codelineno-50-4"></a>
<a id="__codelineno-50-5" name="__codelineno-50-5"></a><span class="kt">void</span><span class="w"> </span><span class="nf">print</span><span class="p">(</span><span class="kt">char</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-50-6" name="__codelineno-50-6"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="sc">'b'</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="sc">'\n'</span><span class="p">;</span>
<a id="__codelineno-50-7" name="__codelineno-50-7"></a><span class="p">}</span>
<a id="__codelineno-50-8" name="__codelineno-50-8"></a>
<a id="__codelineno-50-9" name="__codelineno-50-9"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-50-10" name="__codelineno-50-10"></a><span class="w">    </span><span class="n">print</span><span class="p">(</span><span class="sc">'x'</span><span class="p">,</span><span class="w"> </span><span class="sc">'a'</span><span class="p">);</span>
<a id="__codelineno-50-11" name="__codelineno-50-11"></a>
<a id="__codelineno-50-12" name="__codelineno-50-12"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-50-13" name="__codelineno-50-13"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>在上例中两个函数都与第一个参数完全匹配，但是第一个 <code>print()</code> 可通过数值提升来匹配第二个参数，第二个 <code>print()</code> 需要通过数值转换才能匹配第二个参数，因此第一个 <code>print(char, int)</code> 是最佳匹配。</p>
<div class="highlight"><table class="highlighttable"><tr><th class="filename" colspan="2"><span class="filename">example 2</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-51-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-51-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-51-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-51-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-51-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-51-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-51-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-51-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-51-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-51-10">10</a></span>
<span class="normal"><a href="#__codelineno-51-11">11</a></span>
<span class="normal"><a href="#__codelineno-51-12">12</a></span>
<span class="normal"><a href="#__codelineno-51-13">13</a></span>
<span class="normal"><a href="#__codelineno-51-14">14</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-51-1" name="__codelineno-51-1"></a><span class="kt">void</span><span class="w"> </span><span class="nf">print</span><span class="p">(</span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="kt">float</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-51-2" name="__codelineno-51-2"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="sc">'1'</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="sc">'\n'</span><span class="p">;</span>
<a id="__codelineno-51-3" name="__codelineno-51-3"></a><span class="p">}</span>
<a id="__codelineno-51-4" name="__codelineno-51-4"></a>
<a id="__codelineno-51-5" name="__codelineno-51-5"></a><span class="kt">void</span><span class="w"> </span><span class="nf">print</span><span class="p">(</span><span class="kt">char</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-51-6" name="__codelineno-51-6"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="sc">'2'</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="sc">'\n'</span><span class="p">;</span>
<a id="__codelineno-51-7" name="__codelineno-51-7"></a><span class="p">}</span>
<a id="__codelineno-51-8" name="__codelineno-51-8"></a>
<a id="__codelineno-51-9" name="__codelineno-51-9"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span>
<a id="__codelineno-51-10" name="__codelineno-51-10"></a><span class="p">{</span>
<a id="__codelineno-51-11" name="__codelineno-51-11"></a><span class="w">    </span><span class="n">print</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0</span><span class="p">);</span>
<a id="__codelineno-51-12" name="__codelineno-51-12"></a>
<a id="__codelineno-51-13" name="__codelineno-51-13"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-51-14" name="__codelineno-51-14"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>在这个例子中 <code>print(1, 1.0);</code> 与 <code>print(int, float)</code> 的第一个参数完全匹配，但第二个参数需要进行数值转换；同时与 <code>print(char, double)</code> 的第二个参数完全匹配，但第一个参数需要进行数值转换。</p>
<p>因此这里不满足“至少有一个参数比其他所有函数都更好，并且剩余参数至少不会比其他函数更差”的条件，因此编译器认为这是一个不明确的函数调用。</p>
</div>
<h3 id="_19">删除函数<a class="headerlink" href="#_19" title="Permanent link">¶</a></h3>
<p>有时候我们在调用函数时不希望它通过类型转换匹配到了一个不能按预期运行的函数，例如</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-52-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-52-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-52-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-52-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-52-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-52-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-52-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-52-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-52-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-52-10">10</a></span>
<span class="normal"><a href="#__codelineno-52-11">11</a></span>
<span class="normal"><a href="#__codelineno-52-12">12</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-52-1" name="__codelineno-52-1"></a><span class="kt">void</span><span class="w"> </span><span class="nf">printInt</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-52-2" name="__codelineno-52-2"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="sc">'\n'</span><span class="p">;</span>
<a id="__codelineno-52-3" name="__codelineno-52-3"></a><span class="p">}</span>
<a id="__codelineno-52-4" name="__codelineno-52-4"></a>
<a id="__codelineno-52-5" name="__codelineno-52-5"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span>
<a id="__codelineno-52-6" name="__codelineno-52-6"></a><span class="p">{</span>
<a id="__codelineno-52-7" name="__codelineno-52-7"></a><span class="w">    </span><span class="n">printInt</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span><span class="w">    </span><span class="c1">// okay: prints 5</span>
<a id="__codelineno-52-8" name="__codelineno-52-8"></a><span class="w">    </span><span class="n">printInt</span><span class="p">(</span><span class="sc">'a'</span><span class="p">);</span><span class="w">  </span><span class="c1">// prints 97 -- make no sense</span>
<a id="__codelineno-52-9" name="__codelineno-52-9"></a><span class="w">    </span><span class="n">printInt</span><span class="p">(</span><span class="nb">true</span><span class="p">);</span><span class="w"> </span><span class="c1">// print 1   -- make no sense</span>
<a id="__codelineno-52-10" name="__codelineno-52-10"></a>
<a id="__codelineno-52-11" name="__codelineno-52-11"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-52-12" name="__codelineno-52-12"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>对于 <code>printInt('a')</code> 和 <code>printInt(true)</code> 而言，我们认为他们是没有意义的，我们并不希望输出一个字符对应的 ASCII 码或者输出一个布尔值对应的 0/1，我们该怎么做呢？答案是使用 <code>= delete</code> 说明符删除函数。</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-53-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-53-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-53-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-53-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-53-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-53-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-53-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-53-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-53-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-53-10">10</a></span>
<span class="normal"><a href="#__codelineno-53-11">11</a></span>
<span class="normal"><a href="#__codelineno-53-12">12</a></span>
<span class="normal"><a href="#__codelineno-53-13">13</a></span>
<span class="normal"><a href="#__codelineno-53-14">14</a></span>
<span class="normal"><a href="#__codelineno-53-15">15</a></span>
<span class="normal"><a href="#__codelineno-53-16">16</a></span>
<span class="normal"><a href="#__codelineno-53-17">17</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-53-1" name="__codelineno-53-1"></a><span class="kt">void</span><span class="w"> </span><span class="nf">printInt</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-53-2" name="__codelineno-53-2"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="sc">'\n'</span><span class="p">;</span>
<a id="__codelineno-53-3" name="__codelineno-53-3"></a><span class="p">}</span>
<a id="__codelineno-53-4" name="__codelineno-53-4"></a>
<a id="__codelineno-53-5" name="__codelineno-53-5"></a><span class="kt">void</span><span class="w"> </span><span class="nf">printInt</span><span class="p">(</span><span class="kt">char</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">delete</span><span class="p">;</span><span class="w"> </span><span class="c1">// calls to this function will halt compilation</span>
<a id="__codelineno-53-6" name="__codelineno-53-6"></a><span class="kt">void</span><span class="w"> </span><span class="nf">printInt</span><span class="p">(</span><span class="kt">bool</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">delete</span><span class="p">;</span><span class="w"> </span><span class="c1">// calls to this function will halt compilation</span>
<a id="__codelineno-53-7" name="__codelineno-53-7"></a>
<a id="__codelineno-53-8" name="__codelineno-53-8"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-53-9" name="__codelineno-53-9"></a><span class="w">    </span><span class="n">printInt</span><span class="p">(</span><span class="mi">97</span><span class="p">);</span><span class="w">   </span><span class="c1">// okay</span>
<a id="__codelineno-53-10" name="__codelineno-53-10"></a>
<a id="__codelineno-53-11" name="__codelineno-53-11"></a><span class="w">    </span><span class="n">printInt</span><span class="p">(</span><span class="sc">'a'</span><span class="p">);</span><span class="w">  </span><span class="c1">// compile error: function deleted</span>
<a id="__codelineno-53-12" name="__codelineno-53-12"></a><span class="w">    </span><span class="n">printInt</span><span class="p">(</span><span class="nb">true</span><span class="p">);</span><span class="w"> </span><span class="c1">// compile error: function deleted</span>
<a id="__codelineno-53-13" name="__codelineno-53-13"></a>
<a id="__codelineno-53-14" name="__codelineno-53-14"></a><span class="w">    </span><span class="n">printInt</span><span class="p">(</span><span class="mf">5.0</span><span class="p">);</span><span class="w">  </span><span class="c1">// compile error: ambiguous match</span>
<a id="__codelineno-53-15" name="__codelineno-53-15"></a>
<a id="__codelineno-53-16" name="__codelineno-53-16"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-53-17" name="__codelineno-53-17"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>当我们调用一个已经被 <code>= delete</code> 的函数时，编译器将会报告一个编译错误，告诉我们这个函数已经被删除了。</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p><code>= delete</code> 表示的是“这个函数不应该被调用”，而不是“这个函数不存在”。因此被删除的函数也会参与重载函数的解析过程，<code>printInt(5.0)</code> 会出现模糊匹配问题。</p>
</div>
<div class="admonition extra">
<p class="admonition-title">删除所有不匹配的重载函数</p>
<p>对可能的各种参数逐一使用 <code>= delete</code> 有时候会导致代码很冗长，这时我们可以通过函数模板来删除所有不匹配的重载函数。</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-54-1">1</a></span>
<span class="normal"><a href="#__codelineno-54-2">2</a></span>
<span class="normal"><a href="#__codelineno-54-3">3</a></span>
<span class="normal"><a href="#__codelineno-54-4">4</a></span>
<span class="normal"><a href="#__codelineno-54-5">5</a></span>
<span class="normal"><a href="#__codelineno-54-6">6</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-54-1" name="__codelineno-54-1"></a><span class="kt">void</span><span class="w"> </span><span class="nf">printInt</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-54-2" name="__codelineno-54-2"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="sc">'\n'</span><span class="p">;</span>
<a id="__codelineno-54-3" name="__codelineno-54-3"></a><span class="p">}</span>
<a id="__codelineno-54-4" name="__codelineno-54-4"></a>
<a id="__codelineno-54-5" name="__codelineno-54-5"></a><span class="k">template</span><span class="w"> </span><span class="o">&lt;</span><span class="k">typename</span><span class="w"> </span><span class="nc">T</span><span class="o">&gt;</span>
<a id="__codelineno-54-6" name="__codelineno-54-6"></a><span class="kt">void</span><span class="w"> </span><span class="n">printInt</span><span class="p">(</span><span class="n">T</span><span class="w"> </span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">delete</span><span class="p">;</span>
</code></pre></div></td></tr></table></div>
</div>
<h3 id="_20">默认参数<a class="headerlink" href="#_20" title="Permanent link">¶</a></h3>
<p>在函数声明时，可以给一些参数指定默认值，这样在调用函数时，如果没有提供这些参数的值，编译器将使用默认值。</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-55-1">1</a></span>
<span class="normal"><a href="#__codelineno-55-2">2</a></span>
<span class="normal"><a href="#__codelineno-55-3">3</a></span>
<span class="normal"><a href="#__codelineno-55-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-55-1" name="__codelineno-55-1"></a><span class="kt">void</span><span class="w"> </span><span class="nf">print</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-55-2" name="__codelineno-55-2"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"x: "</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="sc">'\n'</span><span class="p">;</span>
<a id="__codelineno-55-3" name="__codelineno-55-3"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"y: "</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="sc">'\n'</span><span class="p">;</span>
<a id="__codelineno-55-4" name="__codelineno-55-4"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>在函数调用中，任何显式提供的参数都从最左边开始使用，而未提供的参数将使用默认值。</li>
<li>
<p>如果为一个参数提供了默认值，那么它右边的所有参数都必须有默认值。</p>
<p>下面这个声明是不允许的
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-56-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-56-1" name="__codelineno-56-1"></a><span class="kt">void</span><span class="w"> </span><span class="nf">print</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">y</span><span class="p">);</span><span class="w"> </span><span class="c1">// not allowed</span>
</code></pre></div></td></tr></table></div></p>
</li>
<li>
<p>如果不止一个参数具有默认值，那么其中最左边的参数应当是最有可能由用户显式设置的参数</p>
</li>
</ul>
<div class="admonition note">
<p class="admonition-title">默认参数不能多次声明</p>
<p>函数的默认参数不能再同一翻译单元中重复声明，这意味着对于具有前向声明和函数定义的函数，默认参数可以在前向声明中出现，也可以在函数定义中出现，但不可同时在两者中出现。</p>
</div>
<p>默认参数还必须在使用之前进行声明，例如下面的代码就是错误的</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-57-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-57-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-57-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-57-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-57-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-57-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-57-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-57-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-57-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-57-10">10</a></span>
<span class="normal"><a href="#__codelineno-57-11">11</a></span>
<span class="normal"><a href="#__codelineno-57-12">12</a></span>
<span class="normal"><a href="#__codelineno-57-13">13</a></span>
<span class="normal"><a href="#__codelineno-57-14">14</a></span>
<span class="normal"><a href="#__codelineno-57-15">15</a></span>
<span class="normal"><a href="#__codelineno-57-16">16</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-57-1" name="__codelineno-57-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span>
<a id="__codelineno-57-2" name="__codelineno-57-2"></a>
<a id="__codelineno-57-3" name="__codelineno-57-3"></a><span class="kt">void</span><span class="w"> </span><span class="nf">print</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">y</span><span class="p">);</span><span class="w"> </span><span class="c1">// forward declaration, no default argument</span>
<a id="__codelineno-57-4" name="__codelineno-57-4"></a>
<a id="__codelineno-57-5" name="__codelineno-57-5"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span>
<a id="__codelineno-57-6" name="__codelineno-57-6"></a><span class="p">{</span>
<a id="__codelineno-57-7" name="__codelineno-57-7"></a><span class="w">    </span><span class="n">print</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span><span class="w"> </span><span class="c1">// compile error: default argument for y hasn't been defined yet</span>
<a id="__codelineno-57-8" name="__codelineno-57-8"></a>
<a id="__codelineno-57-9" name="__codelineno-57-9"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-57-10" name="__codelineno-57-10"></a><span class="p">}</span>
<a id="__codelineno-57-11" name="__codelineno-57-11"></a>
<a id="__codelineno-57-12" name="__codelineno-57-12"></a><span class="kt">void</span><span class="w"> </span><span class="nf">print</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
<a id="__codelineno-57-13" name="__codelineno-57-13"></a><span class="p">{</span>
<a id="__codelineno-57-14" name="__codelineno-57-14"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"x: "</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="sc">'\n'</span><span class="p">;</span>
<a id="__codelineno-57-15" name="__codelineno-57-15"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"y: "</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="sc">'\n'</span><span class="p">;</span>
<a id="__codelineno-57-16" name="__codelineno-57-16"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>因此我们通常会在前向声明中，而非函数定义中声明默认参数。同时如果前向声明位于头文件中，也便于它在被其他文件使用前观察到。</p>
<h4 id="_21">默认参数可能导致模糊匹配<a class="headerlink" href="#_21" title="Permanent link">¶</a></h4>
<p>默认参数很容易导致调用的函数不明确，例如</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-58-1">1</a></span>
<span class="normal"><a href="#__codelineno-58-2">2</a></span>
<span class="normal"><a href="#__codelineno-58-3">3</a></span>
<span class="normal"><a href="#__codelineno-58-4">4</a></span>
<span class="normal"><a href="#__codelineno-58-5">5</a></span>
<span class="normal"><a href="#__codelineno-58-6">6</a></span>
<span class="normal"><a href="#__codelineno-58-7">7</a></span>
<span class="normal"><a href="#__codelineno-58-8">8</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-58-1" name="__codelineno-58-1"></a><span class="kt">void</span><span class="w"> </span><span class="nf">foo</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span>
<a id="__codelineno-58-2" name="__codelineno-58-2"></a><span class="kt">void</span><span class="w"> </span><span class="nf">foo</span><span class="p">(</span><span class="kt">double</span><span class="w"> </span><span class="n">d</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span>
<a id="__codelineno-58-3" name="__codelineno-58-3"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span>
<a id="__codelineno-58-4" name="__codelineno-58-4"></a><span class="p">{</span>
<a id="__codelineno-58-5" name="__codelineno-58-5"></a><span class="w">    </span><span class="n">foo</span><span class="p">();</span><span class="w"> </span><span class="c1">// ambiguous function call</span>
<a id="__codelineno-58-6" name="__codelineno-58-6"></a>
<a id="__codelineno-58-7" name="__codelineno-58-7"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-58-8" name="__codelineno-58-8"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>在这里，编译器无法判断调用 <code>foo(int)</code> 还是 <code>foo(double)</code>。</p>
<p>我们还有另一个例子：</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-59-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-59-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-59-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-59-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-59-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-59-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-59-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-59-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-59-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-59-10">10</a></span>
<span class="normal"><a href="#__codelineno-59-11">11</a></span>
<span class="normal"><a href="#__codelineno-59-12">12</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-59-1" name="__codelineno-59-1"></a><span class="kt">void</span><span class="w"> </span><span class="nf">print</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">);</span><span class="w">                  </span><span class="c1">// signature print(int)</span>
<a id="__codelineno-59-2" name="__codelineno-59-2"></a><span class="kt">void</span><span class="w"> </span><span class="nf">print</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">10</span><span class="p">);</span><span class="w">      </span><span class="c1">// signature print(int, int)</span>
<a id="__codelineno-59-3" name="__codelineno-59-3"></a><span class="kt">void</span><span class="w"> </span><span class="nf">print</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">20.5</span><span class="p">);</span><span class="w"> </span><span class="c1">// signature print(int, double)</span>
<a id="__codelineno-59-4" name="__codelineno-59-4"></a>
<a id="__codelineno-59-5" name="__codelineno-59-5"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span>
<a id="__codelineno-59-6" name="__codelineno-59-6"></a><span class="p">{</span>
<a id="__codelineno-59-7" name="__codelineno-59-7"></a><span class="w">    </span><span class="n">print</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">);</span><span class="w">   </span><span class="c1">// will resolve to print(int, int)</span>
<a id="__codelineno-59-8" name="__codelineno-59-8"></a><span class="w">    </span><span class="n">print</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mf">2.5</span><span class="p">);</span><span class="w"> </span><span class="c1">// will resolve to print(int, double)</span>
<a id="__codelineno-59-9" name="__codelineno-59-9"></a><span class="w">    </span><span class="n">print</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span><span class="w">      </span><span class="c1">// ambiguous function call</span>
<a id="__codelineno-59-10" name="__codelineno-59-10"></a>
<a id="__codelineno-59-11" name="__codelineno-59-11"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-59-12" name="__codelineno-59-12"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>对于 <code>print(1)</code> 而言，编译器无法判断调用<code>print(int)</code>、<code>print(int, int)</code> 还是 <code>print(int, double)</code>。</p>
<h3 id="_22">函数模板<a class="headerlink" href="#_22" title="Permanent link">¶</a></h3>
<p>函数模板是指一种通用的函数定义，它使用一个或多个类型参数来定义一个函数的模板，在使用时编译器可以使用单个模板来生成一系列相关的函数。</p>
<p>创建函数模板时，我们使用占位符类型（placeholder type）来代替函数的参数类型、返回类型或者函数体中将要被使用的类型。在使用函数模板前，我们需要进行<strong>模板参数声明（template parameter declaration）</strong>，模板参数声明的范围仅限于跟在它后面的函数模板（或类模板）。因此，每个函数模板（类模板）都需要有自己的模板参数声明。</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-60-1">1</a></span>
<span class="normal"><a href="#__codelineno-60-2">2</a></span>
<span class="normal"><a href="#__codelineno-60-3">3</a></span>
<span class="normal"><a href="#__codelineno-60-4">4</a></span>
<span class="normal"><a href="#__codelineno-60-5">5</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-60-1" name="__codelineno-60-1"></a><span class="k">template</span><span class="w"> </span><span class="o">&lt;</span><span class="k">typename</span><span class="w"> </span><span class="nc">T</span><span class="o">&gt;</span><span class="w"> </span><span class="c1">// this is the template parameter declaration</span>
<a id="__codelineno-60-2" name="__codelineno-60-2"></a><span class="n">T</span><span class="w"> </span><span class="n">max</span><span class="p">(</span><span class="n">T</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="w"> </span><span class="n">y</span><span class="p">)</span><span class="w"> </span><span class="c1">// this is the function template definition for max&lt;T&gt;</span>
<a id="__codelineno-60-3" name="__codelineno-60-3"></a><span class="p">{</span>
<a id="__codelineno-60-4" name="__codelineno-60-4"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">y</span><span class="p">)</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">x</span><span class="p">;</span>
<a id="__codelineno-60-5" name="__codelineno-60-5"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>在模板参数声明中，我们以关键字<code>template</code>开头，它告诉编译器我们正在创建一个模板。接下来，我们在尖括号 ( <code>&lt;&gt;</code> ) 内指定模板将使用的所有模板参数。对于每个类型模板参数，我们使用关键字<code>typename</code>或<code>class</code> ，后跟类型模板参数的名称（例如<code>T</code>）。</p>
<p>当函数模板被实例化时，编译器将模板形参替换为模板实参，然后编译生成的实例化函数。函数是否编译取决于每种类型的对象在函数内的使用方式。</p>
<p>从函数模板创建具有特定类型的函数的过程称为<strong>函数模板实例化</strong>（function template instantiation，或简称<strong>实例化</strong>）。当函数因函数调用而实例化时，称为<strong>隐式实例化</strong>。从模板实例化得到的函数在技术上称为<strong>特化</strong>，但在通用语言中通常称为<strong>函数实例</strong>。</p>
<div class="admonition example">
<p class="admonition-title">Example</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-61-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-61-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-61-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-61-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-61-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-61-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-61-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-61-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-61-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-61-10">10</a></span>
<span class="normal"><a href="#__codelineno-61-11">11</a></span>
<span class="normal"><a href="#__codelineno-61-12">12</a></span>
<span class="normal"><a href="#__codelineno-61-13">13</a></span>
<span class="normal"><a href="#__codelineno-61-14">14</a></span>
<span class="normal"><a href="#__codelineno-61-15">15</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-61-1" name="__codelineno-61-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span>
<a id="__codelineno-61-2" name="__codelineno-61-2"></a>
<a id="__codelineno-61-3" name="__codelineno-61-3"></a><span class="k">template</span><span class="w"> </span><span class="o">&lt;</span><span class="k">typename</span><span class="w"> </span><span class="nc">T</span><span class="o">&gt;</span>
<a id="__codelineno-61-4" name="__codelineno-61-4"></a><span class="n">T</span><span class="w"> </span><span class="n">max</span><span class="p">(</span><span class="n">T</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="w"> </span><span class="n">y</span><span class="p">)</span>
<a id="__codelineno-61-5" name="__codelineno-61-5"></a><span class="p">{</span>
<a id="__codelineno-61-6" name="__codelineno-61-6"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">y</span><span class="p">)</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">x</span><span class="p">;</span>
<a id="__codelineno-61-7" name="__codelineno-61-7"></a><span class="p">}</span>
<a id="__codelineno-61-8" name="__codelineno-61-8"></a>
<a id="__codelineno-61-9" name="__codelineno-61-9"></a><span class="kt">int</span><span class="w"> </span><span class="n">main</span><span class="p">()</span>
<a id="__codelineno-61-10" name="__codelineno-61-10"></a><span class="p">{</span>
<a id="__codelineno-61-11" name="__codelineno-61-11"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">max</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="sc">'\n'</span><span class="p">;</span><span class="w"> </span><span class="c1">// instantiates and calls max&lt;int&gt;(int, int)</span>
<a id="__codelineno-61-12" name="__codelineno-61-12"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">max</span><span class="p">(</span><span class="mf">3.0</span><span class="p">,</span><span class="w"> </span><span class="mf">5.0</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="sc">'\n'</span><span class="p">;</span><span class="w"> </span><span class="c1">// instantiates and calls max&lt;double&gt;(double, double)</span>
<a id="__codelineno-61-13" name="__codelineno-61-13"></a>
<a id="__codelineno-61-14" name="__codelineno-61-14"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-61-15" name="__codelineno-61-15"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>在这个例子中，<code>max(3, 5)</code> 实例化为 <code>max&lt;int&gt;(int, int)</code>，而 <code>max(3.0, 5.0)</code> 实例化为 <code>max&lt;double&gt;(double, double)</code>。</p>
<p>我们还可以指定函数模板实例化某种特定的参数，例如我们可以使用 <code>max&lt;long&gt;(1, 2)</code> 来实例化得到 <code>max&lt;long&gt;(long, long)</code>，其中 <code>1</code> 和 <code>2</code> 会被隐式转换为 <code>long</code>。</p>
</div>
<h4 id="_23">具有多个模板参数的函数模板<a class="headerlink" href="#_23" title="Permanent link">¶</a></h4>
<p>现在我们考虑下面的程序</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-62-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-62-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-62-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-62-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-62-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-62-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-62-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-62-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-62-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-62-10">10</a></span>
<span class="normal"><a href="#__codelineno-62-11">11</a></span>
<span class="normal"><a href="#__codelineno-62-12">12</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-62-1" name="__codelineno-62-1"></a><span class="k">template</span><span class="w"> </span><span class="o">&lt;</span><span class="k">typename</span><span class="w"> </span><span class="nc">T</span><span class="o">&gt;</span>
<a id="__codelineno-62-2" name="__codelineno-62-2"></a><span class="n">T</span><span class="w"> </span><span class="n">max</span><span class="p">(</span><span class="n">T</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="w"> </span><span class="n">y</span><span class="p">)</span>
<a id="__codelineno-62-3" name="__codelineno-62-3"></a><span class="p">{</span>
<a id="__codelineno-62-4" name="__codelineno-62-4"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">y</span><span class="p">)</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">x</span><span class="p">;</span>
<a id="__codelineno-62-5" name="__codelineno-62-5"></a><span class="p">}</span>
<a id="__codelineno-62-6" name="__codelineno-62-6"></a>
<a id="__codelineno-62-7" name="__codelineno-62-7"></a><span class="kt">int</span><span class="w"> </span><span class="n">main</span><span class="p">()</span>
<a id="__codelineno-62-8" name="__codelineno-62-8"></a><span class="p">{</span>
<a id="__codelineno-62-9" name="__codelineno-62-9"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">max</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mf">3.5</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="sc">'\n'</span><span class="p">;</span><span class="w">  </span><span class="c1">// compile error</span>
<a id="__codelineno-62-10" name="__codelineno-62-10"></a>
<a id="__codelineno-62-11" name="__codelineno-62-11"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-62-12" name="__codelineno-62-12"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>在调用 <code>max(2, 3.5)</code> 时，我们传递了 <code>int</code> 和 <code>double</code> 两种不同类型的参数，编译器首先发现并不存在一个 <code>max(int, double)</code> 的函数。接着在编译器寻找函数模板时，发现了 <code>max&lt;T&gt;(T, T)</code>，但是这里要求函数的两个参数是相同类型的，于是无法找到一个匹配的函数模板，这个函数调用无法解析，编译器会报告一个编译错误。</p>
<p>为了解决这个问题，我们可以对函数调用的参数进行显式类型转换，比如 <code>max(static_cast&lt;double&gt;(2), 3.5)</code>，或者我们也可以明确地指定函数模板把模板参数实例化为哪一种类型，比如 <code>max&lt;double&gt;(2, 3.5)</code>。</p>
<p>实际上解决这个问题的最好办法是让函数模板接受多个模板参数，这样我们就可以传递不同类型的参数给函数模板。</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-63-1">1</a></span>
<span class="normal"><a href="#__codelineno-63-2">2</a></span>
<span class="normal"><a href="#__codelineno-63-3">3</a></span>
<span class="normal"><a href="#__codelineno-63-4">4</a></span>
<span class="normal"><a href="#__codelineno-63-5">5</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-63-1" name="__codelineno-63-1"></a><span class="k">template</span><span class="w"> </span><span class="o">&lt;</span><span class="k">typename</span><span class="w"> </span><span class="nc">T</span><span class="p">,</span><span class="w"> </span><span class="k">typename</span><span class="w"> </span><span class="nc">U</span><span class="o">&gt;</span><span class="w"> </span>
<a id="__codelineno-63-2" name="__codelineno-63-2"></a><span class="n">T</span><span class="w"> </span><span class="n">max</span><span class="p">(</span><span class="n">T</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">U</span><span class="w"> </span><span class="n">y</span><span class="p">)</span>
<a id="__codelineno-63-3" name="__codelineno-63-3"></a><span class="p">{</span>
<a id="__codelineno-63-4" name="__codelineno-63-4"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">y</span><span class="p">)</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">x</span><span class="p">;</span>
<a id="__codelineno-63-5" name="__codelineno-63-5"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>但是这样还有一个问题，当我们调用这个函数时，返回值类型将始终与第一个参数的类型相同，比如 <code>max(2, 3.5)</code> 的返回值将是 <code>3</code> 而非 <code>3.5</code>。这种情况下我们可以使用 <code>auto</code> 来很方便的解决这个问题：</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-64-1">1</a></span>
<span class="normal"><a href="#__codelineno-64-2">2</a></span>
<span class="normal"><a href="#__codelineno-64-3">3</a></span>
<span class="normal"><a href="#__codelineno-64-4">4</a></span>
<span class="normal"><a href="#__codelineno-64-5">5</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-64-1" name="__codelineno-64-1"></a><span class="k">template</span><span class="w"> </span><span class="o">&lt;</span><span class="k">typename</span><span class="w"> </span><span class="nc">T</span><span class="p">,</span><span class="w"> </span><span class="k">typename</span><span class="w"> </span><span class="nc">U</span><span class="o">&gt;</span><span class="w"> </span>
<a id="__codelineno-64-2" name="__codelineno-64-2"></a><span class="k">auto</span><span class="w"> </span><span class="n">max</span><span class="p">(</span><span class="n">T</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">U</span><span class="w"> </span><span class="n">y</span><span class="p">)</span>
<a id="__codelineno-64-3" name="__codelineno-64-3"></a><span class="p">{</span>
<a id="__codelineno-64-4" name="__codelineno-64-4"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">y</span><span class="p">)</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">x</span><span class="p">;</span>
<a id="__codelineno-64-5" name="__codelineno-64-5"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>这样一来 <code>max(2, 3.5)</code> 的返回值将是 <code>3.5</code>，符合我们的预期。</p>
<div class="admonition info">
<p class="admonition-title">前向声明</p>
<p>如果我们要对一个函数进行前向声明，那么我们必须明确返回类型，这代表着我们不能直接使用 <code>auto</code> 来声明函数模板。但是我们还可以使用 <code>std::common_type_t</code> 来获取 <code>T</code> 和 <code>U</code> 的通用类型作为我们的显式返回类型。</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-65-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-65-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-65-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-65-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-65-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-65-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-65-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-65-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-65-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-65-10">10</a></span>
<span class="normal"><a href="#__codelineno-65-11">11</a></span>
<span class="normal"><a href="#__codelineno-65-12">12</a></span>
<span class="normal"><a href="#__codelineno-65-13">13</a></span>
<span class="normal"><a href="#__codelineno-65-14">14</a></span>
<span class="normal"><a href="#__codelineno-65-15">15</a></span>
<span class="normal"><a href="#__codelineno-65-16">16</a></span>
<span class="normal"><a href="#__codelineno-65-17">17</a></span>
<span class="normal"><a href="#__codelineno-65-18">18</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-65-1" name="__codelineno-65-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span>
<a id="__codelineno-65-2" name="__codelineno-65-2"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;type_traits&gt;</span><span class="c1"> // for std::common_type_t</span>
<a id="__codelineno-65-3" name="__codelineno-65-3"></a>
<a id="__codelineno-65-4" name="__codelineno-65-4"></a><span class="k">template</span><span class="w"> </span><span class="o">&lt;</span><span class="k">typename</span><span class="w"> </span><span class="nc">T</span><span class="p">,</span><span class="w"> </span><span class="k">typename</span><span class="w"> </span><span class="nc">U</span><span class="o">&gt;</span>
<a id="__codelineno-65-5" name="__codelineno-65-5"></a><span class="k">auto</span><span class="w"> </span><span class="n">max</span><span class="p">(</span><span class="n">T</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">U</span><span class="w"> </span><span class="n">y</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">common_type_t</span><span class="o">&lt;</span><span class="n">T</span><span class="p">,</span><span class="w"> </span><span class="n">U</span><span class="o">&gt;</span><span class="p">;</span><span class="w"> </span><span class="c1">// returns the common type of T and U</span>
<a id="__codelineno-65-6" name="__codelineno-65-6"></a>
<a id="__codelineno-65-7" name="__codelineno-65-7"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span>
<a id="__codelineno-65-8" name="__codelineno-65-8"></a><span class="p">{</span>
<a id="__codelineno-65-9" name="__codelineno-65-9"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">max</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mf">3.5</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="sc">'\n'</span><span class="p">;</span>
<a id="__codelineno-65-10" name="__codelineno-65-10"></a>
<a id="__codelineno-65-11" name="__codelineno-65-11"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-65-12" name="__codelineno-65-12"></a><span class="p">}</span>
<a id="__codelineno-65-13" name="__codelineno-65-13"></a>
<a id="__codelineno-65-14" name="__codelineno-65-14"></a><span class="k">template</span><span class="w"> </span><span class="o">&lt;</span><span class="k">typename</span><span class="w"> </span><span class="nc">T</span><span class="p">,</span><span class="w"> </span><span class="k">typename</span><span class="w"> </span><span class="nc">U</span><span class="o">&gt;</span>
<a id="__codelineno-65-15" name="__codelineno-65-15"></a><span class="k">auto</span><span class="w"> </span><span class="n">max</span><span class="p">(</span><span class="n">T</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">U</span><span class="w"> </span><span class="n">y</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">common_type_t</span><span class="o">&lt;</span><span class="n">T</span><span class="p">,</span><span class="w"> </span><span class="n">U</span><span class="o">&gt;</span>
<a id="__codelineno-65-16" name="__codelineno-65-16"></a><span class="p">{</span>
<a id="__codelineno-65-17" name="__codelineno-65-17"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">y</span><span class="p">)</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">x</span><span class="p">;</span>
<a id="__codelineno-65-18" name="__codelineno-65-18"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
</div>
<div class="admonition extra">
<p class="admonition-title">缩写函数模板</p>
<p>C++20 引入了<code>auto</code>关键字的新用法：当<code>auto</code>关键字在普通函数中用作参数类型时，编译器会自动将函数转换为函数模板，每个<code>auto</code>参数成为<em>独立</em>的模板类型参数。这种创建函数模板的方法称为<strong>缩写函数模板（abbreviated function template）</strong>。</p>
<p>例如</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-66-1">1</a></span>
<span class="normal"><a href="#__codelineno-66-2">2</a></span>
<span class="normal"><a href="#__codelineno-66-3">3</a></span>
<span class="normal"><a href="#__codelineno-66-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-66-1" name="__codelineno-66-1"></a><span class="k">auto</span><span class="w"> </span><span class="n">max</span><span class="p">(</span><span class="k">auto</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="n">y</span><span class="p">)</span>
<a id="__codelineno-66-2" name="__codelineno-66-2"></a><span class="p">{</span>
<a id="__codelineno-66-3" name="__codelineno-66-3"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">y</span><span class="p">)</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">x</span><span class="p">;</span>
<a id="__codelineno-66-4" name="__codelineno-66-4"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>就相当于</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-67-1">1</a></span>
<span class="normal"><a href="#__codelineno-67-2">2</a></span>
<span class="normal"><a href="#__codelineno-67-3">3</a></span>
<span class="normal"><a href="#__codelineno-67-4">4</a></span>
<span class="normal"><a href="#__codelineno-67-5">5</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-67-1" name="__codelineno-67-1"></a><span class="k">template</span><span class="w"> </span><span class="o">&lt;</span><span class="k">typename</span><span class="w"> </span><span class="nc">T</span><span class="p">,</span><span class="w"> </span><span class="k">typename</span><span class="w"> </span><span class="nc">U</span><span class="o">&gt;</span><span class="w"> </span>
<a id="__codelineno-67-2" name="__codelineno-67-2"></a><span class="k">auto</span><span class="w"> </span><span class="n">max</span><span class="p">(</span><span class="n">T</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">U</span><span class="w"> </span><span class="n">y</span><span class="p">)</span>
<a id="__codelineno-67-3" name="__codelineno-67-3"></a><span class="p">{</span>
<a id="__codelineno-67-4" name="__codelineno-67-4"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">y</span><span class="p">)</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">x</span><span class="p">;</span>
<a id="__codelineno-67-5" name="__codelineno-67-5"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>如果我们希望函数模板里的每一个模板类型参数都是独立的类型，就可以选择使用上面的缩写函数模板。但如果我们想让多个模板类型参数是相同的类型，那么目前并没有更简洁的方法来实现下面的写法：</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-68-1">1</a></span>
<span class="normal"><a href="#__codelineno-68-2">2</a></span>
<span class="normal"><a href="#__codelineno-68-3">3</a></span>
<span class="normal"><a href="#__codelineno-68-4">4</a></span>
<span class="normal"><a href="#__codelineno-68-5">5</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-68-1" name="__codelineno-68-1"></a><span class="k">template</span><span class="w"> </span><span class="o">&lt;</span><span class="k">typename</span><span class="w"> </span><span class="nc">T</span><span class="o">&gt;</span>
<a id="__codelineno-68-2" name="__codelineno-68-2"></a><span class="n">T</span><span class="w"> </span><span class="n">max</span><span class="p">(</span><span class="n">T</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="w"> </span><span class="n">y</span><span class="p">)</span><span class="w"> </span><span class="c1">// two parameters of the same type</span>
<a id="__codelineno-68-3" name="__codelineno-68-3"></a><span class="p">{</span>
<a id="__codelineno-68-4" name="__codelineno-68-4"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">y</span><span class="p">)</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">x</span><span class="p">;</span>
<a id="__codelineno-68-5" name="__codelineno-68-5"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
</div>
<h4 id="_24">非类型模板参数<a class="headerlink" href="#_24" title="Permanent link">¶</a></h4>
<p><strong>非类型模板参数（non-type template parameter）</strong>是指具体有固定类型的模板参数，它以占位符的形式作为模板参数向函数传递 constexpr 值。</p>
<p>非类型模板参数可以是以下的任何类型：</p>
<ul>
<li>整型</li>
<li>枚举类型</li>
<li><code>std::nullptr_t</code></li>
<li>浮点型（从 C++20 开始）</li>
<li>指向一个对象的指针或引用</li>
<li>指向函数的指针或引用</li>
<li>指向成员函数的指针或引用</li>
<li>字面量类类型（从 C++20 开始）</li>
</ul>
<div class="admonition example">
<p class="admonition-title">Example</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-69-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-69-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-69-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-69-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-69-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-69-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-69-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-69-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-69-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-69-10">10</a></span>
<span class="normal"><a href="#__codelineno-69-11">11</a></span>
<span class="normal"><a href="#__codelineno-69-12">12</a></span>
<span class="normal"><a href="#__codelineno-69-13">13</a></span>
<span class="normal"><a href="#__codelineno-69-14">14</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-69-1" name="__codelineno-69-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span>
<a id="__codelineno-69-2" name="__codelineno-69-2"></a>
<a id="__codelineno-69-3" name="__codelineno-69-3"></a><span class="k">template</span><span class="w"> </span><span class="o">&lt;</span><span class="kt">int</span><span class="w"> </span><span class="n">N</span><span class="o">&gt;</span><span class="w"> </span><span class="c1">// declare a non-type template parameter of type int named N</span>
<a id="__codelineno-69-4" name="__codelineno-69-4"></a><span class="kt">void</span><span class="w"> </span><span class="n">print</span><span class="p">()</span>
<a id="__codelineno-69-5" name="__codelineno-69-5"></a><span class="p">{</span>
<a id="__codelineno-69-6" name="__codelineno-69-6"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">N</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="sc">'\n'</span><span class="p">;</span><span class="w"> </span><span class="c1">// use value of N here</span>
<a id="__codelineno-69-7" name="__codelineno-69-7"></a><span class="p">}</span>
<a id="__codelineno-69-8" name="__codelineno-69-8"></a>
<a id="__codelineno-69-9" name="__codelineno-69-9"></a><span class="kt">int</span><span class="w"> </span><span class="n">main</span><span class="p">()</span>
<a id="__codelineno-69-10" name="__codelineno-69-10"></a><span class="p">{</span>
<a id="__codelineno-69-11" name="__codelineno-69-11"></a><span class="w">    </span><span class="n">print</span><span class="o">&lt;</span><span class="mi">5</span><span class="o">&gt;</span><span class="p">();</span><span class="w"> </span><span class="c1">// 5 is our non-type template argument</span>
<a id="__codelineno-69-12" name="__codelineno-69-12"></a>
<a id="__codelineno-69-13" name="__codelineno-69-13"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-69-14" name="__codelineno-69-14"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>编译器看到函数调用 <code>print&lt;5&gt;()</code> 时，会实例化一个如下所示的函数</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-70-1">1</a></span>
<span class="normal"><a href="#__codelineno-70-2">2</a></span>
<span class="normal"><a href="#__codelineno-70-3">3</a></span>
<span class="normal"><a href="#__codelineno-70-4">4</a></span>
<span class="normal"><a href="#__codelineno-70-5">5</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-70-1" name="__codelineno-70-1"></a><span class="k">template</span><span class="w"> </span><span class="o">&lt;&gt;</span>
<a id="__codelineno-70-2" name="__codelineno-70-2"></a><span class="kt">void</span><span class="w"> </span><span class="n">print</span><span class="o">&lt;</span><span class="mi">5</span><span class="o">&gt;</span><span class="p">()</span>
<a id="__codelineno-70-3" name="__codelineno-70-3"></a><span class="p">{</span>
<a id="__codelineno-70-4" name="__codelineno-70-4"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="sc">'\n'</span><span class="p">;</span>
<a id="__codelineno-70-5" name="__codelineno-70-5"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
</div>
<p>非类型模板参数主要在我们需要将 constexpr 值传递给函数（或类类型）时使用，这样它就可以在需要常量表达式时传递数据。</p>
<p>从 C++17 开始，非类型模板参数可以使用<code>auto</code>让编译器从函数调用的实参中推导出非类型模板参数</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-71-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-71-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-71-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-71-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-71-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-71-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-71-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-71-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-71-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-71-10">10</a></span>
<span class="normal"><a href="#__codelineno-71-11">11</a></span>
<span class="normal"><a href="#__codelineno-71-12">12</a></span>
<span class="normal"><a href="#__codelineno-71-13">13</a></span>
<span class="normal"><a href="#__codelineno-71-14">14</a></span>
<span class="normal"><a href="#__codelineno-71-15">15</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-71-1" name="__codelineno-71-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span>
<a id="__codelineno-71-2" name="__codelineno-71-2"></a>
<a id="__codelineno-71-3" name="__codelineno-71-3"></a><span class="k">template</span><span class="w"> </span><span class="o">&lt;</span><span class="k">auto</span><span class="w"> </span><span class="n">N</span><span class="o">&gt;</span><span class="w"> </span><span class="c1">// deduce non-type template parameter from template argument</span>
<a id="__codelineno-71-4" name="__codelineno-71-4"></a><span class="kt">void</span><span class="w"> </span><span class="n">print</span><span class="p">()</span>
<a id="__codelineno-71-5" name="__codelineno-71-5"></a><span class="p">{</span>
<a id="__codelineno-71-6" name="__codelineno-71-6"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">N</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="sc">'\n'</span><span class="p">;</span>
<a id="__codelineno-71-7" name="__codelineno-71-7"></a><span class="p">}</span>
<a id="__codelineno-71-8" name="__codelineno-71-8"></a>
<a id="__codelineno-71-9" name="__codelineno-71-9"></a><span class="kt">int</span><span class="w"> </span><span class="n">main</span><span class="p">()</span>
<a id="__codelineno-71-10" name="__codelineno-71-10"></a><span class="p">{</span>
<a id="__codelineno-71-11" name="__codelineno-71-11"></a><span class="w">    </span><span class="n">print</span><span class="o">&lt;</span><span class="mi">5</span><span class="o">&gt;</span><span class="p">();</span><span class="w">   </span><span class="c1">// N deduced as int `5`</span>
<a id="__codelineno-71-12" name="__codelineno-71-12"></a><span class="w">    </span><span class="n">print</span><span class="o">&lt;</span><span class="sc">'c'</span><span class="o">&gt;</span><span class="p">();</span><span class="w"> </span><span class="c1">// N deduced as char `c`</span>
<a id="__codelineno-71-13" name="__codelineno-71-13"></a>
<a id="__codelineno-71-14" name="__codelineno-71-14"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-71-15" name="__codelineno-71-15"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h4 id="_25">多文件程序中使用函数模板<a class="headerlink" href="#_25" title="Permanent link">¶</a></h4>
<p>考虑下面的程序，它并不能正常工作</p>
<div class="highlight"><table class="highlighttable"><tr><th class="filename" colspan="2"><span class="filename">main.cpp</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-72-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-72-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-72-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-72-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-72-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-72-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-72-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-72-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-72-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-72-10">10</a></span>
<span class="normal"><a href="#__codelineno-72-11">11</a></span>
<span class="normal"><a href="#__codelineno-72-12">12</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-72-1" name="__codelineno-72-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span>
<a id="__codelineno-72-2" name="__codelineno-72-2"></a>
<a id="__codelineno-72-3" name="__codelineno-72-3"></a><span class="k">template</span><span class="w"> </span><span class="o">&lt;</span><span class="k">typename</span><span class="w"> </span><span class="nc">T</span><span class="o">&gt;</span>
<a id="__codelineno-72-4" name="__codelineno-72-4"></a><span class="n">T</span><span class="w"> </span><span class="n">addOne</span><span class="p">(</span><span class="n">T</span><span class="w"> </span><span class="n">x</span><span class="p">);</span><span class="w"> </span><span class="c1">// function template forward declaration</span>
<a id="__codelineno-72-5" name="__codelineno-72-5"></a>
<a id="__codelineno-72-6" name="__codelineno-72-6"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span>
<a id="__codelineno-72-7" name="__codelineno-72-7"></a><span class="p">{</span>
<a id="__codelineno-72-8" name="__codelineno-72-8"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">addOne</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="sc">'\n'</span><span class="p">;</span>
<a id="__codelineno-72-9" name="__codelineno-72-9"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">addOne</span><span class="p">(</span><span class="mf">2.3</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="sc">'\n'</span><span class="p">;</span>
<a id="__codelineno-72-10" name="__codelineno-72-10"></a>
<a id="__codelineno-72-11" name="__codelineno-72-11"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-72-12" name="__codelineno-72-12"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<div class="highlight"><table class="highlighttable"><tr><th class="filename" colspan="2"><span class="filename">add.cpp</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-73-1">1</a></span>
<span class="normal"><a href="#__codelineno-73-2">2</a></span>
<span class="normal"><a href="#__codelineno-73-3">3</a></span>
<span class="normal"><a href="#__codelineno-73-4">4</a></span>
<span class="normal"><a href="#__codelineno-73-5">5</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-73-1" name="__codelineno-73-1"></a><span class="k">template</span><span class="w"> </span><span class="o">&lt;</span><span class="k">typename</span><span class="w"> </span><span class="nc">T</span><span class="o">&gt;</span>
<a id="__codelineno-73-2" name="__codelineno-73-2"></a><span class="n">T</span><span class="w"> </span><span class="n">addOne</span><span class="p">(</span><span class="n">T</span><span class="w"> </span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="c1">// function template definition</span>
<a id="__codelineno-73-3" name="__codelineno-73-3"></a><span class="p">{</span>
<a id="__codelineno-73-4" name="__codelineno-73-4"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<a id="__codelineno-73-5" name="__codelineno-73-5"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>在 main.cpp 中，我们调用<code>addOne&lt;int&gt;</code>和<code>addOne&lt;double&gt;</code>，但是编译器由于在这个翻译单元中看不到 <code>addOne()</code> 的定义，它无法在 main.cpp 中实例化这些函数。但是它确实看到了 <code>addOne</code> 的前向声明，并且会假设这些函数存在于其他地方，并将在稍后链接。</p>
<p>当编译器去编译 add.cpp 时，它会看到函数模板<code>addOne</code>的定义。但是,add.cpp 中没有使用此模板，因此编译器不会实例化任何内容。最终结果是链接器无法将对 main.cpp 中的<code>addOne&lt;int&gt;</code>和<code>addOne&lt;double&gt;</code>的调用连接到实际函数，因为这些函数从未实例化。</p>
<p>解决这个问题最传统的办法是把所有的模板代码都放入 <code>.h</code> 头文件中，而非 <code>.cpp</code> 源文件中</p>
<div class="highlight"><table class="highlighttable"><tr><th class="filename" colspan="2"><span class="filename">add.h</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-74-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-74-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-74-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-74-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-74-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-74-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-74-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-74-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-74-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-74-10">10</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-74-1" name="__codelineno-74-1"></a><span class="cp">#ifndef ADD_H</span>
<a id="__codelineno-74-2" name="__codelineno-74-2"></a><span class="cp">#define ADD_H</span>
<a id="__codelineno-74-3" name="__codelineno-74-3"></a>
<a id="__codelineno-74-4" name="__codelineno-74-4"></a><span class="k">template</span><span class="w"> </span><span class="o">&lt;</span><span class="k">typename</span><span class="w"> </span><span class="nc">T</span><span class="o">&gt;</span>
<a id="__codelineno-74-5" name="__codelineno-74-5"></a><span class="n">T</span><span class="w"> </span><span class="n">addOne</span><span class="p">(</span><span class="n">T</span><span class="w"> </span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="c1">// function template definition</span>
<a id="__codelineno-74-6" name="__codelineno-74-6"></a><span class="p">{</span>
<a id="__codelineno-74-7" name="__codelineno-74-7"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<a id="__codelineno-74-8" name="__codelineno-74-8"></a><span class="p">}</span>
<a id="__codelineno-74-9" name="__codelineno-74-9"></a>
<a id="__codelineno-74-10" name="__codelineno-74-10"></a><span class="cp">#endif</span>
</code></pre></div></td></tr></table></div>
<div class="highlight"><table class="highlighttable"><tr><th class="filename" colspan="2"><span class="filename">main.cpp</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-75-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-75-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-75-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-75-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-75-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-75-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-75-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-75-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-75-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-75-10">10</a></span>
<span class="normal"><a href="#__codelineno-75-11">11</a></span>
<span class="normal"><a href="#__codelineno-75-12">12</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-75-1" name="__codelineno-75-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span>
<a id="__codelineno-75-2" name="__codelineno-75-2"></a>
<a id="__codelineno-75-3" name="__codelineno-75-3"></a><span class="k">template</span><span class="w"> </span><span class="o">&lt;</span><span class="k">typename</span><span class="w"> </span><span class="nc">T</span><span class="o">&gt;</span>
<a id="__codelineno-75-4" name="__codelineno-75-4"></a><span class="n">T</span><span class="w"> </span><span class="n">addOne</span><span class="p">(</span><span class="n">T</span><span class="w"> </span><span class="n">x</span><span class="p">);</span><span class="w"> </span><span class="c1">// function template forward declaration</span>
<a id="__codelineno-75-5" name="__codelineno-75-5"></a>
<a id="__codelineno-75-6" name="__codelineno-75-6"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span>
<a id="__codelineno-75-7" name="__codelineno-75-7"></a><span class="p">{</span>
<a id="__codelineno-75-8" name="__codelineno-75-8"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">addOne</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="sc">'\n'</span><span class="p">;</span>
<a id="__codelineno-75-9" name="__codelineno-75-9"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">addOne</span><span class="p">(</span><span class="mf">2.3</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="sc">'\n'</span><span class="p">;</span>
<a id="__codelineno-75-10" name="__codelineno-75-10"></a>
<a id="__codelineno-75-11" name="__codelineno-75-11"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-75-12" name="__codelineno-75-12"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>这样，任何需要访问模板的文件都可以 <code>#include</code> 相关头文件，模板定义将由预处理器复制到源文件中，然后编译器将能够实例化所需的任何函数。</p>
<h3 id="constexpr_2">constexpr 函数<a class="headerlink" href="#constexpr_2" title="Permanent link">¶</a></h3>
<p>一般的函数是在程序运行时执行的，因此不能参与到一个常量表达式之中。在函数返回值类型之前加上一个 <code>constexpr</code> 关键字可以告诉编译器这个函数可以在编译时执行，因此可以用于常量表达式。</p>
<p>如果一个被使用的常量表达式中包含一个 constexpr 函数，那么这个 constexpr 函数调用必须在编译时求值。</p>
<p>要在编译时对函数进行执行，还必须满足其他两件事：</p>
<ul>
<li>调用 constexpr 函数时使用的参数必须都是编译时已知的（例如常量表达式）</li>
<li>constexpr 函数中的所有语句和表达式都必须可在编译时计算</li>
</ul>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>和 constexpr 变量类似，constexpr 函数表示的是“可以在编译时计算的函数”，这意味着它可以在常量表达式中使用，但实际上它也可能在运行时才求值，例如</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-76-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-76-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-76-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-76-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-76-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-76-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-76-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-76-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-76-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-76-10">10</a></span>
<span class="normal"><a href="#__codelineno-76-11">11</a></span>
<span class="normal"><a href="#__codelineno-76-12">12</a></span>
<span class="normal"><a href="#__codelineno-76-13">13</a></span>
<span class="normal"><a href="#__codelineno-76-14">14</a></span>
<span class="normal"><a href="#__codelineno-76-15">15</a></span>
<span class="normal"><a href="#__codelineno-76-16">16</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-76-1" name="__codelineno-76-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span>
<a id="__codelineno-76-2" name="__codelineno-76-2"></a>
<a id="__codelineno-76-3" name="__codelineno-76-3"></a><span class="k">constexpr</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">greater</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">y</span><span class="p">)</span>
<a id="__codelineno-76-4" name="__codelineno-76-4"></a><span class="p">{</span>
<a id="__codelineno-76-5" name="__codelineno-76-5"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">y</span><span class="p">);</span>
<a id="__codelineno-76-6" name="__codelineno-76-6"></a><span class="p">}</span>
<a id="__codelineno-76-7" name="__codelineno-76-7"></a>
<a id="__codelineno-76-8" name="__codelineno-76-8"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span>
<a id="__codelineno-76-9" name="__codelineno-76-9"></a><span class="p">{</span>
<a id="__codelineno-76-10" name="__codelineno-76-10"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">{</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="p">};</span><span class="w"> </span><span class="c1">// not constexpr</span>
<a id="__codelineno-76-11" name="__codelineno-76-11"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">y</span><span class="p">{</span><span class="w"> </span><span class="mi">6</span><span class="w"> </span><span class="p">};</span><span class="w"> </span><span class="c1">// not constexpr</span>
<a id="__codelineno-76-12" name="__codelineno-76-12"></a>
<a id="__codelineno-76-13" name="__codelineno-76-13"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">greater</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">" is greater!</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span><span class="w"> </span><span class="c1">// will be evaluated at runtime</span>
<a id="__codelineno-76-14" name="__codelineno-76-14"></a>
<a id="__codelineno-76-15" name="__codelineno-76-15"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-76-16" name="__codelineno-76-16"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>在这个例子中，<code>x</code> 和 <code>y</code> 都不是常量表达式，因此在编译时 <code>greater(x, y)</code> 无法被解析，它会像一个普通函数一样在程序运行时返回结果，<code>constexpr</code> 在这种情况下没有任何作用。</p>
</div>
<p>当 constexpr 函数中包含了非常量表达式，或者其他的非 constexpr 函数时，它就无法在编译时被运算，这时它也无法被用在常量表达式中。</p>
<p>因此 constexpr 函数需要被用在常量表达式之中时，它必须在编译时被计算。在我们把 constexpr 函数用在常量表达式中时最好随时对代码进行编译、检查，以测试它是否能通过编译。</p>
<div class="admonition info">
<p class="admonition-title">constexpr/consteval 函数的参数并不是 constexpr 的</p>
<p>constexpr 函数的参数并不是隐式的 constexpr 变量，也不能声明为 <code>constexpr</code>，因此他们不能在函数内的常量表达式中使用。</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-77-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-77-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-77-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-77-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-77-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-77-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-77-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-77-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-77-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-77-10">10</a></span>
<span class="normal"><a href="#__codelineno-77-11">11</a></span>
<span class="normal"><a href="#__codelineno-77-12">12</a></span>
<span class="normal"><a href="#__codelineno-77-13">13</a></span>
<span class="normal"><a href="#__codelineno-77-14">14</a></span>
<span class="normal"><a href="#__codelineno-77-15">15</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-77-1" name="__codelineno-77-1"></a><span class="k">constexpr</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">foo</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">b</span><span class="p">)</span><span class="w">    </span><span class="c1">// b is not constexpr, and cannot be used in constant expressions</span>
<a id="__codelineno-77-2" name="__codelineno-77-2"></a><span class="p">{</span>
<a id="__codelineno-77-3" name="__codelineno-77-3"></a><span class="w">    </span><span class="k">constexpr</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">b2</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="p">};</span><span class="w"> </span><span class="c1">// compile error: constexpr variable requires constant expression initializer</span>
<a id="__codelineno-77-4" name="__codelineno-77-4"></a>
<a id="__codelineno-77-5" name="__codelineno-77-5"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">goo</span><span class="p">(</span><span class="n">b</span><span class="p">);</span><span class="w">          </span><span class="c1">// compile error: consteval function call requires constant expression argument</span>
<a id="__codelineno-77-6" name="__codelineno-77-6"></a><span class="p">}</span>
<a id="__codelineno-77-7" name="__codelineno-77-7"></a>
<a id="__codelineno-77-8" name="__codelineno-77-8"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span>
<a id="__codelineno-77-9" name="__codelineno-77-9"></a><span class="p">{</span>
<a id="__codelineno-77-10" name="__codelineno-77-10"></a><span class="w">    </span><span class="k">constexpr</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="p">};</span>
<a id="__codelineno-77-11" name="__codelineno-77-11"></a>
<a id="__codelineno-77-12" name="__codelineno-77-12"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">foo</span><span class="p">(</span><span class="n">a</span><span class="p">);</span><span class="w"> </span><span class="c1">// okay: constant expression a can be used as argument to constexpr function foo()</span>
<a id="__codelineno-77-13" name="__codelineno-77-13"></a>
<a id="__codelineno-77-14" name="__codelineno-77-14"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-77-15" name="__codelineno-77-15"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>在这个例子中，constexpr 函数的参数 <code>b</code> 不是 constexpr 的（即使函数调用中的 <code>a</code> 时一个常量表达式），它不能被用在需要常量表达式的任何地方。</p>
<ul>
<li>constexpr 函数的参数可以声明为 <code>const</code> ，但在这种情况下，它们仅被视为一般的运行时常量。</li>
</ul>
</div>
<h4 id="constexpr_3">constexpr 函数是隐式内联的<a class="headerlink" href="#constexpr_3" title="Permanent link">¶</a></h4>
<p>当 constexpr 函数在编译时被计算时，编译器必须在这个 constexpr 函数被调用前知道它的完整定义，这样编译器才可以在编译时就用函数的结果替换掉这个函数所在的调用语句。</p>
<p>在这种情况下，仅仅是前向声明是不够的，这意味着被多个文件使用的 constexpr 函数的定义需要被包含到每一个翻译单元中来——这通常会违反单一定义原则（one-definition rule，多个翻译单元中不能出现完全一致的函数定义，除非这个函数是内联函数）。为了避免此类问题，constexpr 函数是隐式内联的，这使得它们不受单一定义规则的约束。</p>
<p>因此，constexpr 函数通常在头文件中定义，因此可以将它们 <code>#included</code> 到任何需要完整定义的 .cpp 文件中。</p>
<div class="admonition abstract">
<p class="admonition-title">Abstract</p>
<ul>
<li>被单个源文件 (.cpp) 中使用的 constexpr/consteval 函数应在使用它们的上方源文件中定义。</li>
<li>被多个源文件中使用的 constexpr/consteval 函数应在头文件中定义，以便它们可以包含在每个源文件中。</li>
</ul>
</div>
<div class="admonition property">
<p class="admonition-title">编译时求值的 constexpr 函数的前向声明</p>
<p>根据 CWG2166 ，对在编译时求值的 constexpr 函数的前向声明的要求实际上是“constexpr 函数必须在最终导致调用的最外层计算之前定义”。因此，下面的代码是有效的</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-78-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-78-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-78-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-78-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-78-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-78-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-78-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-78-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-78-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-78-10">10</a></span>
<span class="normal"><a href="#__codelineno-78-11">11</a></span>
<span class="normal"><a href="#__codelineno-78-12">12</a></span>
<span class="normal"><a href="#__codelineno-78-13">13</a></span>
<span class="normal"><a href="#__codelineno-78-14">14</a></span>
<span class="normal"><a href="#__codelineno-78-15">15</a></span>
<span class="normal"><a href="#__codelineno-78-16">16</a></span>
<span class="normal"><a href="#__codelineno-78-17">17</a></span>
<span class="normal"><a href="#__codelineno-78-18">18</a></span>
<span class="normal"><a href="#__codelineno-78-19">19</a></span>
<span class="normal"><a href="#__codelineno-78-20">20</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-78-1" name="__codelineno-78-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span>
<a id="__codelineno-78-2" name="__codelineno-78-2"></a>
<a id="__codelineno-78-3" name="__codelineno-78-3"></a><span class="k">constexpr</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">foo</span><span class="p">(</span><span class="kt">int</span><span class="p">);</span>
<a id="__codelineno-78-4" name="__codelineno-78-4"></a>
<a id="__codelineno-78-5" name="__codelineno-78-5"></a><span class="k">constexpr</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">goo</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">c</span><span class="p">)</span>
<a id="__codelineno-78-6" name="__codelineno-78-6"></a><span class="p">{</span>
<a id="__codelineno-78-7" name="__codelineno-78-7"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">foo</span><span class="p">(</span><span class="n">c</span><span class="p">);</span><span class="w">   </span><span class="c1">// note that foo is not defined yet</span>
<a id="__codelineno-78-8" name="__codelineno-78-8"></a><span class="p">}</span>
<a id="__codelineno-78-9" name="__codelineno-78-9"></a>
<a id="__codelineno-78-10" name="__codelineno-78-10"></a><span class="k">constexpr</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">foo</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">b</span><span class="p">)</span><span class="w"> </span><span class="c1">// okay because foo is still defined before any calls to goo</span>
<a id="__codelineno-78-11" name="__codelineno-78-11"></a><span class="p">{</span>
<a id="__codelineno-78-12" name="__codelineno-78-12"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">b</span><span class="p">;</span>
<a id="__codelineno-78-13" name="__codelineno-78-13"></a><span class="p">}</span>
<a id="__codelineno-78-14" name="__codelineno-78-14"></a>
<a id="__codelineno-78-15" name="__codelineno-78-15"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span>
<a id="__codelineno-78-16" name="__codelineno-78-16"></a><span class="p">{</span>
<a id="__codelineno-78-17" name="__codelineno-78-17"></a><span class="w">    </span><span class="k">constexpr</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">a</span><span class="p">{</span><span class="w"> </span><span class="n">goo</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="w"> </span><span class="p">};</span><span class="w"> </span><span class="c1">// this is the outermost invocation</span>
<a id="__codelineno-78-18" name="__codelineno-78-18"></a>
<a id="__codelineno-78-19" name="__codelineno-78-19"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-78-20" name="__codelineno-78-20"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>这么做的目的是允许 constexpr 函数进行相互递归。</p>
</div>
<h4 id="consteval">consteval<a class="headerlink" href="#consteval" title="Permanent link">¶</a></h4>
<p>当 constexpr 函数不在常量表达式中调用时，我们没办法保证编译器在编译时求值这个函数。解决这个问题的最简单粗暴的方法是用这个 constexpr 函数的返回值去初始化一个变量，但这样就会导致一个不必要的变量，也会使得代码变得冗长且丑陋。</p>
<p>为了解决这个问题，C++20 引入了 <code>consteval</code> 关键字，它表示这个函数必须在编译时求值，否则将导致编译错误。</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-79-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-79-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-79-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-79-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-79-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-79-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-79-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-79-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-79-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-79-10">10</a></span>
<span class="normal"><a href="#__codelineno-79-11">11</a></span>
<span class="normal"><a href="#__codelineno-79-12">12</a></span>
<span class="normal"><a href="#__codelineno-79-13">13</a></span>
<span class="normal"><a href="#__codelineno-79-14">14</a></span>
<span class="normal"><a href="#__codelineno-79-15">15</a></span>
<span class="normal"><a href="#__codelineno-79-16">16</a></span>
<span class="normal"><a href="#__codelineno-79-17">17</a></span>
<span class="normal"><a href="#__codelineno-79-18">18</a></span>
<span class="normal"><a href="#__codelineno-79-19">19</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-79-1" name="__codelineno-79-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span>
<a id="__codelineno-79-2" name="__codelineno-79-2"></a>
<a id="__codelineno-79-3" name="__codelineno-79-3"></a><span class="k">consteval</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">greater</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">y</span><span class="p">)</span><span class="w"> </span><span class="c1">// function is now consteval</span>
<a id="__codelineno-79-4" name="__codelineno-79-4"></a><span class="p">{</span>
<a id="__codelineno-79-5" name="__codelineno-79-5"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">y</span><span class="p">);</span>
<a id="__codelineno-79-6" name="__codelineno-79-6"></a><span class="p">}</span>
<a id="__codelineno-79-7" name="__codelineno-79-7"></a>
<a id="__codelineno-79-8" name="__codelineno-79-8"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span>
<a id="__codelineno-79-9" name="__codelineno-79-9"></a><span class="p">{</span>
<a id="__codelineno-79-10" name="__codelineno-79-10"></a><span class="w">    </span><span class="k">constexpr</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">greater</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="p">)</span><span class="w"> </span><span class="p">};</span><span class="w">              </span><span class="c1">// ok: will evaluate at compile-time</span>
<a id="__codelineno-79-11" name="__codelineno-79-11"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="sc">'\n'</span><span class="p">;</span>
<a id="__codelineno-79-12" name="__codelineno-79-12"></a>
<a id="__codelineno-79-13" name="__codelineno-79-13"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">greater</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">" is greater!</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span><span class="w"> </span><span class="c1">// ok: will evaluate at compile-time</span>
<a id="__codelineno-79-14" name="__codelineno-79-14"></a>
<a id="__codelineno-79-15" name="__codelineno-79-15"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">{</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="p">};</span><span class="w"> </span><span class="c1">// not constexpr</span>
<a id="__codelineno-79-16" name="__codelineno-79-16"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">greater</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">" is greater!</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span><span class="w"> </span><span class="c1">// error: consteval functions must evaluate at compile-time</span>
<a id="__codelineno-79-17" name="__codelineno-79-17"></a>
<a id="__codelineno-79-18" name="__codelineno-79-18"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-79-19" name="__codelineno-79-19"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>上面的例子中，对 <code>greater(x, 6)</code> 的调用无法在编译时求值，因此会导致编译错误。</p>
<p>consteval 函数的缺点是此类函数无法在运行时求值，这使得它不如 constexpr 函数灵活——后者可以在编译时或运行时执行。因此，有一种使得 constexpr 函数在编译时强制执行的方法还是很有用的，这样我们就可以在可能时让函数在编译时求值，不能时就在运行时求值。</p>
<p>C++20 为 constexpr 函数提供了实现这一目标的方法——使用一个简洁的辅助函数</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-80-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-80-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-80-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-80-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-80-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-80-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-80-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-80-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-80-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-80-10">10</a></span>
<span class="normal"><a href="#__codelineno-80-11">11</a></span>
<span class="normal"><a href="#__codelineno-80-12">12</a></span>
<span class="normal"><a href="#__codelineno-80-13">13</a></span>
<span class="normal"><a href="#__codelineno-80-14">14</a></span>
<span class="normal"><a href="#__codelineno-80-15">15</a></span>
<span class="normal"><a href="#__codelineno-80-16">16</a></span>
<span class="normal"><a href="#__codelineno-80-17">17</a></span>
<span class="normal"><a href="#__codelineno-80-18">18</a></span>
<span class="normal"><a href="#__codelineno-80-19">19</a></span>
<span class="normal"><a href="#__codelineno-80-20">20</a></span>
<span class="normal"><a href="#__codelineno-80-21">21</a></span>
<span class="normal"><a href="#__codelineno-80-22">22</a></span>
<span class="normal"><a href="#__codelineno-80-23">23</a></span>
<span class="normal"><a href="#__codelineno-80-24">24</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-80-1" name="__codelineno-80-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span>
<a id="__codelineno-80-2" name="__codelineno-80-2"></a>
<a id="__codelineno-80-3" name="__codelineno-80-3"></a><span class="c1">// Uses abbreviated function template (C++20) and `auto` return type to make this function work with any type of value</span>
<a id="__codelineno-80-4" name="__codelineno-80-4"></a><span class="c1">// See 'related content' box below for more info (you don't need to know how these work to use this function)</span>
<a id="__codelineno-80-5" name="__codelineno-80-5"></a><span class="k">consteval</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="n">compileTimeEval</span><span class="p">(</span><span class="k">auto</span><span class="w"> </span><span class="n">value</span><span class="p">)</span>
<a id="__codelineno-80-6" name="__codelineno-80-6"></a><span class="p">{</span>
<a id="__codelineno-80-7" name="__codelineno-80-7"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">value</span><span class="p">;</span>
<a id="__codelineno-80-8" name="__codelineno-80-8"></a><span class="p">}</span>
<a id="__codelineno-80-9" name="__codelineno-80-9"></a>
<a id="__codelineno-80-10" name="__codelineno-80-10"></a><span class="k">constexpr</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">greater</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">y</span><span class="p">)</span><span class="w"> </span><span class="c1">// function is constexpr</span>
<a id="__codelineno-80-11" name="__codelineno-80-11"></a><span class="p">{</span>
<a id="__codelineno-80-12" name="__codelineno-80-12"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">y</span><span class="p">);</span>
<a id="__codelineno-80-13" name="__codelineno-80-13"></a><span class="p">}</span>
<a id="__codelineno-80-14" name="__codelineno-80-14"></a>
<a id="__codelineno-80-15" name="__codelineno-80-15"></a><span class="kt">int</span><span class="w"> </span><span class="n">main</span><span class="p">()</span>
<a id="__codelineno-80-16" name="__codelineno-80-16"></a><span class="p">{</span>
<a id="__codelineno-80-17" name="__codelineno-80-17"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">greater</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="sc">'\n'</span><span class="p">;</span><span class="w">                  </span><span class="c1">// may or may not execute at compile-time</span>
<a id="__codelineno-80-18" name="__codelineno-80-18"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">compileTimeEval</span><span class="p">(</span><span class="n">greater</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="p">))</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="sc">'\n'</span><span class="p">;</span><span class="w"> </span><span class="c1">// will execute at compile-time</span>
<a id="__codelineno-80-19" name="__codelineno-80-19"></a>
<a id="__codelineno-80-20" name="__codelineno-80-20"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="p">};</span>
<a id="__codelineno-80-21" name="__codelineno-80-21"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">greater</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="sc">'\n'</span><span class="p">;</span><span class="w">                  </span><span class="c1">// we can still call the constexpr version at runtime if we wish</span>
<a id="__codelineno-80-22" name="__codelineno-80-22"></a>
<a id="__codelineno-80-23" name="__codelineno-80-23"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-80-24" name="__codelineno-80-24"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>这里我们使用一个 constexpr 函数的返回值作为 consteval 函数的参数，这样我们就可以在编译时强制执行这个 constexpr 函数。</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>这里我们让 consteval 函数按值返回，虽然这在运行时执行可能效率低下（如果这个值是复制成本高昂的类型，例如 <code>std::string</code>），但在编译中执行时，这不是什么问题。</p>
</div>
<p>在 constexpr 或 consteval 函数中，我们可以使用非 constexpr 的局部变量，并且可以更改这些变量的值。因为编译器本质上会“执行”这个函数并返回函数的结果。</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-81-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-81-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-81-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-81-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-81-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-81-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-81-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-81-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-81-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-81-10">10</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-81-1" name="__codelineno-81-1"></a><span class="k">consteval</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">doSomething</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">y</span><span class="p">)</span><span class="w"> </span><span class="c1">// function is consteval</span>
<a id="__codelineno-81-2" name="__codelineno-81-2"></a><span class="p">{</span>
<a id="__codelineno-81-3" name="__codelineno-81-3"></a><span class="w">    </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span><span class="w">       </span><span class="c1">// we can modify the value of non-const function parameters</span>
<a id="__codelineno-81-4" name="__codelineno-81-4"></a>
<a id="__codelineno-81-5" name="__codelineno-81-5"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">z</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="p">};</span><span class="w"> </span><span class="c1">// we can instantiate non-const local variables</span>
<a id="__codelineno-81-6" name="__codelineno-81-6"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">y</span><span class="p">)</span>
<a id="__codelineno-81-7" name="__codelineno-81-7"></a><span class="w">        </span><span class="n">z</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">z</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w">   </span><span class="c1">// and then modify their values</span>
<a id="__codelineno-81-8" name="__codelineno-81-8"></a>
<a id="__codelineno-81-9" name="__codelineno-81-9"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">z</span><span class="p">;</span>
<a id="__codelineno-81-10" name="__codelineno-81-10"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<div class="admonition warning">
<p class="admonition-title">不使用 constexpr 函数的原因</p>
<ul>
<li>如果某个函数无法作为常量表达式的一部分进行计算，则不应将其标记为 <code>constexpr</code></li>
<li><code>constexpr</code> 是函数接口的一部分。一旦函数被设为 constexpr，它就可以被其他 constexpr 函数调用或在需要常量表达式的上下文中使用。稍后删除 <code>constexpr</code> 将破坏此类代码</li>
<li>constexpr 使函数更难调试，因为我们无法在运行时检查它们</li>
</ul>
</div>
<hr/>
<h2 id="_26">引用<a class="headerlink" href="#_26" title="Permanent link">¶</a></h2>
<p>在 C++ 中，<strong>引用（reference）</strong>相当于现有对象的一个别名（这里的“对象”不特指 OOP 中的 object，而是泛指变量、常量、函数等）。定义了一个引用之后（明确了它所引用的对象之后），对引用的任何操作都相当于对原对象的操作。</p>
<h3 id="_27">左值引用<a class="headerlink" href="#_27" title="Permanent link">¶</a></h3>
<p>我们通常所说的引用一般指的都是左值引用（lvalue reference），它是通过 <code>&amp;</code> 符号来定义的。</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-82-1">1</a></span>
<span class="normal"><a href="#__codelineno-82-2">2</a></span>
<span class="normal"><a href="#__codelineno-82-3">3</a></span>
<span class="normal"><a href="#__codelineno-82-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-82-1" name="__codelineno-82-1"></a><span class="kt">int</span><span class="w">        </span><span class="c1">// a normal int type (not an reference)</span>
<a id="__codelineno-82-2" name="__codelineno-82-2"></a><span class="kt">int</span><span class="o">&amp;</span><span class="w">       </span><span class="c1">// an lvalue reference to an int object</span>
<a id="__codelineno-82-3" name="__codelineno-82-3"></a><span class="kt">double</span><span class="o">&amp;</span><span class="w">    </span><span class="c1">// an lvalue reference to a double object</span>
<a id="__codelineno-82-4" name="__codelineno-82-4"></a><span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="o">&amp;</span><span class="w"> </span><span class="c1">// an lvalue reference to a const int object</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>通常所说的左值引用是对一个非 const 变量的引用，即<strong>非 const 左值引用</strong>（<strong>lvalue reference to non-const</strong> or <strong>non-const lvalue reference</strong>）</li>
<li>对一个 const 变量的引用称为<strong>const 左值引用</strong>（<strong>lvalue reference to const</strong> or <strong>const lvalue reference</strong>）</li>
</ul>
<p>引用在初始化时必须明确它所绑定的对象，这意味着引用必须在定义时初始化，且一旦初始化后，它将一直绑定到同一个对象。</p>
<ul>
<li>绑定引用的过程称为<strong>引用绑定</strong>（reference binding）。</li>
<li>非常量左值引用只能绑定到可修改的左值上</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-83-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-83-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-83-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-83-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-83-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-83-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-83-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-83-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-83-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-83-10">10</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-83-1" name="__codelineno-83-1"></a><span class="kt">int</span><span class="o">&amp;</span><span class="w"> </span><span class="n">invalidRef</span><span class="p">;</span><span class="w">   </span><span class="c1">// error: references must be initialized</span>
<a id="__codelineno-83-2" name="__codelineno-83-2"></a>
<a id="__codelineno-83-3" name="__codelineno-83-3"></a><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="p">};</span>
<a id="__codelineno-83-4" name="__codelineno-83-4"></a><span class="kt">int</span><span class="o">&amp;</span><span class="w"> </span><span class="n">ref</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="p">};</span><span class="w">         </span><span class="c1">// okay</span>
<a id="__codelineno-83-5" name="__codelineno-83-5"></a>
<a id="__codelineno-83-6" name="__codelineno-83-6"></a><span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="p">};</span>
<a id="__codelineno-83-7" name="__codelineno-83-7"></a><span class="c1">// invalid: non-const lvalue reference can't bind to a non-modifiable lvalue</span>
<a id="__codelineno-83-8" name="__codelineno-83-8"></a><span class="kt">int</span><span class="o">&amp;</span><span class="w"> </span><span class="n">invalidRef</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="p">};</span><span class="w"> </span>
<a id="__codelineno-83-9" name="__codelineno-83-9"></a><span class="c1">// invalid: non-const lvalue reference can't bind to an rvalue </span>
<a id="__codelineno-83-10" name="__codelineno-83-10"></a><span class="kt">int</span><span class="o">&amp;</span><span class="w"> </span><span class="n">invalidRef2</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">};</span><span class="w"> </span>
</code></pre></div></td></tr></table></div>
<p>如果我们尝试把引用绑定到另一种类型的变量上，编译器会尝试先对这个变量进行隐式类型转换，然后把引用绑定到转换的结果上。但由于隐式类型转换的结果是一个右值，而非 const 左值引用不能绑定到右值上，这就会导致编译错误。</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-84-1">1</a></span>
<span class="normal"><a href="#__codelineno-84-2">2</a></span>
<span class="normal"><a href="#__codelineno-84-3">3</a></span>
<span class="normal"><a href="#__codelineno-84-4">4</a></span>
<span class="normal"><a href="#__codelineno-84-5">5</a></span>
<span class="normal"><a href="#__codelineno-84-6">6</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-84-1" name="__codelineno-84-1"></a><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="p">};</span>
<a id="__codelineno-84-2" name="__codelineno-84-2"></a><span class="kt">int</span><span class="o">&amp;</span><span class="w"> </span><span class="n">ref</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="p">};</span><span class="w">            </span><span class="c1">// okay: referenced type (int) matches type of initializer</span>
<a id="__codelineno-84-3" name="__codelineno-84-3"></a>
<a id="__codelineno-84-4" name="__codelineno-84-4"></a><span class="kt">double</span><span class="w"> </span><span class="n">d</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="mf">6.0</span><span class="w"> </span><span class="p">};</span>
<a id="__codelineno-84-5" name="__codelineno-84-5"></a><span class="kt">int</span><span class="o">&amp;</span><span class="w"> </span><span class="n">invalidRef</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">d</span><span class="w"> </span><span class="p">};</span><span class="w">     </span>
<a id="__codelineno-84-6" name="__codelineno-84-6"></a><span class="kt">double</span><span class="o">&amp;</span><span class="w"> </span><span class="n">invalidRef2</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="p">};</span>
</code></pre></div></td></tr></table></div>
<p>引用也可以使用另一个引用来初始化，这样会创建一个新的引用，它绑定到原引用所绑定的对象上。</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-85-1">1</a></span>
<span class="normal"><a href="#__codelineno-85-2">2</a></span>
<span class="normal"><a href="#__codelineno-85-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-85-1" name="__codelineno-85-1"></a><span class="kt">int</span><span class="w"> </span><span class="n">var</span><span class="p">{};</span>
<a id="__codelineno-85-2" name="__codelineno-85-2"></a><span class="kt">int</span><span class="o">&amp;</span><span class="w"> </span><span class="n">ref1</span><span class="p">{</span><span class="w"> </span><span class="n">var</span><span class="w"> </span><span class="p">};</span><span class="w">  </span><span class="c1">// an lvalue reference bound to var</span>
<a id="__codelineno-85-3" name="__codelineno-85-3"></a><span class="kt">int</span><span class="o">&amp;</span><span class="w"> </span><span class="n">ref2</span><span class="p">{</span><span class="w"> </span><span class="n">ref1</span><span class="w"> </span><span class="p">};</span><span class="w"> </span><span class="c1">// an lvalue reference bound to var</span>
</code></pre></div></td></tr></table></div>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>可能会有人会把<code>int&amp;&amp;</code>和<code>int**</code>（指向指针的指针）进行类比，认为<code>int&amp;&amp;</code>是对引用的引用，但实际上这表示对右值的引用（C++11）。</p>
</div>
<h3 id="_28">引用的生命周期<a class="headerlink" href="#_28" title="Permanent link">¶</a></h3>
<p>引用的生命周期和普通的变量类似：引用在定义时创建，在超出作用域时被销毁。</p>
<p>引用和被引用者具有相互独立的生命周期，这意味着</p>
<ul>
<li>引用可以在被引用者之前被销毁</li>
<li>被引用者也可以在引用之前被销毁</li>
</ul>
<p>当引用先被销毁时，被引用对象并不会受到任何印象，但当被引用对象先被销毁时，引用就会变成<strong>悬空引用</strong>（dangling reference），对悬空引用的访问会导致未定义行为。</p>
<div class="admonition info">
<p class="admonition-title">引用不是对象</p>
<p>在 C++ 中，引用并不是一个对象。如果可能的话，编译器会试图使用被引用对象来替代所有出现的引用，以此来优化程序，此时引用就不需要占据任何内存空间，甚至不需要实际存在；但有时候这种替代无法做到的，这时候引用就会占据实际的内存空间。</p>
<p>因为引用不是一个对象，所以我们不能创建引用的引用（左值引用必须指向一个可识别的对象）。</p>
</div>
<h3 id="const_1">const 左值引用<a class="headerlink" href="#const_1" title="Permanent link">¶</a></h3>
<p>刚刚我们提到过，一个非 const 的左值引用不能绑定到 const 变量上，因为如果允许这么做，我们将可以通过引用来修改这个变量，这违背了 const 变量的定义。如果我们希望引用一个 const 变量，我们可以使用 const 左值引用。</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-86-1">1</a></span>
<span class="normal"><a href="#__codelineno-86-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-86-1" name="__codelineno-86-1"></a><span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="p">};</span>
<a id="__codelineno-86-2" name="__codelineno-86-2"></a><span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="o">&amp;</span><span class="w"> </span><span class="n">ref</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="p">};</span>
</code></pre></div></td></tr></table></div>
<p>我们也可以对一个非 const 变量使用一个 const 引用，此时通过引用来访问的对象将被视为常量，这表示我们不能通过这个引用来修改这个对象。</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-87-1">1</a></span>
<span class="normal"><a href="#__codelineno-87-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-87-1" name="__codelineno-87-1"></a><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="p">};</span>
<a id="__codelineno-87-2" name="__codelineno-87-2"></a><span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="o">&amp;</span><span class="w"> </span><span class="n">ref</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="p">};</span>
</code></pre></div></td></tr></table></div>
<div class="admonition note">
<p class="admonition-title">使用右值初始化 const 左值引用</p>
<p>const 左值引用可以绑定到右值上</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-88-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-88-1" name="__codelineno-88-1"></a><span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="o">&amp;</span><span class="w"> </span><span class="n">ref</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="p">};</span><span class="w"> </span><span class="c1">// okay: 5 is an rvalue</span>
</code></pre></div></td></tr></table></div>
<p>此时将会创建一个临时对象，这个临时对象被右值 5 初始化，然后 const 引用绑定到这个临时对象上。</p>
<p>之前我们提到过，隐式类型转换的结果是一个右值，这意味着我们可以使用一个类型的 const 引用绑定到另一种类型的对象上去，但此时引用实际上绑定的是临时变量而非原对象，对原对象的任何修改都不会影响到引用。</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-89-1">1</a></span>
<span class="normal"><a href="#__codelineno-89-2">2</a></span>
<span class="normal"><a href="#__codelineno-89-3">3</a></span>
<span class="normal"><a href="#__codelineno-89-4">4</a></span>
<span class="normal"><a href="#__codelineno-89-5">5</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-89-1" name="__codelineno-89-1"></a><span class="kt">short</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">};</span>
<a id="__codelineno-89-2" name="__codelineno-89-2"></a><span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="o">&amp;</span><span class="w"> </span><span class="n">ref</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="p">};</span>
<a id="__codelineno-89-3" name="__codelineno-89-3"></a>
<a id="__codelineno-89-4" name="__codelineno-89-4"></a><span class="n">x</span><span class="o">--</span><span class="p">;</span>
<a id="__codelineno-89-5" name="__codelineno-89-5"></a><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">ref</span><span class="p">;</span><span class="w"> </span><span class="c1">// output 1</span>
</code></pre></div></td></tr></table></div>
</div>
<p>为了上述情况中避免临时变量被销毁而导致的悬空引用，C++ 有一个特殊的规则：当 const 左值引用被绑定到一个临时变量上时，临时变量的生命周期将会被延长，直到这个引用的生命周期结束，这个临时变量才会被销毁。</p>
<div class="admonition extra">
<p class="admonition-title">constexpr 左值引用</p>
<p>constexpr 允许被应用到引用上时，这个引用将会被允许出现在常量表达式中，但此时这个引用只能绑定到具有静态存储期的对象上（全局变量或静态局部变量）。</p>
<p>当 constexpr 引用绑定到一个 const 变量上时，我们需要同时使用 constexpr（引用） 和 const（所引用的对象）</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-90-1">1</a></span>
<span class="normal"><a href="#__codelineno-90-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-90-1" name="__codelineno-90-1"></a><span class="k">static</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">s_x</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="mi">6</span><span class="w"> </span><span class="p">};</span><span class="w">        </span><span class="c1">// a const int</span>
<a id="__codelineno-90-2" name="__codelineno-90-2"></a><span class="k">constexpr</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="o">&amp;</span><span class="w"> </span><span class="n">ref2</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">s_x</span><span class="w"> </span><span class="p">};</span><span class="w"> </span><span class="c1">// needs both constexpr and const</span>
</code></pre></div></td></tr></table></div>
<p>介于以上的限制，constexpr 引用通常很少出现。</p>
</div>
<h3 id="_29">按引用传递参数<a class="headerlink" href="#_29" title="Permanent link">¶</a></h3>
<p>在函数调用中按值传递参数时，参数会被复制出一个副本以供函数使用，这样会导致一定的开销，尤其是当参数是一个较大的对象时。为了避免这种开销，我们可以使用引用来传递参数。</p>
<p>按引用传递参数时，我们可以在函数内部通过引用来对原对象进行修改，其作用和按地址传递参数类似，但是引用的语法更加简洁。</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-91-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-91-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-91-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-91-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-91-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-91-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-91-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-91-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-91-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-91-10">10</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-91-1" name="__codelineno-91-1"></a><span class="kt">void</span><span class="w"> </span><span class="nf">addOne_ref</span><span class="p">(</span><span class="kt">int</span><span class="o">&amp;</span><span class="w"> </span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="c1">// reference version</span>
<a id="__codelineno-91-2" name="__codelineno-91-2"></a><span class="p">{</span>
<a id="__codelineno-91-3" name="__codelineno-91-3"></a><span class="w">    </span><span class="n">x</span><span class="o">++</span><span class="p">;</span>
<a id="__codelineno-91-4" name="__codelineno-91-4"></a><span class="p">}</span>
<a id="__codelineno-91-5" name="__codelineno-91-5"></a>
<a id="__codelineno-91-6" name="__codelineno-91-6"></a>
<a id="__codelineno-91-7" name="__codelineno-91-7"></a><span class="kt">void</span><span class="w"> </span><span class="nf">addOne_ptr</span><span class="p">(</span><span class="kt">int</span><span class="o">*</span><span class="w"> </span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="c1">// pointer version</span>
<a id="__codelineno-91-8" name="__codelineno-91-8"></a><span class="p">{</span>
<a id="__codelineno-91-9" name="__codelineno-91-9"></a><span class="w">    </span><span class="p">(</span><span class="o">*</span><span class="n">x</span><span class="p">)</span><span class="o">++</span><span class="p">;</span>
<a id="__codelineno-91-10" name="__codelineno-91-10"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>
<p>如果我们不希望函数修改传入的参数，我们可以使用 const 引用来传递参数，这样函数就无法修改传入的参数了。</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-92-1">1</a></span>
<span class="normal"><a href="#__codelineno-92-2">2</a></span>
<span class="normal"><a href="#__codelineno-92-3">3</a></span>
<span class="normal"><a href="#__codelineno-92-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-92-1" name="__codelineno-92-1"></a><span class="kt">void</span><span class="w"> </span><span class="nf">print</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="o">&amp;</span><span class="w"> </span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="c1">// reference version</span>
<a id="__codelineno-92-2" name="__codelineno-92-2"></a><span class="p">{</span>
<a id="__codelineno-92-3" name="__codelineno-92-3"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="sc">'\n'</span><span class="p">;</span>
<a id="__codelineno-92-4" name="__codelineno-92-4"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
</li>
</ul>
<div class="admonition note">
<p class="admonition-title">把不同类型的参数传递给 const 引用参数</p>
<p>之前我们提到过，const 引用可以绑定到不同类型的对象上，但此时引用实际上绑定的是临时变量而非原对象，对原对象的任何修改都不会影响到引用。</p>
<p>当我们把不同类型的参数传递给 const 引用参数时，也会发生同样的事情。</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-93-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-93-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-93-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-93-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-93-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-93-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-93-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-93-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-93-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-93-10">10</a></span>
<span class="normal"><a href="#__codelineno-93-11">11</a></span>
<span class="normal"><a href="#__codelineno-93-12">12</a></span>
<span class="normal"><a href="#__codelineno-93-13">13</a></span>
<span class="normal"><a href="#__codelineno-93-14">14</a></span>
<span class="normal"><a href="#__codelineno-93-15">15</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-93-1" name="__codelineno-93-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span>
<a id="__codelineno-93-2" name="__codelineno-93-2"></a>
<a id="__codelineno-93-3" name="__codelineno-93-3"></a><span class="kt">void</span><span class="w"> </span><span class="nf">printAddr_ref</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="o">&amp;</span><span class="w"> </span><span class="n">y</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-93-4" name="__codelineno-93-4"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="o">&amp;</span><span class="n">y</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="sc">'\n'</span><span class="p">;</span>
<a id="__codelineno-93-5" name="__codelineno-93-5"></a><span class="p">}</span>
<a id="__codelineno-93-6" name="__codelineno-93-6"></a>
<a id="__codelineno-93-7" name="__codelineno-93-7"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span>
<a id="__codelineno-93-8" name="__codelineno-93-8"></a><span class="p">{</span>
<a id="__codelineno-93-9" name="__codelineno-93-9"></a><span class="w">    </span><span class="kt">double</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="mf">2.0</span><span class="w"> </span><span class="p">};</span>
<a id="__codelineno-93-10" name="__codelineno-93-10"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="o">&amp;</span><span class="n">x</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="sc">'\n'</span><span class="p">;</span>
<a id="__codelineno-93-11" name="__codelineno-93-11"></a>
<a id="__codelineno-93-12" name="__codelineno-93-12"></a><span class="w">    </span><span class="n">printAddr_ref</span><span class="p">(</span><span class="n">x</span><span class="p">);</span>
<a id="__codelineno-93-13" name="__codelineno-93-13"></a>
<a id="__codelineno-93-14" name="__codelineno-93-14"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-93-15" name="__codelineno-93-15"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>在我的一次本地运行中，这个程序的输出是</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-94-1">1</a></span>
<span class="normal"><a href="#__codelineno-94-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-94-1" name="__codelineno-94-1"></a>0x7ffcc45a1080
<a id="__codelineno-94-2" name="__codelineno-94-2"></a>0x7ffcc45a107c
</code></pre></div></td></tr></table></div>
<p>函数中 <code>y</code> 的地址和 main 函数中的 <code>x</code> 的地址不同，这表明函数内引用绑定的是一个临时变量而非原对象。</p>
</div>
<div class="admonition question">
<p class="admonition-title">该用 <code>std::string_view</code> 还是 <code>const std::string&amp;</code>？</p>
<p>在 C++ 中，被作为参数传递的字符串通常是 <code>std::string</code>、<code>std::string_view</code> 或 C 风格字符串（<code>const char*</code>）。     </p>
<table>
<thead>
<tr>
<th>Argument Type</th>
<th><code>std::string_view</code> parameter</th>
<th><code>const std::string&amp;</code> parameter</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>std::string</code></td>
<td>Inexpensive conversion</td>
<td>Inexpensive reference binding</td>
</tr>
<tr>
<td><code>std::string_view</code></td>
<td>Inexpensive copy</td>
<td>Expensive explicit conversion to std::string</td>
</tr>
<tr>
<td>C-style string / literal</td>
<td>Inexpensive conversion</td>
<td>Expensive conversion</td>
</tr>
</tbody>
</table>
<ol>
<li>
<p>函数中的形参是 <code>std::string_view</code>，</p>
<ul>
<li>如果传入的是 <code>std::string</code> 或 C 风格字符串，那么这个字符串会被转换为 <code>std::string_view</code>，但这个转换并不会带来太大的开销</li>
<li>如果传入的是 <code>std::string_view</code>，那么这个字符串会被直接按值传递给函数，发生一次开销不大的复制</li>
</ul>
</li>
<li>
<p>函数中的形参是 <code>const std::string&amp;</code>，</p>
<ul>
<li>如果传入的是 <code>std::string</code>，引用会直接绑定到传递过来的 <code>std::string</code> 上</li>
<li>如果传入的是 <code>std::string_view</code> 或 C 风格字符串，那么这个字符串会先被隐式转换为 <code>std::string</code>，然后引用才会绑定到这个 <code>std::string</code> 上</li>
</ul>
</li>
</ol>
<p>从上面的分析可以看出，<code>std::string_view</code> 作为参数通常要比 <code>const std::string&amp;</code> 更好，因为它可以接受更多类型的参数，而且转换开销更小。</p>
<p>但这并不是绝对的，在某些情况下，<code>const std::string&amp;</code> 可能更适合，例如</p>
<ul>
<li>使用的 C++ 版本低于 C++14，此时就无法使用 <code>std::string_view</code></li>
<li>如果函数需要使用到字符串一些其他的属性或功能，例如需要字符串以 null 结尾（<code>std::string_view</code> 不保证它以 null 结尾）、需要调用 <code>std::string</code> 的成员函数等</li>
</ul>
</div>
<h3 id="_30">按引用返回<a class="headerlink" href="#_30" title="Permanent link">¶</a></h3>
<p>当函数按值返回时，会制作一个函数返回值的副本，然后传递给调用者，这样会导致一定的开销，尤其是当返回值是一个较大的对象时。</p>
<p>为了避免这种开销，我们可以使用引用来返回函数的结果。<strong>按引用返回</strong>（return by reference）的函数返回的是一个绑定到需要返回的对象的引用。</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-95-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-95-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-95-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-95-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-95-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-95-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-95-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-95-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-95-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-95-10">10</a></span>
<span class="normal"><a href="#__codelineno-95-11">11</a></span>
<span class="normal"><a href="#__codelineno-95-12">12</a></span>
<span class="normal"><a href="#__codelineno-95-13">13</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-95-1" name="__codelineno-95-1"></a><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="nf">getProgramName</span><span class="p">()</span><span class="w"> </span><span class="c1">// returns a const reference</span>
<a id="__codelineno-95-2" name="__codelineno-95-2"></a><span class="p">{</span>
<a id="__codelineno-95-3" name="__codelineno-95-3"></a><span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">s_programName</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s">"Calculator"</span><span class="w"> </span><span class="p">};</span>
<a id="__codelineno-95-4" name="__codelineno-95-4"></a>
<a id="__codelineno-95-5" name="__codelineno-95-5"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">s_programName</span><span class="p">;</span>
<a id="__codelineno-95-6" name="__codelineno-95-6"></a><span class="p">}</span>
<a id="__codelineno-95-7" name="__codelineno-95-7"></a>
<a id="__codelineno-95-8" name="__codelineno-95-8"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span>
<a id="__codelineno-95-9" name="__codelineno-95-9"></a><span class="p">{</span>
<a id="__codelineno-95-10" name="__codelineno-95-10"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"This program is named "</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">getProgramName</span><span class="p">();</span>
<a id="__codelineno-95-11" name="__codelineno-95-11"></a>
<a id="__codelineno-95-12" name="__codelineno-95-12"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-95-13" name="__codelineno-95-13"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<div class="admonition warning">
<p class="admonition-title">通过引用返回的对象必须在函数返回后仍存在</p>
<p>为了避免出现悬空引用，我们必须确保被引用的对象的生命周期要比调用的这个函数更长。例如上面的例子中我们让 <code>s_programName</code> 成为了一个具有 static 生命周期的变量。</p>
</div>
<div class="admonition example">
<p class="admonition-title">Example</p>
<p>在实际的程序中，我们应当避免对非 const 的静态变量的按引用返回，例如</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-96-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-96-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-96-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-96-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-96-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-96-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-96-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-96-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-96-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-96-10">10</a></span>
<span class="normal"><a href="#__codelineno-96-11">11</a></span>
<span class="normal"><a href="#__codelineno-96-12">12</a></span>
<span class="normal"><a href="#__codelineno-96-13">13</a></span>
<span class="normal"><a href="#__codelineno-96-14">14</a></span>
<span class="normal"><a href="#__codelineno-96-15">15</a></span>
<span class="normal"><a href="#__codelineno-96-16">16</a></span>
<span class="normal"><a href="#__codelineno-96-17">17</a></span>
<span class="normal"><a href="#__codelineno-96-18">18</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-96-1" name="__codelineno-96-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span>
<a id="__codelineno-96-2" name="__codelineno-96-2"></a>
<a id="__codelineno-96-3" name="__codelineno-96-3"></a><span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="o">&amp;</span><span class="w"> </span><span class="nf">getNextId</span><span class="p">()</span>
<a id="__codelineno-96-4" name="__codelineno-96-4"></a><span class="p">{</span>
<a id="__codelineno-96-5" name="__codelineno-96-5"></a><span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">s_x</span><span class="p">{</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">};</span>
<a id="__codelineno-96-6" name="__codelineno-96-6"></a><span class="w">    </span><span class="o">++</span><span class="n">s_x</span><span class="p">;</span>
<a id="__codelineno-96-7" name="__codelineno-96-7"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">s_x</span><span class="p">;</span>
<a id="__codelineno-96-8" name="__codelineno-96-8"></a><span class="p">}</span>
<a id="__codelineno-96-9" name="__codelineno-96-9"></a>
<a id="__codelineno-96-10" name="__codelineno-96-10"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span>
<a id="__codelineno-96-11" name="__codelineno-96-11"></a><span class="p">{</span>
<a id="__codelineno-96-12" name="__codelineno-96-12"></a><span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="o">&amp;</span><span class="w"> </span><span class="n">id1</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">getNextId</span><span class="p">()</span><span class="w"> </span><span class="p">};</span><span class="w"> </span><span class="c1">// id1 is a reference</span>
<a id="__codelineno-96-13" name="__codelineno-96-13"></a><span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="o">&amp;</span><span class="w"> </span><span class="n">id2</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">getNextId</span><span class="p">()</span><span class="w"> </span><span class="p">};</span><span class="w"> </span><span class="c1">// id2 is a reference</span>
<a id="__codelineno-96-14" name="__codelineno-96-14"></a>
<a id="__codelineno-96-15" name="__codelineno-96-15"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">id1</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">id2</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="sc">'\n'</span><span class="p">;</span>
<a id="__codelineno-96-16" name="__codelineno-96-16"></a>
<a id="__codelineno-96-17" name="__codelineno-96-17"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-96-18" name="__codelineno-96-18"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>程序的输出结果为</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-97-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-97-1" name="__codelineno-97-1"></a><span class="mi">22</span>
</code></pre></div></td></tr></table></div>
<p>发生这种情况是因为<code>id1</code>和<code>id2</code>引用了相同的对象（静态变量<code>s_x</code>），因此当修改<code>s_x</code>被修改时，所有引用都会访问修改后的值。</p>
<p>对于上面的这个例子，我们可以把<code>id1</code>和<code>id2</code>改为普通的常量变量 <code>const int</code> 而非 <code>const int&amp;</code>，这样它们就可以保存返回值的副本，而非保存对<code>s_x</code>的引用。</p>
</div>
<p>关于按引用返回有一个很有趣的事情是，我们可以借助函数调用返回的引用来修改一个变量：</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-98-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-98-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-98-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-98-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-98-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-98-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-98-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-98-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-98-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-98-10">10</a></span>
<span class="normal"><a href="#__codelineno-98-11">11</a></span>
<span class="normal"><a href="#__codelineno-98-12">12</a></span>
<span class="normal"><a href="#__codelineno-98-13">13</a></span>
<span class="normal"><a href="#__codelineno-98-14">14</a></span>
<span class="normal"><a href="#__codelineno-98-15">15</a></span>
<span class="normal"><a href="#__codelineno-98-16">16</a></span>
<span class="normal"><a href="#__codelineno-98-17">17</a></span>
<span class="normal"><a href="#__codelineno-98-18">18</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-98-1" name="__codelineno-98-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span>
<a id="__codelineno-98-2" name="__codelineno-98-2"></a>
<a id="__codelineno-98-3" name="__codelineno-98-3"></a><span class="kt">int</span><span class="o">&amp;</span><span class="w"> </span><span class="nf">max</span><span class="p">(</span><span class="kt">int</span><span class="o">&amp;</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="o">&amp;</span><span class="w"> </span><span class="n">y</span><span class="p">)</span>
<a id="__codelineno-98-4" name="__codelineno-98-4"></a><span class="p">{</span>
<a id="__codelineno-98-5" name="__codelineno-98-5"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">y</span><span class="p">)</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">y</span><span class="p">;</span>
<a id="__codelineno-98-6" name="__codelineno-98-6"></a><span class="p">}</span>
<a id="__codelineno-98-7" name="__codelineno-98-7"></a>
<a id="__codelineno-98-8" name="__codelineno-98-8"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span>
<a id="__codelineno-98-9" name="__codelineno-98-9"></a><span class="p">{</span>
<a id="__codelineno-98-10" name="__codelineno-98-10"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">a</span><span class="p">{</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="p">};</span>
<a id="__codelineno-98-11" name="__codelineno-98-11"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">b</span><span class="p">{</span><span class="w"> </span><span class="mi">6</span><span class="w"> </span><span class="p">};</span>
<a id="__codelineno-98-12" name="__codelineno-98-12"></a>
<a id="__codelineno-98-13" name="__codelineno-98-13"></a><span class="w">    </span><span class="n">max</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">7</span><span class="p">;</span><span class="w"> </span><span class="c1">// sets the greater of a or b to 7</span>
<a id="__codelineno-98-14" name="__codelineno-98-14"></a>
<a id="__codelineno-98-15" name="__codelineno-98-15"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="sc">'\n'</span><span class="p">;</span>
<a id="__codelineno-98-16" name="__codelineno-98-16"></a>
<a id="__codelineno-98-17" name="__codelineno-98-17"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-98-18" name="__codelineno-98-18"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>上述程序中 b 的值更大，因此 <code>max()</code> 函数将会返回一个绑定到 b 的引用，我们可以直接利用这个引用来修改 b 的值为 7。因此这段程序的输出结果为</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-99-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-99-1" name="__codelineno-99-1"></a><span class="mi">57</span>
</code></pre></div></td></tr></table></div>
<h3 id="_31">关于引用的类型推导<a class="headerlink" href="#_31" title="Permanent link">¶</a></h3>
<p>我们知道，使用 <code>auto</code> 进行类型推导时，const 标识符会被删除，实际上除了删除 const 之外，auto 还会删除引用标识符。</p>
<div class="admonition example">
<p class="admonition-title">Example</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-100-1">1</a></span>
<span class="normal"><a href="#__codelineno-100-2">2</a></span>
<span class="normal"><a href="#__codelineno-100-3">3</a></span>
<span class="normal"><a href="#__codelineno-100-4">4</a></span>
<span class="normal"><a href="#__codelineno-100-5">5</a></span>
<span class="normal"><a href="#__codelineno-100-6">6</a></span>
<span class="normal"><a href="#__codelineno-100-7">7</a></span>
<span class="normal"><a href="#__codelineno-100-8">8</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-100-1" name="__codelineno-100-1"></a><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="nf">getRef</span><span class="p">();</span>
<a id="__codelineno-100-2" name="__codelineno-100-2"></a>
<a id="__codelineno-100-3" name="__codelineno-100-3"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span>
<a id="__codelineno-100-4" name="__codelineno-100-4"></a><span class="p">{</span>
<a id="__codelineno-100-5" name="__codelineno-100-5"></a><span class="w">    </span><span class="k">auto</span><span class="w"> </span><span class="n">ref</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">getRef</span><span class="p">()</span><span class="w"> </span><span class="p">};</span><span class="w"> </span><span class="c1">// type deduced as std::string (not std::string&amp;)</span>
<a id="__codelineno-100-6" name="__codelineno-100-6"></a>
<a id="__codelineno-100-7" name="__codelineno-100-7"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-100-8" name="__codelineno-100-8"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>在这个例子中，尽管函数<code>getRef()</code>返回一个<code>std::string&amp;</code>，但<code>ref</code>的类型被推导为<code>std::string</code>。</p>
</div>
<p>就像 const 一样，如果我们希望类型被推导为引用，我们可以在定义处重新把它变为参考</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-101-1">1</a></span>
<span class="normal"><a href="#__codelineno-101-2">2</a></span>
<span class="normal"><a href="#__codelineno-101-3">3</a></span>
<span class="normal"><a href="#__codelineno-101-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-101-1" name="__codelineno-101-1"></a><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="nf">getRef</span><span class="p">();</span>
<a id="__codelineno-101-2" name="__codelineno-101-2"></a>
<a id="__codelineno-101-3" name="__codelineno-101-3"></a><span class="k">auto</span><span class="w"> </span><span class="n">ref1</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">getRef</span><span class="p">()</span><span class="w"> </span><span class="p">};</span><span class="w">  </span>
<a id="__codelineno-101-4" name="__codelineno-101-4"></a><span class="k">auto</span><span class="o">&amp;</span><span class="w"> </span><span class="n">ref2</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">getRef</span><span class="p">()</span><span class="w"> </span><span class="p">};</span><span class="w"> </span>
</code></pre></div></td></tr></table></div>
<div class="admonition definition">
<p class="admonition-title">Top-level const and low-level const</p>
<ul>
<li><strong>顶级 const（top-level const）</strong>：const 修饰的是<strong>对象本身</strong>，或者<strong>指针或引用本身</strong>，而非指针或引用所指向的对象。例如 </li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-102-1">1</a></span>
<span class="normal"><a href="#__codelineno-102-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-102-1" name="__codelineno-102-1"></a><span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">;</span>
<a id="__codelineno-102-2" name="__codelineno-102-2"></a><span class="kt">int</span><span class="o">*</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">ptr</span><span class="p">;</span>
</code></pre></div></td></tr></table></div>
<ul>
<li><strong>低级 const（low-level const）</strong>：const 修饰的是<strong>指针所指向的对象</strong>或<strong>引用所绑定的对象</strong>，而非指针或引用本身。例如</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-103-1">1</a></span>
<span class="normal"><a href="#__codelineno-103-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-103-1" name="__codelineno-103-1"></a><span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="o">&amp;</span><span class="w"> </span><span class="n">ref</span><span class="p">;</span><span class="w"> </span>
<a id="__codelineno-103-2" name="__codelineno-103-2"></a><span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="o">*</span><span class="w"> </span><span class="n">ptr</span><span class="p">;</span>
</code></pre></div></td></tr></table></div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>指针可以同时拥有两种 const，例如 <code>const int* const ptr;</code>，但引用只能拥有一种 const，例如 <code>const int&amp; ref;</code>，因为引用本身就是不可修改的（即不可以改变它所绑定的对象），所以不可以拥有顶级 const。</p>
</div>
</div>
<ul>
<li>当我们说类型推导会删去 const 限定符时，我们指的是<strong>顶层 const</strong>，而<strong>底层 const</strong>则会被保留。</li>
</ul>
<div class="admonition key-point">
<p class="admonition-title">Key-point</p>
<p>删除引用时可能会把一个低级 const 变为顶级 const： </p>
<ul>
<li><code>const std::string&amp;</code> 是低级 const，但删除引用后会得到 <code>const std::string</code> ，它现在变成顶级 const了，可以在类型推导中被删去。</li>
</ul>
<p>因此，如果初始化器是一个对 const 变量的引用，那么在类型推导时会首先删除引用，然后再删除 const 限定符。</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-104-1">1</a></span>
<span class="normal"><a href="#__codelineno-104-2">2</a></span>
<span class="normal"><a href="#__codelineno-104-3">3</a></span>
<span class="normal"><a href="#__codelineno-104-4">4</a></span>
<span class="normal"><a href="#__codelineno-104-5">5</a></span>
<span class="normal"><a href="#__codelineno-104-6">6</a></span>
<span class="normal"><a href="#__codelineno-104-7">7</a></span>
<span class="normal"><a href="#__codelineno-104-8">8</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-104-1" name="__codelineno-104-1"></a><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="nf">getConstRef</span><span class="p">();</span>
<a id="__codelineno-104-2" name="__codelineno-104-2"></a>
<a id="__codelineno-104-3" name="__codelineno-104-3"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span>
<a id="__codelineno-104-4" name="__codelineno-104-4"></a><span class="p">{</span>
<a id="__codelineno-104-5" name="__codelineno-104-5"></a><span class="w">    </span><span class="k">auto</span><span class="w"> </span><span class="n">ref1</span><span class="p">{</span><span class="w"> </span><span class="n">getConstRef</span><span class="p">()</span><span class="w"> </span><span class="p">};</span><span class="w"> </span><span class="c1">// std::string</span>
<a id="__codelineno-104-6" name="__codelineno-104-6"></a>
<a id="__codelineno-104-7" name="__codelineno-104-7"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-104-8" name="__codelineno-104-8"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
</div>
<p>如果我们希望得到的是引用和/或 const 限定符，可以手动添加它们：</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-105-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-105-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-105-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-105-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-105-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-105-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-105-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-105-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-105-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-105-10">10</a></span>
<span class="normal"><a href="#__codelineno-105-11">11</a></span>
<span class="normal"><a href="#__codelineno-105-12">12</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-105-1" name="__codelineno-105-1"></a><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="nf">getConstRef</span><span class="p">();</span>
<a id="__codelineno-105-2" name="__codelineno-105-2"></a>
<a id="__codelineno-105-3" name="__codelineno-105-3"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span>
<a id="__codelineno-105-4" name="__codelineno-105-4"></a><span class="p">{</span>
<a id="__codelineno-105-5" name="__codelineno-105-5"></a><span class="w">    </span><span class="k">auto</span><span class="w"> </span><span class="n">ref1</span><span class="p">{</span><span class="w"> </span><span class="n">getConstRef</span><span class="p">()</span><span class="w"> </span><span class="p">};</span><span class="w">        </span><span class="c1">// std::string </span>
<a id="__codelineno-105-6" name="__codelineno-105-6"></a><span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="n">ref2</span><span class="p">{</span><span class="w"> </span><span class="n">getConstRef</span><span class="p">()</span><span class="w"> </span><span class="p">};</span><span class="w">  </span><span class="c1">// const std::string</span>
<a id="__codelineno-105-7" name="__codelineno-105-7"></a>
<a id="__codelineno-105-8" name="__codelineno-105-8"></a><span class="w">    </span><span class="k">auto</span><span class="o">&amp;</span><span class="w"> </span><span class="n">ref3</span><span class="p">{</span><span class="w"> </span><span class="n">getConstRef</span><span class="p">()</span><span class="w"> </span><span class="p">};</span><span class="w">       </span><span class="c1">// const std::string&amp; </span>
<a id="__codelineno-105-9" name="__codelineno-105-9"></a><span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="o">&amp;</span><span class="w"> </span><span class="n">ref4</span><span class="p">{</span><span class="w"> </span><span class="n">getConstRef</span><span class="p">()</span><span class="w"> </span><span class="p">};</span><span class="w"> </span><span class="c1">// const std::string&amp; </span>
<a id="__codelineno-105-10" name="__codelineno-105-10"></a>
<a id="__codelineno-105-11" name="__codelineno-105-11"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-105-12" name="__codelineno-105-12"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>上例的前两种情况前面已经介绍过了，就不多解释了。值得解释的是 <code>ref3</code>：</p>
<ul>
<li>通常，引用会首先被删除，此时 const 就是顶层的了，然后 const 也会被删除。但是由于我们这时候重新把引用应用到了 <code>auto</code> 上，相当于重新添加了引用，此时 const 仍然是底层的，不会被删去，因此 <code>ref3</code> 的类型是 <code>const std::string&amp;</code>。</li>
</ul>
<p><code>ref4</code> 的情况和 <code>ref3</code> 类似，只是我们也重新应用了 const 限定符。由于类型已经被推导为对 const 的引用，重复的 const 实际上是多余的，但这并不会导致编译错误。事实上这也有助于代码编写者/阅读者明确地知道这个引用是一个对 const 的引用。</p>
<div class="admonition question">
<p class="admonition-title">推导为 constexpr 引用</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>当我们希望定义一个绑定到 const 变量的 constexpr 引用时，我们需要同时使用 <code>constexpr</code>（修饰引用）和 <code>const</code>（修饰被绑定对象）限定符。例如<code>constexpr const int&amp;</code>。</p>
</div>
<p>constexpr 不是类型系统的一部分，因此永远不会被推导出来（但它是隐式的 const），我们需要将其显式地把它加到类型推导中。</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-106-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-106-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-106-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-106-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-106-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-106-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-106-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-106-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-106-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-106-10">10</a></span>
<span class="normal"><a href="#__codelineno-106-11">11</a></span>
<span class="normal"><a href="#__codelineno-106-12">12</a></span>
<span class="normal"><a href="#__codelineno-106-13">13</a></span>
<span class="normal"><a href="#__codelineno-106-14">14</a></span>
<span class="normal"><a href="#__codelineno-106-15">15</a></span>
<span class="normal"><a href="#__codelineno-106-16">16</a></span>
<span class="normal"><a href="#__codelineno-106-17">17</a></span>
<span class="normal"><a href="#__codelineno-106-18">18</a></span>
<span class="normal"><a href="#__codelineno-106-19">19</a></span>
<span class="normal"><a href="#__codelineno-106-20">20</a></span>
<span class="normal"><a href="#__codelineno-106-21">21</a></span>
<span class="normal"><a href="#__codelineno-106-22">22</a></span>
<span class="normal"><a href="#__codelineno-106-23">23</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-106-1" name="__codelineno-106-1"></a><span class="k">constexpr</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string_view</span><span class="w"> </span><span class="n">hello</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s">"Hello"</span><span class="w"> </span><span class="p">};</span><span class="w">   </span><span class="c1">// implicitly const</span>
<a id="__codelineno-106-2" name="__codelineno-106-2"></a>
<a id="__codelineno-106-3" name="__codelineno-106-3"></a><span class="k">constexpr</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string_view</span><span class="o">&amp;</span><span class="w"> </span><span class="nf">getConstRef</span><span class="p">()</span><span class="w"> </span><span class="c1">// function is constexpr, returns a const std::string_view&amp;</span>
<a id="__codelineno-106-4" name="__codelineno-106-4"></a><span class="p">{</span>
<a id="__codelineno-106-5" name="__codelineno-106-5"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">hello</span><span class="p">;</span>
<a id="__codelineno-106-6" name="__codelineno-106-6"></a><span class="p">}</span>
<a id="__codelineno-106-7" name="__codelineno-106-7"></a>
<a id="__codelineno-106-8" name="__codelineno-106-8"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span>
<a id="__codelineno-106-9" name="__codelineno-106-9"></a><span class="p">{</span>
<a id="__codelineno-106-10" name="__codelineno-106-10"></a><span class="w">    </span><span class="c1">// std::string_view (reference dropped and top-level const dropped)</span>
<a id="__codelineno-106-11" name="__codelineno-106-11"></a><span class="w">    </span><span class="k">auto</span><span class="w"> </span><span class="n">ref1</span><span class="p">{</span><span class="w"> </span><span class="n">getConstRef</span><span class="p">()</span><span class="w"> </span><span class="p">};</span><span class="w"> </span>
<a id="__codelineno-106-12" name="__codelineno-106-12"></a>
<a id="__codelineno-106-13" name="__codelineno-106-13"></a><span class="w">    </span><span class="c1">// constexpr const std::string_view (reference dropped and top-level const dropped, constexpr applied, implicitly const)                 </span>
<a id="__codelineno-106-14" name="__codelineno-106-14"></a><span class="w">    </span><span class="k">constexpr</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="n">ref2</span><span class="p">{</span><span class="w"> </span><span class="n">getConstRef</span><span class="p">()</span><span class="w"> </span><span class="p">};</span><span class="w">        </span>
<a id="__codelineno-106-15" name="__codelineno-106-15"></a>
<a id="__codelineno-106-16" name="__codelineno-106-16"></a><span class="w">    </span><span class="c1">// const std::string_view&amp; (reference reapplied, low-level const not dropped)</span>
<a id="__codelineno-106-17" name="__codelineno-106-17"></a><span class="w">    </span><span class="k">auto</span><span class="o">&amp;</span><span class="w"> </span><span class="n">ref3</span><span class="p">{</span><span class="w"> </span><span class="n">getConstRef</span><span class="p">()</span><span class="w"> </span><span class="p">};</span><span class="w">  </span>
<a id="__codelineno-106-18" name="__codelineno-106-18"></a>
<a id="__codelineno-106-19" name="__codelineno-106-19"></a><span class="w">    </span><span class="c1">// constexpr const std::string_view&amp; (reference reapplied, low-level const not dropped, constexpr applied)              </span>
<a id="__codelineno-106-20" name="__codelineno-106-20"></a><span class="w">    </span><span class="k">constexpr</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="o">&amp;</span><span class="w"> </span><span class="n">ref4</span><span class="p">{</span><span class="w"> </span><span class="n">getConstRef</span><span class="p">()</span><span class="w"> </span><span class="p">};</span><span class="w"> </span>
<a id="__codelineno-106-21" name="__codelineno-106-21"></a>
<a id="__codelineno-106-22" name="__codelineno-106-22"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-106-23" name="__codelineno-106-23"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
</div>
<div class="admonition note">
<p class="admonition-title">指针的类型推导</p>
<p>与引用不同，指针的类型推导不会去掉指针标识符，因此 <code>auto</code> 推导出来的类型会是指针（还记得吗，引用不是一个对象，而指针是），我们还可以使用 <code>auto*</code> 来明确指出推到的结果一定是一个指针。</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-107-1">1</a></span>
<span class="normal"><a href="#__codelineno-107-2">2</a></span>
<span class="normal"><a href="#__codelineno-107-3">3</a></span>
<span class="normal"><a href="#__codelineno-107-4">4</a></span>
<span class="normal"><a href="#__codelineno-107-5">5</a></span>
<span class="normal"><a href="#__codelineno-107-6">6</a></span>
<span class="normal"><a href="#__codelineno-107-7">7</a></span>
<span class="normal"><a href="#__codelineno-107-8">8</a></span>
<span class="normal"><a href="#__codelineno-107-9">9</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-107-1" name="__codelineno-107-1"></a><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">*</span><span class="w"> </span><span class="nf">getPtr</span><span class="p">();</span><span class="w"> </span><span class="c1">// some function that returns a pointer</span>
<a id="__codelineno-107-2" name="__codelineno-107-2"></a>
<a id="__codelineno-107-3" name="__codelineno-107-3"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span>
<a id="__codelineno-107-4" name="__codelineno-107-4"></a><span class="p">{</span>
<a id="__codelineno-107-5" name="__codelineno-107-5"></a><span class="w">    </span><span class="k">auto</span><span class="w"> </span><span class="n">ptr1</span><span class="p">{</span><span class="w"> </span><span class="n">getPtr</span><span class="p">()</span><span class="w"> </span><span class="p">};</span><span class="w">  </span><span class="c1">// std::string*</span>
<a id="__codelineno-107-6" name="__codelineno-107-6"></a><span class="w">    </span><span class="k">auto</span><span class="o">*</span><span class="w"> </span><span class="n">ptr2</span><span class="p">{</span><span class="w"> </span><span class="n">getPtr</span><span class="p">()</span><span class="w"> </span><span class="p">};</span><span class="w"> </span><span class="c1">// std::string*</span>
<a id="__codelineno-107-7" name="__codelineno-107-7"></a>
<a id="__codelineno-107-8" name="__codelineno-107-8"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-107-9" name="__codelineno-107-9"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
</div>
<div class="admonition abstract">
<p class="admonition-title">Abstract</p>
<p>顶层 const 和底层 const </p>
<ul>
<li>顶层 const 修饰的是对象本身，如 <code>const int x</code>和<code>int* const ptr</code></li>
<li>低层 const 修饰的是指针所指向的对象，如 <code>const int&amp; ref</code> 和 <code>const int* ptr</code></li>
</ul>
<p>推导的过程</p>
<ul>
<li>类型推导首先删除所有引用（除非推导的类型被定义为引用 <code>auto&amp;</code>）</li>
<li>然后类型推导会删除所有顶层 const 限定符（除非推导的类型被定义为 const 或 constexpr）</li>
<li>constexpr 不是类型系统的一部分，不会被推导出来，需要将其显式添加到类型推导中</li>
<li>类型推导不会删除指针标识符</li>
<li>在进行类型推导时，始终显式地使用引用标识符、指针标识符、const 限定符和 constexpr 限定符，即使这些限定符是多余的。这有助于我们明晰自己想得到的类型，防止出现错误。</li>
</ul>
<p>关于指针的类型推导</p>
<ul>
<li>使用 <code>auto</code> 时，仅当初始化器是指针时，类型推导的结果才是指针。使用<code>auto*</code>时，即使初始化器不是指针，推论类型也始终是指针。</li>
<li>auto const 和 const auto 都会使推导得到的的指针成为 const 指针。</li>
<li>auto<em> const 的结果是 const 指针，而 const auto</em> 的结果是指向 const 对象的指针。</li>
<li>对指针类型进行推导时，尽可能考虑使用 <code>auto*</code> 而非 <code>auto</code>，这样允许我们显式地重新应用顶级和低层 const，并且能保证推导的结果是一个指针。</li>
</ul>
</div>
<h3 id="_32">右值引用<a class="headerlink" href="#_32" title="Permanent link">¶</a></h3>
<p>C++11 添加了一种新型的参考——右值参考（rvalue reference），它被设计为仅可被右值初始化，我们使用 <code>&amp;&amp;</code> 符号来定义右值引用。</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-108-1">1</a></span>
<span class="normal"><a href="#__codelineno-108-2">2</a></span>
<span class="normal"><a href="#__codelineno-108-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-108-1" name="__codelineno-108-1"></a><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">{</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="p">};</span>
<a id="__codelineno-108-2" name="__codelineno-108-2"></a><span class="kt">int</span><span class="o">&amp;</span><span class="w"> </span><span class="n">lref</span><span class="p">{</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="p">};</span><span class="w">  </span><span class="c1">// l-value reference initialized with l-value x</span>
<a id="__codelineno-108-3" name="__codelineno-108-3"></a><span class="kt">int</span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">rref</span><span class="p">{</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="p">};</span><span class="w"> </span><span class="c1">// r-value reference initialized with r-value 5</span>
</code></pre></div></td></tr></table></div>
<p>右值引用有两个有用的属性：</p>
<ul>
<li>右值引用将使得被用于初始化的右值的生命周期延长至于这个右值引用的生命周期相同，而不是像普通的右值一样在它出现的的完整表达式结束后就被销毁。</li>
<li>非 const 的右值引用甚至允许我们修改这个右值。</li>
</ul>
<div class="admonition example">
<p class="admonition-title">Example</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-109-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-109-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-109-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-109-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-109-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-109-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-109-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-109-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-109-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-109-10">10</a></span>
<span class="normal"><a href="#__codelineno-109-11">11</a></span>
<span class="normal"><a href="#__codelineno-109-12">12</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-109-1" name="__codelineno-109-1"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span>
<a id="__codelineno-109-2" name="__codelineno-109-2"></a><span class="p">{</span>
<a id="__codelineno-109-3" name="__codelineno-109-3"></a><span class="w">    </span><span class="kt">int</span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">rref</span><span class="p">{</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="p">};</span><span class="w"> </span>
<a id="__codelineno-109-4" name="__codelineno-109-4"></a>
<a id="__codelineno-109-5" name="__codelineno-109-5"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">rref</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="sc">' '</span><span class="p">;</span><span class="w"> </span><span class="c1">// prints 5</span>
<a id="__codelineno-109-6" name="__codelineno-109-6"></a>
<a id="__codelineno-109-7" name="__codelineno-109-7"></a><span class="w">    </span><span class="n">rref</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">10</span><span class="p">;</span><span class="w"> </span><span class="c1">// okay: modifies the r-value</span>
<a id="__codelineno-109-8" name="__codelineno-109-8"></a>
<a id="__codelineno-109-9" name="__codelineno-109-9"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">rref</span><span class="p">;</span><span class="w"> </span><span class="c1">// prints 10</span>
<a id="__codelineno-109-10" name="__codelineno-109-10"></a>
<a id="__codelineno-109-11" name="__codelineno-109-11"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-109-12" name="__codelineno-109-12"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>上述程序将输出</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-110-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-110-1" name="__codelineno-110-1"></a>5 10
</code></pre></div></td></tr></table></div>
</div>
<p>虽然先用字面量初始化一个右值引用，然后修改这个值看起来很奇怪，但当我们初始化一个右值引用时，实际上会用这个字面量初始化一个临时变量，然后这个右值引用绑定到这个临时变量上，因此我们实际上是在修改这个临时变量。</p>
<p>右值引用常用作函数的参数，尤其是当我们在希望重载函数能区分左值和右值，并作出不同的行为时</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-111-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-111-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-111-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-111-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-111-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-111-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-111-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-111-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-111-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-111-10">10</a></span>
<span class="normal"><a href="#__codelineno-111-11">11</a></span>
<span class="normal"><a href="#__codelineno-111-12">12</a></span>
<span class="normal"><a href="#__codelineno-111-13">13</a></span>
<span class="normal"><a href="#__codelineno-111-14">14</a></span>
<span class="normal"><a href="#__codelineno-111-15">15</a></span>
<span class="normal"><a href="#__codelineno-111-16">16</a></span>
<span class="normal"><a href="#__codelineno-111-17">17</a></span>
<span class="normal"><a href="#__codelineno-111-18">18</a></span>
<span class="normal"><a href="#__codelineno-111-19">19</a></span>
<span class="normal"><a href="#__codelineno-111-20">20</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-111-1" name="__codelineno-111-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span>
<a id="__codelineno-111-2" name="__codelineno-111-2"></a>
<a id="__codelineno-111-3" name="__codelineno-111-3"></a><span class="kt">void</span><span class="w"> </span><span class="nf">fun</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="o">&amp;</span><span class="w"> </span><span class="n">lref</span><span class="p">)</span><span class="w"> </span><span class="c1">// l-value arguments</span>
<a id="__codelineno-111-4" name="__codelineno-111-4"></a><span class="p">{</span>
<a id="__codelineno-111-5" name="__codelineno-111-5"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"l-value reference to const: "</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">lref</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="sc">'\n'</span><span class="p">;</span>
<a id="__codelineno-111-6" name="__codelineno-111-6"></a><span class="p">}</span>
<a id="__codelineno-111-7" name="__codelineno-111-7"></a>
<a id="__codelineno-111-8" name="__codelineno-111-8"></a><span class="kt">void</span><span class="w"> </span><span class="nf">fun</span><span class="p">(</span><span class="kt">int</span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">rref</span><span class="p">)</span><span class="w"> </span><span class="c1">// r-value arguments</span>
<a id="__codelineno-111-9" name="__codelineno-111-9"></a><span class="p">{</span>
<a id="__codelineno-111-10" name="__codelineno-111-10"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"r-value reference: "</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">rref</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="sc">'\n'</span><span class="p">;</span>
<a id="__codelineno-111-11" name="__codelineno-111-11"></a><span class="p">}</span>
<a id="__codelineno-111-12" name="__codelineno-111-12"></a>
<a id="__codelineno-111-13" name="__codelineno-111-13"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span>
<a id="__codelineno-111-14" name="__codelineno-111-14"></a><span class="p">{</span>
<a id="__codelineno-111-15" name="__codelineno-111-15"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">{</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="p">};</span>
<a id="__codelineno-111-16" name="__codelineno-111-16"></a><span class="w">    </span><span class="n">fun</span><span class="p">(</span><span class="n">x</span><span class="p">);</span><span class="w"> </span><span class="c1">// l-value argument calls l-value version of function</span>
<a id="__codelineno-111-17" name="__codelineno-111-17"></a><span class="w">    </span><span class="n">fun</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span><span class="w"> </span><span class="c1">// r-value argument calls r-value version of function</span>
<a id="__codelineno-111-18" name="__codelineno-111-18"></a>
<a id="__codelineno-111-19" name="__codelineno-111-19"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-111-20" name="__codelineno-111-20"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>这段程序的输出为</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-112-1">1</a></span>
<span class="normal"><a href="#__codelineno-112-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-112-1" name="__codelineno-112-1"></a>l-value reference to const: 5
<a id="__codelineno-112-2" name="__codelineno-112-2"></a>r-value reference: 5
</code></pre></div></td></tr></table></div>
<p>右值作为函数参数常常用于<a href="#_70">移动语义</a></p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-113-1">1</a></span>
<span class="normal"><a href="#__codelineno-113-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-113-1" name="__codelineno-113-1"></a><span class="kt">int</span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">ref</span><span class="p">{</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="p">};</span>
<a id="__codelineno-113-2" name="__codelineno-113-2"></a><span class="n">fun</span><span class="p">(</span><span class="n">ref</span><span class="p">);</span>
</code></pre></div></td></tr></table></div>
<p>上面的代码片段实际上调用的是 <code>fun(const int&amp;)</code> 而非 <code>fun(int&amp;&amp;)</code>，因为 <code>ref</code> 虽然具有类型 <code>int&amp;&amp;</code>，但在表达式中使用时它是一个左值，因此实际上会调用 <code>fun(const int&amp;)</code>。</p>
</div>
<hr/>
<h2 id="_33">类模板<a class="headerlink" href="#_33" title="Permanent link">¶</a></h2>
<p>类似于函数模板是用于实例化函数的一模板定义，<strong>类模板</strong>（class template）是用于实例化类类型的一种模板定义。</p>
<div class="admonition tip">
<p class="admonition-title">类类型（class type）</p>
<p>类类型包括结构体、类和联合体（struct, class, and union type），为简单起见，下面我们仅在结构体上演示类模板的用法，但它们同样适用于类和联合体。</p>
</div>
<p>对于一个简单的结构体 Pair</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-114-1">1</a></span>
<span class="normal"><a href="#__codelineno-114-2">2</a></span>
<span class="normal"><a href="#__codelineno-114-3">3</a></span>
<span class="normal"><a href="#__codelineno-114-4">4</a></span>
<span class="normal"><a href="#__codelineno-114-5">5</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-114-1" name="__codelineno-114-1"></a><span class="k">struct</span><span class="w"> </span><span class="nc">Pair</span>
<a id="__codelineno-114-2" name="__codelineno-114-2"></a><span class="p">{</span>
<a id="__codelineno-114-3" name="__codelineno-114-3"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">first</span><span class="p">{};</span>
<a id="__codelineno-114-4" name="__codelineno-114-4"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">second</span><span class="p">{};</span>
<a id="__codelineno-114-5" name="__codelineno-114-5"></a><span class="p">};</span>
</code></pre></div></td></tr></table></div>
<p>我们可以用类模板把它重写为</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-115-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-115-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-115-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-115-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-115-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-115-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-115-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-115-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-115-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-115-10">10</a></span>
<span class="normal"><a href="#__codelineno-115-11">11</a></span>
<span class="normal"><a href="#__codelineno-115-12">12</a></span>
<span class="normal"><a href="#__codelineno-115-13">13</a></span>
<span class="normal"><a href="#__codelineno-115-14">14</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-115-1" name="__codelineno-115-1"></a><span class="k">template</span><span class="w"> </span><span class="o">&lt;</span><span class="k">typename</span><span class="w"> </span><span class="nc">T</span><span class="o">&gt;</span>
<a id="__codelineno-115-2" name="__codelineno-115-2"></a><span class="k">struct</span><span class="w"> </span><span class="nc">Pair</span>
<a id="__codelineno-115-3" name="__codelineno-115-3"></a><span class="p">{</span>
<a id="__codelineno-115-4" name="__codelineno-115-4"></a><span class="w">    </span><span class="n">T</span><span class="w"> </span><span class="n">first</span><span class="p">{};</span>
<a id="__codelineno-115-5" name="__codelineno-115-5"></a><span class="w">    </span><span class="n">T</span><span class="w"> </span><span class="n">second</span><span class="p">{};</span>
<a id="__codelineno-115-6" name="__codelineno-115-6"></a><span class="p">};</span>
<a id="__codelineno-115-7" name="__codelineno-115-7"></a>
<a id="__codelineno-115-8" name="__codelineno-115-8"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span>
<a id="__codelineno-115-9" name="__codelineno-115-9"></a><span class="p">{</span>
<a id="__codelineno-115-10" name="__codelineno-115-10"></a><span class="w">    </span><span class="n">Pair</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="n">p1</span><span class="p">{</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="w"> </span><span class="p">};</span><span class="w">        </span>
<a id="__codelineno-115-11" name="__codelineno-115-11"></a><span class="w">    </span><span class="n">Pair</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="w"> </span><span class="n">p2</span><span class="p">{</span><span class="w"> </span><span class="mf">1.2</span><span class="p">,</span><span class="w"> </span><span class="mf">3.4</span><span class="w"> </span><span class="p">};</span><span class="w"> </span>
<a id="__codelineno-115-12" name="__codelineno-115-12"></a>
<a id="__codelineno-115-13" name="__codelineno-115-13"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-115-14" name="__codelineno-115-14"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>当我们想要实例化一个结构体时，只需要像函数模板一样在结构体名称后面加上尖括号，然后在尖括号中指定类型即可，例如 <code>Pair&lt;int&gt;</code> 和 <code>Pair&lt;double&gt;</code>。</p>
<h3 id="_34">函数中的类模板<a class="headerlink" href="#_34" title="Permanent link">¶</a></h3>
<p>我们还可以对这个类模板创建一个函数模板</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-116-1">1</a></span>
<span class="normal"><a href="#__codelineno-116-2">2</a></span>
<span class="normal"><a href="#__codelineno-116-3">3</a></span>
<span class="normal"><a href="#__codelineno-116-4">4</a></span>
<span class="normal"><a href="#__codelineno-116-5">5</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-116-1" name="__codelineno-116-1"></a>template &lt;typename T&gt;
<a id="__codelineno-116-2" name="__codelineno-116-2"></a>constexpr T max(Pair&lt;T&gt; p)
<a id="__codelineno-116-3" name="__codelineno-116-3"></a>{
<a id="__codelineno-116-4" name="__codelineno-116-4"></a>    return (p.first &lt; p.second ? p.second : p.first);
<a id="__codelineno-116-5" name="__codelineno-116-5"></a>}
</code></pre></div></td></tr></table></div>
<p>在调用函数时，可以显示地传入 <code>Pair</code> 的模板参数，也可以让编译器自动推导</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-117-1">1</a></span>
<span class="normal"><a href="#__codelineno-117-2">2</a></span>
<span class="normal"><a href="#__codelineno-117-3">3</a></span>
<span class="normal"><a href="#__codelineno-117-4">4</a></span>
<span class="normal"><a href="#__codelineno-117-5">5</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-117-1" name="__codelineno-117-1"></a><span class="n">Pair</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="n">p1</span><span class="p">{</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="w"> </span><span class="p">};</span>
<a id="__codelineno-117-2" name="__codelineno-117-2"></a><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">max</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="n">p1</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">" is larger</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span><span class="w"> </span><span class="c1">// explicit call to max&lt;int&gt;</span>
<a id="__codelineno-117-3" name="__codelineno-117-3"></a>
<a id="__codelineno-117-4" name="__codelineno-117-4"></a><span class="n">Pair</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="w"> </span><span class="n">p2</span><span class="p">{</span><span class="w"> </span><span class="mf">1.2</span><span class="p">,</span><span class="w"> </span><span class="mf">3.4</span><span class="w"> </span><span class="p">};</span>
<a id="__codelineno-117-5" name="__codelineno-117-5"></a><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">max</span><span class="p">(</span><span class="n">p2</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">" is larger</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
</code></pre></div></td></tr></table></div>
<p>如果我们试图调用 <code>max&lt;double&gt;(p1)</code> 则会出现编译错误</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>类模板可以使用模板类型和普通的类型（非模板类型）混合使用</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-118-1">1</a></span>
<span class="normal"><a href="#__codelineno-118-2">2</a></span>
<span class="normal"><a href="#__codelineno-118-3">3</a></span>
<span class="normal"><a href="#__codelineno-118-4">4</a></span>
<span class="normal"><a href="#__codelineno-118-5">5</a></span>
<span class="normal"><a href="#__codelineno-118-6">6</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-118-1" name="__codelineno-118-1"></a><span class="k">template</span><span class="w"> </span><span class="o">&lt;</span><span class="k">typename</span><span class="w"> </span><span class="nc">T</span><span class="o">&gt;</span>
<a id="__codelineno-118-2" name="__codelineno-118-2"></a><span class="k">struct</span><span class="w"> </span><span class="nc">Foo</span>
<a id="__codelineno-118-3" name="__codelineno-118-3"></a><span class="p">{</span>
<a id="__codelineno-118-4" name="__codelineno-118-4"></a><span class="w">    </span><span class="n">T</span><span class="w"> </span><span class="n">first</span><span class="p">{};</span><span class="w">    </span><span class="c1">// first will have whatever type T is replaced with</span>
<a id="__codelineno-118-5" name="__codelineno-118-5"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">second</span><span class="p">{};</span><span class="w"> </span><span class="c1">// second will always have type int, regardless of what type T is</span>
<a id="__codelineno-118-6" name="__codelineno-118-6"></a><span class="p">};</span>
</code></pre></div></td></tr></table></div>
<p>类模板也可以使用多种模板类型</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-119-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-119-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-119-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-119-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-119-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-119-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-119-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-119-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-119-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-119-10">10</a></span>
<span class="normal"><a href="#__codelineno-119-11">11</a></span>
<span class="normal"><a href="#__codelineno-119-12">12</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-119-1" name="__codelineno-119-1"></a><span class="k">template</span><span class="w"> </span><span class="o">&lt;</span><span class="k">typename</span><span class="w"> </span><span class="nc">T</span><span class="p">,</span><span class="w"> </span><span class="k">typename</span><span class="w"> </span><span class="nc">U</span><span class="o">&gt;</span>
<a id="__codelineno-119-2" name="__codelineno-119-2"></a><span class="k">struct</span><span class="w"> </span><span class="nc">Pair</span>
<a id="__codelineno-119-3" name="__codelineno-119-3"></a><span class="p">{</span>
<a id="__codelineno-119-4" name="__codelineno-119-4"></a><span class="w">    </span><span class="n">T</span><span class="w"> </span><span class="n">first</span><span class="p">{};</span>
<a id="__codelineno-119-5" name="__codelineno-119-5"></a><span class="w">    </span><span class="n">U</span><span class="w"> </span><span class="n">second</span><span class="p">{};</span>
<a id="__codelineno-119-6" name="__codelineno-119-6"></a><span class="p">};</span>
<a id="__codelineno-119-7" name="__codelineno-119-7"></a>
<a id="__codelineno-119-8" name="__codelineno-119-8"></a><span class="k">template</span><span class="w"> </span><span class="o">&lt;</span><span class="k">typename</span><span class="w"> </span><span class="nc">T</span><span class="p">,</span><span class="w"> </span><span class="k">typename</span><span class="w"> </span><span class="nc">U</span><span class="o">&gt;</span>
<a id="__codelineno-119-9" name="__codelineno-119-9"></a><span class="kt">void</span><span class="w"> </span><span class="n">print</span><span class="p">(</span><span class="n">Pair</span><span class="o">&lt;</span><span class="n">T</span><span class="p">,</span><span class="w"> </span><span class="n">U</span><span class="o">&gt;</span><span class="w"> </span><span class="n">p</span><span class="p">)</span>
<a id="__codelineno-119-10" name="__codelineno-119-10"></a><span class="p">{</span>
<a id="__codelineno-119-11" name="__codelineno-119-11"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="sc">'['</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">p</span><span class="p">.</span><span class="n">first</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">", "</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">p</span><span class="p">.</span><span class="n">second</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="sc">']'</span><span class="p">;</span>
<a id="__codelineno-119-12" name="__codelineno-119-12"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>如果我们希望编写一个用于各种类型的 <code>print()</code> 函数（只要能通过编译就可以），可以写为</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-120-1">1</a></span>
<span class="normal"><a href="#__codelineno-120-2">2</a></span>
<span class="normal"><a href="#__codelineno-120-3">3</a></span>
<span class="normal"><a href="#__codelineno-120-4">4</a></span>
<span class="normal"><a href="#__codelineno-120-5">5</a></span>
<span class="normal"><a href="#__codelineno-120-6">6</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-120-1" name="__codelineno-120-1"></a><span class="k">template</span><span class="w"> </span><span class="o">&lt;</span><span class="k">typename</span><span class="w"> </span><span class="nc">T</span><span class="o">&gt;</span>
<a id="__codelineno-120-2" name="__codelineno-120-2"></a><span class="kt">void</span><span class="w"> </span><span class="n">print</span><span class="p">(</span><span class="n">T</span><span class="w"> </span><span class="n">p</span><span class="p">)</span><span class="w"> </span><span class="c1">// type template parameter will match anything</span>
<a id="__codelineno-120-3" name="__codelineno-120-3"></a><span class="p">{</span>
<a id="__codelineno-120-4" name="__codelineno-120-4"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="sc">'['</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">p</span><span class="p">.</span><span class="n">first</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">", "</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">p</span><span class="p">.</span><span class="n">second</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="sc">']'</span><span class="p">;</span><span class="w"> </span>
<a id="__codelineno-120-5" name="__codelineno-120-5"></a><span class="w">    </span><span class="c1">// will only compile if type has first and second members</span>
<a id="__codelineno-120-6" name="__codelineno-120-6"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
</div>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>由于处理数据对的情况很常见，因此 C++ 标准库包含一个名为 <code>std::pair</code> 的类模板（在 <code>&lt;utility&gt;</code> 头文件中），它是一个类似于我们定义的 <code>Pair</code> 的类模板。</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-121-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-121-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-121-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-121-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-121-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-121-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-121-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-121-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-121-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-121-10">10</a></span>
<span class="normal"><a href="#__codelineno-121-11">11</a></span>
<span class="normal"><a href="#__codelineno-121-12">12</a></span>
<span class="normal"><a href="#__codelineno-121-13">13</a></span>
<span class="normal"><a href="#__codelineno-121-14">14</a></span>
<span class="normal"><a href="#__codelineno-121-15">15</a></span>
<span class="normal"><a href="#__codelineno-121-16">16</a></span>
<span class="normal"><a href="#__codelineno-121-17">17</a></span>
<span class="normal"><a href="#__codelineno-121-18">18</a></span>
<span class="normal"><a href="#__codelineno-121-19">19</a></span>
<span class="normal"><a href="#__codelineno-121-20">20</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-121-1" name="__codelineno-121-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span>
<a id="__codelineno-121-2" name="__codelineno-121-2"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;utility&gt;</span>
<a id="__codelineno-121-3" name="__codelineno-121-3"></a>
<a id="__codelineno-121-4" name="__codelineno-121-4"></a><span class="k">template</span><span class="w"> </span><span class="o">&lt;</span><span class="k">typename</span><span class="w"> </span><span class="nc">T</span><span class="p">,</span><span class="w"> </span><span class="k">typename</span><span class="w"> </span><span class="nc">U</span><span class="o">&gt;</span>
<a id="__codelineno-121-5" name="__codelineno-121-5"></a><span class="kt">void</span><span class="w"> </span><span class="n">print</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">pair</span><span class="o">&lt;</span><span class="n">T</span><span class="p">,</span><span class="w"> </span><span class="n">U</span><span class="o">&gt;</span><span class="w"> </span><span class="n">p</span><span class="p">)</span>
<a id="__codelineno-121-6" name="__codelineno-121-6"></a><span class="p">{</span>
<a id="__codelineno-121-7" name="__codelineno-121-7"></a><span class="w">    </span><span class="c1">// the members of std::pair have predefined names `first` and `second`</span>
<a id="__codelineno-121-8" name="__codelineno-121-8"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="sc">'['</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">p</span><span class="p">.</span><span class="n">first</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">", "</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">p</span><span class="p">.</span><span class="n">second</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="sc">']'</span><span class="p">;</span>
<a id="__codelineno-121-9" name="__codelineno-121-9"></a><span class="p">}</span>
<a id="__codelineno-121-10" name="__codelineno-121-10"></a>
<a id="__codelineno-121-11" name="__codelineno-121-11"></a><span class="kt">int</span><span class="w"> </span><span class="n">main</span><span class="p">()</span>
<a id="__codelineno-121-12" name="__codelineno-121-12"></a><span class="p">{</span>
<a id="__codelineno-121-13" name="__codelineno-121-13"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">pair</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="o">&gt;</span><span class="w"> </span><span class="n">p1</span><span class="p">{</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mf">2.3</span><span class="w"> </span><span class="p">};</span><span class="w"> </span><span class="c1">// a pair holding an int and a double</span>
<a id="__codelineno-121-14" name="__codelineno-121-14"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">pair</span><span class="o">&lt;</span><span class="kt">double</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="n">p2</span><span class="p">{</span><span class="w"> </span><span class="mf">4.5</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="w"> </span><span class="p">};</span><span class="w"> </span><span class="c1">// a pair holding a double and an int</span>
<a id="__codelineno-121-15" name="__codelineno-121-15"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">pair</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="n">p3</span><span class="p">{</span><span class="w"> </span><span class="mi">7</span><span class="p">,</span><span class="w"> </span><span class="mi">8</span><span class="w"> </span><span class="p">};</span><span class="w">      </span><span class="c1">// a pair holding two ints</span>
<a id="__codelineno-121-16" name="__codelineno-121-16"></a>
<a id="__codelineno-121-17" name="__codelineno-121-17"></a><span class="w">    </span><span class="n">print</span><span class="p">(</span><span class="n">p2</span><span class="p">);</span>
<a id="__codelineno-121-18" name="__codelineno-121-18"></a>
<a id="__codelineno-121-19" name="__codelineno-121-19"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-121-20" name="__codelineno-121-20"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>我们刚刚实现了自己的 <code>Pair</code> 类，但在实际的代码中使用 <code>std::pair</code> 是个更好的选择</p>
</div>
<p>和函数模板一样，类模板通常也在头文件中定义，通过 <code>#include</code> 指令包含到需要使用的文件中。</p>
<h3 id="ctad">类模板参数推导（CTAD）<a class="headerlink" href="#ctad" title="Permanent link">¶</a></h3>
<p>从 C++17 开始，从类模板实例化对象时，编译器可以从初始化器的类型中推导出模板类型，这称之为<strong>类模板参数推导</strong>（Class Template Argument Deduction，CTAD）。</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-122-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-122-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-122-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-122-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-122-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-122-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-122-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-122-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-122-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-122-10">10</a></span>
<span class="normal"><a href="#__codelineno-122-11">11</a></span>
<span class="normal"><a href="#__codelineno-122-12">12</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-122-1" name="__codelineno-122-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;utility&gt;</span><span class="c1"> // for std::pair</span>
<a id="__codelineno-122-2" name="__codelineno-122-2"></a>
<a id="__codelineno-122-3" name="__codelineno-122-3"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span>
<a id="__codelineno-122-4" name="__codelineno-122-4"></a><span class="p">{</span>
<a id="__codelineno-122-5" name="__codelineno-122-5"></a><span class="w">    </span><span class="c1">// explicitly specify class template std::pair&lt;int, int&gt; (C++11 onward)</span>
<a id="__codelineno-122-6" name="__codelineno-122-6"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">pair</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="n">p1</span><span class="p">{</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">};</span><span class="w"> </span>
<a id="__codelineno-122-7" name="__codelineno-122-7"></a>
<a id="__codelineno-122-8" name="__codelineno-122-8"></a><span class="w">    </span><span class="c1">// CTAD used to deduce std::pair&lt;int, int&gt; from the initializers (C++17)</span>
<a id="__codelineno-122-9" name="__codelineno-122-9"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">pair</span><span class="w"> </span><span class="n">p2</span><span class="p">{</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">};</span><span class="w">           </span>
<a id="__codelineno-122-10" name="__codelineno-122-10"></a>
<a id="__codelineno-122-11" name="__codelineno-122-11"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-122-12" name="__codelineno-122-12"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>仅在没有模板参数列表时，编译器才会执行 CTAD，因此以下两种情况都是错误的</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-123-1">1</a></span>
<span class="normal"><a href="#__codelineno-123-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-123-1" name="__codelineno-123-1"></a><span class="n">std</span><span class="o">::</span><span class="n">pair</span><span class="o">&lt;&gt;</span><span class="w"> </span><span class="n">p1</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">};</span>
<a id="__codelineno-123-2" name="__codelineno-123-2"></a><span class="n">std</span><span class="o">::</span><span class="n">pair</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="n">p2</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="w"> </span><span class="p">};</span>
</code></pre></div></td></tr></table></div>
<p>由于 CTAD 是一种类型推导的形式，因此我们可以使用字面量后缀来更改推导得到的类型：</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-124-1">1</a></span>
<span class="normal"><a href="#__codelineno-124-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-124-1" name="__codelineno-124-1"></a><span class="n">std</span><span class="o">::</span><span class="n">pair</span><span class="w"> </span><span class="n">p1</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="mf">3.4f</span><span class="p">,</span><span class="w"> </span><span class="mf">5.6f</span><span class="w"> </span><span class="p">};</span><span class="w"> </span><span class="c1">// pair&lt;float, float&gt;</span>
<a id="__codelineno-124-2" name="__codelineno-124-2"></a><span class="n">std</span><span class="o">::</span><span class="n">pair</span><span class="w"> </span><span class="n">p2</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="mi">1u</span><span class="p">,</span><span class="w"> </span><span class="mi">2u</span><span class="w"> </span><span class="p">};</span><span class="w">     </span><span class="c1">// pair&lt;unsigned int, unsigned int&gt;</span>
</code></pre></div></td></tr></table></div>
<h4 id="c17">模板参数推导指南（C++17）<a class="headerlink" href="#c17" title="Permanent link">¶</a></h4>
<p>在多数情况下，CTAD 可以直接使用；但在某些情况下，编译器可能需要一些额外的帮助才能知道如何正确地推断模板参数。</p>
<p>例如在下面的程序在 C++17 中无法编译</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-125-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-125-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-125-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-125-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-125-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-125-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-125-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-125-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-125-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-125-10">10</a></span>
<span class="normal"><a href="#__codelineno-125-11">11</a></span>
<span class="normal"><a href="#__codelineno-125-12">12</a></span>
<span class="normal"><a href="#__codelineno-125-13">13</a></span>
<span class="normal"><a href="#__codelineno-125-14">14</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-125-1" name="__codelineno-125-1"></a><span class="k">template</span><span class="w"> </span><span class="o">&lt;</span><span class="k">typename</span><span class="w"> </span><span class="nc">T</span><span class="p">,</span><span class="w"> </span><span class="k">typename</span><span class="w"> </span><span class="nc">U</span><span class="o">&gt;</span>
<a id="__codelineno-125-2" name="__codelineno-125-2"></a><span class="k">struct</span><span class="w"> </span><span class="nc">Pair</span>
<a id="__codelineno-125-3" name="__codelineno-125-3"></a><span class="p">{</span>
<a id="__codelineno-125-4" name="__codelineno-125-4"></a><span class="w">    </span><span class="n">T</span><span class="w"> </span><span class="n">first</span><span class="p">{};</span>
<a id="__codelineno-125-5" name="__codelineno-125-5"></a><span class="w">    </span><span class="n">U</span><span class="w"> </span><span class="n">second</span><span class="p">{};</span>
<a id="__codelineno-125-6" name="__codelineno-125-6"></a><span class="p">};</span>
<a id="__codelineno-125-7" name="__codelineno-125-7"></a>
<a id="__codelineno-125-8" name="__codelineno-125-8"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span>
<a id="__codelineno-125-9" name="__codelineno-125-9"></a><span class="p">{</span>
<a id="__codelineno-125-10" name="__codelineno-125-10"></a><span class="w">    </span><span class="n">Pair</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="n">p1</span><span class="p">{</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">};</span><span class="w"> </span><span class="c1">// ok: we're explicitly specifying the template arguments</span>
<a id="__codelineno-125-11" name="__codelineno-125-11"></a><span class="w">    </span><span class="n">Pair</span><span class="w"> </span><span class="n">p2</span><span class="p">{</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">};</span><span class="w">           </span><span class="c1">// compile error in C++17 (okay in C++20)</span>
<a id="__codelineno-125-12" name="__codelineno-125-12"></a>
<a id="__codelineno-125-13" name="__codelineno-125-13"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-125-14" name="__codelineno-125-14"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>在 C++17 中编译上面这段代码，可能会遇到“class template argument deduction failed”或“cannot deduce template arguments”或“No viable constructor or deduction guide”的报错信息。这是因为在 C++17 中，编译器不知道如何推导聚合类模板的模板参数，因此我们需要提供一个<strong>模板参数推导指南</strong>（deduction guide）来帮助编译器推导模板参数。</p>
<p>这是添加推导指南之后的同一段程序：</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-126-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-126-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-126-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-126-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-126-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-126-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-126-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-126-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-126-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-126-10">10</a></span>
<span class="normal"><a href="#__codelineno-126-11">11</a></span>
<span class="normal"><a href="#__codelineno-126-12">12</a></span>
<span class="normal"><a href="#__codelineno-126-13">13</a></span>
<span class="normal"><a href="#__codelineno-126-14">14</a></span>
<span class="normal"><a href="#__codelineno-126-15">15</a></span>
<span class="normal"><a href="#__codelineno-126-16">16</a></span>
<span class="normal"><a href="#__codelineno-126-17">17</a></span>
<span class="normal"><a href="#__codelineno-126-18">18</a></span>
<span class="normal"><a href="#__codelineno-126-19">19</a></span>
<span class="normal"><a href="#__codelineno-126-20">20</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-126-1" name="__codelineno-126-1"></a><span class="k">template</span><span class="w"> </span><span class="o">&lt;</span><span class="k">typename</span><span class="w"> </span><span class="nc">T</span><span class="p">,</span><span class="w"> </span><span class="k">typename</span><span class="w"> </span><span class="nc">U</span><span class="o">&gt;</span>
<a id="__codelineno-126-2" name="__codelineno-126-2"></a><span class="k">struct</span><span class="w"> </span><span class="nc">Pair</span>
<a id="__codelineno-126-3" name="__codelineno-126-3"></a><span class="p">{</span>
<a id="__codelineno-126-4" name="__codelineno-126-4"></a><span class="w">    </span><span class="n">T</span><span class="w"> </span><span class="n">first</span><span class="p">{};</span>
<a id="__codelineno-126-5" name="__codelineno-126-5"></a><span class="w">    </span><span class="n">U</span><span class="w"> </span><span class="n">second</span><span class="p">{};</span>
<a id="__codelineno-126-6" name="__codelineno-126-6"></a><span class="p">};</span>
<a id="__codelineno-126-7" name="__codelineno-126-7"></a>
<a id="__codelineno-126-8" name="__codelineno-126-8"></a><span class="c1">// Pair objects initialized with arguments of type T and U should deduce to Pair&lt;T, U&gt;</span>
<a id="__codelineno-126-9" name="__codelineno-126-9"></a><span class="k">template</span><span class="w"> </span><span class="o">&lt;</span><span class="k">typename</span><span class="w"> </span><span class="nc">T</span><span class="p">,</span><span class="w"> </span><span class="k">typename</span><span class="w"> </span><span class="nc">U</span><span class="o">&gt;</span>
<a id="__codelineno-126-10" name="__codelineno-126-10"></a><span class="n">Pair</span><span class="p">(</span><span class="n">T</span><span class="p">,</span><span class="w"> </span><span class="n">U</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">Pair</span><span class="o">&lt;</span><span class="n">T</span><span class="p">,</span><span class="w"> </span><span class="n">U</span><span class="o">&gt;</span><span class="p">;</span>
<a id="__codelineno-126-11" name="__codelineno-126-11"></a>
<a id="__codelineno-126-12" name="__codelineno-126-12"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span>
<a id="__codelineno-126-13" name="__codelineno-126-13"></a><span class="p">{</span>
<a id="__codelineno-126-14" name="__codelineno-126-14"></a><span class="w">    </span><span class="c1">// explicitly specify class template Pair&lt;int, int&gt; (C++11 onward)</span>
<a id="__codelineno-126-15" name="__codelineno-126-15"></a><span class="w">    </span><span class="n">Pair</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="n">p1</span><span class="p">{</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">};</span><span class="w"> </span>
<a id="__codelineno-126-16" name="__codelineno-126-16"></a><span class="w">    </span><span class="c1">// CTAD used to deduce Pair&lt;int, int&gt; from the initializers (C++17)</span>
<a id="__codelineno-126-17" name="__codelineno-126-17"></a><span class="w">    </span><span class="n">Pair</span><span class="w"> </span><span class="n">p2</span><span class="p">{</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">};</span><span class="w">           </span>
<a id="__codelineno-126-18" name="__codelineno-126-18"></a>
<a id="__codelineno-126-19" name="__codelineno-126-19"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-126-20" name="__codelineno-126-20"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<div class="highlight"><table class="highlighttable"><tr><th class="filename" colspan="2"><span class="filename">deduction guide</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-127-1">1</a></span>
<span class="normal"><a href="#__codelineno-127-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-127-1" name="__codelineno-127-1"></a><span class="k">template</span><span class="w"> </span><span class="o">&lt;</span><span class="k">typename</span><span class="w"> </span><span class="nc">T</span><span class="p">,</span><span class="w"> </span><span class="k">typename</span><span class="w"> </span><span class="nc">U</span><span class="o">&gt;</span>
<a id="__codelineno-127-2" name="__codelineno-127-2"></a><span class="n">Pair</span><span class="p">(</span><span class="n">T</span><span class="p">,</span><span class="w"> </span><span class="n">U</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">Pair</span><span class="o">&lt;</span><span class="n">T</span><span class="p">,</span><span class="w"> </span><span class="n">U</span><span class="o">&gt;</span><span class="p">;</span>
</code></pre></div></td></tr></table></div>
<p>上面这段的推导指南的作用是，告诉编译器当它看到一个名为 <code>Pair</code> 的对象带有类型分别为 <code>T</code> 和 <code>U</code> 的参数时，应该把最终的类型推导为 <code>Pair&lt;T, U&gt;</code>。</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<ul>
<li>C++20 中添加了编译器自动生成推导指南的功能，因此我们只需要在 C++17 中手动编写推导指南</li>
<li><code>std::pair</code>（和其他标准库中的模板类型）附带预定义的推导指南，无需我们自己提供推导指南</li>
</ul>
</div>
<h4 id="_35">模板参数的默认值<a class="headerlink" href="#_35" title="Permanent link">¶</a></h4>
<p>就像函数参数可以有默认参数一样，模板参数也可以有默认值。当模板参数未明确指定且无法推断时，将使用这些参数。</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-128-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-128-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-128-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-128-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-128-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-128-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-128-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-128-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-128-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-128-10">10</a></span>
<span class="normal"><a href="#__codelineno-128-11">11</a></span>
<span class="normal"><a href="#__codelineno-128-12">12</a></span>
<span class="normal"><a href="#__codelineno-128-13">13</a></span>
<span class="normal"><a href="#__codelineno-128-14">14</a></span>
<span class="normal"><a href="#__codelineno-128-15">15</a></span>
<span class="normal"><a href="#__codelineno-128-16">16</a></span>
<span class="normal"><a href="#__codelineno-128-17">17</a></span>
<span class="normal"><a href="#__codelineno-128-18">18</a></span>
<span class="normal"><a href="#__codelineno-128-19">19</a></span>
<span class="normal"><a href="#__codelineno-128-20">20</a></span>
<span class="normal"><a href="#__codelineno-128-21">21</a></span>
<span class="normal"><a href="#__codelineno-128-22">22</a></span>
<span class="normal"><a href="#__codelineno-128-23">23</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-128-1" name="__codelineno-128-1"></a><span class="k">template</span><span class="w"> </span><span class="o">&lt;</span><span class="k">typename</span><span class="w"> </span><span class="nc">T</span><span class="o">=</span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="k">typename</span><span class="w"> </span><span class="nc">U</span><span class="o">=</span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="c1">// default T and U to type int</span>
<a id="__codelineno-128-2" name="__codelineno-128-2"></a><span class="k">struct</span><span class="w"> </span><span class="nc">Pair</span>
<a id="__codelineno-128-3" name="__codelineno-128-3"></a><span class="p">{</span>
<a id="__codelineno-128-4" name="__codelineno-128-4"></a><span class="w">    </span><span class="n">T</span><span class="w"> </span><span class="n">first</span><span class="p">{};</span>
<a id="__codelineno-128-5" name="__codelineno-128-5"></a><span class="w">    </span><span class="n">U</span><span class="w"> </span><span class="n">second</span><span class="p">{};</span>
<a id="__codelineno-128-6" name="__codelineno-128-6"></a><span class="p">};</span>
<a id="__codelineno-128-7" name="__codelineno-128-7"></a>
<a id="__codelineno-128-8" name="__codelineno-128-8"></a><span class="k">template</span><span class="w"> </span><span class="o">&lt;</span><span class="k">typename</span><span class="w"> </span><span class="nc">T</span><span class="p">,</span><span class="w"> </span><span class="k">typename</span><span class="w"> </span><span class="nc">U</span><span class="o">&gt;</span>
<a id="__codelineno-128-9" name="__codelineno-128-9"></a><span class="n">Pair</span><span class="p">(</span><span class="n">T</span><span class="p">,</span><span class="w"> </span><span class="n">U</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">Pair</span><span class="o">&lt;</span><span class="n">T</span><span class="p">,</span><span class="w"> </span><span class="n">U</span><span class="o">&gt;</span><span class="p">;</span>
<a id="__codelineno-128-10" name="__codelineno-128-10"></a>
<a id="__codelineno-128-11" name="__codelineno-128-11"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span>
<a id="__codelineno-128-12" name="__codelineno-128-12"></a><span class="p">{</span>
<a id="__codelineno-128-13" name="__codelineno-128-13"></a><span class="w">    </span><span class="c1">// explicitly specify class template Pair&lt;int, int&gt; (C++11 onward)</span>
<a id="__codelineno-128-14" name="__codelineno-128-14"></a><span class="w">    </span><span class="n">Pair</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="n">p1</span><span class="p">{</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">};</span><span class="w"> </span>
<a id="__codelineno-128-15" name="__codelineno-128-15"></a>
<a id="__codelineno-128-16" name="__codelineno-128-16"></a><span class="w">    </span><span class="c1">// CTAD used to deduce Pair&lt;int, int&gt; (C++17)</span>
<a id="__codelineno-128-17" name="__codelineno-128-17"></a><span class="w">    </span><span class="n">Pair</span><span class="w"> </span><span class="n">p2</span><span class="p">{</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">};</span><span class="w">           </span>
<a id="__codelineno-128-18" name="__codelineno-128-18"></a>
<a id="__codelineno-128-19" name="__codelineno-128-19"></a><span class="w">    </span><span class="c1">// uses default Pair&lt;int, int&gt;</span>
<a id="__codelineno-128-20" name="__codelineno-128-20"></a><span class="w">    </span><span class="n">Pair</span><span class="w"> </span><span class="n">p3</span><span class="p">;</span><span class="w">                   </span>
<a id="__codelineno-128-21" name="__codelineno-128-21"></a>
<a id="__codelineno-128-22" name="__codelineno-128-22"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-128-23" name="__codelineno-128-23"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>这里我们对 <code>p3</code> 的定义并未明确指定类型模板参数的类型，也没有能够从中推导这些类型的初始化器。</p>
<details class="warning">
<summary>CTAD 不适用于函数参数</summary>
<p>CTAD 表示的是 class template <em>argument</em> deduction，而非 class template <em>parameter</em> deduction，因此它不能用于函数的形参（parameter）。例如下面的代码是错误的：</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-129-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-129-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-129-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-129-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-129-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-129-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-129-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-129-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-129-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-129-10">10</a></span>
<span class="normal"><a href="#__codelineno-129-11">11</a></span>
<span class="normal"><a href="#__codelineno-129-12">12</a></span>
<span class="normal"><a href="#__codelineno-129-13">13</a></span>
<span class="normal"><a href="#__codelineno-129-14">14</a></span>
<span class="normal"><a href="#__codelineno-129-15">15</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-129-1" name="__codelineno-129-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span>
<a id="__codelineno-129-2" name="__codelineno-129-2"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;utility&gt;</span>
<a id="__codelineno-129-3" name="__codelineno-129-3"></a>
<a id="__codelineno-129-4" name="__codelineno-129-4"></a><span class="kt">void</span><span class="w"> </span><span class="nf">print</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">pair</span><span class="w"> </span><span class="n">p</span><span class="p">)</span><span class="w"> </span><span class="c1">// compile error, CTAD can't be used here</span>
<a id="__codelineno-129-5" name="__codelineno-129-5"></a><span class="p">{</span>
<a id="__codelineno-129-6" name="__codelineno-129-6"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">p</span><span class="p">.</span><span class="n">first</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="sc">' '</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">p</span><span class="p">.</span><span class="n">second</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="sc">'\n'</span><span class="p">;</span>
<a id="__codelineno-129-7" name="__codelineno-129-7"></a><span class="p">}</span>
<a id="__codelineno-129-8" name="__codelineno-129-8"></a>
<a id="__codelineno-129-9" name="__codelineno-129-9"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span>
<a id="__codelineno-129-10" name="__codelineno-129-10"></a><span class="p">{</span>
<a id="__codelineno-129-11" name="__codelineno-129-11"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">pair</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">};</span><span class="w"> </span><span class="c1">// p deduced to std::pair&lt;int, int&gt;</span>
<a id="__codelineno-129-12" name="__codelineno-129-12"></a><span class="w">    </span><span class="n">print</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
<a id="__codelineno-129-13" name="__codelineno-129-13"></a>
<a id="__codelineno-129-14" name="__codelineno-129-14"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-129-15" name="__codelineno-129-15"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>这种情况下，我们需要显式地使用模板：</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-130-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-130-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-130-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-130-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-130-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-130-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-130-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-130-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-130-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-130-10">10</a></span>
<span class="normal"><a href="#__codelineno-130-11">11</a></span>
<span class="normal"><a href="#__codelineno-130-12">12</a></span>
<span class="normal"><a href="#__codelineno-130-13">13</a></span>
<span class="normal"><a href="#__codelineno-130-14">14</a></span>
<span class="normal"><a href="#__codelineno-130-15">15</a></span>
<span class="normal"><a href="#__codelineno-130-16">16</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-130-1" name="__codelineno-130-1"></a>#include &lt;iostream&gt;
<a id="__codelineno-130-2" name="__codelineno-130-2"></a>#include &lt;utility&gt;
<a id="__codelineno-130-3" name="__codelineno-130-3"></a>
<a id="__codelineno-130-4" name="__codelineno-130-4"></a>template &lt;typename T, typename U&gt;
<a id="__codelineno-130-5" name="__codelineno-130-5"></a>void print(std::pair&lt;T, U&gt; p)
<a id="__codelineno-130-6" name="__codelineno-130-6"></a>{
<a id="__codelineno-130-7" name="__codelineno-130-7"></a>    std::cout &lt;&lt; p.first &lt;&lt; ' ' &lt;&lt; p.second &lt;&lt; '\n';
<a id="__codelineno-130-8" name="__codelineno-130-8"></a>}
<a id="__codelineno-130-9" name="__codelineno-130-9"></a>
<a id="__codelineno-130-10" name="__codelineno-130-10"></a>int main()
<a id="__codelineno-130-11" name="__codelineno-130-11"></a>{
<a id="__codelineno-130-12" name="__codelineno-130-12"></a>    std::pair p { 1, 2 }; // p deduced to std::pair&lt;int, int&gt;
<a id="__codelineno-130-13" name="__codelineno-130-13"></a>    print(p);
<a id="__codelineno-130-14" name="__codelineno-130-14"></a>
<a id="__codelineno-130-15" name="__codelineno-130-15"></a>    return 0;
<a id="__codelineno-130-16" name="__codelineno-130-16"></a>}
</code></pre></div></td></tr></table></div>
</details>
<h4 id="_36">别名模板<a class="headerlink" href="#_36" title="Permanent link">¶</a></h4>
<p>我们可以像为普通的类型创建别名一样，为类模板创建一个类型别名，这个类型别名的作用范围是它被定义的那个作用域。</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-131-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-131-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-131-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-131-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-131-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-131-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-131-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-131-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-131-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-131-10">10</a></span>
<span class="normal"><a href="#__codelineno-131-11">11</a></span>
<span class="normal"><a href="#__codelineno-131-12">12</a></span>
<span class="normal"><a href="#__codelineno-131-13">13</a></span>
<span class="normal"><a href="#__codelineno-131-14">14</a></span>
<span class="normal"><a href="#__codelineno-131-15">15</a></span>
<span class="normal"><a href="#__codelineno-131-16">16</a></span>
<span class="normal"><a href="#__codelineno-131-17">17</a></span>
<span class="normal"><a href="#__codelineno-131-18">18</a></span>
<span class="normal"><a href="#__codelineno-131-19">19</a></span>
<span class="normal"><a href="#__codelineno-131-20">20</a></span>
<span class="normal"><a href="#__codelineno-131-21">21</a></span>
<span class="normal"><a href="#__codelineno-131-22">22</a></span>
<span class="normal"><a href="#__codelineno-131-23">23</a></span>
<span class="normal"><a href="#__codelineno-131-24">24</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-131-1" name="__codelineno-131-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span>
<a id="__codelineno-131-2" name="__codelineno-131-2"></a>
<a id="__codelineno-131-3" name="__codelineno-131-3"></a><span class="k">template</span><span class="w"> </span><span class="o">&lt;</span><span class="k">typename</span><span class="w"> </span><span class="nc">T</span><span class="o">&gt;</span>
<a id="__codelineno-131-4" name="__codelineno-131-4"></a><span class="k">struct</span><span class="w"> </span><span class="nc">Pair</span>
<a id="__codelineno-131-5" name="__codelineno-131-5"></a><span class="p">{</span>
<a id="__codelineno-131-6" name="__codelineno-131-6"></a><span class="w">    </span><span class="n">T</span><span class="w"> </span><span class="n">first</span><span class="p">{};</span>
<a id="__codelineno-131-7" name="__codelineno-131-7"></a><span class="w">    </span><span class="n">T</span><span class="w"> </span><span class="n">second</span><span class="p">{};</span>
<a id="__codelineno-131-8" name="__codelineno-131-8"></a><span class="p">};</span>
<a id="__codelineno-131-9" name="__codelineno-131-9"></a>
<a id="__codelineno-131-10" name="__codelineno-131-10"></a><span class="k">template</span><span class="w"> </span><span class="o">&lt;</span><span class="k">typename</span><span class="w"> </span><span class="nc">T</span><span class="o">&gt;</span>
<a id="__codelineno-131-11" name="__codelineno-131-11"></a><span class="kt">void</span><span class="w"> </span><span class="n">print</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">Pair</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;&amp;</span><span class="w"> </span><span class="n">p</span><span class="p">)</span>
<a id="__codelineno-131-12" name="__codelineno-131-12"></a><span class="p">{</span>
<a id="__codelineno-131-13" name="__codelineno-131-13"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">p</span><span class="p">.</span><span class="n">first</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="sc">' '</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">p</span><span class="p">.</span><span class="n">second</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="sc">'\n'</span><span class="p">;</span>
<a id="__codelineno-131-14" name="__codelineno-131-14"></a><span class="p">}</span>
<a id="__codelineno-131-15" name="__codelineno-131-15"></a>
<a id="__codelineno-131-16" name="__codelineno-131-16"></a><span class="kt">int</span><span class="w"> </span><span class="n">main</span><span class="p">()</span>
<a id="__codelineno-131-17" name="__codelineno-131-17"></a><span class="p">{</span>
<a id="__codelineno-131-18" name="__codelineno-131-18"></a><span class="w">    </span><span class="k">using</span><span class="w"> </span><span class="n">Point</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Pair</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">;</span><span class="w"> </span><span class="c1">// create normal type alias</span>
<a id="__codelineno-131-19" name="__codelineno-131-19"></a><span class="w">    </span><span class="n">Point</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">};</span><span class="w">        </span><span class="c1">// compiler replaces this with Pair&lt;int&gt;</span>
<a id="__codelineno-131-20" name="__codelineno-131-20"></a>
<a id="__codelineno-131-21" name="__codelineno-131-21"></a><span class="w">    </span><span class="n">print</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
<a id="__codelineno-131-22" name="__codelineno-131-22"></a>
<a id="__codelineno-131-23" name="__codelineno-131-23"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-131-24" name="__codelineno-131-24"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>有时候，我们可能需要一个模板类的类型别名，但是并非所有的模板参数都被定义到这个别名的一部分（这部分参数被别名的使用者提供）。为此我们可以定义一个<strong>别名模板</strong>（alias template），它可以用于实例化一个类型别名。</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-132-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-132-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-132-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-132-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-132-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-132-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-132-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-132-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-132-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-132-10">10</a></span>
<span class="normal"><a href="#__codelineno-132-11">11</a></span>
<span class="normal"><a href="#__codelineno-132-12">12</a></span>
<span class="normal"><a href="#__codelineno-132-13">13</a></span>
<span class="normal"><a href="#__codelineno-132-14">14</a></span>
<span class="normal"><a href="#__codelineno-132-15">15</a></span>
<span class="normal"><a href="#__codelineno-132-16">16</a></span>
<span class="normal"><a href="#__codelineno-132-17">17</a></span>
<span class="normal"><a href="#__codelineno-132-18">18</a></span>
<span class="normal"><a href="#__codelineno-132-19">19</a></span>
<span class="normal"><a href="#__codelineno-132-20">20</a></span>
<span class="normal"><a href="#__codelineno-132-21">21</a></span>
<span class="normal"><a href="#__codelineno-132-22">22</a></span>
<span class="normal"><a href="#__codelineno-132-23">23</a></span>
<span class="normal"><a href="#__codelineno-132-24">24</a></span>
<span class="normal"><a href="#__codelineno-132-25">25</a></span>
<span class="normal"><a href="#__codelineno-132-26">26</a></span>
<span class="normal"><a href="#__codelineno-132-27">27</a></span>
<span class="normal"><a href="#__codelineno-132-28">28</a></span>
<span class="normal"><a href="#__codelineno-132-29">29</a></span>
<span class="normal"><a href="#__codelineno-132-30">30</a></span>
<span class="normal"><a href="#__codelineno-132-31">31</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-132-1" name="__codelineno-132-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span>
<a id="__codelineno-132-2" name="__codelineno-132-2"></a>
<a id="__codelineno-132-3" name="__codelineno-132-3"></a><span class="k">template</span><span class="w"> </span><span class="o">&lt;</span><span class="k">typename</span><span class="w"> </span><span class="nc">T</span><span class="o">&gt;</span>
<a id="__codelineno-132-4" name="__codelineno-132-4"></a><span class="k">struct</span><span class="w"> </span><span class="nc">Pair</span>
<a id="__codelineno-132-5" name="__codelineno-132-5"></a><span class="p">{</span>
<a id="__codelineno-132-6" name="__codelineno-132-6"></a><span class="w">    </span><span class="n">T</span><span class="w"> </span><span class="n">first</span><span class="p">{};</span>
<a id="__codelineno-132-7" name="__codelineno-132-7"></a><span class="w">    </span><span class="n">T</span><span class="w"> </span><span class="n">second</span><span class="p">{};</span>
<a id="__codelineno-132-8" name="__codelineno-132-8"></a><span class="p">};</span>
<a id="__codelineno-132-9" name="__codelineno-132-9"></a>
<a id="__codelineno-132-10" name="__codelineno-132-10"></a><span class="c1">// Here's our alias template</span>
<a id="__codelineno-132-11" name="__codelineno-132-11"></a><span class="c1">// Alias templates must be defined in global scope</span>
<a id="__codelineno-132-12" name="__codelineno-132-12"></a><span class="k">template</span><span class="w"> </span><span class="o">&lt;</span><span class="k">typename</span><span class="w"> </span><span class="nc">T</span><span class="o">&gt;</span>
<a id="__codelineno-132-13" name="__codelineno-132-13"></a><span class="k">using</span><span class="w"> </span><span class="n">Coord</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Pair</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">;</span><span class="w"> </span><span class="c1">// Coord is an alias for Pair&lt;T&gt;</span>
<a id="__codelineno-132-14" name="__codelineno-132-14"></a>
<a id="__codelineno-132-15" name="__codelineno-132-15"></a><span class="c1">// Our print function template needs to know that Coord's template parameter T is a type template parameter</span>
<a id="__codelineno-132-16" name="__codelineno-132-16"></a><span class="k">template</span><span class="w"> </span><span class="o">&lt;</span><span class="k">typename</span><span class="w"> </span><span class="nc">T</span><span class="o">&gt;</span>
<a id="__codelineno-132-17" name="__codelineno-132-17"></a><span class="kt">void</span><span class="w"> </span><span class="n">print</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">Coord</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;&amp;</span><span class="w"> </span><span class="n">c</span><span class="p">)</span>
<a id="__codelineno-132-18" name="__codelineno-132-18"></a><span class="p">{</span>
<a id="__codelineno-132-19" name="__codelineno-132-19"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">c</span><span class="p">.</span><span class="n">first</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="sc">' '</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">c</span><span class="p">.</span><span class="n">second</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="sc">'\n'</span><span class="p">;</span>
<a id="__codelineno-132-20" name="__codelineno-132-20"></a><span class="p">}</span>
<a id="__codelineno-132-21" name="__codelineno-132-21"></a>
<a id="__codelineno-132-22" name="__codelineno-132-22"></a><span class="kt">int</span><span class="w"> </span><span class="n">main</span><span class="p">()</span>
<a id="__codelineno-132-23" name="__codelineno-132-23"></a><span class="p">{</span>
<a id="__codelineno-132-24" name="__codelineno-132-24"></a><span class="w">    </span><span class="n">Coord</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="n">p1</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">};</span><span class="w"> </span><span class="c1">// Pre C++-20: We must explicitly specify all type template argument</span>
<a id="__codelineno-132-25" name="__codelineno-132-25"></a><span class="w">    </span><span class="n">Coord</span><span class="w"> </span><span class="n">p2</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">};</span><span class="w">      </span><span class="c1">// In C++20, we can use alias template deduction to deduce the template arguments in cases where CTAD works</span>
<a id="__codelineno-132-26" name="__codelineno-132-26"></a>
<a id="__codelineno-132-27" name="__codelineno-132-27"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">p1</span><span class="p">.</span><span class="n">first</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="sc">' '</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">p1</span><span class="p">.</span><span class="n">second</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="sc">'\n'</span><span class="p">;</span>
<a id="__codelineno-132-28" name="__codelineno-132-28"></a><span class="w">    </span><span class="n">print</span><span class="p">(</span><span class="n">p2</span><span class="p">);</span>
<a id="__codelineno-132-29" name="__codelineno-132-29"></a>
<a id="__codelineno-132-30" name="__codelineno-132-30"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-132-31" name="__codelineno-132-31"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>这里，我们将一个名为<code>Coord</code>的别名模板定义为<code>Pair&lt;T&gt;</code>的别名，其中类型模板参数<code>T</code>将由坐标别名的使用者提供。<code>Coord</code>是别名模板，<code>Coord&lt;T&gt;</code>是<code>Pair&lt;T&gt;</code>的实例化类型别名，定义后，<code>Coord</code>相当于<code>Pair</code>，<code>Coord&lt;int&gt;</code>相当于<code>Pair&lt;int&gt;</code>。</p>
<p>关于别名模板我们有几点需要注意</p>
<ul>
<li>与普通类型的别名（可以在块内定义）不同，别名模板必须在全局定义域中定义</li>
<li>在 C++20 之前，当我们使用别名模板实例化对象时，必须显式指定模板参数。从 C++20 开始，我们可以使用别名模板推导（alias template deduction），在别名类型可与 CTAD 配合使用的情况下，它将从初始化器推导模板参数的类型。</li>
<li>
<p>由于 CTAD 不适用于函数参数（parameter），因此当我们使用别名模板作为函数参数时，必须显式定义别名模板使用的模板实参。</p>
<p>换句话说，我们只能这么写</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-133-1">1</a></span>
<span class="normal"><a href="#__codelineno-133-2">2</a></span>
<span class="normal"><a href="#__codelineno-133-3">3</a></span>
<span class="normal"><a href="#__codelineno-133-4">4</a></span>
<span class="normal"><a href="#__codelineno-133-5">5</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-133-1" name="__codelineno-133-1"></a><span class="k">template</span><span class="w"> </span><span class="o">&lt;</span><span class="k">typename</span><span class="w"> </span><span class="nc">T</span><span class="o">&gt;</span>
<a id="__codelineno-133-2" name="__codelineno-133-2"></a><span class="kt">void</span><span class="w"> </span><span class="n">print</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">Coord</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;&amp;</span><span class="w"> </span><span class="n">c</span><span class="p">)</span>
<a id="__codelineno-133-3" name="__codelineno-133-3"></a><span class="p">{</span>
<a id="__codelineno-133-4" name="__codelineno-133-4"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">c</span><span class="p">.</span><span class="n">first</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="sc">' '</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">c</span><span class="p">.</span><span class="n">second</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="sc">'\n'</span><span class="p">;</span>
<a id="__codelineno-133-5" name="__codelineno-133-5"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>而不能这么写</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-134-1">1</a></span>
<span class="normal"><a href="#__codelineno-134-2">2</a></span>
<span class="normal"><a href="#__codelineno-134-3">3</a></span>
<span class="normal"><a href="#__codelineno-134-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-134-1" name="__codelineno-134-1"></a><span class="kt">void</span><span class="w"> </span><span class="nf">print</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">Coord</span><span class="o">&amp;</span><span class="w"> </span><span class="n">c</span><span class="p">)</span>
<a id="__codelineno-134-2" name="__codelineno-134-2"></a><span class="p">{</span>
<a id="__codelineno-134-3" name="__codelineno-134-3"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">c</span><span class="p">.</span><span class="n">first</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="sc">' '</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">c</span><span class="p">.</span><span class="n">second</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="sc">'\n'</span><span class="p">;</span>
<a id="__codelineno-134-4" name="__codelineno-134-4"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>实际上和我们使用 <code>Pair</code> 和 <code>Pair&lt;T&gt;</code> 时是一样的。</p>
</li>
</ul>
<h3 id="_37">具有成员函数的类模板<a class="headerlink" href="#_37" title="Permanent link">¶</a></h3>
<p>定义为类模板参数声明的一部分的类型模板参数既可以用作类的成员变量的类型，也可以用作类的成员函数的返回类型或参数类型。</p>
<p>例如对于我们已经定义过的 <code>Pair</code> 类模板，我们可以把它从结构体转换为类</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-135-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-135-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-135-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-135-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-135-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-135-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-135-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-135-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-135-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-135-10">10</a></span>
<span class="normal"><a href="#__codelineno-135-11">11</a></span>
<span class="normal"><a href="#__codelineno-135-12">12</a></span>
<span class="normal"><a href="#__codelineno-135-13">13</a></span>
<span class="normal"><a href="#__codelineno-135-14">14</a></span>
<span class="normal"><a href="#__codelineno-135-15">15</a></span>
<span class="normal"><a href="#__codelineno-135-16">16</a></span>
<span class="normal"><a href="#__codelineno-135-17">17</a></span>
<span class="normal"><a href="#__codelineno-135-18">18</a></span>
<span class="normal"><a href="#__codelineno-135-19">19</a></span>
<span class="normal"><a href="#__codelineno-135-20">20</a></span>
<span class="normal"><a href="#__codelineno-135-21">21</a></span>
<span class="normal"><a href="#__codelineno-135-22">22</a></span>
<span class="normal"><a href="#__codelineno-135-23">23</a></span>
<span class="normal"><a href="#__codelineno-135-24">24</a></span>
<span class="normal"><a href="#__codelineno-135-25">25</a></span>
<span class="normal"><a href="#__codelineno-135-26">26</a></span>
<span class="normal"><a href="#__codelineno-135-27">27</a></span>
<span class="normal"><a href="#__codelineno-135-28">28</a></span>
<span class="normal"><a href="#__codelineno-135-29">29</a></span>
<span class="normal"><a href="#__codelineno-135-30">30</a></span>
<span class="normal"><a href="#__codelineno-135-31">31</a></span>
<span class="normal"><a href="#__codelineno-135-32">32</a></span>
<span class="normal"><a href="#__codelineno-135-33">33</a></span>
<span class="normal"><a href="#__codelineno-135-34">34</a></span>
<span class="normal"><a href="#__codelineno-135-35">35</a></span>
<span class="normal"><a href="#__codelineno-135-36">36</a></span>
<span class="normal"><a href="#__codelineno-135-37">37</a></span>
<span class="normal"><a href="#__codelineno-135-38">38</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-135-1" name="__codelineno-135-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;ios&gt;</span><span class="c1">       // for std::boolalpha</span>
<a id="__codelineno-135-2" name="__codelineno-135-2"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span>
<a id="__codelineno-135-3" name="__codelineno-135-3"></a>
<a id="__codelineno-135-4" name="__codelineno-135-4"></a><span class="k">template</span><span class="w"> </span><span class="o">&lt;</span><span class="k">typename</span><span class="w"> </span><span class="nc">T</span><span class="o">&gt;</span>
<a id="__codelineno-135-5" name="__codelineno-135-5"></a><span class="k">class</span><span class="w"> </span><span class="nc">Pair</span>
<a id="__codelineno-135-6" name="__codelineno-135-6"></a><span class="p">{</span>
<a id="__codelineno-135-7" name="__codelineno-135-7"></a><span class="k">private</span><span class="o">:</span>
<a id="__codelineno-135-8" name="__codelineno-135-8"></a><span class="w">    </span><span class="n">T</span><span class="w"> </span><span class="n">m_first</span><span class="p">{};</span>
<a id="__codelineno-135-9" name="__codelineno-135-9"></a><span class="w">    </span><span class="n">T</span><span class="w"> </span><span class="n">m_second</span><span class="p">{};</span>
<a id="__codelineno-135-10" name="__codelineno-135-10"></a>
<a id="__codelineno-135-11" name="__codelineno-135-11"></a><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-135-12" name="__codelineno-135-12"></a><span class="w">    </span><span class="c1">// When we define a member function inside the class definition,</span>
<a id="__codelineno-135-13" name="__codelineno-135-13"></a><span class="w">    </span><span class="c1">// the template parameter declaration belonging to the class applies</span>
<a id="__codelineno-135-14" name="__codelineno-135-14"></a><span class="w">    </span><span class="n">Pair</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">T</span><span class="o">&amp;</span><span class="w"> </span><span class="n">first</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">T</span><span class="o">&amp;</span><span class="w"> </span><span class="n">second</span><span class="p">)</span>
<a id="__codelineno-135-15" name="__codelineno-135-15"></a><span class="w">        </span><span class="o">:</span><span class="w"> </span><span class="n">m_first</span><span class="p">{</span><span class="w"> </span><span class="n">first</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-135-16" name="__codelineno-135-16"></a><span class="w">        </span><span class="p">,</span><span class="w"> </span><span class="n">m_second</span><span class="p">{</span><span class="w"> </span><span class="n">second</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-135-17" name="__codelineno-135-17"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-135-18" name="__codelineno-135-18"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-135-19" name="__codelineno-135-19"></a>
<a id="__codelineno-135-20" name="__codelineno-135-20"></a><span class="w">    </span><span class="kt">bool</span><span class="w"> </span><span class="n">isEqual</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">Pair</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;&amp;</span><span class="w"> </span><span class="n">pair</span><span class="p">);</span>
<a id="__codelineno-135-21" name="__codelineno-135-21"></a><span class="p">};</span>
<a id="__codelineno-135-22" name="__codelineno-135-22"></a>
<a id="__codelineno-135-23" name="__codelineno-135-23"></a><span class="c1">// When we define a member function outside the class definition,</span>
<a id="__codelineno-135-24" name="__codelineno-135-24"></a><span class="c1">// we need to resupply a template parameter declaration</span>
<a id="__codelineno-135-25" name="__codelineno-135-25"></a><span class="k">template</span><span class="w"> </span><span class="o">&lt;</span><span class="k">typename</span><span class="w"> </span><span class="nc">T</span><span class="o">&gt;</span>
<a id="__codelineno-135-26" name="__codelineno-135-26"></a><span class="kt">bool</span><span class="w"> </span><span class="n">Pair</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;::</span><span class="n">isEqual</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">Pair</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;&amp;</span><span class="w"> </span><span class="n">pair</span><span class="p">)</span>
<a id="__codelineno-135-27" name="__codelineno-135-27"></a><span class="p">{</span>
<a id="__codelineno-135-28" name="__codelineno-135-28"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">m_first</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">pair</span><span class="p">.</span><span class="n">m_first</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">m_second</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">pair</span><span class="p">.</span><span class="n">m_second</span><span class="p">;</span>
<a id="__codelineno-135-29" name="__codelineno-135-29"></a><span class="p">}</span>
<a id="__codelineno-135-30" name="__codelineno-135-30"></a>
<a id="__codelineno-135-31" name="__codelineno-135-31"></a><span class="kt">int</span><span class="w"> </span><span class="n">main</span><span class="p">()</span>
<a id="__codelineno-135-32" name="__codelineno-135-32"></a><span class="p">{</span>
<a id="__codelineno-135-33" name="__codelineno-135-33"></a><span class="w">    </span><span class="n">Pair</span><span class="w"> </span><span class="n">p1</span><span class="p">{</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="w"> </span><span class="p">};</span><span class="w"> </span><span class="c1">// uses CTAD to infer type Pair&lt;int&gt;</span>
<a id="__codelineno-135-34" name="__codelineno-135-34"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">boolalpha</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"isEqual(5, 6): "</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">p1</span><span class="p">.</span><span class="n">isEqual</span><span class="p">(</span><span class="w"> </span><span class="n">Pair</span><span class="p">{</span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="p">}</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="sc">'\n'</span><span class="p">;</span>
<a id="__codelineno-135-35" name="__codelineno-135-35"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">boolalpha</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"isEqual(5, 7): "</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">p1</span><span class="p">.</span><span class="n">isEqual</span><span class="p">(</span><span class="w"> </span><span class="n">Pair</span><span class="p">{</span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="mi">7</span><span class="p">}</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="sc">'\n'</span><span class="p">;</span>
<a id="__codelineno-135-36" name="__codelineno-135-36"></a>
<a id="__codelineno-135-37" name="__codelineno-135-37"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-135-38" name="__codelineno-135-38"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>
<p>由于类不是一个聚合类型，因此我们不能像结构体那样使用聚合初始化，因此我们必须使用构造函数来初始化类的成员变量。</p>
<ul>
<li>
<p>由于 T 类型在复制时的开销可能较大，因此我们通过 const 引用来传递参数，而非直接按值传递，以避免不必要的复制。</p>
</li>
<li>
<p>当我们在类模板定义中对成员函数进行定义时，我们不需要为成员函数提供模板参数声明，它们会默认使用类模板的模板参数声明。</p>
</li>
</ul>
</li>
<li>
<p>对于非聚合的类，我们不需要为 CTAD 提供推导指南。与传入的参数匹配的构造函数为编译器提供了从初始化器推导模板参数所需的信息。</p>
</li>
<li>
<p>对于在类定义外部定义的成员函数，我们需要重新提供模板参数声明。</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-136-1">1</a></span>
<span class="normal"><a href="#__codelineno-136-2">2</a></span>
<span class="normal"><a href="#__codelineno-136-3">3</a></span>
<span class="normal"><a href="#__codelineno-136-4">4</a></span>
<span class="normal"><a href="#__codelineno-136-5">5</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-136-1" name="__codelineno-136-1"></a><span class="k">template</span><span class="w"> </span><span class="o">&lt;</span><span class="k">typename</span><span class="w"> </span><span class="nc">T</span><span class="o">&gt;</span>
<a id="__codelineno-136-2" name="__codelineno-136-2"></a><span class="kt">bool</span><span class="w"> </span><span class="n">Pair</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;::</span><span class="n">isEqual</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">Pair</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;&amp;</span><span class="w"> </span><span class="n">pair</span><span class="p">)</span>
<a id="__codelineno-136-3" name="__codelineno-136-3"></a><span class="p">{</span>
<a id="__codelineno-136-4" name="__codelineno-136-4"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">m_first</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">pair</span><span class="p">.</span><span class="n">m_first</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">m_second</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">pair</span><span class="p">.</span><span class="n">m_second</span><span class="p">;</span>
<a id="__codelineno-136-5" name="__codelineno-136-5"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>除此之外，我们在类外部定义成员变量时，我们需要使用类模板的完整名称（<code>Pair&lt;T&gt;::isEqual</code>，而非<code>Pair&lt;T&gt;::isEqual</code>）来限定成员函数名称。</li>
</ul>
</li>
</ul>
<h4 id="_38">注入类名<a class="headerlink" href="#_38" title="Permanent link">¶</a></h4>
<p>我们可以注意到我们在类模板中定义的构造函数的名称是 <code>Pair</code>，而不是 <code>Pair&lt;T&gt;</code>。在类的范围内，没有被限定的类名被称为<strong>注入类名</strong>（injected class name）。在类模板中，注入类名相当于完整模板名的一个速记。</p>
<p>在上面的例子中，<code>Pair</code>是<code>Pair&lt;T&gt;</code>的注入类名，因此我们在<code>Pair&lt;T&gt;</code>的作用域内使用的任何<code>Pair</code>都被视为<code>Pair&lt;T&gt;</code>。</p>
<p>这意味着我们还可以把 <code>isEqual()</code> 成员函数定义为</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-137-1">1</a></span>
<span class="normal"><a href="#__codelineno-137-2">2</a></span>
<span class="normal"><a href="#__codelineno-137-3">3</a></span>
<span class="normal"><a href="#__codelineno-137-4">4</a></span>
<span class="normal"><a href="#__codelineno-137-5">5</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-137-1" name="__codelineno-137-1"></a><span class="k">template</span><span class="w"> </span><span class="o">&lt;</span><span class="k">typename</span><span class="w"> </span><span class="nc">T</span><span class="o">&gt;</span>
<a id="__codelineno-137-2" name="__codelineno-137-2"></a><span class="kt">bool</span><span class="w"> </span><span class="n">Pair</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;::</span><span class="n">isEqual</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">Pair</span><span class="o">&amp;</span><span class="w"> </span><span class="n">pair</span><span class="p">)</span><span class="w"> </span><span class="c1">// Pair, not Pair&lt;T&gt;</span>
<a id="__codelineno-137-3" name="__codelineno-137-3"></a><span class="p">{</span>
<a id="__codelineno-137-4" name="__codelineno-137-4"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">m_first</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">pair</span><span class="p">.</span><span class="n">m_first</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">m_second</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">pair</span><span class="p">.</span><span class="n">m_second</span><span class="p">;</span>
<a id="__codelineno-137-5" name="__codelineno-137-5"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<div class="admonition key-point">
<p class="admonition-title">Key-point</p>
<p>我们前面提到过 CTAD 不适用于函数参数（因为是 argument deduction，而不是 parameter deduction），但是我们使用注入类名作为函数参数是完全可以的，因为它是完全模板名称的速记，并没有使用 CTAD。</p>
</div>
<details class="question" open="open">
<summary>在何处定义类模板之外的成员函数？</summary>
<p>对于类模板的成员函数，编译器需要同时查看类的定义（以确保将成员函数模板被声明为类的一部分）和模板成员函数的定义（以了解如何实例化模板）。因此我们同城希望在相同（或至少相近）的位置定义类模板及其模板成员函数。</p>
<ul>
<li>当我们<em>在类定义中</em>对成员函数模板进行定义时，由于模板成员函数的定义是类定义的一部分，任何可以看到类定义的地方，都可以看到模板成员函数定义。</li>
<li>当我们<em>在类定义外部</em>对成员函数模板进行定义时，通常我们需要在类定义的下方紧接着就定义模板成员函数，这样可以确保编译器在看到类定义时就能看到模板成员函数的定义。</li>
</ul>
<p>从上面的讨论中我们可以知道，当我们在 .h 文件中定义类模板时，成员函数模板也应在该 .h 文件中定义。</p>
</details>
<hr/>
<h2 id="_39">类<a class="headerlink" href="#_39" title="Permanent link">¶</a></h2>
<p>定义一个类的语法与定义一个结构体相当类似</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-138-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-138-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-138-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-138-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-138-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-138-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-138-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-138-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-138-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-138-10">10</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-138-1" name="__codelineno-138-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">MyClass</span>
<a id="__codelineno-138-2" name="__codelineno-138-2"></a><span class="p">{</span>
<a id="__codelineno-138-3" name="__codelineno-138-3"></a><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-138-4" name="__codelineno-138-4"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">myInt</span><span class="p">{</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">};</span>
<a id="__codelineno-138-5" name="__codelineno-138-5"></a><span class="w">    </span><span class="kt">double</span><span class="w"> </span><span class="n">myDouble</span><span class="p">{</span><span class="w"> </span><span class="mf">0.0</span><span class="w"> </span><span class="p">};</span>
<a id="__codelineno-138-6" name="__codelineno-138-6"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">print</span><span class="p">()</span>
<a id="__codelineno-138-7" name="__codelineno-138-7"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-138-8" name="__codelineno-138-8"></a><span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">myInt</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="sc">' '</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">myDouble</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="sc">'\n'</span><span class="p">;</span>
<a id="__codelineno-138-9" name="__codelineno-138-9"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-138-10" name="__codelineno-138-10"></a><span class="p">};</span>
</code></pre></div></td></tr></table></div>
<h3 id="class-invariant">类不变式（class invariant）<a class="headerlink" href="#class-invariant" title="Permanent link">¶</a></h3>
<p><a href="https://isocpp.github.io/CppCoreGuidelines/CppCoreGuidelines">C++ Core Guidelines</a> 将不变式定义为“程序某一时刻或某一段时间里必须得到满足的条件”。</p>
<p>对于类类型（包括结构体、类和联合体），<strong>类不变式</strong>是指在类的生命周期中，类的成员变量必须满足的条件，违反类不变量的对象被认为处于<strong>无效状态</strong>。</p>
<div class="admonition key-point">
<p class="admonition-title">Key-point</p>
<p>使用违反类不变式的对象可能导致意外或未定义的行为。</p>
</div>
<p>例如考虑下面的结构体：</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-139-1">1</a></span>
<span class="normal"><a href="#__codelineno-139-2">2</a></span>
<span class="normal"><a href="#__codelineno-139-3">3</a></span>
<span class="normal"><a href="#__codelineno-139-4">4</a></span>
<span class="normal"><a href="#__codelineno-139-5">5</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-139-1" name="__codelineno-139-1"></a><span class="k">struct</span><span class="w"> </span><span class="nc">Fraction</span>
<a id="__codelineno-139-2" name="__codelineno-139-2"></a><span class="p">{</span>
<a id="__codelineno-139-3" name="__codelineno-139-3"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">numerator</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">};</span>
<a id="__codelineno-139-4" name="__codelineno-139-4"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">denominator</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">};</span>
<a id="__codelineno-139-5" name="__codelineno-139-5"></a><span class="p">};</span>
</code></pre></div></td></tr></table></div>
<p>我们知道在数学中，分数的分母不能为 0，因此我们要确保 Fraction 的 denominator 成员变量永远不会设置为 0，否则该 Fraction 对象处于无效状态，使用这个对象可能会导致未定义的行为。</p>
<p>例如一个简单的函数</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-140-1">1</a></span>
<span class="normal"><a href="#__codelineno-140-2">2</a></span>
<span class="normal"><a href="#__codelineno-140-3">3</a></span>
<span class="normal"><a href="#__codelineno-140-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-140-1" name="__codelineno-140-1"></a><span class="kt">void</span><span class="w"> </span><span class="nf">printFractionValue</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">Fraction</span><span class="o">&amp;</span><span class="w"> </span><span class="n">f</span><span class="p">)</span>
<a id="__codelineno-140-2" name="__codelineno-140-2"></a><span class="p">{</span>
<a id="__codelineno-140-3" name="__codelineno-140-3"></a><span class="w">     </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">f</span><span class="p">.</span><span class="n">numerator</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">f</span><span class="p">.</span><span class="n">denominator</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="sc">'\n'</span><span class="p">;</span>
<a id="__codelineno-140-4" name="__codelineno-140-4"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>调用 <code>printFractionValue({ 5, 0 })</code> 时会出现除零错误，虽然我们可以通过在函数内添加一个 assert 语句检查分母是否为 0 来避免除零错误，但这并不能解决问题的根本。</p>
<p>依赖于用户来维护类不变量是不可靠的，尤其是在比分数这个例子复杂得多的情况下。理想情况下，我们希望对我们的类类型进行保护，使得对象不能被置于无效状态，或者如果处于无效状态，可以立即发出信号（而不是在将来某个时刻出现未定义行为时才知道）。</p>
<div class="admonition property">
<p class="admonition-title">类与结构体</p>
<p>从技术角度来看，结构和类几乎相同——能用结构体实现的内容都可以通过类实现，反之亦然。<code>class</code> 和 <code>struct</code> 在语法上几乎没有区别，仅有一些微小的差别：</p>
<ul>
<li>class 默认访问说明符为 private, 这其实隐含了它应该将数据设为私用, 即拥有不变式.</li>
<li>struct 默认访问说明符为 public, 这其实隐含了它应该将数据设为公用, 即没有不变式.</li>
</ul>
<p>如果某个类类型具有不变式，则使用 class；如果数据成员之间相互独立，则使用 struct。</p>
</div>
<h3 id="_40">成员函数<a class="headerlink" href="#_40" title="Permanent link">¶</a></h3>
<p>除了成员变量之外，类类型还可以拥有自己的函数，称之为<strong>成员函数</strong>（member function）。</p>
<p>不是成员函数的函数称为<strong>非成员函数</strong>（non-member function），有时也称为<strong>自由函数</strong>（free function）。</p>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>在其他面向对象语言（例如 Java 和 C#）中，成员函数也称为<strong>方法</strong>（method）。我们只需要知道这两个术语在表示一个东西即可。</p>
</div>
<p>为简单起见，我们用结构体来介绍成员函数：</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-141-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-141-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-141-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-141-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-141-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-141-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-141-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-141-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-141-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-141-10">10</a></span>
<span class="normal"><a href="#__codelineno-141-11">11</a></span>
<span class="normal"><a href="#__codelineno-141-12">12</a></span>
<span class="normal"><a href="#__codelineno-141-13">13</a></span>
<span class="normal"><a href="#__codelineno-141-14">14</a></span>
<span class="normal"><a href="#__codelineno-141-15">15</a></span>
<span class="normal"><a href="#__codelineno-141-16">16</a></span>
<span class="normal"><a href="#__codelineno-141-17">17</a></span>
<span class="normal"><a href="#__codelineno-141-18">18</a></span>
<span class="normal"><a href="#__codelineno-141-19">19</a></span>
<span class="normal"><a href="#__codelineno-141-20">20</a></span>
<span class="normal"><a href="#__codelineno-141-21">21</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-141-1" name="__codelineno-141-1"></a><span class="k">struct</span><span class="w"> </span><span class="nc">Date</span>
<a id="__codelineno-141-2" name="__codelineno-141-2"></a><span class="p">{</span>
<a id="__codelineno-141-3" name="__codelineno-141-3"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">year</span><span class="w"> </span><span class="p">{};</span>
<a id="__codelineno-141-4" name="__codelineno-141-4"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">month</span><span class="w"> </span><span class="p">{};</span>
<a id="__codelineno-141-5" name="__codelineno-141-5"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">day</span><span class="w"> </span><span class="p">{};</span>
<a id="__codelineno-141-6" name="__codelineno-141-6"></a>
<a id="__codelineno-141-7" name="__codelineno-141-7"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">print</span><span class="p">()</span><span class="w"> </span>
<a id="__codelineno-141-8" name="__codelineno-141-8"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-141-9" name="__codelineno-141-9"></a><span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">year</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="sc">'/'</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">month</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="sc">'/'</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">day</span><span class="p">;</span>
<a id="__codelineno-141-10" name="__codelineno-141-10"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-141-11" name="__codelineno-141-11"></a><span class="p">};</span>
<a id="__codelineno-141-12" name="__codelineno-141-12"></a>
<a id="__codelineno-141-13" name="__codelineno-141-13"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span>
<a id="__codelineno-141-14" name="__codelineno-141-14"></a><span class="p">{</span>
<a id="__codelineno-141-15" name="__codelineno-141-15"></a><span class="w">    </span><span class="n">Date</span><span class="w"> </span><span class="n">today</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="mi">2020</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="mi">14</span><span class="w"> </span><span class="p">};</span>
<a id="__codelineno-141-16" name="__codelineno-141-16"></a>
<a id="__codelineno-141-17" name="__codelineno-141-17"></a><span class="w">    </span><span class="n">today</span><span class="p">.</span><span class="n">day</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">16</span><span class="p">;</span>
<a id="__codelineno-141-18" name="__codelineno-141-18"></a><span class="w">    </span><span class="n">today</span><span class="p">.</span><span class="n">print</span><span class="p">();</span>
<a id="__codelineno-141-19" name="__codelineno-141-19"></a>
<a id="__codelineno-141-20" name="__codelineno-141-20"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-141-21" name="__codelineno-141-21"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>在这个例子中我们可以看到，成员函数 <code>print()</code> 是在结构体 <code>Date</code> 内部定义的，它可以访问结构体的成员变量 <code>year</code>、<code>month</code> 和 <code>day</code>。在使用成员函数时，我们不需要把 today 作为参数传递给成员函数。当某个对象的成员函数被调用时，它本身会被<strong>隐式传递</strong>给成员函数，因此我们不需要使用成员选择运算符<code>.</code> ，这个对象被称为<strong>隐式对象</strong>（the implicit object）。</p>
<div class="admonition info">
<p class="admonition-title">成员变量和函数可以按任意顺序定义</p>
<p>非成员函数在使用之前必须进行声明，否则在编译时会报错。但类类型的成员函数并没有这个限制，我们可以在声明成员变量和成员函数之前访问它们。</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-142-1">1</a></span>
<span class="normal"><a href="#__codelineno-142-2">2</a></span>
<span class="normal"><a href="#__codelineno-142-3">3</a></span>
<span class="normal"><a href="#__codelineno-142-4">4</a></span>
<span class="normal"><a href="#__codelineno-142-5">5</a></span>
<span class="normal"><a href="#__codelineno-142-6">6</a></span>
<span class="normal"><a href="#__codelineno-142-7">7</a></span>
<span class="normal"><a href="#__codelineno-142-8">8</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-142-1" name="__codelineno-142-1"></a><span class="k">struct</span><span class="w"> </span><span class="nc">Foo</span>
<a id="__codelineno-142-2" name="__codelineno-142-2"></a><span class="p">{</span>
<a id="__codelineno-142-3" name="__codelineno-142-3"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="nf">z</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">m_data</span><span class="p">;</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="c1">// We can access data members before they are defined</span>
<a id="__codelineno-142-4" name="__codelineno-142-4"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="nf">x</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">y</span><span class="p">();</span><span class="w"> </span><span class="p">}</span><span class="w">    </span><span class="c1">// We can can access member functions before they are defined</span>
<a id="__codelineno-142-5" name="__codelineno-142-5"></a>
<a id="__codelineno-142-6" name="__codelineno-142-6"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">m_data</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">y</span><span class="p">()</span><span class="w"> </span><span class="p">};</span><span class="w">        </span><span class="c1">// This even works in default member initializers (see warning below)</span>
<a id="__codelineno-142-7" name="__codelineno-142-7"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="nf">y</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="mi">5</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-142-8" name="__codelineno-142-8"></a><span class="p">};</span>
</code></pre></div></td></tr></table></div>
<p>但是数据成员将按照声明的顺序进行初始化，如果一个成员在初始化时需要使用到一个稍后才声明的另一个成员，那么初始化将会导致未定义的行为。</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-143-1">1</a></span>
<span class="normal"><a href="#__codelineno-143-2">2</a></span>
<span class="normal"><a href="#__codelineno-143-3">3</a></span>
<span class="normal"><a href="#__codelineno-143-4">4</a></span>
<span class="normal"><a href="#__codelineno-143-5">5</a></span>
<span class="normal"><a href="#__codelineno-143-6">6</a></span>
<span class="normal"><a href="#__codelineno-143-7">7</a></span>
<span class="normal"><a href="#__codelineno-143-8">8</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-143-1" name="__codelineno-143-1"></a><span class="k">struct</span><span class="w"> </span><span class="nc">Bad</span>
<a id="__codelineno-143-2" name="__codelineno-143-2"></a><span class="p">{</span>
<a id="__codelineno-143-3" name="__codelineno-143-3"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">m_bad1</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">m_data</span><span class="w"> </span><span class="p">};</span><span class="w"> </span><span class="c1">// undefined behavior: m_bad1 initialized before m_data</span>
<a id="__codelineno-143-4" name="__codelineno-143-4"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">m_bad2</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">fcn</span><span class="p">()</span><span class="w"> </span><span class="p">};</span><span class="w">  </span><span class="c1">// undefined behavior: m_bad2 initialized before m_data (accessed through fcn())</span>
<a id="__codelineno-143-5" name="__codelineno-143-5"></a>
<a id="__codelineno-143-6" name="__codelineno-143-6"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">m_data</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="p">};</span>
<a id="__codelineno-143-7" name="__codelineno-143-7"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="nf">fcn</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">m_data</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-143-8" name="__codelineno-143-8"></a><span class="p">};</span>
</code></pre></div></td></tr></table></div>
<p>因此，最好避免在成员变量初始化时使用其他成员。</p>
</div>
<div class="admonition extra">
<p class="admonition-title">成员函数也可以进行重载</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-144-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-144-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-144-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-144-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-144-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-144-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-144-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-144-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-144-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-144-10">10</a></span>
<span class="normal"><a href="#__codelineno-144-11">11</a></span>
<span class="normal"><a href="#__codelineno-144-12">12</a></span>
<span class="normal"><a href="#__codelineno-144-13">13</a></span>
<span class="normal"><a href="#__codelineno-144-14">14</a></span>
<span class="normal"><a href="#__codelineno-144-15">15</a></span>
<span class="normal"><a href="#__codelineno-144-16">16</a></span>
<span class="normal"><a href="#__codelineno-144-17">17</a></span>
<span class="normal"><a href="#__codelineno-144-18">18</a></span>
<span class="normal"><a href="#__codelineno-144-19">19</a></span>
<span class="normal"><a href="#__codelineno-144-20">20</a></span>
<span class="normal"><a href="#__codelineno-144-21">21</a></span>
<span class="normal"><a href="#__codelineno-144-22">22</a></span>
<span class="normal"><a href="#__codelineno-144-23">23</a></span>
<span class="normal"><a href="#__codelineno-144-24">24</a></span>
<span class="normal"><a href="#__codelineno-144-25">25</a></span>
<span class="normal"><a href="#__codelineno-144-26">26</a></span>
<span class="normal"><a href="#__codelineno-144-27">27</a></span>
<span class="normal"><a href="#__codelineno-144-28">28</a></span>
<span class="normal"><a href="#__codelineno-144-29">29</a></span>
<span class="normal"><a href="#__codelineno-144-30">30</a></span>
<span class="normal"><a href="#__codelineno-144-31">31</a></span>
<span class="normal"><a href="#__codelineno-144-32">32</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-144-1" name="__codelineno-144-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span>
<a id="__codelineno-144-2" name="__codelineno-144-2"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;string_view&gt;</span>
<a id="__codelineno-144-3" name="__codelineno-144-3"></a>
<a id="__codelineno-144-4" name="__codelineno-144-4"></a><span class="k">struct</span><span class="w"> </span><span class="nc">Date</span>
<a id="__codelineno-144-5" name="__codelineno-144-5"></a><span class="p">{</span>
<a id="__codelineno-144-6" name="__codelineno-144-6"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">year</span><span class="w"> </span><span class="p">{};</span>
<a id="__codelineno-144-7" name="__codelineno-144-7"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">month</span><span class="w"> </span><span class="p">{};</span>
<a id="__codelineno-144-8" name="__codelineno-144-8"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">day</span><span class="w"> </span><span class="p">{};</span>
<a id="__codelineno-144-9" name="__codelineno-144-9"></a>
<a id="__codelineno-144-10" name="__codelineno-144-10"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">print</span><span class="p">()</span>
<a id="__codelineno-144-11" name="__codelineno-144-11"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-144-12" name="__codelineno-144-12"></a><span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">year</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="sc">'/'</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">month</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="sc">'/'</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">day</span><span class="p">;</span>
<a id="__codelineno-144-13" name="__codelineno-144-13"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-144-14" name="__codelineno-144-14"></a>
<a id="__codelineno-144-15" name="__codelineno-144-15"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">print</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">string_view</span><span class="w"> </span><span class="n">prefix</span><span class="p">)</span>
<a id="__codelineno-144-16" name="__codelineno-144-16"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-144-17" name="__codelineno-144-17"></a><span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">prefix</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">year</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="sc">'/'</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">month</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="sc">'/'</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">day</span><span class="p">;</span>
<a id="__codelineno-144-18" name="__codelineno-144-18"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-144-19" name="__codelineno-144-19"></a><span class="p">};</span>
<a id="__codelineno-144-20" name="__codelineno-144-20"></a>
<a id="__codelineno-144-21" name="__codelineno-144-21"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span>
<a id="__codelineno-144-22" name="__codelineno-144-22"></a><span class="p">{</span>
<a id="__codelineno-144-23" name="__codelineno-144-23"></a><span class="w">    </span><span class="n">Date</span><span class="w"> </span><span class="n">today</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="mi">2020</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="mi">14</span><span class="w"> </span><span class="p">};</span>
<a id="__codelineno-144-24" name="__codelineno-144-24"></a>
<a id="__codelineno-144-25" name="__codelineno-144-25"></a><span class="w">    </span><span class="n">today</span><span class="p">.</span><span class="n">print</span><span class="p">();</span><span class="w"> </span><span class="c1">// calls Date::print()</span>
<a id="__codelineno-144-26" name="__codelineno-144-26"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="sc">'\n'</span><span class="p">;</span>
<a id="__codelineno-144-27" name="__codelineno-144-27"></a>
<a id="__codelineno-144-28" name="__codelineno-144-28"></a><span class="w">    </span><span class="n">today</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">"The date is: "</span><span class="p">);</span><span class="w"> </span><span class="c1">// calls Date::print(std::string_view)</span>
<a id="__codelineno-144-29" name="__codelineno-144-29"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="sc">'\n'</span><span class="p">;</span>
<a id="__codelineno-144-30" name="__codelineno-144-30"></a>
<a id="__codelineno-144-31" name="__codelineno-144-31"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-144-32" name="__codelineno-144-32"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>输出结果为</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-145-1">1</a></span>
<span class="normal"><a href="#__codelineno-145-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-145-1" name="__codelineno-145-1"></a>2020/10/14
<a id="__codelineno-145-2" name="__codelineno-145-2"></a>The date is: 2020/10/14
</code></pre></div></td></tr></table></div>
</div>
<h3 id="const-const">const 对象和 const 成员函数<a class="headerlink" href="#const-const" title="Permanent link">¶</a></h3>
<p>我们可以向普通的变量一样，用 const 关键字来声明一个类类型对象。一旦初始化了 const 类类型对象，就不允许对对象的成员数据进行修改，这既包括直接修改成员变量（如果是 public 的），也包括通过成员函数修改成员变量。</p>
<p>实际上我们还会发现，如果我们尝试在 const 对象上调用非 const 成员函数，编译器会报错，即使这个非 const 函数并不会修改成员变量。</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-146-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-146-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-146-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-146-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-146-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-146-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-146-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-146-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-146-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-146-10">10</a></span>
<span class="normal"><a href="#__codelineno-146-11">11</a></span>
<span class="normal"><a href="#__codelineno-146-12">12</a></span>
<span class="normal"><a href="#__codelineno-146-13">13</a></span>
<span class="normal"><a href="#__codelineno-146-14">14</a></span>
<span class="normal"><a href="#__codelineno-146-15">15</a></span>
<span class="normal"><a href="#__codelineno-146-16">16</a></span>
<span class="normal"><a href="#__codelineno-146-17">17</a></span>
<span class="normal"><a href="#__codelineno-146-18">18</a></span>
<span class="normal"><a href="#__codelineno-146-19">19</a></span>
<span class="normal"><a href="#__codelineno-146-20">20</a></span>
<span class="normal"><a href="#__codelineno-146-21">21</a></span>
<span class="normal"><a href="#__codelineno-146-22">22</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-146-1" name="__codelineno-146-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span>
<a id="__codelineno-146-2" name="__codelineno-146-2"></a>
<a id="__codelineno-146-3" name="__codelineno-146-3"></a><span class="k">struct</span><span class="w"> </span><span class="nc">Date</span>
<a id="__codelineno-146-4" name="__codelineno-146-4"></a><span class="p">{</span>
<a id="__codelineno-146-5" name="__codelineno-146-5"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">year</span><span class="w"> </span><span class="p">{};</span>
<a id="__codelineno-146-6" name="__codelineno-146-6"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">month</span><span class="w"> </span><span class="p">{};</span>
<a id="__codelineno-146-7" name="__codelineno-146-7"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">day</span><span class="w"> </span><span class="p">{};</span>
<a id="__codelineno-146-8" name="__codelineno-146-8"></a>
<a id="__codelineno-146-9" name="__codelineno-146-9"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">print</span><span class="p">()</span>
<a id="__codelineno-146-10" name="__codelineno-146-10"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-146-11" name="__codelineno-146-11"></a><span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">year</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="sc">'/'</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">month</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="sc">'/'</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">day</span><span class="p">;</span>
<a id="__codelineno-146-12" name="__codelineno-146-12"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-146-13" name="__codelineno-146-13"></a><span class="p">};</span>
<a id="__codelineno-146-14" name="__codelineno-146-14"></a>
<a id="__codelineno-146-15" name="__codelineno-146-15"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span>
<a id="__codelineno-146-16" name="__codelineno-146-16"></a><span class="p">{</span>
<a id="__codelineno-146-17" name="__codelineno-146-17"></a><span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">Date</span><span class="w"> </span><span class="n">today</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="mi">2020</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="mi">14</span><span class="w"> </span><span class="p">};</span><span class="w"> </span><span class="c1">// const</span>
<a id="__codelineno-146-18" name="__codelineno-146-18"></a>
<a id="__codelineno-146-19" name="__codelineno-146-19"></a><span class="w">    </span><span class="n">today</span><span class="p">.</span><span class="n">print</span><span class="p">();</span><span class="w">  </span><span class="c1">// compile error: can't call non-const member function</span>
<a id="__codelineno-146-20" name="__codelineno-146-20"></a>
<a id="__codelineno-146-21" name="__codelineno-146-21"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-146-22" name="__codelineno-146-22"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>我们可以通过把 const 关键字附加到函数原型后来使得这个函数变为 const 成员函数</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-147-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-147-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-147-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-147-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-147-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-147-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-147-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-147-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-147-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-147-10">10</a></span>
<span class="normal"><a href="#__codelineno-147-11">11</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-147-1" name="__codelineno-147-1"></a><span class="k">struct</span><span class="w"> </span><span class="nc">Date</span>
<a id="__codelineno-147-2" name="__codelineno-147-2"></a><span class="p">{</span>
<a id="__codelineno-147-3" name="__codelineno-147-3"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">year</span><span class="w"> </span><span class="p">{};</span>
<a id="__codelineno-147-4" name="__codelineno-147-4"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">month</span><span class="w"> </span><span class="p">{};</span>
<a id="__codelineno-147-5" name="__codelineno-147-5"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">day</span><span class="w"> </span><span class="p">{};</span>
<a id="__codelineno-147-6" name="__codelineno-147-6"></a>
<a id="__codelineno-147-7" name="__codelineno-147-7"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">print</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="c1">// now a const member function</span>
<a id="__codelineno-147-8" name="__codelineno-147-8"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-147-9" name="__codelineno-147-9"></a><span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">year</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="sc">'/'</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">month</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="sc">'/'</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">day</span><span class="p">;</span>
<a id="__codelineno-147-10" name="__codelineno-147-10"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-147-11" name="__codelineno-147-11"></a><span class="p">};</span>
</code></pre></div></td></tr></table></div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<ul>
<li>尝试更改成员变量或调用非 const 成员函数的 const 成员函数将导致编译错误</li>
<li>构造函数不能设为 const，因为它们需要初始化对象的成员，这需要修改它们</li>
<li>const 成员函数可以也被非 const 对象调用，因此我们最好把不会改变对象状态的成员函数设置为 const</li>
</ul>
</div>
<p>虽然很少会这么做，但是成员函数可以被重载为 const 和非 const 两个版本，因为 const 限定符也被认为是函数签名的一部分。</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-148-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-148-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-148-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-148-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-148-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-148-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-148-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-148-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-148-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-148-10">10</a></span>
<span class="normal"><a href="#__codelineno-148-11">11</a></span>
<span class="normal"><a href="#__codelineno-148-12">12</a></span>
<span class="normal"><a href="#__codelineno-148-13">13</a></span>
<span class="normal"><a href="#__codelineno-148-14">14</a></span>
<span class="normal"><a href="#__codelineno-148-15">15</a></span>
<span class="normal"><a href="#__codelineno-148-16">16</a></span>
<span class="normal"><a href="#__codelineno-148-17">17</a></span>
<span class="normal"><a href="#__codelineno-148-18">18</a></span>
<span class="normal"><a href="#__codelineno-148-19">19</a></span>
<span class="normal"><a href="#__codelineno-148-20">20</a></span>
<span class="normal"><a href="#__codelineno-148-21">21</a></span>
<span class="normal"><a href="#__codelineno-148-22">22</a></span>
<span class="normal"><a href="#__codelineno-148-23">23</a></span>
<span class="normal"><a href="#__codelineno-148-24">24</a></span>
<span class="normal"><a href="#__codelineno-148-25">25</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-148-1" name="__codelineno-148-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span>
<a id="__codelineno-148-2" name="__codelineno-148-2"></a>
<a id="__codelineno-148-3" name="__codelineno-148-3"></a><span class="k">struct</span><span class="w"> </span><span class="nc">Something</span>
<a id="__codelineno-148-4" name="__codelineno-148-4"></a><span class="p">{</span>
<a id="__codelineno-148-5" name="__codelineno-148-5"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">print</span><span class="p">()</span>
<a id="__codelineno-148-6" name="__codelineno-148-6"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-148-7" name="__codelineno-148-7"></a><span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"non-const</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
<a id="__codelineno-148-8" name="__codelineno-148-8"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-148-9" name="__codelineno-148-9"></a>
<a id="__codelineno-148-10" name="__codelineno-148-10"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">print</span><span class="p">()</span><span class="w"> </span><span class="k">const</span>
<a id="__codelineno-148-11" name="__codelineno-148-11"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-148-12" name="__codelineno-148-12"></a><span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"const</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
<a id="__codelineno-148-13" name="__codelineno-148-13"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-148-14" name="__codelineno-148-14"></a><span class="p">};</span>
<a id="__codelineno-148-15" name="__codelineno-148-15"></a>
<a id="__codelineno-148-16" name="__codelineno-148-16"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span>
<a id="__codelineno-148-17" name="__codelineno-148-17"></a><span class="p">{</span>
<a id="__codelineno-148-18" name="__codelineno-148-18"></a><span class="w">    </span><span class="n">Something</span><span class="w"> </span><span class="n">s1</span><span class="p">{};</span>
<a id="__codelineno-148-19" name="__codelineno-148-19"></a><span class="w">    </span><span class="n">s1</span><span class="p">.</span><span class="n">print</span><span class="p">();</span><span class="w"> </span><span class="c1">// calls print()</span>
<a id="__codelineno-148-20" name="__codelineno-148-20"></a>
<a id="__codelineno-148-21" name="__codelineno-148-21"></a><span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">Something</span><span class="w"> </span><span class="n">s2</span><span class="p">{};</span>
<a id="__codelineno-148-22" name="__codelineno-148-22"></a><span class="w">    </span><span class="n">s2</span><span class="p">.</span><span class="n">print</span><span class="p">();</span><span class="w"> </span><span class="c1">// calls print() const</span>
<a id="__codelineno-148-23" name="__codelineno-148-23"></a>
<a id="__codelineno-148-24" name="__codelineno-148-24"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-148-25" name="__codelineno-148-25"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>输出结果为</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-149-1">1</a></span>
<span class="normal"><a href="#__codelineno-149-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-149-1" name="__codelineno-149-1"></a>non-const
<a id="__codelineno-149-2" name="__codelineno-149-2"></a>const
</code></pre></div></td></tr></table></div>
<h3 id="_41">访问说明符<a class="headerlink" href="#_41" title="Permanent link">¶</a></h3>
<p>C++ 具有三种不同的访问级别：public、private 和 protected，我们暂时先介绍前两者。</p>
<p>每当对对象的成员进行访问时，编译器都会检查这个成员的访问级别，如果访问级别不允许访问者访问该成员，编译器将报错。</p>
<ul>
<li><strong>public</strong>：公共成员可以被任何人访问，包括同一个类的其他成员、其他类的成员和非成员函数。</li>
<li><strong>private</strong>：私有成员只能被类自己的成员访问，无法被其他类的成员或非成员函数访问。</li>
</ul>
<p>前面提到过，类的默认访问说明符是 private，而结构体的默认访问说明符是 public。</p>
<ul>
<li>默认情况下，结构体的所有成员都是公共成员</li>
<li>
<p>默认情况下，类的所有成员都是私有成员，这表示我们不能直接对类进行聚合初始化</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-150-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-150-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-150-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-150-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-150-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-150-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-150-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-150-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-150-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-150-10">10</a></span>
<span class="normal"><a href="#__codelineno-150-11">11</a></span>
<span class="normal"><a href="#__codelineno-150-12">12</a></span>
<span class="normal"><a href="#__codelineno-150-13">13</a></span>
<span class="normal"><a href="#__codelineno-150-14">14</a></span>
<span class="normal"><a href="#__codelineno-150-15">15</a></span>
<span class="normal"><a href="#__codelineno-150-16">16</a></span>
<span class="normal"><a href="#__codelineno-150-17">17</a></span>
<span class="normal"><a href="#__codelineno-150-18">18</a></span>
<span class="normal"><a href="#__codelineno-150-19">19</a></span>
<span class="normal"><a href="#__codelineno-150-20">20</a></span>
<span class="normal"><a href="#__codelineno-150-21">21</a></span>
<span class="normal"><a href="#__codelineno-150-22">22</a></span>
<span class="normal"><a href="#__codelineno-150-23">23</a></span>
<span class="normal"><a href="#__codelineno-150-24">24</a></span>
<span class="normal"><a href="#__codelineno-150-25">25</a></span>
<span class="normal"><a href="#__codelineno-150-26">26</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-150-1" name="__codelineno-150-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span>
<a id="__codelineno-150-2" name="__codelineno-150-2"></a>
<a id="__codelineno-150-3" name="__codelineno-150-3"></a><span class="k">class</span><span class="w"> </span><span class="nc">Date</span>
<a id="__codelineno-150-4" name="__codelineno-150-4"></a><span class="p">{</span>
<a id="__codelineno-150-5" name="__codelineno-150-5"></a><span class="w">    </span><span class="c1">// class members are private by default, can only be accessed by other members</span>
<a id="__codelineno-150-6" name="__codelineno-150-6"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">m_year</span><span class="w"> </span><span class="p">{};</span><span class="w">     </span><span class="c1">// private by default</span>
<a id="__codelineno-150-7" name="__codelineno-150-7"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">m_month</span><span class="w"> </span><span class="p">{};</span><span class="w">    </span><span class="c1">// private by default</span>
<a id="__codelineno-150-8" name="__codelineno-150-8"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">m_day</span><span class="w"> </span><span class="p">{};</span><span class="w">      </span><span class="c1">// private by default</span>
<a id="__codelineno-150-9" name="__codelineno-150-9"></a>
<a id="__codelineno-150-10" name="__codelineno-150-10"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">print</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="c1">// private by default</span>
<a id="__codelineno-150-11" name="__codelineno-150-11"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-150-12" name="__codelineno-150-12"></a><span class="w">        </span><span class="c1">// private members can be accessed in member functions</span>
<a id="__codelineno-150-13" name="__codelineno-150-13"></a><span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">m_year</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="sc">'/'</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">m_month</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="sc">'/'</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">m_day</span><span class="p">;</span>
<a id="__codelineno-150-14" name="__codelineno-150-14"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-150-15" name="__codelineno-150-15"></a><span class="p">};</span>
<a id="__codelineno-150-16" name="__codelineno-150-16"></a>
<a id="__codelineno-150-17" name="__codelineno-150-17"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span>
<a id="__codelineno-150-18" name="__codelineno-150-18"></a><span class="p">{</span>
<a id="__codelineno-150-19" name="__codelineno-150-19"></a><span class="w">    </span><span class="n">Date</span><span class="w"> </span><span class="n">today</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="mi">2020</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="mi">14</span><span class="w"> </span><span class="p">};</span><span class="w"> </span><span class="c1">// compile error: can no longer use aggregate initialization</span>
<a id="__codelineno-150-20" name="__codelineno-150-20"></a>
<a id="__codelineno-150-21" name="__codelineno-150-21"></a><span class="w">    </span><span class="c1">// private members can not be accessed by the public</span>
<a id="__codelineno-150-22" name="__codelineno-150-22"></a><span class="w">    </span><span class="n">today</span><span class="p">.</span><span class="n">m_day</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">16</span><span class="p">;</span><span class="w"> </span><span class="c1">// compile error: the m_day member is private</span>
<a id="__codelineno-150-23" name="__codelineno-150-23"></a><span class="w">    </span><span class="n">today</span><span class="p">.</span><span class="n">print</span><span class="p">();</span><span class="w">    </span><span class="c1">// compile error: the print() member function is private</span>
<a id="__codelineno-150-24" name="__codelineno-150-24"></a>
<a id="__codelineno-150-25" name="__codelineno-150-25"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-150-26" name="__codelineno-150-26"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
</li>
</ul>
<div class="admonition property">
<p class="admonition-title">给 private 变量命名</p>
<p>在 C++ 中，我们经常能见到给 private 的变量加上前缀 <code>m_</code>，这是一种常见的命名约定，它有助于区分成员变量和局部变量。例如一个成员函数</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-151-1">1</a></span>
<span class="normal"><a href="#__codelineno-151-2">2</a></span>
<span class="normal"><a href="#__codelineno-151-3">3</a></span>
<span class="normal"><a href="#__codelineno-151-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-151-1" name="__codelineno-151-1"></a><span class="kt">void</span><span class="w"> </span><span class="nf">setName</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">string_view</span><span class="w"> </span><span class="n">name</span><span class="p">)</span>
<a id="__codelineno-151-2" name="__codelineno-151-2"></a><span class="p">{</span>
<a id="__codelineno-151-3" name="__codelineno-151-3"></a><span class="w">    </span><span class="n">m_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">name</span><span class="p">;</span>
<a id="__codelineno-151-4" name="__codelineno-151-4"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>这样我们就能很容易地知道 <code>m_name</code> 是一个成员变量，而 <code>name</code> 是一个局部变量。</p>
<ul>
<li>如果有需要，class 的 public 成员也可以使用这种命名方式，但是结构体的 public 成员通常不会使用这个前缀。</li>
</ul>
</div>
<p>我们可以使用访问说明符来明确成员的访问级别，包括 <code>public:</code>、<code>private:</code> 和 <code>protected:</code>。</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-152-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-152-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-152-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-152-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-152-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-152-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-152-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-152-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-152-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-152-10">10</a></span>
<span class="normal"><a href="#__codelineno-152-11">11</a></span>
<span class="normal"><a href="#__codelineno-152-12">12</a></span>
<span class="normal"><a href="#__codelineno-152-13">13</a></span>
<span class="normal"><a href="#__codelineno-152-14">14</a></span>
<span class="normal"><a href="#__codelineno-152-15">15</a></span>
<span class="normal"><a href="#__codelineno-152-16">16</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-152-1" name="__codelineno-152-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">Date</span>
<a id="__codelineno-152-2" name="__codelineno-152-2"></a><span class="p">{</span>
<a id="__codelineno-152-3" name="__codelineno-152-3"></a><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-152-4" name="__codelineno-152-4"></a>
<a id="__codelineno-152-5" name="__codelineno-152-5"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">print</span><span class="p">()</span><span class="w"> </span><span class="k">const</span>
<a id="__codelineno-152-6" name="__codelineno-152-6"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-152-7" name="__codelineno-152-7"></a><span class="w">        </span><span class="c1">// members can access other private members</span>
<a id="__codelineno-152-8" name="__codelineno-152-8"></a><span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">m_year</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="sc">'/'</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">m_month</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="sc">'/'</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">m_day</span><span class="p">;</span>
<a id="__codelineno-152-9" name="__codelineno-152-9"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-152-10" name="__codelineno-152-10"></a>
<a id="__codelineno-152-11" name="__codelineno-152-11"></a><span class="k">private</span><span class="o">:</span>
<a id="__codelineno-152-12" name="__codelineno-152-12"></a>
<a id="__codelineno-152-13" name="__codelineno-152-13"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">m_year</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="mi">2020</span><span class="w"> </span><span class="p">};</span>
<a id="__codelineno-152-14" name="__codelineno-152-14"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">m_month</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="mi">14</span><span class="w"> </span><span class="p">};</span>
<a id="__codelineno-152-15" name="__codelineno-152-15"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">m_day</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="mi">10</span><span class="w"> </span><span class="p">};</span>
<a id="__codelineno-152-16" name="__codelineno-152-16"></a><span class="p">};</span>
</code></pre></div></td></tr></table></div>
<table>
<thead>
<tr>
<th>Access level</th>
<th>Access specifier</th>
<th>Member access</th>
<th>Derived class access</th>
<th>Public access</th>
</tr>
</thead>
<tbody>
<tr>
<td>Public</td>
<td>public:</td>
<td>yes</td>
<td>yes</td>
<td>yes</td>
</tr>
<tr>
<td>Protected</td>
<td>protected:</td>
<td>yes</td>
<td>yes</td>
<td>no</td>
</tr>
<tr>
<td>Private</td>
<td>private:</td>
<td>yes</td>
<td>no</td>
<td>no</td>
</tr>
</tbody>
</table>
<p>有一个很容易被误解的点是：C++ 的访问级别是以每个类（per-class）为基准的，而非每个对象（per-object）。这意味着一个对象的成员函数<strong>可以访问同类的其他对象的私有成员</strong>。</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-153-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-153-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-153-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-153-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-153-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-153-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-153-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-153-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-153-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-153-10">10</a></span>
<span class="normal"><a href="#__codelineno-153-11">11</a></span>
<span class="normal"><a href="#__codelineno-153-12">12</a></span>
<span class="normal"><a href="#__codelineno-153-13">13</a></span>
<span class="normal"><a href="#__codelineno-153-14">14</a></span>
<span class="normal"><a href="#__codelineno-153-15">15</a></span>
<span class="normal"><a href="#__codelineno-153-16">16</a></span>
<span class="normal"><a href="#__codelineno-153-17">17</a></span>
<span class="normal"><a href="#__codelineno-153-18">18</a></span>
<span class="normal"><a href="#__codelineno-153-19">19</a></span>
<span class="normal"><a href="#__codelineno-153-20">20</a></span>
<span class="normal"><a href="#__codelineno-153-21">21</a></span>
<span class="normal"><a href="#__codelineno-153-22">22</a></span>
<span class="normal"><a href="#__codelineno-153-23">23</a></span>
<span class="normal"><a href="#__codelineno-153-24">24</a></span>
<span class="normal"><a href="#__codelineno-153-25">25</a></span>
<span class="normal"><a href="#__codelineno-153-26">26</a></span>
<span class="normal"><a href="#__codelineno-153-27">27</a></span>
<span class="normal"><a href="#__codelineno-153-28">28</a></span>
<span class="normal"><a href="#__codelineno-153-29">29</a></span>
<span class="normal"><a href="#__codelineno-153-30">30</a></span>
<span class="normal"><a href="#__codelineno-153-31">31</a></span>
<span class="normal"><a href="#__codelineno-153-32">32</a></span>
<span class="normal"><a href="#__codelineno-153-33">33</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-153-1" name="__codelineno-153-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span>
<a id="__codelineno-153-2" name="__codelineno-153-2"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;string&gt;</span>
<a id="__codelineno-153-3" name="__codelineno-153-3"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;string_view&gt;</span>
<a id="__codelineno-153-4" name="__codelineno-153-4"></a>
<a id="__codelineno-153-5" name="__codelineno-153-5"></a><span class="k">class</span><span class="w"> </span><span class="nc">Person</span>
<a id="__codelineno-153-6" name="__codelineno-153-6"></a><span class="p">{</span>
<a id="__codelineno-153-7" name="__codelineno-153-7"></a><span class="k">private</span><span class="o">:</span>
<a id="__codelineno-153-8" name="__codelineno-153-8"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">m_name</span><span class="p">{};</span>
<a id="__codelineno-153-9" name="__codelineno-153-9"></a>
<a id="__codelineno-153-10" name="__codelineno-153-10"></a><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-153-11" name="__codelineno-153-11"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">shakeHands</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">Person</span><span class="o">&amp;</span><span class="w"> </span><span class="n">p</span><span class="p">)</span><span class="w"> </span><span class="k">const</span>
<a id="__codelineno-153-12" name="__codelineno-153-12"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-153-13" name="__codelineno-153-13"></a><span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">m_name</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">" shake hands with "</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">p</span><span class="p">.</span><span class="n">m_name</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="sc">'\n'</span><span class="p">;</span>
<a id="__codelineno-153-14" name="__codelineno-153-14"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-153-15" name="__codelineno-153-15"></a>
<a id="__codelineno-153-16" name="__codelineno-153-16"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">setName</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">string_view</span><span class="w"> </span><span class="n">name</span><span class="p">)</span>
<a id="__codelineno-153-17" name="__codelineno-153-17"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-153-18" name="__codelineno-153-18"></a><span class="w">        </span><span class="n">m_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">name</span><span class="p">;</span>
<a id="__codelineno-153-19" name="__codelineno-153-19"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-153-20" name="__codelineno-153-20"></a><span class="p">};</span>
<a id="__codelineno-153-21" name="__codelineno-153-21"></a>
<a id="__codelineno-153-22" name="__codelineno-153-22"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span>
<a id="__codelineno-153-23" name="__codelineno-153-23"></a><span class="p">{</span>
<a id="__codelineno-153-24" name="__codelineno-153-24"></a><span class="w">    </span><span class="n">Person</span><span class="w"> </span><span class="n">joe</span><span class="p">;</span>
<a id="__codelineno-153-25" name="__codelineno-153-25"></a><span class="w">    </span><span class="n">joe</span><span class="p">.</span><span class="n">setName</span><span class="p">(</span><span class="s">"Joe"</span><span class="p">);</span>
<a id="__codelineno-153-26" name="__codelineno-153-26"></a>
<a id="__codelineno-153-27" name="__codelineno-153-27"></a><span class="w">    </span><span class="n">Person</span><span class="w"> </span><span class="n">kate</span><span class="p">;</span>
<a id="__codelineno-153-28" name="__codelineno-153-28"></a><span class="w">    </span><span class="n">kate</span><span class="p">.</span><span class="n">setName</span><span class="p">(</span><span class="s">"Kate"</span><span class="p">);</span>
<a id="__codelineno-153-29" name="__codelineno-153-29"></a>
<a id="__codelineno-153-30" name="__codelineno-153-30"></a><span class="w">    </span><span class="n">joe</span><span class="p">.</span><span class="n">shakeHands</span><span class="p">(</span><span class="n">kate</span><span class="p">);</span>
<a id="__codelineno-153-31" name="__codelineno-153-31"></a>
<a id="__codelineno-153-32" name="__codelineno-153-32"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-153-33" name="__codelineno-153-33"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>这段程序运行后得到输出结果为</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-154-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-154-1" name="__codelineno-154-1"></a>Joe shake hands with Kate
</code></pre></div></td></tr></table></div>
<p>在这里 <code>m_name</code> 是 private 的变量，因此它只能被同为 <code>Person</code> 这个类的其他对象访问，因此我们在成员函数 <code>shakeHands()</code> 中可以直接使用另一个对象的 private 变量 <code>p.m_name</code>。</p>
<h3 id="_42">访问函数<a class="headerlink" href="#_42" title="Permanent link">¶</a></h3>
<p>访问函数（access function）指的是用于检索或更改一个类的私有成员的函数。访问函数有两种：<strong>getter</strong> 和 <strong>setter</strong>。访问函数的存在也为我们提供了一定程度的数据封装。</p>
<ul>
<li><strong>getter</strong>：用于检索私有成员的值，有时也称为<strong>访问器</strong>（accessor）</li>
<li><strong>setter</strong>：用于更改私有成员的值，有时也称为<strong>修改器</strong>（mutator）</li>
</ul>
<p>getter 通常被设置为 const 成员函数，因为它们不会修改对象的状态；setter 则不是 const 成员函数，因为它们会修改对象的状态。</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-155-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-155-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-155-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-155-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-155-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-155-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-155-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-155-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-155-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-155-10">10</a></span>
<span class="normal"><a href="#__codelineno-155-11">11</a></span>
<span class="normal"><a href="#__codelineno-155-12">12</a></span>
<span class="normal"><a href="#__codelineno-155-13">13</a></span>
<span class="normal"><a href="#__codelineno-155-14">14</a></span>
<span class="normal"><a href="#__codelineno-155-15">15</a></span>
<span class="normal"><a href="#__codelineno-155-16">16</a></span>
<span class="normal"><a href="#__codelineno-155-17">17</a></span>
<span class="normal"><a href="#__codelineno-155-18">18</a></span>
<span class="normal"><a href="#__codelineno-155-19">19</a></span>
<span class="normal"><a href="#__codelineno-155-20">20</a></span>
<span class="normal"><a href="#__codelineno-155-21">21</a></span>
<span class="normal"><a href="#__codelineno-155-22">22</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-155-1" name="__codelineno-155-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">Date</span>
<a id="__codelineno-155-2" name="__codelineno-155-2"></a><span class="p">{</span>
<a id="__codelineno-155-3" name="__codelineno-155-3"></a><span class="k">private</span><span class="o">:</span>
<a id="__codelineno-155-4" name="__codelineno-155-4"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">m_year</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="mi">2020</span><span class="w"> </span><span class="p">};</span>
<a id="__codelineno-155-5" name="__codelineno-155-5"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">m_month</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="mi">10</span><span class="w"> </span><span class="p">};</span>
<a id="__codelineno-155-6" name="__codelineno-155-6"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">m_day</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="mi">14</span><span class="w"> </span><span class="p">};</span>
<a id="__codelineno-155-7" name="__codelineno-155-7"></a>
<a id="__codelineno-155-8" name="__codelineno-155-8"></a><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-155-9" name="__codelineno-155-9"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">print</span><span class="p">()</span>
<a id="__codelineno-155-10" name="__codelineno-155-10"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-155-11" name="__codelineno-155-11"></a><span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">m_year</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="sc">'/'</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">m_month</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="sc">'/'</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">m_day</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="sc">'\n'</span><span class="p">;</span>
<a id="__codelineno-155-12" name="__codelineno-155-12"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-155-13" name="__codelineno-155-13"></a>
<a id="__codelineno-155-14" name="__codelineno-155-14"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">getYear</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">m_year</span><span class="p">;</span><span class="w"> </span><span class="p">}</span><span class="w">        </span><span class="c1">// getter for year</span>
<a id="__codelineno-155-15" name="__codelineno-155-15"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">setYear</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">year</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">m_year</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">year</span><span class="p">;</span><span class="w"> </span><span class="p">}</span><span class="w">     </span><span class="c1">// setter for year</span>
<a id="__codelineno-155-16" name="__codelineno-155-16"></a>
<a id="__codelineno-155-17" name="__codelineno-155-17"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">getMonth</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w">  </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">m_month</span><span class="p">;</span><span class="w"> </span><span class="p">}</span><span class="w">     </span><span class="c1">// getter for month</span>
<a id="__codelineno-155-18" name="__codelineno-155-18"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">setMonth</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">month</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">m_month</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">month</span><span class="p">;</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="c1">// setter for month</span>
<a id="__codelineno-155-19" name="__codelineno-155-19"></a>
<a id="__codelineno-155-20" name="__codelineno-155-20"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">getDay</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">m_day</span><span class="p">;</span><span class="w"> </span><span class="p">}</span><span class="w">          </span><span class="c1">// getter for day</span>
<a id="__codelineno-155-21" name="__codelineno-155-21"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">setDay</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">day</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">m_day</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">day</span><span class="p">;</span><span class="w"> </span><span class="p">}</span><span class="w">         </span><span class="c1">// setter for day</span>
<a id="__codelineno-155-22" name="__codelineno-155-22"></a><span class="p">};</span>
</code></pre></div></td></tr></table></div>
<p>我们通常会给访问函数加上前缀 <code>get</code> 和 <code>set</code>，这是一种常见的命名约定，它有助于我们识别 getter 和 setter。</p>
<h3 id="_43">类成员的声明顺序<a class="headerlink" href="#_43" title="Permanent link">¶</a></h3>
<p>由于类的中的成员变量和成员函数不需要在使用之前声明，因此我们不必像在类之外书写代码那样先声明再使用。那么我们该如何安排这些成员的顺序呢？目前主要有两种主张：</p>
<ol>
<li>
<p>首先列出 private 成员，然后再列出 public 的成员函数。</p>
<p>这是一种较为传统的风格，任何查看我们的类代码的人都会在使用数据成员之间就了解它们的定义，这符合阅读的习惯，并让阅读者更容易了解实现的细节。</p>
</li>
<li>
<p>首先列出 public 成员，然后再列出 private 的成员函数。</p>
<p>这种风格将类的接口放在了首位，这样用户可以更容易地找到他们可能需要的函数和使用方法，而不必关注具体的实现细节（很多时候用户并不关心这些细节）。</p>
</li>
</ol>
<div class="admonition info">
<p class="admonition-title">Google C++ style guide 的建议</p>
<p><a href="https://google.github.io/styleguide/cppguide.html#Declaration_Order">Google C++ style guide</a> 推荐按照以下的顺序安排类的成员：</p>
<ul>
<li>Types and type aliases (typedef, using, enum, nested structs and classes, and friend types)</li>
<li>Static constants</li>
<li>Factory functions</li>
<li>Constructors and assignment operators</li>
<li>Destructor</li>
<li>All other functions (static and non-static member functions, and friend functions)</li>
<li>Data members (static and non-static)</li>
</ul>
</div>
<h3 id="_44">构造函数<a class="headerlink" href="#_44" title="Permanent link">¶</a></h3>
<h4 id="_45">构造函数引入<a class="headerlink" href="#_45" title="Permanent link">¶</a></h4>
<p>当类类型是一个聚合体时，我们可以使用聚合初始化来初始化对象，例如</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-156-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-156-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-156-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-156-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-156-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-156-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-156-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-156-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-156-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-156-10">10</a></span>
<span class="normal"><a href="#__codelineno-156-11">11</a></span>
<span class="normal"><a href="#__codelineno-156-12">12</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-156-1" name="__codelineno-156-1"></a><span class="k">struct</span><span class="w"> </span><span class="nc">Foo</span><span class="w"> </span><span class="c1">// Foo is an aggregate</span>
<a id="__codelineno-156-2" name="__codelineno-156-2"></a><span class="p">{</span>
<a id="__codelineno-156-3" name="__codelineno-156-3"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="p">{};</span>
<a id="__codelineno-156-4" name="__codelineno-156-4"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="p">{};</span>
<a id="__codelineno-156-5" name="__codelineno-156-5"></a><span class="p">};</span>
<a id="__codelineno-156-6" name="__codelineno-156-6"></a>
<a id="__codelineno-156-7" name="__codelineno-156-7"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span>
<a id="__codelineno-156-8" name="__codelineno-156-8"></a><span class="p">{</span>
<a id="__codelineno-156-9" name="__codelineno-156-9"></a><span class="w">    </span><span class="n">Foo</span><span class="w"> </span><span class="n">foo</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="mi">6</span><span class="p">,</span><span class="w"> </span><span class="mi">7</span><span class="w"> </span><span class="p">};</span><span class="w"> </span><span class="c1">// uses aggregate initialization</span>
<a id="__codelineno-156-10" name="__codelineno-156-10"></a>
<a id="__codelineno-156-11" name="__codelineno-156-11"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-156-12" name="__codelineno-156-12"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>聚合初始化会按照成员定义的顺序对成员进行初始化，上面这个例子中，<code>foo.x</code> 被初始化为 <code>6</code>，<code>foo.y</code> 被初始化为 <code>7</code>。但是一旦我们把任意一个成员变量变为 private 的，这个类类型就不再是聚合体了（因为聚合体不能拥有私有成员），这时我们就不能再使用聚合初始化了。</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-157-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-157-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-157-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-157-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-157-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-157-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-157-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-157-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-157-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-157-10">10</a></span>
<span class="normal"><a href="#__codelineno-157-11">11</a></span>
<span class="normal"><a href="#__codelineno-157-12">12</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-157-1" name="__codelineno-157-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">Foo</span><span class="w"> </span><span class="c1">// Foo is not an aggregate (has private members)</span>
<a id="__codelineno-157-2" name="__codelineno-157-2"></a><span class="p">{</span>
<a id="__codelineno-157-3" name="__codelineno-157-3"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">m_x</span><span class="w"> </span><span class="p">{};</span>
<a id="__codelineno-157-4" name="__codelineno-157-4"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">m_y</span><span class="w"> </span><span class="p">{};</span>
<a id="__codelineno-157-5" name="__codelineno-157-5"></a><span class="p">};</span>
<a id="__codelineno-157-6" name="__codelineno-157-6"></a>
<a id="__codelineno-157-7" name="__codelineno-157-7"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span>
<a id="__codelineno-157-8" name="__codelineno-157-8"></a><span class="p">{</span>
<a id="__codelineno-157-9" name="__codelineno-157-9"></a><span class="w">    </span><span class="n">Foo</span><span class="w"> </span><span class="n">foo</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="mi">6</span><span class="p">,</span><span class="w"> </span><span class="mi">7</span><span class="w"> </span><span class="p">};</span><span class="w"> </span><span class="c1">// compile error: can not use aggregate initialization</span>
<a id="__codelineno-157-10" name="__codelineno-157-10"></a>
<a id="__codelineno-157-11" name="__codelineno-157-11"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-157-12" name="__codelineno-157-12"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>不允许带有私有成员的类类型使用聚合初始化的原因是</p>
<ul>
<li>聚合初始化需要了解类的具体实现（必须知道成员是什么，以及它们是按照什么顺序声明的），这和我们把变量设为私有的是相悖的</li>
<li>如果我们的类具有某种不变性，那么在初始化时我们就需要依靠用户来确保这种不变性，这是不可靠的</li>
</ul>
<p>既然我们不能使用聚合初始化来对 class 进行初始化，我们就要使用别的方法——<strong>构造函数</strong>（constructor）。</p>
<p>构造函数是一种特殊的成员函数，它会在创建一个非聚合类的对象后被自动调用。编译器会查看是否可以找到和调用者提供的初始化值（如果有的话）相匹配的构造函数</p>
<ul>
<li>如果找到了可访问的匹配的构造函数，编译器将为这个对象分配内存，然后调用这个构造函数</li>
<li>如果没有找到匹配的构造函数，将会出现编译错误</li>
</ul>
<p>构造函数不仅决定如何创建一个对象，通常还执行以下两个工作</p>
<ol>
<li>对成员变量进行初始化（通过初始化列表或构造函数体）</li>
<li>执行一些其他的设置函数（setup functions），可能包括检查初始化值、打开文件等</li>
</ol>
<div class="admonition note">
<p class="admonition-title">构造函数的命名</p>
<p>构造函数的命名与普通的成员函数不同，它有一些特殊的规则：</p>
<ul>
<li>构造函数的名称必须与类名相同。对于模板类，构造函数的名称将不包括模板参数。</li>
<li>构造函数没有任何返回类型（也没有 void），因为它们不返回任何值。</li>
</ul>
</div>
<p>由于构造函数需要对正在构造的对象进行初始化，因此它不能是 const 的。</p>
<blockquote>
<p>通常，非 const 成员函数不能被一个 const 对象调用，但 C++ 标准明确指出 const 标识符不适用于正在构建的对象，并且 const 在构造函数结束之后才生效。</p>
</blockquote>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-158-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-158-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-158-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-158-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-158-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-158-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-158-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-158-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-158-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-158-10">10</a></span>
<span class="normal"><a href="#__codelineno-158-11">11</a></span>
<span class="normal"><a href="#__codelineno-158-12">12</a></span>
<span class="normal"><a href="#__codelineno-158-13">13</a></span>
<span class="normal"><a href="#__codelineno-158-14">14</a></span>
<span class="normal"><a href="#__codelineno-158-15">15</a></span>
<span class="normal"><a href="#__codelineno-158-16">16</a></span>
<span class="normal"><a href="#__codelineno-158-17">17</a></span>
<span class="normal"><a href="#__codelineno-158-18">18</a></span>
<span class="normal"><a href="#__codelineno-158-19">19</a></span>
<span class="normal"><a href="#__codelineno-158-20">20</a></span>
<span class="normal"><a href="#__codelineno-158-21">21</a></span>
<span class="normal"><a href="#__codelineno-158-22">22</a></span>
<span class="normal"><a href="#__codelineno-158-23">23</a></span>
<span class="normal"><a href="#__codelineno-158-24">24</a></span>
<span class="normal"><a href="#__codelineno-158-25">25</a></span>
<span class="normal"><a href="#__codelineno-158-26">26</a></span>
<span class="normal"><a href="#__codelineno-158-27">27</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-158-1" name="__codelineno-158-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span>
<a id="__codelineno-158-2" name="__codelineno-158-2"></a>
<a id="__codelineno-158-3" name="__codelineno-158-3"></a><span class="k">class</span><span class="w"> </span><span class="nc">Foo</span>
<a id="__codelineno-158-4" name="__codelineno-158-4"></a><span class="p">{</span>
<a id="__codelineno-158-5" name="__codelineno-158-5"></a><span class="k">private</span><span class="o">:</span>
<a id="__codelineno-158-6" name="__codelineno-158-6"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">m_x</span><span class="w"> </span><span class="p">{};</span>
<a id="__codelineno-158-7" name="__codelineno-158-7"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">m_y</span><span class="w"> </span><span class="p">{};</span>
<a id="__codelineno-158-8" name="__codelineno-158-8"></a>
<a id="__codelineno-158-9" name="__codelineno-158-9"></a><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-158-10" name="__codelineno-158-10"></a><span class="w">    </span><span class="n">Foo</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">y</span><span class="p">)</span>
<a id="__codelineno-158-11" name="__codelineno-158-11"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-158-12" name="__codelineno-158-12"></a><span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"Foo("</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">", "</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">") constructed</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
<a id="__codelineno-158-13" name="__codelineno-158-13"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-158-14" name="__codelineno-158-14"></a>
<a id="__codelineno-158-15" name="__codelineno-158-15"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">print</span><span class="p">()</span><span class="w"> </span><span class="k">const</span>
<a id="__codelineno-158-16" name="__codelineno-158-16"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-158-17" name="__codelineno-158-17"></a><span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"Foo("</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">m_x</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">", "</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">m_y</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">")</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
<a id="__codelineno-158-18" name="__codelineno-158-18"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-158-19" name="__codelineno-158-19"></a><span class="p">};</span>
<a id="__codelineno-158-20" name="__codelineno-158-20"></a>
<a id="__codelineno-158-21" name="__codelineno-158-21"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span>
<a id="__codelineno-158-22" name="__codelineno-158-22"></a><span class="p">{</span>
<a id="__codelineno-158-23" name="__codelineno-158-23"></a><span class="w">    </span><span class="n">Foo</span><span class="w"> </span><span class="n">foo</span><span class="p">{</span><span class="w"> </span><span class="mi">6</span><span class="p">,</span><span class="w"> </span><span class="mi">7</span><span class="w"> </span><span class="p">};</span>
<a id="__codelineno-158-24" name="__codelineno-158-24"></a><span class="w">    </span><span class="n">foo</span><span class="p">.</span><span class="n">print</span><span class="p">();</span>
<a id="__codelineno-158-25" name="__codelineno-158-25"></a>
<a id="__codelineno-158-26" name="__codelineno-158-26"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-158-27" name="__codelineno-158-27"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>由于这个构造函数并没有对成员变量进行初始化，因此这段程序的输出为</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-159-1">1</a></span>
<span class="normal"><a href="#__codelineno-159-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-159-1" name="__codelineno-159-1"></a>Foo(6, 7) constructed
<a id="__codelineno-159-2" name="__codelineno-159-2"></a>Foo(0, 0)
</code></pre></div></td></tr></table></div>
<div class="admonition extra">
<p class="admonition-title">构造函数的参数会进行隐式转换</p>
<p>对于上面的构造函数，我们可以使用任何可以隐式转换为 <code>int</code> 的类型来调用它，例如 <code>Foo foo{ 'a', true };</code> 或 <code>Foo foo{ 3.14, 2.71 };</code> 等。</p>
</div>
<h4 id="_46">成员初始化列表<a class="headerlink" href="#_46" title="Permanent link">¶</a></h4>
<p>为了让构造函数初始化成员，我们可以使用<strong>成员初始化列表</strong>（member initializer list, or member initialization list）。</p>
<p>对于我们上面的构造函数，我们只需要略作修改就可以让它初始化 <code>m_x</code> 和 <code>m_y</code>。</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-160-1">1</a></span>
<span class="normal"><a href="#__codelineno-160-2">2</a></span>
<span class="normal"><a href="#__codelineno-160-3">3</a></span>
<span class="normal"><a href="#__codelineno-160-4">4</a></span>
<span class="normal"><a href="#__codelineno-160-5">5</a></span>
<span class="normal"><a href="#__codelineno-160-6">6</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-160-1" name="__codelineno-160-1"></a><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-160-2" name="__codelineno-160-2"></a><span class="w">    </span><span class="n">Foo</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">y</span><span class="p">)</span>
<a id="__codelineno-160-3" name="__codelineno-160-3"></a><span class="hll"><span class="w">        </span><span class="o">:</span><span class="w"> </span><span class="n">m_x</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">m_y</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="p">}</span>
</span><a id="__codelineno-160-4" name="__codelineno-160-4"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-160-5" name="__codelineno-160-5"></a><span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"Foo("</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">", "</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">") constructed</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
<a id="__codelineno-160-6" name="__codelineno-160-6"></a><span class="w">    </span><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>成员初始化列表应紧接在在构造函数的参数列表之后，它以一个冒号 <code>:</code> 开始，后面列出要初始化的每个成员及其初始化值，每个成员初始化之间用逗号 <code>,</code> 分隔。</p>
<p>修改后的程序输出结果为</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-161-1">1</a></span>
<span class="normal"><a href="#__codelineno-161-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-161-1" name="__codelineno-161-1"></a>Foo(6, 7) constructed
<a id="__codelineno-161-2" name="__codelineno-161-2"></a>Foo(6, 7)
</code></pre></div></td></tr></table></div>
<div class="admonition info">
<p class="admonition-title">成员初始化列表的格式</p>
<p>C++ 并不在意我们把成员初始化列表的冒号、逗号和空格是怎么写的，因此下面几种格式也都是有效的（并且都可能遇见）</p>
<div class="highlight"><table class="highlighttable"><tr><th class="filename" colspan="2"><span class="filename">style 1</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-162-1">1</a></span>
<span class="normal"><a href="#__codelineno-162-2">2</a></span>
<span class="normal"><a href="#__codelineno-162-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-162-1" name="__codelineno-162-1"></a><span class="n">Foo</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">y</span><span class="p">)</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">m_x</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">m_y</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-162-2" name="__codelineno-162-2"></a><span class="p">{</span>
<a id="__codelineno-162-3" name="__codelineno-162-3"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<div class="highlight"><table class="highlighttable"><tr><th class="filename" colspan="2"><span class="filename">style 2</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-163-1">1</a></span>
<span class="normal"><a href="#__codelineno-163-2">2</a></span>
<span class="normal"><a href="#__codelineno-163-3">3</a></span>
<span class="normal"><a href="#__codelineno-163-4">4</a></span>
<span class="normal"><a href="#__codelineno-163-5">5</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-163-1" name="__codelineno-163-1"></a><span class="n">Foo</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">y</span><span class="p">)</span><span class="w"> </span><span class="o">:</span>
<a id="__codelineno-163-2" name="__codelineno-163-2"></a><span class="w">    </span><span class="n">m_x</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="p">},</span>
<a id="__codelineno-163-3" name="__codelineno-163-3"></a><span class="w">    </span><span class="n">m_y</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-163-4" name="__codelineno-163-4"></a><span class="p">{</span>
<a id="__codelineno-163-5" name="__codelineno-163-5"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<div class="highlight"><table class="highlighttable"><tr><th class="filename" colspan="2"><span class="filename">style 3</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-164-1">1</a></span>
<span class="normal"><a href="#__codelineno-164-2">2</a></span>
<span class="normal"><a href="#__codelineno-164-3">3</a></span>
<span class="normal"><a href="#__codelineno-164-4">4</a></span>
<span class="normal"><a href="#__codelineno-164-5">5</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-164-1" name="__codelineno-164-1"></a><span class="n">Foo</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">y</span><span class="p">)</span>
<a id="__codelineno-164-2" name="__codelineno-164-2"></a><span class="w">    </span><span class="o">:</span><span class="w"> </span><span class="n">m_x</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-164-3" name="__codelineno-164-3"></a><span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="n">m_y</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-164-4" name="__codelineno-164-4"></a><span class="p">{</span>
<a id="__codelineno-164-5" name="__codelineno-164-5"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
</div>
<p>C++ 标准要求成员初始化列表的成员初始化顺序必须与它们在类中声明的顺序一致，而我们在直觉上可能会认为成员变量将按照初始化列表中的顺序进行初始化，这就可能导致一些错误。</p>
<p>假如我们的类定义如下</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-165-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-165-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-165-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-165-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-165-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-165-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-165-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-165-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-165-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-165-10">10</a></span>
<span class="normal"><a href="#__codelineno-165-11">11</a></span>
<span class="normal"><a href="#__codelineno-165-12">12</a></span>
<span class="normal"><a href="#__codelineno-165-13">13</a></span>
<span class="normal"><a href="#__codelineno-165-14">14</a></span>
<span class="normal"><a href="#__codelineno-165-15">15</a></span>
<span class="normal"><a href="#__codelineno-165-16">16</a></span>
<span class="normal"><a href="#__codelineno-165-17">17</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-165-1" name="__codelineno-165-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">Foo</span>
<a id="__codelineno-165-2" name="__codelineno-165-2"></a><span class="p">{</span>
<a id="__codelineno-165-3" name="__codelineno-165-3"></a><span class="k">private</span><span class="o">:</span>
<a id="__codelineno-165-4" name="__codelineno-165-4"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">m_x</span><span class="p">{};</span>
<a id="__codelineno-165-5" name="__codelineno-165-5"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">m_y</span><span class="p">{};</span>
<a id="__codelineno-165-6" name="__codelineno-165-6"></a>
<a id="__codelineno-165-7" name="__codelineno-165-7"></a><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-165-8" name="__codelineno-165-8"></a><span class="w">    </span><span class="n">Foo</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">y</span><span class="p">)</span>
<a id="__codelineno-165-9" name="__codelineno-165-9"></a><span class="w">        </span><span class="o">:</span><span class="w"> </span><span class="n">m_y</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">max</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">)</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">m_x</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">m_y</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="c1">// issue on this line</span>
<a id="__codelineno-165-10" name="__codelineno-165-10"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-165-11" name="__codelineno-165-11"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-165-12" name="__codelineno-165-12"></a>
<a id="__codelineno-165-13" name="__codelineno-165-13"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">print</span><span class="p">()</span><span class="w"> </span><span class="k">const</span>
<a id="__codelineno-165-14" name="__codelineno-165-14"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-165-15" name="__codelineno-165-15"></a><span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"Foo("</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">m_x</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">", "</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">m_y</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">")</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
<a id="__codelineno-165-16" name="__codelineno-165-16"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-165-17" name="__codelineno-165-17"></a><span class="p">};</span>
</code></pre></div></td></tr></table></div>
<p>尽管 <code>m_y</code> 在初始化列表中出现在 <code>m_x</code> 之前，但是 <code>m_x</code> 会比 <code>m_y</code> 先初始化，但由于 <code>m_x</code> 的初始化依赖于 <code>m_y</code> 的值，这就会产生未定义行为。例如在我的机器上，这段程序的输出结果是<code>Foo(32731, 7)</code>。</p>
<div class="admonition warning">
<p class="admonition-title">成员初始化列表的顺序</p>
<p>为了避免这种问题，我们应该按照成员变量在类中的声明顺序来编写成员初始化列表。</p>
</div>
<p>成员变量可以被以下几种方法初始化</p>
<ul>
<li>如果成员初始化列表中有对成员变量的初始化，那么这个成员变量将被初始化为成员初始化列表中的值</li>
<li>如果成员初始化列表中没有对成员变量的初始化，那么这个成员变量将被初始化为它的默认值（如果有的话）</li>
<li>否则，这个成员将被默认初始化（通常是未定义的值）</li>
</ul>
<h4 id="_47">默认构造函数<a class="headerlink" href="#_47" title="Permanent link">¶</a></h4>
<p>我们把不接受任何参数的构造函数称为<strong>默认构造函数</strong>（default constructor）。</p>
<p>如果一个类类型具有默认构造函数，则值初始化和默认初始化都将调用默认构造函数</p>
<details class="example">
<summary>默认构造函数</summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-166-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-166-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-166-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-166-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-166-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-166-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-166-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-166-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-166-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-166-10">10</a></span>
<span class="normal"><a href="#__codelineno-166-11">11</a></span>
<span class="normal"><a href="#__codelineno-166-12">12</a></span>
<span class="normal"><a href="#__codelineno-166-13">13</a></span>
<span class="normal"><a href="#__codelineno-166-14">14</a></span>
<span class="normal"><a href="#__codelineno-166-15">15</a></span>
<span class="normal"><a href="#__codelineno-166-16">16</a></span>
<span class="normal"><a href="#__codelineno-166-17">17</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-166-1" name="__codelineno-166-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span>
<a id="__codelineno-166-2" name="__codelineno-166-2"></a>
<a id="__codelineno-166-3" name="__codelineno-166-3"></a><span class="k">class</span><span class="w"> </span><span class="nc">Foo</span>
<a id="__codelineno-166-4" name="__codelineno-166-4"></a><span class="p">{</span>
<a id="__codelineno-166-5" name="__codelineno-166-5"></a><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-166-6" name="__codelineno-166-6"></a><span class="w">    </span><span class="n">Foo</span><span class="p">()</span><span class="w"> </span><span class="c1">// default constructor</span>
<a id="__codelineno-166-7" name="__codelineno-166-7"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-166-8" name="__codelineno-166-8"></a><span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"Foo default constructed</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
<a id="__codelineno-166-9" name="__codelineno-166-9"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-166-10" name="__codelineno-166-10"></a><span class="p">};</span>
<a id="__codelineno-166-11" name="__codelineno-166-11"></a>
<a id="__codelineno-166-12" name="__codelineno-166-12"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span>
<a id="__codelineno-166-13" name="__codelineno-166-13"></a><span class="p">{</span>
<a id="__codelineno-166-14" name="__codelineno-166-14"></a><span class="w">    </span><span class="n">Foo</span><span class="w"> </span><span class="n">foo1</span><span class="w"> </span><span class="p">{};</span><span class="w"> </span><span class="c1">// value initialization</span>
<a id="__codelineno-166-15" name="__codelineno-166-15"></a><span class="w">    </span><span class="n">Foo</span><span class="w"> </span><span class="n">foo2</span><span class="p">;</span><span class="w">    </span><span class="c1">// default initialization</span>
<a id="__codelineno-166-16" name="__codelineno-166-16"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-166-17" name="__codelineno-166-17"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>这里的两种初始化都将调用默认构造函数，它们本质上是等价的。但我们知道对于聚合体而言，值初始化更加安全；而有时候我们难以区分一个类类型是聚合体还是非聚合体，因此最好使用值初始化来初始化对象。</p>
</details>
<p>与其他函数一样，构造函数的最右边参数可以具有默认参数。如果构造函数中的所有参数都有默认参数，那么这个构造函数就被认为是默认构造函数（因为它可以在没有参数的情况下调用。</p>
<p>因为构造函数也是函数，因此它们也可以重载。也就是说，对于一个类类型，我们可以拥有多种构造函数，以便于以不同的方式构造对象。</p>
<details class="example">
<summary>Example</summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-167-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-167-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-167-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-167-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-167-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-167-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-167-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-167-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-167-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-167-10">10</a></span>
<span class="normal"><a href="#__codelineno-167-11">11</a></span>
<span class="normal"><a href="#__codelineno-167-12">12</a></span>
<span class="normal"><a href="#__codelineno-167-13">13</a></span>
<span class="normal"><a href="#__codelineno-167-14">14</a></span>
<span class="normal"><a href="#__codelineno-167-15">15</a></span>
<span class="normal"><a href="#__codelineno-167-16">16</a></span>
<span class="normal"><a href="#__codelineno-167-17">17</a></span>
<span class="normal"><a href="#__codelineno-167-18">18</a></span>
<span class="normal"><a href="#__codelineno-167-19">19</a></span>
<span class="normal"><a href="#__codelineno-167-20">20</a></span>
<span class="normal"><a href="#__codelineno-167-21">21</a></span>
<span class="normal"><a href="#__codelineno-167-22">22</a></span>
<span class="normal"><a href="#__codelineno-167-23">23</a></span>
<span class="normal"><a href="#__codelineno-167-24">24</a></span>
<span class="normal"><a href="#__codelineno-167-25">25</a></span>
<span class="normal"><a href="#__codelineno-167-26">26</a></span>
<span class="normal"><a href="#__codelineno-167-27">27</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-167-1" name="__codelineno-167-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span>
<a id="__codelineno-167-2" name="__codelineno-167-2"></a>
<a id="__codelineno-167-3" name="__codelineno-167-3"></a><span class="k">class</span><span class="w"> </span><span class="nc">Foo</span>
<a id="__codelineno-167-4" name="__codelineno-167-4"></a><span class="p">{</span>
<a id="__codelineno-167-5" name="__codelineno-167-5"></a><span class="k">private</span><span class="o">:</span>
<a id="__codelineno-167-6" name="__codelineno-167-6"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">m_x</span><span class="w"> </span><span class="p">{};</span>
<a id="__codelineno-167-7" name="__codelineno-167-7"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">m_y</span><span class="w"> </span><span class="p">{};</span>
<a id="__codelineno-167-8" name="__codelineno-167-8"></a>
<a id="__codelineno-167-9" name="__codelineno-167-9"></a><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-167-10" name="__codelineno-167-10"></a><span class="w">    </span><span class="n">Foo</span><span class="p">()</span><span class="w"> </span><span class="c1">// default constructor</span>
<a id="__codelineno-167-11" name="__codelineno-167-11"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-167-12" name="__codelineno-167-12"></a><span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"Foo constructed</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
<a id="__codelineno-167-13" name="__codelineno-167-13"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-167-14" name="__codelineno-167-14"></a>
<a id="__codelineno-167-15" name="__codelineno-167-15"></a><span class="w">    </span><span class="n">Foo</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="c1">// default constructor</span>
<a id="__codelineno-167-16" name="__codelineno-167-16"></a><span class="w">        </span><span class="o">:</span><span class="w"> </span><span class="n">m_x</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">m_y</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-167-17" name="__codelineno-167-17"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-167-18" name="__codelineno-167-18"></a><span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"Foo("</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">m_x</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">", "</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">m_y</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">") constructed</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
<a id="__codelineno-167-19" name="__codelineno-167-19"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-167-20" name="__codelineno-167-20"></a><span class="p">};</span>
<a id="__codelineno-167-21" name="__codelineno-167-21"></a>
<a id="__codelineno-167-22" name="__codelineno-167-22"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span>
<a id="__codelineno-167-23" name="__codelineno-167-23"></a><span class="p">{</span>
<a id="__codelineno-167-24" name="__codelineno-167-24"></a><span class="w">    </span><span class="n">Foo</span><span class="w"> </span><span class="n">foo1</span><span class="w"> </span><span class="p">{</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">};</span><span class="w"> </span><span class="c1">// calls Foo(int, int)</span>
<a id="__codelineno-167-25" name="__codelineno-167-25"></a><span class="w">    </span><span class="n">Foo</span><span class="w"> </span><span class="n">foo2</span><span class="p">;</span><span class="w"> </span><span class="c1">// compile error: ambiguous constructor function call</span>
<a id="__codelineno-167-26" name="__codelineno-167-26"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-167-27" name="__codelineno-167-27"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>当我们试图实例化 <code>foo2</code> 时，编译器将寻找默认构造函数，但是由于有两个默认构造函数，编译器无法确定调用哪一个，因此会报错。</p>
</details>
<p><strong>隐式默认构造函数</strong></p>
<p>如果一个非聚合的类类型没有定义任何构造函数，那么编译器将为它生成一个默认构造函数，称为隐式默认构造函数。隐式默认构造函数等同于没有参数，没有成员初始化器列表，也没有函数体的构造函数。</p>
<details class="example">
<summary>隐式默认构造函数</summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-168-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-168-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-168-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-168-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-168-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-168-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-168-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-168-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-168-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-168-10">10</a></span>
<span class="normal"><a href="#__codelineno-168-11">11</a></span>
<span class="normal"><a href="#__codelineno-168-12">12</a></span>
<span class="normal"><a href="#__codelineno-168-13">13</a></span>
<span class="normal"><a href="#__codelineno-168-14">14</a></span>
<span class="normal"><a href="#__codelineno-168-15">15</a></span>
<span class="normal"><a href="#__codelineno-168-16">16</a></span>
<span class="normal"><a href="#__codelineno-168-17">17</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-168-1" name="__codelineno-168-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span>
<a id="__codelineno-168-2" name="__codelineno-168-2"></a>
<a id="__codelineno-168-3" name="__codelineno-168-3"></a><span class="k">class</span><span class="w"> </span><span class="nc">Foo</span>
<a id="__codelineno-168-4" name="__codelineno-168-4"></a><span class="p">{</span>
<a id="__codelineno-168-5" name="__codelineno-168-5"></a><span class="k">private</span><span class="o">:</span>
<a id="__codelineno-168-6" name="__codelineno-168-6"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">m_x</span><span class="p">{</span><span class="mi">1</span><span class="p">};</span>
<a id="__codelineno-168-7" name="__codelineno-168-7"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">m_y</span><span class="p">{</span><span class="mi">2</span><span class="p">};</span>
<a id="__codelineno-168-8" name="__codelineno-168-8"></a>
<a id="__codelineno-168-9" name="__codelineno-168-9"></a><span class="w">    </span><span class="c1">// Note: no constructors declared</span>
<a id="__codelineno-168-10" name="__codelineno-168-10"></a><span class="p">};</span>
<a id="__codelineno-168-11" name="__codelineno-168-11"></a>
<a id="__codelineno-168-12" name="__codelineno-168-12"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span>
<a id="__codelineno-168-13" name="__codelineno-168-13"></a><span class="p">{</span>
<a id="__codelineno-168-14" name="__codelineno-168-14"></a><span class="w">    </span><span class="n">Foo</span><span class="w"> </span><span class="n">foo</span><span class="p">{};</span>
<a id="__codelineno-168-15" name="__codelineno-168-15"></a>
<a id="__codelineno-168-16" name="__codelineno-168-16"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-168-17" name="__codelineno-168-17"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>编译会为我们生成如下的构造函数：</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-169-1">1</a></span>
<span class="normal"><a href="#__codelineno-169-2">2</a></span>
<span class="normal"><a href="#__codelineno-169-3">3</a></span>
<span class="normal"><a href="#__codelineno-169-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-169-1" name="__codelineno-169-1"></a><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-169-2" name="__codelineno-169-2"></a><span class="w">    </span><span class="n">Foo</span><span class="p">()</span><span class="w"> </span><span class="c1">// implicitly generated default constructor</span>
<a id="__codelineno-169-3" name="__codelineno-169-3"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-169-4" name="__codelineno-169-4"></a><span class="w">    </span><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>这段程序中，<code>Foo foo{}</code> 将调用隐式默认构造函数，<code>m_x</code> 和 <code>m_y</code> 分别将被初始化为 <code>1</code> 和 <code>2</code>。</p>
<p>我们也可以通过 <code>= default</code> 来显式声明一个默认构造函数</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-170-1">1</a></span>
<span class="normal"><a href="#__codelineno-170-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-170-1" name="__codelineno-170-1"></a><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-170-2" name="__codelineno-170-2"></a><span class="w">    </span><span class="n">Foo</span><span class="p">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">default</span><span class="p">;</span><span class="w"> </span><span class="c1">// explicitly defaulted default constructor</span>
</code></pre></div></td></tr></table></div>
</details>
<h4 id="_48">委托构造函数<a class="headerlink" href="#_48" title="Permanent link">¶</a></h4>
<p><strong>委托构造函数</strong>（delegating constructors）是一种特殊的构造函数，它允许一个构造函数调用另一个构造函数来初始化对象，这个过程有时称为<strong>构造函数链</strong>。</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-171-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-171-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-171-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-171-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-171-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-171-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-171-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-171-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-171-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-171-10">10</a></span>
<span class="normal"><a href="#__codelineno-171-11">11</a></span>
<span class="normal"><a href="#__codelineno-171-12">12</a></span>
<span class="normal"><a href="#__codelineno-171-13">13</a></span>
<span class="normal"><a href="#__codelineno-171-14">14</a></span>
<span class="normal"><a href="#__codelineno-171-15">15</a></span>
<span class="normal"><a href="#__codelineno-171-16">16</a></span>
<span class="normal"><a href="#__codelineno-171-17">17</a></span>
<span class="normal"><a href="#__codelineno-171-18">18</a></span>
<span class="normal"><a href="#__codelineno-171-19">19</a></span>
<span class="normal"><a href="#__codelineno-171-20">20</a></span>
<span class="normal"><a href="#__codelineno-171-21">21</a></span>
<span class="normal"><a href="#__codelineno-171-22">22</a></span>
<span class="normal"><a href="#__codelineno-171-23">23</a></span>
<span class="normal"><a href="#__codelineno-171-24">24</a></span>
<span class="normal"><a href="#__codelineno-171-25">25</a></span>
<span class="normal"><a href="#__codelineno-171-26">26</a></span>
<span class="normal"><a href="#__codelineno-171-27">27</a></span>
<span class="normal"><a href="#__codelineno-171-28">28</a></span>
<span class="normal"><a href="#__codelineno-171-29">29</a></span>
<span class="normal"><a href="#__codelineno-171-30">30</a></span>
<span class="normal"><a href="#__codelineno-171-31">31</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-171-1" name="__codelineno-171-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span>
<a id="__codelineno-171-2" name="__codelineno-171-2"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;string&gt;</span>
<a id="__codelineno-171-3" name="__codelineno-171-3"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;string_view&gt;</span>
<a id="__codelineno-171-4" name="__codelineno-171-4"></a>
<a id="__codelineno-171-5" name="__codelineno-171-5"></a><span class="k">class</span><span class="w"> </span><span class="nc">Employee</span>
<a id="__codelineno-171-6" name="__codelineno-171-6"></a><span class="p">{</span>
<a id="__codelineno-171-7" name="__codelineno-171-7"></a><span class="k">private</span><span class="o">:</span>
<a id="__codelineno-171-8" name="__codelineno-171-8"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">m_name</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s">"???"</span><span class="w"> </span><span class="p">};</span>
<a id="__codelineno-171-9" name="__codelineno-171-9"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">m_id</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">};</span>
<a id="__codelineno-171-10" name="__codelineno-171-10"></a>
<a id="__codelineno-171-11" name="__codelineno-171-11"></a><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-171-12" name="__codelineno-171-12"></a><span class="w">    </span><span class="n">Employee</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">string_view</span><span class="w"> </span><span class="n">name</span><span class="p">)</span>
<a id="__codelineno-171-13" name="__codelineno-171-13"></a><span class="w">        </span><span class="o">:</span><span class="w"> </span><span class="n">Employee</span><span class="p">{</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">}</span><span class="w"> </span>
<a id="__codelineno-171-14" name="__codelineno-171-14"></a><span class="w">        </span><span class="c1">// delegate initialization to Employee(std::string_view, int) constructor</span>
<a id="__codelineno-171-15" name="__codelineno-171-15"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-171-16" name="__codelineno-171-16"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-171-17" name="__codelineno-171-17"></a>
<a id="__codelineno-171-18" name="__codelineno-171-18"></a><span class="w">    </span><span class="n">Employee</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">string_view</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">id</span><span class="p">)</span>
<a id="__codelineno-171-19" name="__codelineno-171-19"></a><span class="w">        </span><span class="o">:</span><span class="w"> </span><span class="n">m_name</span><span class="p">{</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">m_id</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="p">}</span><span class="w"> </span>
<a id="__codelineno-171-20" name="__codelineno-171-20"></a><span class="w">        </span><span class="c1">// actually initializes the members</span>
<a id="__codelineno-171-21" name="__codelineno-171-21"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-171-22" name="__codelineno-171-22"></a><span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"Employee "</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">m_name</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">" created</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
<a id="__codelineno-171-23" name="__codelineno-171-23"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-171-24" name="__codelineno-171-24"></a>
<a id="__codelineno-171-25" name="__codelineno-171-25"></a><span class="p">};</span>
<a id="__codelineno-171-26" name="__codelineno-171-26"></a>
<a id="__codelineno-171-27" name="__codelineno-171-27"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span>
<a id="__codelineno-171-28" name="__codelineno-171-28"></a><span class="p">{</span>
<a id="__codelineno-171-29" name="__codelineno-171-29"></a><span class="w">    </span><span class="n">Employee</span><span class="w"> </span><span class="n">e1</span><span class="p">{</span><span class="w"> </span><span class="s">"James"</span><span class="w"> </span><span class="p">};</span>
<a id="__codelineno-171-30" name="__codelineno-171-30"></a><span class="w">    </span><span class="n">Employee</span><span class="w"> </span><span class="n">e2</span><span class="p">{</span><span class="w"> </span><span class="s">"Dave"</span><span class="p">,</span><span class="w"> </span><span class="mi">42</span><span class="w"> </span><span class="p">};</span>
<a id="__codelineno-171-31" name="__codelineno-171-31"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>当 <code>e1{ "James" }</code> 被初始化时，与之匹配的构造函数 <code>Employee(std::string_view name)</code> 被调用，这个构造函数在成员初始化列表中把初始化的人物委托给另一个构造函数 <code>Employee(std::string_view name, int id)</code> 来初始化对象。</li>
<li>被委托的构造函数 <code>Employee(std::string_view name, int id)</code> 把 <code>m_name</code> 初始化为 <code>name</code>，把 <code>m_id</code> 初始化为 <code>id</code>，然后执行它的函数体。</li>
<li>被委托的构造函数体被执行后，控制权返回给委托的构造函数，它的函数体也被执行。</li>
<li>最后，控制权返回给函数调用者。</li>
</ul>
<div class="admonition note">
<p class="admonition-title">关于委托构造函数的一些其他细节</p>
<ul>
<li>把初始化任务委托给其他构造函数的构造函数本身不能进行任何初始化。也就是说，一个构造函数要么自己初始化对象，要么委托给其他构造函数来初始化对象，不能两者兼有。</li>
<li>通常而言，我们会让参数较少的构造函数委托给参数较多的构造函数，这样我们就可以避免重复代码。</li>
<li>被委托的构造函数也可以把初始化任务委托给另一个构造函数，这样就形成了构造函数链。但是这有可能造成一个无限循环，因此我们应该避免这种情况。</li>
</ul>
</div>
<p>有时候我们也可以用默认值来将多个构造函数合并为一个，这样我们就不需要使用委托构造函数了。</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-172-1">1</a></span>
<span class="normal"><a href="#__codelineno-172-2">2</a></span>
<span class="normal"><a href="#__codelineno-172-3">3</a></span>
<span class="normal"><a href="#__codelineno-172-4">4</a></span>
<span class="normal"><a href="#__codelineno-172-5">5</a></span>
<span class="normal"><a href="#__codelineno-172-6">6</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-172-1" name="__codelineno-172-1"></a><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-172-2" name="__codelineno-172-2"></a><span class="w">    </span><span class="n">Employee</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">string_view</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="c1">// default argument for id</span>
<a id="__codelineno-172-3" name="__codelineno-172-3"></a><span class="w">        </span><span class="o">:</span><span class="w"> </span><span class="n">m_name</span><span class="p">{</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">m_id</span><span class="p">{</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-172-4" name="__codelineno-172-4"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-172-5" name="__codelineno-172-5"></a><span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"Employee "</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">m_name</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">" created</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
<a id="__codelineno-172-6" name="__codelineno-172-6"></a><span class="w">    </span><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>由于默认值只能从函数调用的最右边参数开始设置，因此我们应该在定义成员变量时先定义不带默认值的成员变量（使用者必须提供的参数），然后再定义带默认值的成员变量（使用者可选的参数）。</p>
<h4 id="_49">复制构造函数<a class="headerlink" href="#_49" title="Permanent link">¶</a></h4>
<p><strong>复制构造函数</strong>（copy constructor）是一种特殊的构造函数，它用一个现有的对象来初始化一个新对象。复制构造函数执行后，新创建的对象将是原对象的一个副本。</p>
<p>如果我们没有定义复制构造函数，编译器将为我们生成一个 public 的隐式复制构造函数，这个复制构造函数将依次复制每个成员变量。</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-173-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-173-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-173-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-173-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-173-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-173-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-173-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-173-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-173-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-173-10">10</a></span>
<span class="normal"><a href="#__codelineno-173-11">11</a></span>
<span class="normal"><a href="#__codelineno-173-12">12</a></span>
<span class="normal"><a href="#__codelineno-173-13">13</a></span>
<span class="normal"><a href="#__codelineno-173-14">14</a></span>
<span class="normal"><a href="#__codelineno-173-15">15</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-173-1" name="__codelineno-173-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">Foo</span>
<a id="__codelineno-173-2" name="__codelineno-173-2"></a><span class="p">{</span>
<a id="__codelineno-173-3" name="__codelineno-173-3"></a><span class="k">private</span><span class="o">:</span>
<a id="__codelineno-173-4" name="__codelineno-173-4"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">m_x</span><span class="w"> </span><span class="p">{</span><span class="mi">1</span><span class="p">};</span>
<a id="__codelineno-173-5" name="__codelineno-173-5"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">m_y</span><span class="w"> </span><span class="p">{</span><span class="mi">2</span><span class="p">};</span>
<a id="__codelineno-173-6" name="__codelineno-173-6"></a>
<a id="__codelineno-173-7" name="__codelineno-173-7"></a><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-173-8" name="__codelineno-173-8"></a><span class="w">    </span><span class="n">Foo</span><span class="p">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">default</span><span class="p">;</span><span class="w"> </span><span class="c1">// default constructor</span>
<a id="__codelineno-173-9" name="__codelineno-173-9"></a>
<a id="__codelineno-173-10" name="__codelineno-173-10"></a><span class="w">    </span><span class="n">Foo</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">Foo</span><span class="o">&amp;</span><span class="w"> </span><span class="n">foo</span><span class="p">)</span><span class="w"> </span><span class="c1">// copy constructor</span>
<a id="__codelineno-173-11" name="__codelineno-173-11"></a><span class="w">        </span><span class="o">:</span><span class="w"> </span><span class="n">m_x</span><span class="p">{</span><span class="n">foo</span><span class="p">.</span><span class="n">m_x</span><span class="p">},</span><span class="w"> </span><span class="n">m_y</span><span class="p">{</span><span class="n">foo</span><span class="p">.</span><span class="n">m_y</span><span class="p">}</span>
<a id="__codelineno-173-12" name="__codelineno-173-12"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-173-13" name="__codelineno-173-13"></a><span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"Foo copied</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
<a id="__codelineno-173-14" name="__codelineno-173-14"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-173-15" name="__codelineno-173-15"></a><span class="p">};</span>
</code></pre></div></td></tr></table></div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>在前面我们提到过，C++ 中的 private 和 public 是以类为单位的，而不是以对象为单位的。因此，复制构造函数可以访问同类的其他对象的私有成员，以便于我们进行复制。</p>
</div>
<p>一般而言，除了复制之外，复制构造函数不应该有任何其他的副作用，因为在某些情况下，编译器可以优化复制构造函数，如果我们加上了额外的副作用，就可能无法进行优化。</p>
<ul>
<li>一般而言，我们不需要自己去定义一个复制构造函数，使用隐式复制构造函数就足够了</li>
<li>如果我们需要自己定义一个复制构造函数，需要注意复制构造函数的参数是一个 const 引用</li>
<li>
<p>如果我们乐意，可以用 <code>= default</code> 来显式声明一个默认复制构造函数</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-174-1">1</a></span>
<span class="normal"><a href="#__codelineno-174-2">2</a></span>
<span class="normal"><a href="#__codelineno-174-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-174-1" name="__codelineno-174-1"></a><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-174-2" name="__codelineno-174-2"></a><span class="w">    </span><span class="c1">// Explicitly request default copy constructor</span>
<a id="__codelineno-174-3" name="__codelineno-174-3"></a><span class="w">    </span><span class="n">Foo</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">Foo</span><span class="o">&amp;</span><span class="w"> </span><span class="n">foo</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">default</span><span class="p">;</span>
</code></pre></div></td></tr></table></div>
</li>
<li>
<p>如果我们不希望一个类对象被复制，我们可以将复制构造函数声明为 <code>delete</code></p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-175-1">1</a></span>
<span class="normal"><a href="#__codelineno-175-2">2</a></span>
<span class="normal"><a href="#__codelineno-175-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-175-1" name="__codelineno-175-1"></a><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-175-2" name="__codelineno-175-2"></a><span class="w">    </span><span class="c1">// Prevent copying</span>
<a id="__codelineno-175-3" name="__codelineno-175-3"></a><span class="w">    </span><span class="n">Foo</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">Foo</span><span class="o">&amp;</span><span class="w"> </span><span class="n">foo</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">delete</span><span class="p">;</span>
</code></pre></div></td></tr></table></div>
</li>
</ul>
<div class="admonition property">
<p class="admonition-title">类的初始化</p>
<p>我们知道对于基本类型而言，有 6 种基本的初始化方式：</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-176-1">1</a></span>
<span class="normal"><a href="#__codelineno-176-2">2</a></span>
<span class="normal"><a href="#__codelineno-176-3">3</a></span>
<span class="normal"><a href="#__codelineno-176-4">4</a></span>
<span class="normal"><a href="#__codelineno-176-5">5</a></span>
<span class="normal"><a href="#__codelineno-176-6">6</a></span>
<span class="normal"><a href="#__codelineno-176-7">7</a></span>
<span class="normal"><a href="#__codelineno-176-8">8</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-176-1" name="__codelineno-176-1"></a><span class="kt">int</span><span class="w"> </span><span class="n">a</span><span class="p">;</span><span class="w">         </span><span class="c1">// default initialization</span>
<a id="__codelineno-176-2" name="__codelineno-176-2"></a><span class="kt">int</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span><span class="p">;</span><span class="w">     </span><span class="c1">// copy initialization</span>
<a id="__codelineno-176-3" name="__codelineno-176-3"></a><span class="kt">int</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="w"> </span><span class="mi">6</span><span class="w"> </span><span class="p">);</span><span class="w">    </span><span class="c1">// irect initialization</span>
<a id="__codelineno-176-4" name="__codelineno-176-4"></a>
<a id="__codelineno-176-5" name="__codelineno-176-5"></a><span class="c1">// List initialization methods (C++11)</span>
<a id="__codelineno-176-6" name="__codelineno-176-6"></a><span class="kt">int</span><span class="w"> </span><span class="n">d</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="mi">7</span><span class="w"> </span><span class="p">};</span><span class="w">   </span><span class="c1">// direct list initialization</span>
<a id="__codelineno-176-7" name="__codelineno-176-7"></a><span class="kt">int</span><span class="w"> </span><span class="n">e</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="mi">8</span><span class="w"> </span><span class="p">};</span><span class="w"> </span><span class="c1">// copy list initialization</span>
<a id="__codelineno-176-8" name="__codelineno-176-8"></a><span class="kt">int</span><span class="w"> </span><span class="n">f</span><span class="w"> </span><span class="p">{};</span><span class="w">      </span><span class="c1">// value initialization</span>
</code></pre></div></td></tr></table></div>
<p>而上面这些初始化方式对于类类型也是有效的：</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-177-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-177-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-177-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-177-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-177-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-177-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-177-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-177-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-177-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-177-10">10</a></span>
<span class="normal"><a href="#__codelineno-177-11">11</a></span>
<span class="normal"><a href="#__codelineno-177-12">12</a></span>
<span class="normal"><a href="#__codelineno-177-13">13</a></span>
<span class="normal"><a href="#__codelineno-177-14">14</a></span>
<span class="normal"><a href="#__codelineno-177-15">15</a></span>
<span class="normal"><a href="#__codelineno-177-16">16</a></span>
<span class="normal"><a href="#__codelineno-177-17">17</a></span>
<span class="normal"><a href="#__codelineno-177-18">18</a></span>
<span class="normal"><a href="#__codelineno-177-19">19</a></span>
<span class="normal"><a href="#__codelineno-177-20">20</a></span>
<span class="normal"><a href="#__codelineno-177-21">21</a></span>
<span class="normal"><a href="#__codelineno-177-22">22</a></span>
<span class="normal"><a href="#__codelineno-177-23">23</a></span>
<span class="normal"><a href="#__codelineno-177-24">24</a></span>
<span class="normal"><a href="#__codelineno-177-25">25</a></span>
<span class="normal"><a href="#__codelineno-177-26">26</a></span>
<span class="normal"><a href="#__codelineno-177-27">27</a></span>
<span class="normal"><a href="#__codelineno-177-28">28</a></span>
<span class="normal"><a href="#__codelineno-177-29">29</a></span>
<span class="normal"><a href="#__codelineno-177-30">30</a></span>
<span class="normal"><a href="#__codelineno-177-31">31</a></span>
<span class="normal"><a href="#__codelineno-177-32">32</a></span>
<span class="normal"><a href="#__codelineno-177-33">33</a></span>
<span class="normal"><a href="#__codelineno-177-34">34</a></span>
<span class="normal"><a href="#__codelineno-177-35">35</a></span>
<span class="normal"><a href="#__codelineno-177-36">36</a></span>
<span class="normal"><a href="#__codelineno-177-37">37</a></span>
<span class="normal"><a href="#__codelineno-177-38">38</a></span>
<span class="normal"><a href="#__codelineno-177-39">39</a></span>
<span class="normal"><a href="#__codelineno-177-40">40</a></span>
<span class="normal"><a href="#__codelineno-177-41">41</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-177-1" name="__codelineno-177-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span>
<a id="__codelineno-177-2" name="__codelineno-177-2"></a>
<a id="__codelineno-177-3" name="__codelineno-177-3"></a><span class="k">class</span><span class="w"> </span><span class="nc">Foo</span>
<a id="__codelineno-177-4" name="__codelineno-177-4"></a><span class="p">{</span>
<a id="__codelineno-177-5" name="__codelineno-177-5"></a><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-177-6" name="__codelineno-177-6"></a><span class="w">    </span><span class="c1">// Default constructor</span>
<a id="__codelineno-177-7" name="__codelineno-177-7"></a><span class="w">    </span><span class="n">Foo</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-177-8" name="__codelineno-177-8"></a><span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"Foo()</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
<a id="__codelineno-177-9" name="__codelineno-177-9"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-177-10" name="__codelineno-177-10"></a>
<a id="__codelineno-177-11" name="__codelineno-177-11"></a><span class="w">    </span><span class="c1">// Normal constructor</span>
<a id="__codelineno-177-12" name="__codelineno-177-12"></a><span class="w">    </span><span class="n">Foo</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-177-13" name="__codelineno-177-13"></a><span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"Foo(int) "</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="sc">'\n'</span><span class="p">;</span>
<a id="__codelineno-177-14" name="__codelineno-177-14"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-177-15" name="__codelineno-177-15"></a>
<a id="__codelineno-177-16" name="__codelineno-177-16"></a><span class="w">    </span><span class="c1">// Copy constructor</span>
<a id="__codelineno-177-17" name="__codelineno-177-17"></a><span class="w">    </span><span class="n">Foo</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">Foo</span><span class="o">&amp;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-177-18" name="__codelineno-177-18"></a><span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"Foo(const Foo&amp;)</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
<a id="__codelineno-177-19" name="__codelineno-177-19"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-177-20" name="__codelineno-177-20"></a><span class="p">};</span>
<a id="__codelineno-177-21" name="__codelineno-177-21"></a>
<a id="__codelineno-177-22" name="__codelineno-177-22"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span>
<a id="__codelineno-177-23" name="__codelineno-177-23"></a><span class="p">{</span>
<a id="__codelineno-177-24" name="__codelineno-177-24"></a><span class="w">    </span><span class="c1">// Calls Foo() default constructor</span>
<a id="__codelineno-177-25" name="__codelineno-177-25"></a><span class="w">    </span><span class="n">Foo</span><span class="w"> </span><span class="n">f1</span><span class="p">;</span><span class="w">           </span><span class="c1">// default initialization</span>
<a id="__codelineno-177-26" name="__codelineno-177-26"></a><span class="w">    </span><span class="n">Foo</span><span class="w"> </span><span class="n">f2</span><span class="p">{};</span><span class="w">         </span><span class="c1">// value initialization (preferred)</span>
<a id="__codelineno-177-27" name="__codelineno-177-27"></a>
<a id="__codelineno-177-28" name="__codelineno-177-28"></a><span class="w">    </span><span class="c1">// Calls foo(int) normal constructor</span>
<a id="__codelineno-177-29" name="__codelineno-177-29"></a><span class="w">    </span><span class="n">Foo</span><span class="w"> </span><span class="n">f3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="p">;</span><span class="w">       </span><span class="c1">// copy initialization</span>
<a id="__codelineno-177-30" name="__codelineno-177-30"></a><span class="w">    </span><span class="n">Foo</span><span class="w"> </span><span class="n">f4</span><span class="p">(</span><span class="mi">4</span><span class="p">);</span><span class="w">        </span><span class="c1">// direct initialization</span>
<a id="__codelineno-177-31" name="__codelineno-177-31"></a><span class="w">    </span><span class="n">Foo</span><span class="w"> </span><span class="n">f5</span><span class="p">{</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="p">};</span><span class="w">      </span><span class="c1">// direct list initialization (preferred)</span>
<a id="__codelineno-177-32" name="__codelineno-177-32"></a><span class="w">    </span><span class="n">Foo</span><span class="w"> </span><span class="n">f6</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="mi">6</span><span class="w"> </span><span class="p">};</span><span class="w">   </span><span class="c1">// copy list initialization </span>
<a id="__codelineno-177-33" name="__codelineno-177-33"></a>
<a id="__codelineno-177-34" name="__codelineno-177-34"></a><span class="w">    </span><span class="c1">// Calls foo(const Foo&amp;) copy constructor</span>
<a id="__codelineno-177-35" name="__codelineno-177-35"></a><span class="w">    </span><span class="n">Foo</span><span class="w"> </span><span class="n">f7</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">f3</span><span class="p">;</span><span class="w">      </span><span class="c1">// copy initialization</span>
<a id="__codelineno-177-36" name="__codelineno-177-36"></a><span class="w">    </span><span class="n">Foo</span><span class="w"> </span><span class="n">f8</span><span class="p">(</span><span class="n">f3</span><span class="p">);</span><span class="w">       </span><span class="c1">// direct initialization</span>
<a id="__codelineno-177-37" name="__codelineno-177-37"></a><span class="w">    </span><span class="n">Foo</span><span class="w"> </span><span class="n">f9</span><span class="p">{</span><span class="w"> </span><span class="n">f3</span><span class="w"> </span><span class="p">};</span><span class="w">     </span><span class="c1">// direct list initialization (preferred)</span>
<a id="__codelineno-177-38" name="__codelineno-177-38"></a><span class="w">    </span><span class="n">Foo</span><span class="w"> </span><span class="n">f10</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">f3</span><span class="w"> </span><span class="p">};</span><span class="w"> </span><span class="c1">// copy list initialization</span>
<a id="__codelineno-177-39" name="__codelineno-177-39"></a>
<a id="__codelineno-177-40" name="__codelineno-177-40"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-177-41" name="__codelineno-177-41"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
</div>
<details class="extra">
<summary>复制省略</summary>
<p>考虑一个简单的程序</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-178-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-178-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-178-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-178-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-178-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-178-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-178-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-178-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-178-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-178-10">10</a></span>
<span class="normal"><a href="#__codelineno-178-11">11</a></span>
<span class="normal"><a href="#__codelineno-178-12">12</a></span>
<span class="normal"><a href="#__codelineno-178-13">13</a></span>
<span class="normal"><a href="#__codelineno-178-14">14</a></span>
<span class="normal"><a href="#__codelineno-178-15">15</a></span>
<span class="normal"><a href="#__codelineno-178-16">16</a></span>
<span class="normal"><a href="#__codelineno-178-17">17</a></span>
<span class="normal"><a href="#__codelineno-178-18">18</a></span>
<span class="normal"><a href="#__codelineno-178-19">19</a></span>
<span class="normal"><a href="#__codelineno-178-20">20</a></span>
<span class="normal"><a href="#__codelineno-178-21">21</a></span>
<span class="normal"><a href="#__codelineno-178-22">22</a></span>
<span class="normal"><a href="#__codelineno-178-23">23</a></span>
<span class="normal"><a href="#__codelineno-178-24">24</a></span>
<span class="normal"><a href="#__codelineno-178-25">25</a></span>
<span class="normal"><a href="#__codelineno-178-26">26</a></span>
<span class="normal"><a href="#__codelineno-178-27">27</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-178-1" name="__codelineno-178-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span>
<a id="__codelineno-178-2" name="__codelineno-178-2"></a>
<a id="__codelineno-178-3" name="__codelineno-178-3"></a><span class="k">class</span><span class="w"> </span><span class="nc">Something</span>
<a id="__codelineno-178-4" name="__codelineno-178-4"></a><span class="p">{</span>
<a id="__codelineno-178-5" name="__codelineno-178-5"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">m_x</span><span class="p">{};</span>
<a id="__codelineno-178-6" name="__codelineno-178-6"></a>
<a id="__codelineno-178-7" name="__codelineno-178-7"></a><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-178-8" name="__codelineno-178-8"></a><span class="w">    </span><span class="n">Something</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">)</span>
<a id="__codelineno-178-9" name="__codelineno-178-9"></a><span class="w">        </span><span class="o">:</span><span class="w"> </span><span class="n">m_x</span><span class="p">{</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-178-10" name="__codelineno-178-10"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-178-11" name="__codelineno-178-11"></a><span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"Normal constructor</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
<a id="__codelineno-178-12" name="__codelineno-178-12"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-178-13" name="__codelineno-178-13"></a>
<a id="__codelineno-178-14" name="__codelineno-178-14"></a><span class="w">    </span><span class="n">Something</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">Something</span><span class="o">&amp;</span><span class="w"> </span><span class="n">s</span><span class="p">)</span>
<a id="__codelineno-178-15" name="__codelineno-178-15"></a><span class="w">        </span><span class="o">:</span><span class="w"> </span><span class="n">m_x</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">s</span><span class="p">.</span><span class="n">m_x</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-178-16" name="__codelineno-178-16"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-178-17" name="__codelineno-178-17"></a><span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"Copy constructor</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
<a id="__codelineno-178-18" name="__codelineno-178-18"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-178-19" name="__codelineno-178-19"></a>
<a id="__codelineno-178-20" name="__codelineno-178-20"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">print</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"Something("</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">m_x</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">")</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-178-21" name="__codelineno-178-21"></a><span class="p">};</span>
<a id="__codelineno-178-22" name="__codelineno-178-22"></a>
<a id="__codelineno-178-23" name="__codelineno-178-23"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span>
<a id="__codelineno-178-24" name="__codelineno-178-24"></a><span class="p">{</span>
<a id="__codelineno-178-25" name="__codelineno-178-25"></a><span class="w">    </span><span class="n">Something</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">Something</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">};</span><span class="w"> </span><span class="c1">// focus on this line</span>
<a id="__codelineno-178-26" name="__codelineno-178-26"></a><span class="w">    </span><span class="n">s</span><span class="p">.</span><span class="n">print</span><span class="p">();</span>
<a id="__codelineno-178-27" name="__codelineno-178-27"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>在上面变量 <code>s</code> 的初始化中，我们首先构建了一个用 <code>5</code> 来初始化的临时的 <code>Something</code> 对象，然后用这个临时对象来初始化 <code>s</code>，最后调用 <code>s.print()</code>。</p>
<p>在没有任何优化的情况下，上述程序的输出结果应该是</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-179-1">1</a></span>
<span class="normal"><a href="#__codelineno-179-2">2</a></span>
<span class="normal"><a href="#__codelineno-179-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-179-1" name="__codelineno-179-1"></a>Normal constructor
<a id="__codelineno-179-2" name="__codelineno-179-2"></a>Copy constructor
<a id="__codelineno-179-3" name="__codelineno-179-3"></a>Something(5)
</code></pre></div></td></tr></table></div>
<p>但由于编译器可以对重写代码以进行优化，我们可以很自然地猜想编译器是否可以优化掉不必要的对象副本，答案是肯定的。在本人的测试中，输出结果是</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-180-1">1</a></span>
<span class="normal"><a href="#__codelineno-180-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-180-1" name="__codelineno-180-1"></a>Normal constructor
<a id="__codelineno-180-2" name="__codelineno-180-2"></a>Something(5)
</code></pre></div></td></tr></table></div>
<p>上面的优化称为<strong>复制省略</strong>（copy elision），它是 C++ 标准的一部分，允许编译器在某些情况下省略复制构造函数的调用。</p>
<p>这也是我们在编写复制构造函数时应该避免引入副作用的原因之一：当编译器把复制构造函数优化掉时，它的副作用将不会被执行。</p>
<div class="admonition info">
<p class="admonition-title">强制复制省略（C++17）</p>
<p>在 C++17 之前，复制省略是编译器可选的一个优化；但在 C++17 中，在某些情况下即使我们已经明确告知编译器不要执行复制省略，复制省略也会被强制执行。</p>
</div>
</details>
<h4 id="_50">转换构造函数<a class="headerlink" href="#_50" title="Permanent link">¶</a></h4>
<p>我们知道，当调用函数时传入函数的参数类型和函数声明中的参数类型不匹配时，编译器会尝试进行隐式类型转换。考虑下面这个例子</p>
<details class="example" open="open">
<summary>Example</summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-181-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-181-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-181-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-181-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-181-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-181-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-181-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-181-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-181-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-181-10">10</a></span>
<span class="normal"><a href="#__codelineno-181-11">11</a></span>
<span class="normal"><a href="#__codelineno-181-12">12</a></span>
<span class="normal"><a href="#__codelineno-181-13">13</a></span>
<span class="normal"><a href="#__codelineno-181-14">14</a></span>
<span class="normal"><a href="#__codelineno-181-15">15</a></span>
<span class="normal"><a href="#__codelineno-181-16">16</a></span>
<span class="normal"><a href="#__codelineno-181-17">17</a></span>
<span class="normal"><a href="#__codelineno-181-18">18</a></span>
<span class="normal"><a href="#__codelineno-181-19">19</a></span>
<span class="normal"><a href="#__codelineno-181-20">20</a></span>
<span class="normal"><a href="#__codelineno-181-21">21</a></span>
<span class="normal"><a href="#__codelineno-181-22">22</a></span>
<span class="normal"><a href="#__codelineno-181-23">23</a></span>
<span class="normal"><a href="#__codelineno-181-24">24</a></span>
<span class="normal"><a href="#__codelineno-181-25">25</a></span>
<span class="normal"><a href="#__codelineno-181-26">26</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-181-1" name="__codelineno-181-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span>
<a id="__codelineno-181-2" name="__codelineno-181-2"></a>
<a id="__codelineno-181-3" name="__codelineno-181-3"></a><span class="k">class</span><span class="w"> </span><span class="nc">Foo</span>
<a id="__codelineno-181-4" name="__codelineno-181-4"></a><span class="p">{</span>
<a id="__codelineno-181-5" name="__codelineno-181-5"></a><span class="k">private</span><span class="o">:</span>
<a id="__codelineno-181-6" name="__codelineno-181-6"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">m_x</span><span class="p">{};</span>
<a id="__codelineno-181-7" name="__codelineno-181-7"></a><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-181-8" name="__codelineno-181-8"></a><span class="w">    </span><span class="n">Foo</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">)</span>
<a id="__codelineno-181-9" name="__codelineno-181-9"></a><span class="w">        </span><span class="o">:</span><span class="w"> </span><span class="n">m_x</span><span class="p">{</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-181-10" name="__codelineno-181-10"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-181-11" name="__codelineno-181-11"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-181-12" name="__codelineno-181-12"></a>
<a id="__codelineno-181-13" name="__codelineno-181-13"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">getX</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">m_x</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-181-14" name="__codelineno-181-14"></a><span class="p">};</span>
<a id="__codelineno-181-15" name="__codelineno-181-15"></a>
<a id="__codelineno-181-16" name="__codelineno-181-16"></a><span class="kt">void</span><span class="w"> </span><span class="nf">printFoo</span><span class="p">(</span><span class="n">Foo</span><span class="w"> </span><span class="n">f</span><span class="p">)</span><span class="w"> </span><span class="c1">// has a Foo parameter</span>
<a id="__codelineno-181-17" name="__codelineno-181-17"></a><span class="p">{</span>
<a id="__codelineno-181-18" name="__codelineno-181-18"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">f</span><span class="p">.</span><span class="n">getX</span><span class="p">();</span>
<a id="__codelineno-181-19" name="__codelineno-181-19"></a><span class="p">}</span>
<a id="__codelineno-181-20" name="__codelineno-181-20"></a>
<a id="__codelineno-181-21" name="__codelineno-181-21"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span>
<a id="__codelineno-181-22" name="__codelineno-181-22"></a><span class="p">{</span>
<a id="__codelineno-181-23" name="__codelineno-181-23"></a><span class="w">    </span><span class="n">printFoo</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span><span class="w"> </span><span class="c1">// we're supplying an int argument</span>
<a id="__codelineno-181-24" name="__codelineno-181-24"></a>
<a id="__codelineno-181-25" name="__codelineno-181-25"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-181-26" name="__codelineno-181-26"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
</details>
<p>在这里我们给 <code>printFoo</code> 传入的参数是 <code>int</code>，但函数需要的是一个 <code>Foo</code> 对象，编译器将尝试把 <code>int</code> 转换为 <code>Foo</code> 对象。这种转换是通过 <code>Foo</code> 的构造函数 <code>Foo(int x)</code> 来完成的，它相当于把一个 <code>int</code> 参数转换为了一个 <code>Foo</code> 对象。这种可用于执行隐式转换的构造函数称为<strong>转换构造函数</strong>（converting constructor）。</p>
<p>有时候我们不希望一个函数只能调用一个类对象而不能发生隐式类型转换，这时我们可以在构造函数前面加上 <code>explicit</code> 关键字，这样这个构造函数就不能用于隐式类型转换了。</p>
<details class="example" open="open">
<summary>Example</summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-182-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-182-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-182-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-182-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-182-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-182-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-182-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-182-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-182-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-182-10">10</a></span>
<span class="normal"><a href="#__codelineno-182-11">11</a></span>
<span class="normal"><a href="#__codelineno-182-12">12</a></span>
<span class="normal"><a href="#__codelineno-182-13">13</a></span>
<span class="normal"><a href="#__codelineno-182-14">14</a></span>
<span class="normal"><a href="#__codelineno-182-15">15</a></span>
<span class="normal"><a href="#__codelineno-182-16">16</a></span>
<span class="normal"><a href="#__codelineno-182-17">17</a></span>
<span class="normal"><a href="#__codelineno-182-18">18</a></span>
<span class="normal"><a href="#__codelineno-182-19">19</a></span>
<span class="normal"><a href="#__codelineno-182-20">20</a></span>
<span class="normal"><a href="#__codelineno-182-21">21</a></span>
<span class="normal"><a href="#__codelineno-182-22">22</a></span>
<span class="normal"><a href="#__codelineno-182-23">23</a></span>
<span class="normal"><a href="#__codelineno-182-24">24</a></span>
<span class="normal"><a href="#__codelineno-182-25">25</a></span>
<span class="normal"><a href="#__codelineno-182-26">26</a></span>
<span class="normal"><a href="#__codelineno-182-27">27</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-182-1" name="__codelineno-182-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span>
<a id="__codelineno-182-2" name="__codelineno-182-2"></a>
<a id="__codelineno-182-3" name="__codelineno-182-3"></a><span class="k">class</span><span class="w"> </span><span class="nc">Dollars</span>
<a id="__codelineno-182-4" name="__codelineno-182-4"></a><span class="p">{</span>
<a id="__codelineno-182-5" name="__codelineno-182-5"></a><span class="k">private</span><span class="o">:</span>
<a id="__codelineno-182-6" name="__codelineno-182-6"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">m_dollars</span><span class="p">{};</span>
<a id="__codelineno-182-7" name="__codelineno-182-7"></a>
<a id="__codelineno-182-8" name="__codelineno-182-8"></a><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-182-9" name="__codelineno-182-9"></a><span class="w">    </span><span class="n">Dollars</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">d</span><span class="p">)</span>
<a id="__codelineno-182-10" name="__codelineno-182-10"></a><span class="w">        </span><span class="o">:</span><span class="w"> </span><span class="n">m_dollars</span><span class="p">{</span><span class="w"> </span><span class="n">d</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-182-11" name="__codelineno-182-11"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-182-12" name="__codelineno-182-12"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-182-13" name="__codelineno-182-13"></a>
<a id="__codelineno-182-14" name="__codelineno-182-14"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">getDollars</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">m_dollars</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-182-15" name="__codelineno-182-15"></a><span class="p">};</span>
<a id="__codelineno-182-16" name="__codelineno-182-16"></a>
<a id="__codelineno-182-17" name="__codelineno-182-17"></a><span class="kt">void</span><span class="w"> </span><span class="nf">print</span><span class="p">(</span><span class="n">Dollars</span><span class="w"> </span><span class="n">d</span><span class="p">)</span>
<a id="__codelineno-182-18" name="__codelineno-182-18"></a><span class="p">{</span>
<a id="__codelineno-182-19" name="__codelineno-182-19"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"$"</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">d</span><span class="p">.</span><span class="n">getDollars</span><span class="p">();</span>
<a id="__codelineno-182-20" name="__codelineno-182-20"></a><span class="p">}</span>
<a id="__codelineno-182-21" name="__codelineno-182-21"></a>
<a id="__codelineno-182-22" name="__codelineno-182-22"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span>
<a id="__codelineno-182-23" name="__codelineno-182-23"></a><span class="p">{</span>
<a id="__codelineno-182-24" name="__codelineno-182-24"></a><span class="w">    </span><span class="n">print</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span>
<a id="__codelineno-182-25" name="__codelineno-182-25"></a>
<a id="__codelineno-182-26" name="__codelineno-182-26"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-182-27" name="__codelineno-182-27"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>在这里我们调用<code>print(5)</code>时，<code>Dollars(int)</code>转换构造函数将会把 <code>5</code> 转换为一个 <code>Dollars</code> 对象，然后传递给 <code>print</code> 函数。这段程序的输出结果是 <code>$5</code>。</p>
</details>
<p>给这个例子中的构造函数加上 <code>explicit</code> 关键字后，编译器将不再允许隐式类型转换，这时我们必须显式地给函数传入一个 <code>Dollars</code> 对象。</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-183-1">1</a></span>
<span class="normal"><a href="#__codelineno-183-2">2</a></span>
<span class="normal"><a href="#__codelineno-183-3">3</a></span>
<span class="normal"><a href="#__codelineno-183-4">4</a></span>
<span class="normal"><a href="#__codelineno-183-5">5</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-183-1" name="__codelineno-183-1"></a><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-183-2" name="__codelineno-183-2"></a><span class="w">    </span><span class="k">explicit</span><span class="w"> </span><span class="n">Dollars</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">d</span><span class="p">)</span><span class="w"> </span><span class="c1">// now explicit</span>
<a id="__codelineno-183-3" name="__codelineno-183-3"></a><span class="w">        </span><span class="o">:</span><span class="w"> </span><span class="n">m_dollars</span><span class="p">{</span><span class="w"> </span><span class="n">d</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-183-4" name="__codelineno-183-4"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-183-5" name="__codelineno-183-5"></a><span class="w">    </span><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>explicit 构造函数不能用于复制初始化或复制列表初始化</li>
<li>explicit 构造函数不能用于进行隐式转换（因为这实际上会使用复制初始化或复制列表初始化）</li>
</ul>
<div class="admonition note">
<p class="admonition-title">何时使用 explicit 关键字</p>
<ul>
<li>一般情况下，任何接受单个参数的构造函数都应该是 <code>explicit</code> 的，包括参数列表只有一个参数的构造函数和有多个参数但其他参数都有默认值的构造函数。</li>
<li>不需要使复制构造函数和移动构造函数 explicit，因为它们通常不会执行类型转换。</li>
</ul>
</div>
<h3 id="this">this 关键字<a class="headerlink" href="#this" title="Permanent link">¶</a></h3>
<p>在每一个成员函数内部，都隐含着一个关键字 <code>this</code>，它是一个 const 指针，隐式地保存着当前正在被操作的对象的地址。</p>
<h4 id="this_1">this 是被如何设置的<a class="headerlink" href="#this_1" title="Permanent link">¶</a></h4>
<p>考虑一个简单的类</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-184-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-184-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-184-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-184-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-184-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-184-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-184-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-184-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-184-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-184-10">10</a></span>
<span class="normal"><a href="#__codelineno-184-11">11</a></span>
<span class="normal"><a href="#__codelineno-184-12">12</a></span>
<span class="normal"><a href="#__codelineno-184-13">13</a></span>
<span class="normal"><a href="#__codelineno-184-14">14</a></span>
<span class="normal"><a href="#__codelineno-184-15">15</a></span>
<span class="normal"><a href="#__codelineno-184-16">16</a></span>
<span class="normal"><a href="#__codelineno-184-17">17</a></span>
<span class="normal"><a href="#__codelineno-184-18">18</a></span>
<span class="normal"><a href="#__codelineno-184-19">19</a></span>
<span class="normal"><a href="#__codelineno-184-20">20</a></span>
<span class="normal"><a href="#__codelineno-184-21">21</a></span>
<span class="normal"><a href="#__codelineno-184-22">22</a></span>
<span class="normal"><a href="#__codelineno-184-23">23</a></span>
<span class="normal"><a href="#__codelineno-184-24">24</a></span>
<span class="normal"><a href="#__codelineno-184-25">25</a></span>
<span class="normal"><a href="#__codelineno-184-26">26</a></span>
<span class="normal"><a href="#__codelineno-184-27">27</a></span>
<span class="normal"><a href="#__codelineno-184-28">28</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-184-1" name="__codelineno-184-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span>
<a id="__codelineno-184-2" name="__codelineno-184-2"></a>
<a id="__codelineno-184-3" name="__codelineno-184-3"></a><span class="k">class</span><span class="w"> </span><span class="nc">Simple</span>
<a id="__codelineno-184-4" name="__codelineno-184-4"></a><span class="p">{</span>
<a id="__codelineno-184-5" name="__codelineno-184-5"></a><span class="k">private</span><span class="o">:</span>
<a id="__codelineno-184-6" name="__codelineno-184-6"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">m_id</span><span class="p">{};</span>
<a id="__codelineno-184-7" name="__codelineno-184-7"></a>
<a id="__codelineno-184-8" name="__codelineno-184-8"></a><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-184-9" name="__codelineno-184-9"></a><span class="w">    </span><span class="n">Simple</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">id</span><span class="p">)</span>
<a id="__codelineno-184-10" name="__codelineno-184-10"></a><span class="w">        </span><span class="o">:</span><span class="w"> </span><span class="n">m_id</span><span class="p">{</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-184-11" name="__codelineno-184-11"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-184-12" name="__codelineno-184-12"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-184-13" name="__codelineno-184-13"></a>
<a id="__codelineno-184-14" name="__codelineno-184-14"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">getID</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">m_id</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-184-15" name="__codelineno-184-15"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">setID</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">id</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">m_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">id</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-184-16" name="__codelineno-184-16"></a>
<a id="__codelineno-184-17" name="__codelineno-184-17"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">print</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">m_id</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-184-18" name="__codelineno-184-18"></a><span class="p">};</span>
<a id="__codelineno-184-19" name="__codelineno-184-19"></a>
<a id="__codelineno-184-20" name="__codelineno-184-20"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span>
<a id="__codelineno-184-21" name="__codelineno-184-21"></a><span class="p">{</span>
<a id="__codelineno-184-22" name="__codelineno-184-22"></a><span class="w">    </span><span class="n">Simple</span><span class="w"> </span><span class="n">simple</span><span class="p">{</span><span class="mi">1</span><span class="p">};</span>
<a id="__codelineno-184-23" name="__codelineno-184-23"></a><span class="w">    </span><span class="n">simple</span><span class="p">.</span><span class="n">setID</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
<a id="__codelineno-184-24" name="__codelineno-184-24"></a>
<a id="__codelineno-184-25" name="__codelineno-184-25"></a><span class="w">    </span><span class="n">simple</span><span class="p">.</span><span class="n">print</span><span class="p">();</span>
<a id="__codelineno-184-26" name="__codelineno-184-26"></a>
<a id="__codelineno-184-27" name="__codelineno-184-27"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-184-28" name="__codelineno-184-28"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>在这里我们并没有使用 <code>this</code> 关键字，但对于 <code>print()</code> 函数而言，下面两种写法是完全相同的，区别仅在于一个显式地使用了 <code>this</code> 关键字，而另一个没有。</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-185-1">1</a></span>
<span class="normal"><a href="#__codelineno-185-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-185-1" name="__codelineno-185-1"></a><span class="kt">void</span><span class="w"> </span><span class="nf">print</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">m_id</span><span class="p">;</span><span class="w"> </span><span class="p">}</span><span class="w"> </span>
<a id="__codelineno-185-2" name="__codelineno-185-2"></a><span class="kt">void</span><span class="w"> </span><span class="nf">print</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="k">this</span><span class="o">-&gt;</span><span class="n">m_id</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>当我们进行函数调用 <code>simple.setID(2);</code> 时，看起来我们只传入了一个参数，但实际上编译器会把这个函数重写为</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-186-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-186-1" name="__codelineno-186-1"></a><span class="n">Simple</span><span class="o">::</span><span class="n">setID</span><span class="p">(</span><span class="o">&amp;</span><span class="n">simple</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">);</span>
</code></pre></div></td></tr></table></div>
<p>除此之外，编译器还会把函数的实现重写为</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-187-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-187-1" name="__codelineno-187-1"></a><span class="k">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setID</span><span class="p">(</span><span class="n">Simple</span><span class="o">*</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">id</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">this</span><span class="o">-&gt;</span><span class="n">m_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">id</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>在我的笔记中，你会发现大部分时候我都没有使用 this 指针，一般而言，在函数参数和成员变量具有相同的名称时，<code>this-&gt;</code> 可以用于区分两者。但因为我通常会使用 <code>m_</code> 前缀来区分成员变量，因此我很少使用 <code>this-&gt;</code>。</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-188-1">1</a></span>
<span class="normal"><a href="#__codelineno-188-2">2</a></span>
<span class="normal"><a href="#__codelineno-188-3">3</a></span>
<span class="normal"><a href="#__codelineno-188-4">4</a></span>
<span class="normal"><a href="#__codelineno-188-5">5</a></span>
<span class="normal"><a href="#__codelineno-188-6">6</a></span>
<span class="normal"><a href="#__codelineno-188-7">7</a></span>
<span class="normal"><a href="#__codelineno-188-8">8</a></span>
<span class="normal"><a href="#__codelineno-188-9">9</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-188-1" name="__codelineno-188-1"></a><span class="k">struct</span><span class="w"> </span><span class="nc">Something</span>
<a id="__codelineno-188-2" name="__codelineno-188-2"></a><span class="p">{</span>
<a id="__codelineno-188-3" name="__codelineno-188-3"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">data</span><span class="p">{};</span><span class="w"> </span><span class="c1">// not using m_ prefix because this is a struct</span>
<a id="__codelineno-188-4" name="__codelineno-188-4"></a>
<a id="__codelineno-188-5" name="__codelineno-188-5"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">setData</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">data</span><span class="p">)</span>
<a id="__codelineno-188-6" name="__codelineno-188-6"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-188-7" name="__codelineno-188-7"></a><span class="w">        </span><span class="k">this</span><span class="o">-&gt;</span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">data</span><span class="p">;</span><span class="w"> </span><span class="c1">// this-&gt;data is the member, data is the local parameter</span>
<a id="__codelineno-188-8" name="__codelineno-188-8"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-188-9" name="__codelineno-188-9"></a><span class="p">};</span>
</code></pre></div></td></tr></table></div>
</div>
<h4 id="this_2">函数返回 <code>*this</code><a class="headerlink" href="#this_2" title="Permanent link">¶</a></h4>
<p>有时，让成员函数把正在调用的对象作为返回值返回相当有用，因为这允许我们把多个成员函数“链接”在一起，这样我们就可以在一个表达式中调用多个成员函数。这被称为<strong>函数链</strong>（function chaining），或<strong>方法链</strong>（method chaining）。</p>
<p>考虑下面这个类 <code>Calc</code> 的定义</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-189-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-189-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-189-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-189-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-189-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-189-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-189-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-189-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-189-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-189-10">10</a></span>
<span class="normal"><a href="#__codelineno-189-11">11</a></span>
<span class="normal"><a href="#__codelineno-189-12">12</a></span>
<span class="normal"><a href="#__codelineno-189-13">13</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-189-1" name="__codelineno-189-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">Calc</span>
<a id="__codelineno-189-2" name="__codelineno-189-2"></a><span class="p">{</span>
<a id="__codelineno-189-3" name="__codelineno-189-3"></a><span class="k">private</span><span class="o">:</span>
<a id="__codelineno-189-4" name="__codelineno-189-4"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">m_value</span><span class="p">{};</span>
<a id="__codelineno-189-5" name="__codelineno-189-5"></a>
<a id="__codelineno-189-6" name="__codelineno-189-6"></a><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-189-7" name="__codelineno-189-7"></a>
<a id="__codelineno-189-8" name="__codelineno-189-8"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">add</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">value</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">m_value</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">value</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-189-9" name="__codelineno-189-9"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">sub</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">value</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">m_value</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="n">value</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-189-10" name="__codelineno-189-10"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">mult</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">value</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">m_value</span><span class="w"> </span><span class="o">*=</span><span class="w"> </span><span class="n">value</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-189-11" name="__codelineno-189-11"></a>
<a id="__codelineno-189-12" name="__codelineno-189-12"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">getValue</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">m_value</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-189-13" name="__codelineno-189-13"></a><span class="p">};</span>
</code></pre></div></td></tr></table></div>
<p>如果我们想要先加 5，再减 3，然后乘以 4，就必须</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-190-1">1</a></span>
<span class="normal"><a href="#__codelineno-190-2">2</a></span>
<span class="normal"><a href="#__codelineno-190-3">3</a></span>
<span class="normal"><a href="#__codelineno-190-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-190-1" name="__codelineno-190-1"></a><span class="n">Calc</span><span class="w"> </span><span class="n">calc</span><span class="p">{};</span>
<a id="__codelineno-190-2" name="__codelineno-190-2"></a><span class="n">calc</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span>
<a id="__codelineno-190-3" name="__codelineno-190-3"></a><span class="n">calc</span><span class="p">.</span><span class="n">sub</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span>
<a id="__codelineno-190-4" name="__codelineno-190-4"></a><span class="n">calc</span><span class="p">.</span><span class="n">mult</span><span class="p">(</span><span class="mi">4</span><span class="p">);</span>
</code></pre></div></td></tr></table></div>
<p>但如果我们让每个成员函数都按引用返回 <code>*this</code>，就可以把这三个操作链接起来</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-191-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-191-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-191-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-191-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-191-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-191-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-191-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-191-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-191-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-191-10">10</a></span>
<span class="normal"><a href="#__codelineno-191-11">11</a></span>
<span class="normal"><a href="#__codelineno-191-12">12</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-191-1" name="__codelineno-191-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">Calc</span>
<a id="__codelineno-191-2" name="__codelineno-191-2"></a><span class="p">{</span>
<a id="__codelineno-191-3" name="__codelineno-191-3"></a><span class="k">private</span><span class="o">:</span>
<a id="__codelineno-191-4" name="__codelineno-191-4"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">m_value</span><span class="p">{};</span>
<a id="__codelineno-191-5" name="__codelineno-191-5"></a>
<a id="__codelineno-191-6" name="__codelineno-191-6"></a><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-191-7" name="__codelineno-191-7"></a><span class="w">    </span><span class="n">Calc</span><span class="o">&amp;</span><span class="w"> </span><span class="n">add</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">value</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">m_value</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">value</span><span class="p">;</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="o">*</span><span class="k">this</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-191-8" name="__codelineno-191-8"></a><span class="w">    </span><span class="n">Calc</span><span class="o">&amp;</span><span class="w"> </span><span class="n">sub</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">value</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">m_value</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="n">value</span><span class="p">;</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="o">*</span><span class="k">this</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-191-9" name="__codelineno-191-9"></a><span class="w">    </span><span class="n">Calc</span><span class="o">&amp;</span><span class="w"> </span><span class="n">mult</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">value</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">m_value</span><span class="w"> </span><span class="o">*=</span><span class="w"> </span><span class="n">value</span><span class="p">;</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="o">*</span><span class="k">this</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-191-10" name="__codelineno-191-10"></a>
<a id="__codelineno-191-11" name="__codelineno-191-11"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">getValue</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">m_value</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-191-12" name="__codelineno-191-12"></a><span class="p">};</span>
</code></pre></div></td></tr></table></div>
<p>只需要一个表达式就可以完成这三个操作</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-192-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-192-1" name="__codelineno-192-1"></a><span class="n">calc</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="mi">5</span><span class="p">).</span><span class="n">sub</span><span class="p">(</span><span class="mi">3</span><span class="p">).</span><span class="n">mult</span><span class="p">(</span><span class="mi">4</span><span class="p">);</span>
</code></pre></div></td></tr></table></div>
<div class="admonition note">
<p class="admonition-title">把类重置回默认状态</p>
<p>如果我们定义的类有一个默认构造函数，那么有时候我们有把类变成默认状态的需要，这时候就可以定义一个 <code>reset</code> 成员函数，</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-193-1">1</a></span>
<span class="normal"><a href="#__codelineno-193-2">2</a></span>
<span class="normal"><a href="#__codelineno-193-3">3</a></span>
<span class="normal"><a href="#__codelineno-193-4">4</a></span>
<span class="normal"><a href="#__codelineno-193-5">5</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-193-1" name="__codelineno-193-1"></a><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-193-2" name="__codelineno-193-2"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">reset</span><span class="p">()</span>
<a id="__codelineno-193-3" name="__codelineno-193-3"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-193-4" name="__codelineno-193-4"></a><span class="w">        </span><span class="o">*</span><span class="k">this</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{};</span>
<a id="__codelineno-193-5" name="__codelineno-193-5"></a><span class="w">    </span><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>这样我们就可以在链式调用中插入 <code>reset</code> 函数</p>
</div>
<div class="admonition info">
<p class="admonition-title">Info</p>
<ul>
<li>对于非 const 成员函数而言，<code>this</code> 是一个指向非 const 对象的 const 指针：<code>this</code> 不能指向其他对象，但可以通过 <code>this</code> 来修改对象的值。</li>
<li>对于 const 成员函数而言，<code>this</code> 是一个指向 const 对象的 const 指针：<code>this</code> 不能指向其他对象，也不能通过 <code>this</code> 来修改对象的值。</li>
</ul>
</div>
<h3 id="_51">析构函数<a class="headerlink" href="#_51" title="Permanent link">¶</a></h3>
<p>构造函数是在创建一个非聚合的类类型对象时用于初始化成员变量，并执行一些其他设置任务的特殊的成员函数。与之相对的是<strong>析构函数</strong>（destructor），它是在对象被销毁时执行的特殊成员函数。</p>
<p>当一个非聚合的类类型对象将要被销毁时，析构函数将会被自动调用，它的任务是在对象被销毁前执行一些必要的清理工作。</p>
<div class="admonition note">
<p class="admonition-title">析构函数的命名规则</p>
<p>析构函数也有自己特定的命名规则</p>
<ul>
<li>析构函数的名称必须是波浪号（tilde）<code>~</code> 后面跟着类名（也可以理解为构造函数名的前面加上一个波浪号）</li>
<li>析构函数没有参数，也没有返回值</li>
</ul>
</div>
<ul>
<li>一个类只能有一个析构函数</li>
<li>通常而言，我们不应该显式地调用析构函数，因为这可能会导致清理工作被多次执行，从而导致未定义行为</li>
<li>析构函数可以安全地调用其他成员函数，因为直到析构函数执行完毕后对象才会被销毁</li>
</ul>
<details class="example">
<summary>一个析构函数的简单例子</summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-194-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-194-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-194-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-194-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-194-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-194-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-194-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-194-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-194-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-194-10">10</a></span>
<span class="normal"><a href="#__codelineno-194-11">11</a></span>
<span class="normal"><a href="#__codelineno-194-12">12</a></span>
<span class="normal"><a href="#__codelineno-194-13">13</a></span>
<span class="normal"><a href="#__codelineno-194-14">14</a></span>
<span class="normal"><a href="#__codelineno-194-15">15</a></span>
<span class="normal"><a href="#__codelineno-194-16">16</a></span>
<span class="normal"><a href="#__codelineno-194-17">17</a></span>
<span class="normal"><a href="#__codelineno-194-18">18</a></span>
<span class="normal"><a href="#__codelineno-194-19">19</a></span>
<span class="normal"><a href="#__codelineno-194-20">20</a></span>
<span class="normal"><a href="#__codelineno-194-21">21</a></span>
<span class="normal"><a href="#__codelineno-194-22">22</a></span>
<span class="normal"><a href="#__codelineno-194-23">23</a></span>
<span class="normal"><a href="#__codelineno-194-24">24</a></span>
<span class="normal"><a href="#__codelineno-194-25">25</a></span>
<span class="normal"><a href="#__codelineno-194-26">26</a></span>
<span class="normal"><a href="#__codelineno-194-27">27</a></span>
<span class="normal"><a href="#__codelineno-194-28">28</a></span>
<span class="normal"><a href="#__codelineno-194-29">29</a></span>
<span class="normal"><a href="#__codelineno-194-30">30</a></span>
<span class="normal"><a href="#__codelineno-194-31">31</a></span>
<span class="normal"><a href="#__codelineno-194-32">32</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-194-1" name="__codelineno-194-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span>
<a id="__codelineno-194-2" name="__codelineno-194-2"></a>
<a id="__codelineno-194-3" name="__codelineno-194-3"></a><span class="k">class</span><span class="w"> </span><span class="nc">Simple</span>
<a id="__codelineno-194-4" name="__codelineno-194-4"></a><span class="p">{</span>
<a id="__codelineno-194-5" name="__codelineno-194-5"></a><span class="k">private</span><span class="o">:</span>
<a id="__codelineno-194-6" name="__codelineno-194-6"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">m_id</span><span class="w"> </span><span class="p">{};</span>
<a id="__codelineno-194-7" name="__codelineno-194-7"></a>
<a id="__codelineno-194-8" name="__codelineno-194-8"></a><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-194-9" name="__codelineno-194-9"></a><span class="w">    </span><span class="n">Simple</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">id</span><span class="p">)</span>
<a id="__codelineno-194-10" name="__codelineno-194-10"></a><span class="w">        </span><span class="o">:</span><span class="w"> </span><span class="n">m_id</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-194-11" name="__codelineno-194-11"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-194-12" name="__codelineno-194-12"></a><span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"Constructing Simple "</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">m_id</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="sc">'\n'</span><span class="p">;</span>
<a id="__codelineno-194-13" name="__codelineno-194-13"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-194-14" name="__codelineno-194-14"></a>
<a id="__codelineno-194-15" name="__codelineno-194-15"></a><span class="w">    </span><span class="o">~</span><span class="n">Simple</span><span class="p">()</span><span class="w"> </span><span class="c1">// here's our destructor</span>
<a id="__codelineno-194-16" name="__codelineno-194-16"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-194-17" name="__codelineno-194-17"></a><span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"Destructing Simple "</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">m_id</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="sc">'\n'</span><span class="p">;</span>
<a id="__codelineno-194-18" name="__codelineno-194-18"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-194-19" name="__codelineno-194-19"></a>
<a id="__codelineno-194-20" name="__codelineno-194-20"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">getID</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">m_id</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-194-21" name="__codelineno-194-21"></a><span class="p">};</span>
<a id="__codelineno-194-22" name="__codelineno-194-22"></a>
<a id="__codelineno-194-23" name="__codelineno-194-23"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span>
<a id="__codelineno-194-24" name="__codelineno-194-24"></a><span class="p">{</span>
<a id="__codelineno-194-25" name="__codelineno-194-25"></a><span class="w">    </span><span class="c1">// Allocate a Simple</span>
<a id="__codelineno-194-26" name="__codelineno-194-26"></a><span class="w">    </span><span class="n">Simple</span><span class="w"> </span><span class="n">simple1</span><span class="p">{</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">};</span>
<a id="__codelineno-194-27" name="__codelineno-194-27"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-194-28" name="__codelineno-194-28"></a><span class="w">        </span><span class="n">Simple</span><span class="w"> </span><span class="n">simple2</span><span class="p">{</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">};</span>
<a id="__codelineno-194-29" name="__codelineno-194-29"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="c1">// simple2 dies here</span>
<a id="__codelineno-194-30" name="__codelineno-194-30"></a>
<a id="__codelineno-194-31" name="__codelineno-194-31"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-194-32" name="__codelineno-194-32"></a><span class="p">}</span><span class="w"> </span><span class="c1">// simple1 dies here</span>
</code></pre></div></td></tr></table></div>
<p>这段程序的输出结果是</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-195-1">1</a></span>
<span class="normal"><a href="#__codelineno-195-2">2</a></span>
<span class="normal"><a href="#__codelineno-195-3">3</a></span>
<span class="normal"><a href="#__codelineno-195-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-195-1" name="__codelineno-195-1"></a>Constructing Simple 1
<a id="__codelineno-195-2" name="__codelineno-195-2"></a>Constructing Simple 2
<a id="__codelineno-195-3" name="__codelineno-195-3"></a>Destructing Simple 2
<a id="__codelineno-195-4" name="__codelineno-195-4"></a>Destructing Simple 1
</code></pre></div></td></tr></table></div>
</details>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>如果一个类没有定义析构函数，编译器将为它生成一个隐式析构函数，这个析构函数的函数体是空的，也就是说，它不会执行任何清理工作，相当于一个占位符。</p>
<p>如果一个类不需要在被销毁时进行任何清理工作，我们可以不定义析构函数，让编译器为我们生成一个隐式析构函数。</p>
</div>
<details class="example">
<summary>使用析构函数释放资源</summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-196-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-196-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-196-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-196-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-196-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-196-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-196-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-196-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-196-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-196-10">10</a></span>
<span class="normal"><a href="#__codelineno-196-11">11</a></span>
<span class="normal"><a href="#__codelineno-196-12">12</a></span>
<span class="normal"><a href="#__codelineno-196-13">13</a></span>
<span class="normal"><a href="#__codelineno-196-14">14</a></span>
<span class="normal"><a href="#__codelineno-196-15">15</a></span>
<span class="normal"><a href="#__codelineno-196-16">16</a></span>
<span class="normal"><a href="#__codelineno-196-17">17</a></span>
<span class="normal"><a href="#__codelineno-196-18">18</a></span>
<span class="normal"><a href="#__codelineno-196-19">19</a></span>
<span class="normal"><a href="#__codelineno-196-20">20</a></span>
<span class="normal"><a href="#__codelineno-196-21">21</a></span>
<span class="normal"><a href="#__codelineno-196-22">22</a></span>
<span class="normal"><a href="#__codelineno-196-23">23</a></span>
<span class="normal"><a href="#__codelineno-196-24">24</a></span>
<span class="normal"><a href="#__codelineno-196-25">25</a></span>
<span class="normal"><a href="#__codelineno-196-26">26</a></span>
<span class="normal"><a href="#__codelineno-196-27">27</a></span>
<span class="normal"><a href="#__codelineno-196-28">28</a></span>
<span class="normal"><a href="#__codelineno-196-29">29</a></span>
<span class="normal"><a href="#__codelineno-196-30">30</a></span>
<span class="normal"><a href="#__codelineno-196-31">31</a></span>
<span class="normal"><a href="#__codelineno-196-32">32</a></span>
<span class="normal"><a href="#__codelineno-196-33">33</a></span>
<span class="normal"><a href="#__codelineno-196-34">34</a></span>
<span class="normal"><a href="#__codelineno-196-35">35</a></span>
<span class="normal"><a href="#__codelineno-196-36">36</a></span>
<span class="normal"><a href="#__codelineno-196-37">37</a></span>
<span class="normal"><a href="#__codelineno-196-38">38</a></span>
<span class="normal"><a href="#__codelineno-196-39">39</a></span>
<span class="normal"><a href="#__codelineno-196-40">40</a></span>
<span class="normal"><a href="#__codelineno-196-41">41</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-196-1" name="__codelineno-196-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span>
<a id="__codelineno-196-2" name="__codelineno-196-2"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;cassert&gt;</span>
<a id="__codelineno-196-3" name="__codelineno-196-3"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;cstddef&gt;</span>
<a id="__codelineno-196-4" name="__codelineno-196-4"></a>
<a id="__codelineno-196-5" name="__codelineno-196-5"></a><span class="k">class</span><span class="w"> </span><span class="nc">IntArray</span>
<a id="__codelineno-196-6" name="__codelineno-196-6"></a><span class="p">{</span>
<a id="__codelineno-196-7" name="__codelineno-196-7"></a><span class="k">private</span><span class="o">:</span>
<a id="__codelineno-196-8" name="__codelineno-196-8"></a><span class="w">    </span><span class="kt">int</span><span class="o">*</span><span class="w"> </span><span class="n">m_array</span><span class="p">{};</span>
<a id="__codelineno-196-9" name="__codelineno-196-9"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">m_length</span><span class="p">{};</span>
<a id="__codelineno-196-10" name="__codelineno-196-10"></a>
<a id="__codelineno-196-11" name="__codelineno-196-11"></a><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-196-12" name="__codelineno-196-12"></a><span class="w">    </span><span class="n">IntArray</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">length</span><span class="p">)</span><span class="w"> </span><span class="c1">// constructor</span>
<a id="__codelineno-196-13" name="__codelineno-196-13"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-196-14" name="__codelineno-196-14"></a><span class="w">        </span><span class="n">assert</span><span class="p">(</span><span class="n">length</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
<a id="__codelineno-196-15" name="__codelineno-196-15"></a>
<a id="__codelineno-196-16" name="__codelineno-196-16"></a><span class="w">        </span><span class="n">m_array</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="kt">int</span><span class="p">[</span><span class="k">static_cast</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="kt">size_t</span><span class="o">&gt;</span><span class="p">(</span><span class="n">length</span><span class="p">)]{};</span>
<a id="__codelineno-196-17" name="__codelineno-196-17"></a><span class="w">        </span><span class="n">m_length</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">length</span><span class="p">;</span>
<a id="__codelineno-196-18" name="__codelineno-196-18"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-196-19" name="__codelineno-196-19"></a>
<a id="__codelineno-196-20" name="__codelineno-196-20"></a><span class="w">    </span><span class="o">~</span><span class="n">IntArray</span><span class="p">()</span><span class="w"> </span><span class="c1">// destructor</span>
<a id="__codelineno-196-21" name="__codelineno-196-21"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-196-22" name="__codelineno-196-22"></a><span class="w">        </span><span class="c1">// Dynamically delete the array we allocated earlier</span>
<a id="__codelineno-196-23" name="__codelineno-196-23"></a><span class="w">        </span><span class="k">delete</span><span class="p">[]</span><span class="w"> </span><span class="n">m_array</span><span class="p">;</span>
<a id="__codelineno-196-24" name="__codelineno-196-24"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-196-25" name="__codelineno-196-25"></a>
<a id="__codelineno-196-26" name="__codelineno-196-26"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">setValue</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">index</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">value</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">m_array</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">value</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-196-27" name="__codelineno-196-27"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">getValue</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">index</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">m_array</span><span class="p">[</span><span class="n">index</span><span class="p">];</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-196-28" name="__codelineno-196-28"></a>
<a id="__codelineno-196-29" name="__codelineno-196-29"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">getLength</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">m_length</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-196-30" name="__codelineno-196-30"></a><span class="p">};</span>
<a id="__codelineno-196-31" name="__codelineno-196-31"></a>
<a id="__codelineno-196-32" name="__codelineno-196-32"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span>
<a id="__codelineno-196-33" name="__codelineno-196-33"></a><span class="p">{</span>
<a id="__codelineno-196-34" name="__codelineno-196-34"></a><span class="w">    </span><span class="n">IntArray</span><span class="w"> </span><span class="n">ar</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="mi">10</span><span class="w"> </span><span class="p">);</span><span class="w"> </span><span class="c1">// allocate 10 integers</span>
<a id="__codelineno-196-35" name="__codelineno-196-35"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">count</span><span class="p">{</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">};</span><span class="w"> </span><span class="n">count</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">ar</span><span class="p">.</span><span class="n">getLength</span><span class="p">();</span><span class="w"> </span><span class="o">++</span><span class="n">count</span><span class="p">)</span>
<a id="__codelineno-196-36" name="__codelineno-196-36"></a><span class="w">        </span><span class="n">ar</span><span class="p">.</span><span class="n">setValue</span><span class="p">(</span><span class="n">count</span><span class="p">,</span><span class="w"> </span><span class="n">count</span><span class="o">+</span><span class="mi">1</span><span class="p">);</span>
<a id="__codelineno-196-37" name="__codelineno-196-37"></a>
<a id="__codelineno-196-38" name="__codelineno-196-38"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"The value of element 5 is: "</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">ar</span><span class="p">.</span><span class="n">getValue</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="sc">'\n'</span><span class="p">;</span>
<a id="__codelineno-196-39" name="__codelineno-196-39"></a>
<a id="__codelineno-196-40" name="__codelineno-196-40"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-196-41" name="__codelineno-196-41"></a><span class="p">}</span><span class="w"> </span><span class="c1">// the ~IntArray() destructor function is called here</span>
</code></pre></div></td></tr></table></div>
<p>这段程序的输出结果是</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-197-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-197-1" name="__codelineno-197-1"></a>The value of element 5 is: 6
</code></pre></div></td></tr></table></div>
<p>这个例子中我们在构造函数中使用 <code>new</code> 关键字为 <code>m_array</code> 动态分配了一块内存，假如我们没有使用 <code>delete[]</code> 来手动释放这块内存的话，当对象被销毁时，这块内存将永远无法被释放，将产生内存泄漏。</p>
<p>而我们通过在析构函数中使用 <code>delete[]</code> 来释放这块内存，解决了这个隐患。</p>
<ul>
<li>如果我们的类对象持有资源（如内存、文件句柄、数据库句柄等），我们通常需要手动释放这些资源，在析构函数中释放资源是一个很好的选择。</li>
</ul>
</details>
<h3 id="_52">友元函数和友元类<a class="headerlink" href="#_52" title="Permanent link">¶</a></h3>
<p>在类的定义中，我们可以使用 <code>friend</code> 关键字来告诉编译器现在其他的类或函数是当前这个类的友元。在 C++ 中，<strong>友元</strong>（friend）是一种访问控制机制，它授予一个类或函数访问另一个类的私有（private）或受保护（protected）成员的权限。</p>
<ul>
<li>友元声明不受访问控制权限的限制，因此可以出现在类的任何一个位置。</li>
</ul>
<details class="example">
<summary>友谊是魔法</summary>
<p>考虑我们已经拥有了一个由于管理某些数据的储存类，现在我们希望也能够展示这些数据，我们可以直接在现有的储存类上添加一些展示数据的函数，但这样会让类的接口变得相当复杂；我们也可以额外创建一个展示类来展示数据，但显示类无法访问储存类的私有成员。</p>
<p>结合上面的分析，我们希望的是展示类能够在特定情况下无视储存类的访问控制权限，这时我们就可以让展示类成为储存类的友元，这样它就能无阻地直接访问储存类的所有成员，以便于展示数据。</p>
</details>
<h4 id="_53">友元非成员函数<a class="headerlink" href="#_53" title="Permanent link">¶</a></h4>
<p>友元函数是可以访问特定类的私有和受保护成员的函数（可能是成员函数或非成员函数）。我们可以在类的定义中使用 <code>friend</code> 关键字来声明一个友元函数，以告知编译器这个函数是当前类的友元。</p>
<details class="example" open="open">
<summary>Example</summary>
<div class="tabbed-set tabbed-alternate" data-tabs="3:2"><input checked="checked" id="__tabbed_3_1" name="__tabbed_3" type="radio"><input id="__tabbed_3_2" name="__tabbed_3" type="radio"><div class="tabbed-labels"><label for="__tabbed_3_1">在类外定义友元非成员函数</label><label for="__tabbed_3_2">在类内定义友元非成员函数</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-198-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-198-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-198-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-198-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-198-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-198-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-198-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-198-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-198-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-198-10">10</a></span>
<span class="normal"><a href="#__codelineno-198-11">11</a></span>
<span class="normal"><a href="#__codelineno-198-12">12</a></span>
<span class="normal"><a href="#__codelineno-198-13">13</a></span>
<span class="normal"><a href="#__codelineno-198-14">14</a></span>
<span class="normal"><a href="#__codelineno-198-15">15</a></span>
<span class="normal"><a href="#__codelineno-198-16">16</a></span>
<span class="normal"><a href="#__codelineno-198-17">17</a></span>
<span class="normal"><a href="#__codelineno-198-18">18</a></span>
<span class="normal"><a href="#__codelineno-198-19">19</a></span>
<span class="normal"><a href="#__codelineno-198-20">20</a></span>
<span class="normal"><a href="#__codelineno-198-21">21</a></span>
<span class="normal"><a href="#__codelineno-198-22">22</a></span>
<span class="normal"><a href="#__codelineno-198-23">23</a></span>
<span class="normal"><a href="#__codelineno-198-24">24</a></span>
<span class="normal"><a href="#__codelineno-198-25">25</a></span>
<span class="normal"><a href="#__codelineno-198-26">26</a></span>
<span class="normal"><a href="#__codelineno-198-27">27</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-198-1" name="__codelineno-198-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span>
<a id="__codelineno-198-2" name="__codelineno-198-2"></a>
<a id="__codelineno-198-3" name="__codelineno-198-3"></a><span class="k">class</span><span class="w"> </span><span class="nc">Accumulator</span>
<a id="__codelineno-198-4" name="__codelineno-198-4"></a><span class="p">{</span>
<a id="__codelineno-198-5" name="__codelineno-198-5"></a><span class="k">private</span><span class="o">:</span>
<a id="__codelineno-198-6" name="__codelineno-198-6"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">m_value</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">};</span>
<a id="__codelineno-198-7" name="__codelineno-198-7"></a>
<a id="__codelineno-198-8" name="__codelineno-198-8"></a><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-198-9" name="__codelineno-198-9"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">add</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">value</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">m_value</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">value</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-198-10" name="__codelineno-198-10"></a>
<a id="__codelineno-198-11" name="__codelineno-198-11"></a><span class="w">    </span><span class="k">friend</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="n">print</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">Accumulator</span><span class="o">&amp;</span><span class="w"> </span><span class="n">accumulator</span><span class="p">);</span>
<a id="__codelineno-198-12" name="__codelineno-198-12"></a><span class="p">};</span>
<a id="__codelineno-198-13" name="__codelineno-198-13"></a>
<a id="__codelineno-198-14" name="__codelineno-198-14"></a><span class="kt">void</span><span class="w"> </span><span class="nf">print</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">Accumulator</span><span class="o">&amp;</span><span class="w"> </span><span class="n">accumulator</span><span class="p">)</span>
<a id="__codelineno-198-15" name="__codelineno-198-15"></a><span class="p">{</span>
<a id="__codelineno-198-16" name="__codelineno-198-16"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">accumulator</span><span class="p">.</span><span class="n">m_value</span><span class="p">;</span>
<a id="__codelineno-198-17" name="__codelineno-198-17"></a><span class="p">}</span>
<a id="__codelineno-198-18" name="__codelineno-198-18"></a>
<a id="__codelineno-198-19" name="__codelineno-198-19"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span>
<a id="__codelineno-198-20" name="__codelineno-198-20"></a><span class="p">{</span>
<a id="__codelineno-198-21" name="__codelineno-198-21"></a><span class="w">    </span><span class="n">Accumulator</span><span class="w"> </span><span class="n">acc</span><span class="p">{};</span>
<a id="__codelineno-198-22" name="__codelineno-198-22"></a><span class="w">    </span><span class="n">acc</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span><span class="w"> </span><span class="c1">// add 5 to the accumulator</span>
<a id="__codelineno-198-23" name="__codelineno-198-23"></a>
<a id="__codelineno-198-24" name="__codelineno-198-24"></a><span class="w">    </span><span class="n">print</span><span class="p">(</span><span class="n">acc</span><span class="p">);</span><span class="w"> </span><span class="c1">// call the print() non-member function</span>
<a id="__codelineno-198-25" name="__codelineno-198-25"></a>
<a id="__codelineno-198-26" name="__codelineno-198-26"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-198-27" name="__codelineno-198-27"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>由于 <code>print()</code> 是一个非成员函数（没有隐式对象），因此我们必须显式地传入一个 <code>Accumulator</code> 对象。</p>
</div>
<div class="tabbed-block">
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-199-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-199-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-199-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-199-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-199-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-199-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-199-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-199-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-199-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-199-10">10</a></span>
<span class="normal"><a href="#__codelineno-199-11">11</a></span>
<span class="normal"><a href="#__codelineno-199-12">12</a></span>
<span class="normal"><a href="#__codelineno-199-13">13</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-199-1" name="__codelineno-199-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">Accumulator</span>
<a id="__codelineno-199-2" name="__codelineno-199-2"></a><span class="p">{</span>
<a id="__codelineno-199-3" name="__codelineno-199-3"></a><span class="k">private</span><span class="o">:</span>
<a id="__codelineno-199-4" name="__codelineno-199-4"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">m_value</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">};</span>
<a id="__codelineno-199-5" name="__codelineno-199-5"></a>
<a id="__codelineno-199-6" name="__codelineno-199-6"></a><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-199-7" name="__codelineno-199-7"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">add</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">value</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">m_value</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">value</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-199-8" name="__codelineno-199-8"></a>
<a id="__codelineno-199-9" name="__codelineno-199-9"></a><span class="w">    </span><span class="k">friend</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="n">print</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">Accumulator</span><span class="o">&amp;</span><span class="w"> </span><span class="n">accumulator</span><span class="p">)</span>
<a id="__codelineno-199-10" name="__codelineno-199-10"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-199-11" name="__codelineno-199-11"></a><span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">accumulator</span><span class="p">.</span><span class="n">m_value</span><span class="p">;</span>
<a id="__codelineno-199-12" name="__codelineno-199-12"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-199-13" name="__codelineno-199-13"></a><span class="p">};</span>
</code></pre></div></td></tr></table></div>
<p>虽然这里的 <code>print()</code> 函数定义在类内，但它被 <code>friend</code> 关键字定义为友元，因此它被视为一个非成员函数，就好像是在<code>Accumulator</code>外部定义的一样。</p>
</div>
</div>
</input></input></div>
</details>
<details class="property" open="open">
<summary>多重友元</summary>
<p>一个函数可以同时成为多个类的友元，例如下面这个例子</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-200-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-200-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-200-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-200-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-200-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-200-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-200-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-200-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-200-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-200-10">10</a></span>
<span class="normal"><a href="#__codelineno-200-11">11</a></span>
<span class="normal"><a href="#__codelineno-200-12">12</a></span>
<span class="normal"><a href="#__codelineno-200-13">13</a></span>
<span class="normal"><a href="#__codelineno-200-14">14</a></span>
<span class="normal"><a href="#__codelineno-200-15">15</a></span>
<span class="normal"><a href="#__codelineno-200-16">16</a></span>
<span class="normal"><a href="#__codelineno-200-17">17</a></span>
<span class="normal"><a href="#__codelineno-200-18">18</a></span>
<span class="normal"><a href="#__codelineno-200-19">19</a></span>
<span class="normal"><a href="#__codelineno-200-20">20</a></span>
<span class="normal"><a href="#__codelineno-200-21">21</a></span>
<span class="normal"><a href="#__codelineno-200-22">22</a></span>
<span class="normal"><a href="#__codelineno-200-23">23</a></span>
<span class="normal"><a href="#__codelineno-200-24">24</a></span>
<span class="normal"><a href="#__codelineno-200-25">25</a></span>
<span class="normal"><a href="#__codelineno-200-26">26</a></span>
<span class="normal"><a href="#__codelineno-200-27">27</a></span>
<span class="normal"><a href="#__codelineno-200-28">28</a></span>
<span class="normal"><a href="#__codelineno-200-29">29</a></span>
<span class="normal"><a href="#__codelineno-200-30">30</a></span>
<span class="normal"><a href="#__codelineno-200-31">31</a></span>
<span class="normal"><a href="#__codelineno-200-32">32</a></span>
<span class="normal"><a href="#__codelineno-200-33">33</a></span>
<span class="normal"><a href="#__codelineno-200-34">34</a></span>
<span class="normal"><a href="#__codelineno-200-35">35</a></span>
<span class="normal"><a href="#__codelineno-200-36">36</a></span>
<span class="normal"><a href="#__codelineno-200-37">37</a></span>
<span class="normal"><a href="#__codelineno-200-38">38</a></span>
<span class="normal"><a href="#__codelineno-200-39">39</a></span>
<span class="normal"><a href="#__codelineno-200-40">40</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-200-1" name="__codelineno-200-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span>
<a id="__codelineno-200-2" name="__codelineno-200-2"></a>
<a id="__codelineno-200-3" name="__codelineno-200-3"></a><span class="k">class</span><span class="w"> </span><span class="nc">Humidity</span><span class="p">;</span><span class="w"> </span><span class="c1">// forward declaration of Humidity</span>
<a id="__codelineno-200-4" name="__codelineno-200-4"></a>
<a id="__codelineno-200-5" name="__codelineno-200-5"></a><span class="k">class</span><span class="w"> </span><span class="nc">Temperature</span>
<a id="__codelineno-200-6" name="__codelineno-200-6"></a><span class="p">{</span>
<a id="__codelineno-200-7" name="__codelineno-200-7"></a><span class="k">private</span><span class="o">:</span>
<a id="__codelineno-200-8" name="__codelineno-200-8"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">m_temp</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">};</span>
<a id="__codelineno-200-9" name="__codelineno-200-9"></a><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-200-10" name="__codelineno-200-10"></a><span class="w">    </span><span class="k">explicit</span><span class="w"> </span><span class="n">Temperature</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">temp</span><span class="p">)</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">m_temp</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">temp</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-200-11" name="__codelineno-200-11"></a>
<a id="__codelineno-200-12" name="__codelineno-200-12"></a><span class="w">    </span><span class="c1">// forward declaration needed for this line</span>
<a id="__codelineno-200-13" name="__codelineno-200-13"></a><span class="w">    </span><span class="k">friend</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="n">printWeather</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">Temperature</span><span class="o">&amp;</span><span class="w"> </span><span class="n">temperature</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">Humidity</span><span class="o">&amp;</span><span class="w"> </span><span class="n">humidity</span><span class="p">);</span><span class="w"> </span>
<a id="__codelineno-200-14" name="__codelineno-200-14"></a><span class="p">};</span>
<a id="__codelineno-200-15" name="__codelineno-200-15"></a>
<a id="__codelineno-200-16" name="__codelineno-200-16"></a><span class="k">class</span><span class="w"> </span><span class="nc">Humidity</span>
<a id="__codelineno-200-17" name="__codelineno-200-17"></a><span class="p">{</span>
<a id="__codelineno-200-18" name="__codelineno-200-18"></a><span class="k">private</span><span class="o">:</span>
<a id="__codelineno-200-19" name="__codelineno-200-19"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">m_humidity</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">};</span>
<a id="__codelineno-200-20" name="__codelineno-200-20"></a><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-200-21" name="__codelineno-200-21"></a><span class="w">    </span><span class="k">explicit</span><span class="w"> </span><span class="n">Humidity</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">humidity</span><span class="p">)</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">m_humidity</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">humidity</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">{</span><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-200-22" name="__codelineno-200-22"></a>
<a id="__codelineno-200-23" name="__codelineno-200-23"></a><span class="w">    </span><span class="k">friend</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="n">printWeather</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">Temperature</span><span class="o">&amp;</span><span class="w"> </span><span class="n">temperature</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">Humidity</span><span class="o">&amp;</span><span class="w"> </span><span class="n">humidity</span><span class="p">);</span>
<a id="__codelineno-200-24" name="__codelineno-200-24"></a><span class="p">};</span>
<a id="__codelineno-200-25" name="__codelineno-200-25"></a>
<a id="__codelineno-200-26" name="__codelineno-200-26"></a><span class="kt">void</span><span class="w"> </span><span class="nf">printWeather</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">Temperature</span><span class="o">&amp;</span><span class="w"> </span><span class="n">temperature</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">Humidity</span><span class="o">&amp;</span><span class="w"> </span><span class="n">humidity</span><span class="p">)</span>
<a id="__codelineno-200-27" name="__codelineno-200-27"></a><span class="p">{</span>
<a id="__codelineno-200-28" name="__codelineno-200-28"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"The temperature is "</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">temperature</span><span class="p">.</span><span class="n">m_temp</span><span class="w"> </span><span class="o">&lt;&lt;</span>
<a id="__codelineno-200-29" name="__codelineno-200-29"></a><span class="w">    </span><span class="s">" and the humidity is "</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">humidity</span><span class="p">.</span><span class="n">m_humidity</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="sc">'\n'</span><span class="p">;</span><span class="w">  </span>
<a id="__codelineno-200-30" name="__codelineno-200-30"></a><span class="p">}</span>
<a id="__codelineno-200-31" name="__codelineno-200-31"></a>
<a id="__codelineno-200-32" name="__codelineno-200-32"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span>
<a id="__codelineno-200-33" name="__codelineno-200-33"></a><span class="p">{</span>
<a id="__codelineno-200-34" name="__codelineno-200-34"></a><span class="w">    </span><span class="n">Humidity</span><span class="w"> </span><span class="n">hum</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="mi">10</span><span class="w"> </span><span class="p">};</span>
<a id="__codelineno-200-35" name="__codelineno-200-35"></a><span class="w">    </span><span class="n">Temperature</span><span class="w"> </span><span class="n">temp</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="mi">12</span><span class="w"> </span><span class="p">};</span>
<a id="__codelineno-200-36" name="__codelineno-200-36"></a>
<a id="__codelineno-200-37" name="__codelineno-200-37"></a><span class="w">    </span><span class="n">printWeather</span><span class="p">(</span><span class="n">temp</span><span class="p">,</span><span class="w"> </span><span class="n">hum</span><span class="p">);</span>
<a id="__codelineno-200-38" name="__codelineno-200-38"></a>
<a id="__codelineno-200-39" name="__codelineno-200-39"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-200-40" name="__codelineno-200-40"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>这里的 <code>printWeather()</code> 函数同时是 <code>Temperature</code> 和 <code>Humidity</code> 的友元，因此它可以访问这两个类的私有成员。</li>
<li>注意到在这个例子的顶部有一个类 <code>Humidity</code> 的前向声明，这是因为  <code>printWeather()</code> 出现在 <code>Humidity</code> 的完整定义之前，如果我们没有前向声明会使编译器在 <code>Temperature</code> 类中对函数进行解析时找不到 <code>Humidity</code> 类。</li>
</ul>
</details>
<p>从可维护性的角度来看，友元函数在可能的情况下最好使用类接口来访问类的私有成员，而非直接访问。这是因为一个类可能有多个友元函数，如果它们全都是直接访问类的私有成员，那么当类的私有成员发生变化时，我们就需要修改所有的友元函数，这会增加代码的维护成本。</p>
<h4 id="_54">友元类<a class="headerlink" href="#_54" title="Permanent link">¶</a></h4>
<p><strong>友元类</strong>（friend class）是一个可以任意访问其他类的任何成员的类。</p>
<details class="example">
<summary>Example</summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-201-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-201-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-201-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-201-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-201-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-201-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-201-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-201-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-201-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-201-10">10</a></span>
<span class="normal"><a href="#__codelineno-201-11">11</a></span>
<span class="normal"><a href="#__codelineno-201-12">12</a></span>
<span class="normal"><a href="#__codelineno-201-13">13</a></span>
<span class="normal"><a href="#__codelineno-201-14">14</a></span>
<span class="normal"><a href="#__codelineno-201-15">15</a></span>
<span class="normal"><a href="#__codelineno-201-16">16</a></span>
<span class="normal"><a href="#__codelineno-201-17">17</a></span>
<span class="normal"><a href="#__codelineno-201-18">18</a></span>
<span class="normal"><a href="#__codelineno-201-19">19</a></span>
<span class="normal"><a href="#__codelineno-201-20">20</a></span>
<span class="normal"><a href="#__codelineno-201-21">21</a></span>
<span class="normal"><a href="#__codelineno-201-22">22</a></span>
<span class="normal"><a href="#__codelineno-201-23">23</a></span>
<span class="normal"><a href="#__codelineno-201-24">24</a></span>
<span class="normal"><a href="#__codelineno-201-25">25</a></span>
<span class="normal"><a href="#__codelineno-201-26">26</a></span>
<span class="normal"><a href="#__codelineno-201-27">27</a></span>
<span class="normal"><a href="#__codelineno-201-28">28</a></span>
<span class="normal"><a href="#__codelineno-201-29">29</a></span>
<span class="normal"><a href="#__codelineno-201-30">30</a></span>
<span class="normal"><a href="#__codelineno-201-31">31</a></span>
<span class="normal"><a href="#__codelineno-201-32">32</a></span>
<span class="normal"><a href="#__codelineno-201-33">33</a></span>
<span class="normal"><a href="#__codelineno-201-34">34</a></span>
<span class="normal"><a href="#__codelineno-201-35">35</a></span>
<span class="normal"><a href="#__codelineno-201-36">36</a></span>
<span class="normal"><a href="#__codelineno-201-37">37</a></span>
<span class="normal"><a href="#__codelineno-201-38">38</a></span>
<span class="normal"><a href="#__codelineno-201-39">39</a></span>
<span class="normal"><a href="#__codelineno-201-40">40</a></span>
<span class="normal"><a href="#__codelineno-201-41">41</a></span>
<span class="normal"><a href="#__codelineno-201-42">42</a></span>
<span class="normal"><a href="#__codelineno-201-43">43</a></span>
<span class="normal"><a href="#__codelineno-201-44">44</a></span>
<span class="normal"><a href="#__codelineno-201-45">45</a></span>
<span class="normal"><a href="#__codelineno-201-46">46</a></span>
<span class="normal"><a href="#__codelineno-201-47">47</a></span>
<span class="normal"><a href="#__codelineno-201-48">48</a></span>
<span class="normal"><a href="#__codelineno-201-49">49</a></span>
<span class="normal"><a href="#__codelineno-201-50">50</a></span>
<span class="normal"><a href="#__codelineno-201-51">51</a></span>
<span class="normal"><a href="#__codelineno-201-52">52</a></span>
<span class="normal"><a href="#__codelineno-201-53">53</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-201-1" name="__codelineno-201-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span>
<a id="__codelineno-201-2" name="__codelineno-201-2"></a>
<a id="__codelineno-201-3" name="__codelineno-201-3"></a><span class="k">class</span><span class="w"> </span><span class="nc">Storage</span>
<a id="__codelineno-201-4" name="__codelineno-201-4"></a><span class="p">{</span>
<a id="__codelineno-201-5" name="__codelineno-201-5"></a><span class="k">private</span><span class="o">:</span>
<a id="__codelineno-201-6" name="__codelineno-201-6"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">m_nValue</span><span class="w"> </span><span class="p">{};</span>
<a id="__codelineno-201-7" name="__codelineno-201-7"></a><span class="w">    </span><span class="kt">double</span><span class="w"> </span><span class="n">m_dValue</span><span class="w"> </span><span class="p">{};</span>
<a id="__codelineno-201-8" name="__codelineno-201-8"></a><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-201-9" name="__codelineno-201-9"></a><span class="w">    </span><span class="n">Storage</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">nValue</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">dValue</span><span class="p">)</span>
<a id="__codelineno-201-10" name="__codelineno-201-10"></a><span class="w">    </span><span class="o">:</span><span class="w"> </span><span class="n">m_nValue</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">nValue</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">m_dValue</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">dValue</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-201-11" name="__codelineno-201-11"></a><span class="w">    </span><span class="p">{</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-201-12" name="__codelineno-201-12"></a>
<a id="__codelineno-201-13" name="__codelineno-201-13"></a><span class="w">    </span><span class="c1">// Make the Display class a friend of Storage</span>
<a id="__codelineno-201-14" name="__codelineno-201-14"></a><span class="w">    </span><span class="k">friend</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">Display</span><span class="p">;</span>
<a id="__codelineno-201-15" name="__codelineno-201-15"></a><span class="p">};</span>
<a id="__codelineno-201-16" name="__codelineno-201-16"></a>
<a id="__codelineno-201-17" name="__codelineno-201-17"></a><span class="k">class</span><span class="w"> </span><span class="nc">Display</span>
<a id="__codelineno-201-18" name="__codelineno-201-18"></a><span class="p">{</span>
<a id="__codelineno-201-19" name="__codelineno-201-19"></a><span class="k">private</span><span class="o">:</span>
<a id="__codelineno-201-20" name="__codelineno-201-20"></a><span class="w">    </span><span class="kt">bool</span><span class="w"> </span><span class="n">m_displayIntFirst</span><span class="w"> </span><span class="p">{};</span>
<a id="__codelineno-201-21" name="__codelineno-201-21"></a>
<a id="__codelineno-201-22" name="__codelineno-201-22"></a><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-201-23" name="__codelineno-201-23"></a><span class="w">    </span><span class="n">Display</span><span class="p">(</span><span class="kt">bool</span><span class="w"> </span><span class="n">displayIntFirst</span><span class="p">)</span>
<a id="__codelineno-201-24" name="__codelineno-201-24"></a><span class="w">        </span><span class="o">:</span><span class="w"> </span><span class="n">m_displayIntFirst</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">displayIntFirst</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-201-25" name="__codelineno-201-25"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-201-26" name="__codelineno-201-26"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-201-27" name="__codelineno-201-27"></a>
<a id="__codelineno-201-28" name="__codelineno-201-28"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">displayStorage</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">Storage</span><span class="o">&amp;</span><span class="w"> </span><span class="n">storage</span><span class="p">)</span>
<a id="__codelineno-201-29" name="__codelineno-201-29"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-201-30" name="__codelineno-201-30"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">m_displayIntFirst</span><span class="p">)</span>
<a id="__codelineno-201-31" name="__codelineno-201-31"></a><span class="w">            </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">storage</span><span class="p">.</span><span class="n">m_nValue</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="sc">' '</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">storage</span><span class="p">.</span><span class="n">m_dValue</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="sc">'\n'</span><span class="p">;</span>
<a id="__codelineno-201-32" name="__codelineno-201-32"></a><span class="w">        </span><span class="k">else</span><span class="w"> </span><span class="c1">// display double first</span>
<a id="__codelineno-201-33" name="__codelineno-201-33"></a><span class="w">            </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">storage</span><span class="p">.</span><span class="n">m_dValue</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="sc">' '</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">storage</span><span class="p">.</span><span class="n">m_nValue</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="sc">'\n'</span><span class="p">;</span>
<a id="__codelineno-201-34" name="__codelineno-201-34"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-201-35" name="__codelineno-201-35"></a>
<a id="__codelineno-201-36" name="__codelineno-201-36"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">setDisplayIntFirst</span><span class="p">(</span><span class="kt">bool</span><span class="w"> </span><span class="n">b</span><span class="p">)</span>
<a id="__codelineno-201-37" name="__codelineno-201-37"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-201-38" name="__codelineno-201-38"></a><span class="w">        </span><span class="n">m_displayIntFirst</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">b</span><span class="p">;</span>
<a id="__codelineno-201-39" name="__codelineno-201-39"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-201-40" name="__codelineno-201-40"></a><span class="p">};</span>
<a id="__codelineno-201-41" name="__codelineno-201-41"></a>
<a id="__codelineno-201-42" name="__codelineno-201-42"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span>
<a id="__codelineno-201-43" name="__codelineno-201-43"></a><span class="p">{</span>
<a id="__codelineno-201-44" name="__codelineno-201-44"></a><span class="w">    </span><span class="n">Storage</span><span class="w"> </span><span class="n">storage</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="mf">6.7</span><span class="w"> </span><span class="p">};</span>
<a id="__codelineno-201-45" name="__codelineno-201-45"></a><span class="w">    </span><span class="n">Display</span><span class="w"> </span><span class="n">display</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nb">false</span><span class="w"> </span><span class="p">};</span>
<a id="__codelineno-201-46" name="__codelineno-201-46"></a>
<a id="__codelineno-201-47" name="__codelineno-201-47"></a><span class="w">    </span><span class="n">display</span><span class="p">.</span><span class="n">displayStorage</span><span class="p">(</span><span class="n">storage</span><span class="p">);</span>
<a id="__codelineno-201-48" name="__codelineno-201-48"></a>
<a id="__codelineno-201-49" name="__codelineno-201-49"></a><span class="w">    </span><span class="n">display</span><span class="p">.</span><span class="n">setDisplayIntFirst</span><span class="p">(</span><span class="nb">true</span><span class="p">);</span>
<a id="__codelineno-201-50" name="__codelineno-201-50"></a><span class="w">    </span><span class="n">display</span><span class="p">.</span><span class="n">displayStorage</span><span class="p">(</span><span class="n">storage</span><span class="p">);</span>
<a id="__codelineno-201-51" name="__codelineno-201-51"></a>
<a id="__codelineno-201-52" name="__codelineno-201-52"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-201-53" name="__codelineno-201-53"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>这段程序的输出结果是</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-202-1">1</a></span>
<span class="normal"><a href="#__codelineno-202-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-202-1" name="__codelineno-202-1"></a>6.7 5
<a id="__codelineno-202-2" name="__codelineno-202-2"></a>5 6.7
</code></pre></div></td></tr></table></div>
</details>
<ul>
<li>
<p>友元<strong>不是互反的</strong>：如果类 A 是类 B 的友元，那么类 B 不一定是类 A 的友元。</p>
<ul>
<li>如果我们希望类 B 也是类 A 的友元，我们需要在类 B 的定义中再次使用 <code>friend</code> 关键字来声明类 A 是类 B 的友元。</li>
</ul>
</li>
<li>
<p>友元关系<strong>不具有传递性</strong>：即使类 A 是类 B 的友元，类 B 是类 C 的友元，但是这不代表类 A 不一定是类 C 的友元。</p>
<ul>
<li>如果我们希望类 A 也是类 C 的友元，我们需要在类 C 的定义中再次使用 <code>friend</code> 关键字来声明类 A 是类 C 的友元。</li>
</ul>
</li>
<li>
<p>把一个类声明为友元类实际上也相当于“被友元”的类的一个前向声明，因此我们可以在友元类的定义之前直接把其声明为友元类。</p>
<ul>
<li>比如在上面的例子中  ，在 <code>Storage</code> 类中进行友元类声明时，我们并没有对 <code>Display</code> 类进行前向声明。</li>
</ul>
</li>
</ul>
<h4 id="_55">友元成员函数<a class="headerlink" href="#_55" title="Permanent link">¶</a></h4>
<p>我们也可以仅让单个成员函数成为友元，而不是让整个类成为友元。但是我们并不能直接把上面的代码修改为：</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-203-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-203-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-203-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-203-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-203-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-203-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-203-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-203-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-203-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-203-10">10</a></span>
<span class="normal"><a href="#__codelineno-203-11">11</a></span>
<span class="normal"><a href="#__codelineno-203-12">12</a></span>
<span class="normal"><a href="#__codelineno-203-13">13</a></span>
<span class="normal"><a href="#__codelineno-203-14">14</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-203-1" name="__codelineno-203-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">Storage</span>
<a id="__codelineno-203-2" name="__codelineno-203-2"></a><span class="p">{</span>
<a id="__codelineno-203-3" name="__codelineno-203-3"></a><span class="k">private</span><span class="o">:</span>
<a id="__codelineno-203-4" name="__codelineno-203-4"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">m_nValue</span><span class="w"> </span><span class="p">{};</span>
<a id="__codelineno-203-5" name="__codelineno-203-5"></a><span class="w">    </span><span class="kt">double</span><span class="w"> </span><span class="n">m_dValue</span><span class="w"> </span><span class="p">{};</span>
<a id="__codelineno-203-6" name="__codelineno-203-6"></a><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-203-7" name="__codelineno-203-7"></a><span class="w">    </span><span class="n">Storage</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">nValue</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">dValue</span><span class="p">)</span>
<a id="__codelineno-203-8" name="__codelineno-203-8"></a><span class="w">        </span><span class="o">:</span><span class="w"> </span><span class="n">m_nValue</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">nValue</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">m_dValue</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">dValue</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-203-9" name="__codelineno-203-9"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-203-10" name="__codelineno-203-10"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-203-11" name="__codelineno-203-11"></a>
<a id="__codelineno-203-12" name="__codelineno-203-12"></a><span class="w">    </span><span class="k">friend</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="n">Display</span><span class="o">::</span><span class="n">displayStorage</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">Storage</span><span class="o">&amp;</span><span class="w"> </span><span class="n">storage</span><span class="p">);</span><span class="w"> </span>
<a id="__codelineno-203-13" name="__codelineno-203-13"></a><span class="w">    </span><span class="c1">// error: Storage hasn't seen the full definition of class Display</span>
<a id="__codelineno-203-14" name="__codelineno-203-14"></a><span class="p">};</span>
</code></pre></div></td></tr></table></div>
<p>这是因为在使单个成员函数成为友元时，编译器必须看到完整的友元成员函数的定义，而不仅仅是声明。这里，我们将在试图让 <code>Display::displayStorage()</code> 成为 <code>Storage</code> 的友元时发生编译错误。</p>
<p>对上面这个问题的一个解决办法是把 <code>Display</code> 类的定义放在 <code>Storage</code> 类的定义之前。但是这么做我们又会遇到一个问题：成员函数 <code>Display::displayStorage()</code> 使用 <code>Storage</code> 类的引用作为参数，这时编译器还不知道 <code>Storage</code> 类的完整定义。为了解决这个新的问题，我们需要在 <code>Display</code> 类的定义之前对 <code>Storage</code> 类进行前向声明。</p>
<p>最终修改后的程序变为</p>
<div class="admonition example">
<p class="admonition-title">Example</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-204-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-204-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-204-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-204-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-204-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-204-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-204-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-204-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-204-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-204-10">10</a></span>
<span class="normal"><a href="#__codelineno-204-11">11</a></span>
<span class="normal"><a href="#__codelineno-204-12">12</a></span>
<span class="normal"><a href="#__codelineno-204-13">13</a></span>
<span class="normal"><a href="#__codelineno-204-14">14</a></span>
<span class="normal"><a href="#__codelineno-204-15">15</a></span>
<span class="normal"><a href="#__codelineno-204-16">16</a></span>
<span class="normal"><a href="#__codelineno-204-17">17</a></span>
<span class="normal"><a href="#__codelineno-204-18">18</a></span>
<span class="normal"><a href="#__codelineno-204-19">19</a></span>
<span class="normal"><a href="#__codelineno-204-20">20</a></span>
<span class="normal"><a href="#__codelineno-204-21">21</a></span>
<span class="normal"><a href="#__codelineno-204-22">22</a></span>
<span class="normal"><a href="#__codelineno-204-23">23</a></span>
<span class="normal"><a href="#__codelineno-204-24">24</a></span>
<span class="normal"><a href="#__codelineno-204-25">25</a></span>
<span class="normal"><a href="#__codelineno-204-26">26</a></span>
<span class="normal"><a href="#__codelineno-204-27">27</a></span>
<span class="normal"><a href="#__codelineno-204-28">28</a></span>
<span class="normal"><a href="#__codelineno-204-29">29</a></span>
<span class="normal"><a href="#__codelineno-204-30">30</a></span>
<span class="normal"><a href="#__codelineno-204-31">31</a></span>
<span class="normal"><a href="#__codelineno-204-32">32</a></span>
<span class="normal"><a href="#__codelineno-204-33">33</a></span>
<span class="normal"><a href="#__codelineno-204-34">34</a></span>
<span class="normal"><a href="#__codelineno-204-35">35</a></span>
<span class="normal"><a href="#__codelineno-204-36">36</a></span>
<span class="normal"><a href="#__codelineno-204-37">37</a></span>
<span class="normal"><a href="#__codelineno-204-38">38</a></span>
<span class="normal"><a href="#__codelineno-204-39">39</a></span>
<span class="normal"><a href="#__codelineno-204-40">40</a></span>
<span class="normal"><a href="#__codelineno-204-41">41</a></span>
<span class="normal"><a href="#__codelineno-204-42">42</a></span>
<span class="normal"><a href="#__codelineno-204-43">43</a></span>
<span class="normal"><a href="#__codelineno-204-44">44</a></span>
<span class="normal"><a href="#__codelineno-204-45">45</a></span>
<span class="normal"><a href="#__codelineno-204-46">46</a></span>
<span class="normal"><a href="#__codelineno-204-47">47</a></span>
<span class="normal"><a href="#__codelineno-204-48">48</a></span>
<span class="normal"><a href="#__codelineno-204-49">49</a></span>
<span class="normal"><a href="#__codelineno-204-50">50</a></span>
<span class="normal"><a href="#__codelineno-204-51">51</a></span>
<span class="normal"><a href="#__codelineno-204-52">52</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-204-1" name="__codelineno-204-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span>
<a id="__codelineno-204-2" name="__codelineno-204-2"></a>
<a id="__codelineno-204-3" name="__codelineno-204-3"></a><span class="k">class</span><span class="w"> </span><span class="nc">Storage</span><span class="p">;</span><span class="w"> </span><span class="c1">// forward declaration for class Storage</span>
<a id="__codelineno-204-4" name="__codelineno-204-4"></a>
<a id="__codelineno-204-5" name="__codelineno-204-5"></a><span class="k">class</span><span class="w"> </span><span class="nc">Display</span>
<a id="__codelineno-204-6" name="__codelineno-204-6"></a><span class="p">{</span>
<a id="__codelineno-204-7" name="__codelineno-204-7"></a><span class="k">private</span><span class="o">:</span>
<a id="__codelineno-204-8" name="__codelineno-204-8"></a><span class="w">    </span><span class="kt">bool</span><span class="w"> </span><span class="n">m_displayIntFirst</span><span class="w"> </span><span class="p">{};</span>
<a id="__codelineno-204-9" name="__codelineno-204-9"></a>
<a id="__codelineno-204-10" name="__codelineno-204-10"></a><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-204-11" name="__codelineno-204-11"></a><span class="w">    </span><span class="n">Display</span><span class="p">(</span><span class="kt">bool</span><span class="w"> </span><span class="n">displayIntFirst</span><span class="p">)</span>
<a id="__codelineno-204-12" name="__codelineno-204-12"></a><span class="w">        </span><span class="o">:</span><span class="w"> </span><span class="n">m_displayIntFirst</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">displayIntFirst</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-204-13" name="__codelineno-204-13"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-204-14" name="__codelineno-204-14"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-204-15" name="__codelineno-204-15"></a><span class="w">    </span><span class="c1">// forward declaration for Storage needed for reference here</span>
<a id="__codelineno-204-16" name="__codelineno-204-16"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">displayStorage</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">Storage</span><span class="o">&amp;</span><span class="w"> </span><span class="n">storage</span><span class="p">);</span><span class="w"> </span>
<a id="__codelineno-204-17" name="__codelineno-204-17"></a><span class="p">};</span>
<a id="__codelineno-204-18" name="__codelineno-204-18"></a>
<a id="__codelineno-204-19" name="__codelineno-204-19"></a><span class="k">class</span><span class="w"> </span><span class="nc">Storage</span><span class="w"> </span><span class="c1">// full definition of Storage class</span>
<a id="__codelineno-204-20" name="__codelineno-204-20"></a><span class="p">{</span>
<a id="__codelineno-204-21" name="__codelineno-204-21"></a><span class="k">private</span><span class="o">:</span>
<a id="__codelineno-204-22" name="__codelineno-204-22"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">m_nValue</span><span class="w"> </span><span class="p">{};</span>
<a id="__codelineno-204-23" name="__codelineno-204-23"></a><span class="w">    </span><span class="kt">double</span><span class="w"> </span><span class="n">m_dValue</span><span class="w"> </span><span class="p">{};</span>
<a id="__codelineno-204-24" name="__codelineno-204-24"></a><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-204-25" name="__codelineno-204-25"></a><span class="w">    </span><span class="n">Storage</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">nValue</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">dValue</span><span class="p">)</span>
<a id="__codelineno-204-26" name="__codelineno-204-26"></a><span class="w">        </span><span class="o">:</span><span class="w"> </span><span class="n">m_nValue</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">nValue</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">m_dValue</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">dValue</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-204-27" name="__codelineno-204-27"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-204-28" name="__codelineno-204-28"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-204-29" name="__codelineno-204-29"></a>
<a id="__codelineno-204-30" name="__codelineno-204-30"></a><span class="w">    </span><span class="c1">// Make the Display::displayStorage member function a friend of the Storage class</span>
<a id="__codelineno-204-31" name="__codelineno-204-31"></a><span class="w">    </span><span class="c1">// Requires seeing the full definition of class Display (as displayStorage is a member)</span>
<a id="__codelineno-204-32" name="__codelineno-204-32"></a><span class="w">    </span><span class="k">friend</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="n">Display</span><span class="o">::</span><span class="n">displayStorage</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">Storage</span><span class="o">&amp;</span><span class="w"> </span><span class="n">storage</span><span class="p">);</span>
<a id="__codelineno-204-33" name="__codelineno-204-33"></a><span class="p">};</span>
<a id="__codelineno-204-34" name="__codelineno-204-34"></a>
<a id="__codelineno-204-35" name="__codelineno-204-35"></a><span class="c1">// Now we can define Display::displayStorage</span>
<a id="__codelineno-204-36" name="__codelineno-204-36"></a><span class="c1">// Requires seeing the full definition of class Storage (as we access Storage members)</span>
<a id="__codelineno-204-37" name="__codelineno-204-37"></a><span class="kt">void</span><span class="w"> </span><span class="nf">Display::displayStorage</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">Storage</span><span class="o">&amp;</span><span class="w"> </span><span class="n">storage</span><span class="p">)</span>
<a id="__codelineno-204-38" name="__codelineno-204-38"></a><span class="p">{</span>
<a id="__codelineno-204-39" name="__codelineno-204-39"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">m_displayIntFirst</span><span class="p">)</span>
<a id="__codelineno-204-40" name="__codelineno-204-40"></a><span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">storage</span><span class="p">.</span><span class="n">m_nValue</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="sc">' '</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">storage</span><span class="p">.</span><span class="n">m_dValue</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="sc">'\n'</span><span class="p">;</span>
<a id="__codelineno-204-41" name="__codelineno-204-41"></a><span class="w">    </span><span class="k">else</span><span class="w"> </span><span class="c1">// display double first</span>
<a id="__codelineno-204-42" name="__codelineno-204-42"></a><span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">storage</span><span class="p">.</span><span class="n">m_dValue</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="sc">' '</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">storage</span><span class="p">.</span><span class="n">m_nValue</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="sc">'\n'</span><span class="p">;</span>
<a id="__codelineno-204-43" name="__codelineno-204-43"></a><span class="p">}</span>
<a id="__codelineno-204-44" name="__codelineno-204-44"></a>
<a id="__codelineno-204-45" name="__codelineno-204-45"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span>
<a id="__codelineno-204-46" name="__codelineno-204-46"></a><span class="p">{</span>
<a id="__codelineno-204-47" name="__codelineno-204-47"></a><span class="w">    </span><span class="n">Storage</span><span class="w"> </span><span class="n">storage</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="mf">6.7</span><span class="w"> </span><span class="p">};</span>
<a id="__codelineno-204-48" name="__codelineno-204-48"></a><span class="w">    </span><span class="n">Display</span><span class="w"> </span><span class="n">display</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nb">false</span><span class="w"> </span><span class="p">};</span>
<a id="__codelineno-204-49" name="__codelineno-204-49"></a><span class="w">    </span><span class="n">display</span><span class="p">.</span><span class="n">displayStorage</span><span class="p">(</span><span class="n">storage</span><span class="p">);</span>
<a id="__codelineno-204-50" name="__codelineno-204-50"></a>
<a id="__codelineno-204-51" name="__codelineno-204-51"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-204-52" name="__codelineno-204-52"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
</div>
<ul>
<li><code>Storage</code> 的前向声明满足了 <code>Display</code> 类的友元成员函数 <code>displayStorage()</code> 的要求</li>
<li><code>Display</code> 类的完整定义满足了 <code>Storage</code> 把 <code>Display::displayStorage()</code> 声明为友元的要求</li>
<li><code>Storage</code> 类的完整定义满足了 <code>Display::displayStorage()</code> 在进行完整定义时的要求</li>
</ul>
<p>这看起来很复杂，但一般而言仅在把所有内容都写到同一个文件中时我们才会这么做。如果我们把每个类的定义放到不同的头文件中，把成员函数的完整定义都写到 <code>.cpp</code> 文件中，并且通过 <code>#include</code> 来包含头文件，我们就不需要考虑类和成员函数的定义顺序问题了</p>
<hr/>
<h2 id="lambda">lambda 表达式<a class="headerlink" href="#lambda" title="Permanent link">¶</a></h2>
<p>在 C++ 中，<strong>lambda 表达式</strong>（lambda expression，也称 lambda 或 closure）是一种可以在一个函数内中定义匿名函数的方法，它通常用于在函数内部定义一个简单的函数，而不必专门在全局作用域中定义一个可能只会用到一次的函数。</p>
<p>lambda 表达式的语法相对而言比较奇怪：</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-205-1">1</a></span>
<span class="normal"><a href="#__codelineno-205-2">2</a></span>
<span class="normal"><a href="#__codelineno-205-3">3</a></span>
<span class="normal"><a href="#__codelineno-205-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-205-1" name="__codelineno-205-1"></a><span class="p">[</span><span class="w"> </span><span class="n">captureClause</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">parameters</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">returnType</span>
<a id="__codelineno-205-2" name="__codelineno-205-2"></a><span class="p">{</span>
<a id="__codelineno-205-3" name="__codelineno-205-3"></a><span class="w">    </span><span class="n">statements</span><span class="p">;</span>
<a id="__codelineno-205-4" name="__codelineno-205-4"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>如果不需要捕获字句，那么捕获子句可以留空，直接使用 <code>[]</code>。</li>
<li>如果不需要参数，那么参数列表可以留空，直接使用 <code>()</code>，甚至连 <code>()</code> 都可以省略。</li>
<li>返回类型可以省略，如果省略了，那么就相当于使用 <code>auto</code> 关键字来推断返回类型。</li>
</ul>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>lambda 可被视作一个匿名函数对象，我们不需要为它命名。</p>
</div>
<h3 id="_56">简单引入<a class="headerlink" href="#_56" title="Permanent link">¶</a></h3>
<p>一个最最简单的 lambda 定义是</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-206-1">1</a></span>
<span class="normal"><a href="#__codelineno-206-2">2</a></span>
<span class="normal"><a href="#__codelineno-206-3">3</a></span>
<span class="normal"><a href="#__codelineno-206-4">4</a></span>
<span class="normal"><a href="#__codelineno-206-5">5</a></span>
<span class="normal"><a href="#__codelineno-206-6">6</a></span>
<span class="normal"><a href="#__codelineno-206-7">7</a></span>
<span class="normal"><a href="#__codelineno-206-8">8</a></span>
<span class="normal"><a href="#__codelineno-206-9">9</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-206-1" name="__codelineno-206-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span>
<a id="__codelineno-206-2" name="__codelineno-206-2"></a>
<a id="__codelineno-206-3" name="__codelineno-206-3"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span>
<a id="__codelineno-206-4" name="__codelineno-206-4"></a><span class="p">{</span>
<a id="__codelineno-206-5" name="__codelineno-206-5"></a><span class="w">    </span><span class="c1">// 省略了返回类型、没有捕获子句、不接受任何参数，同时函数体为空的 lambda</span>
<a id="__codelineno-206-6" name="__codelineno-206-6"></a><span class="w">    </span><span class="p">[]</span><span class="w"> </span><span class="p">{};</span>
<a id="__codelineno-206-7" name="__codelineno-206-7"></a>
<a id="__codelineno-206-8" name="__codelineno-206-8"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-206-9" name="__codelineno-206-9"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>虽然 lambda 函数很方便，但在同一行中书写 lambda 表达式和调用它的代码可能会让代码变得难以阅读。因此，我们用 lambda 定义去初始化一个 lambda 变量，然后使用这个变量来调用 lambda 函数。</p>
<details class="example">
<summary>使用 lambda 变量</summary>
<p>在下面这个代码片段中，我们使用 <code>std::all_of</code> 来检查数组中的元素是否都是偶数</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-207-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-207-1" name="__codelineno-207-1"></a><span class="k">return</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">all_of</span><span class="p">(</span><span class="n">array</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span><span class="w"> </span><span class="n">array</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span><span class="w"> </span><span class="p">[](</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="p">){</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="p">((</span><span class="n">i</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span><span class="w"> </span><span class="p">});</span>
</code></pre></div></td></tr></table></div>
<p>我们可以把它重写为可读性更好的形式</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-208-1">1</a></span>
<span class="normal"><a href="#__codelineno-208-2">2</a></span>
<span class="normal"><a href="#__codelineno-208-3">3</a></span>
<span class="normal"><a href="#__codelineno-208-4">4</a></span>
<span class="normal"><a href="#__codelineno-208-5">5</a></span>
<span class="normal"><a href="#__codelineno-208-6">6</a></span>
<span class="normal"><a href="#__codelineno-208-7">7</a></span>
<span class="normal"><a href="#__codelineno-208-8">8</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-208-1" name="__codelineno-208-1"></a><span class="k">auto</span><span class="w"> </span><span class="n">isEven</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-208-2" name="__codelineno-208-2"></a><span class="p">[](</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="p">)</span>
<a id="__codelineno-208-3" name="__codelineno-208-3"></a><span class="p">{</span>
<a id="__codelineno-208-4" name="__codelineno-208-4"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-208-5" name="__codelineno-208-5"></a><span class="p">}</span>
<a id="__codelineno-208-6" name="__codelineno-208-6"></a><span class="p">};</span>
<a id="__codelineno-208-7" name="__codelineno-208-7"></a>
<a id="__codelineno-208-8" name="__codelineno-208-8"></a><span class="k">return</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">all_of</span><span class="p">(</span><span class="n">array</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span><span class="w"> </span><span class="n">array</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span><span class="w"> </span><span class="n">isEven</span><span class="p">);</span>
</code></pre></div></td></tr></table></div>
</details>
<div class="admonition question">
<p class="admonition-title">上例中 lambda 变量 isEven 的类型是什么？</p>
<p>事实上，lambda 并没有我们可以明确使用的类型。当我们编写 lambda 时，编译器将会为这个 lambda 生成一个特定的不暴露于我们的类型。我们可以使用 <code>auto</code> 关键字来推断这个类型，但我们不能显式地指定这个类型。</p>
<p>lambda 实质上并不是函数，它们是一种被称为<strong>函子</strong>（functor）的特殊对象，函子拥有被重载过的函数调用运算符 <code>operator()</code>，这使得 lambda 可以像函数那样被调用。</p>
</div>
<p>尽管我们无法知道 lambda 的类型，但有几种方法可以用于存储定义后的 lambda：</p>
<ul>
<li>如果 lambda 的捕获子句为空，那么我们可以直接使用常规的函数指针来存储 lambda</li>
<li>无论 lambda 是否具有非空的捕获子句，我们都可以使用 auto 关键字或 std::function 来存储 lambda</li>
</ul>
<details class="example">
<summary>Example</summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-209-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-209-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-209-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-209-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-209-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-209-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-209-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-209-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-209-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-209-10">10</a></span>
<span class="normal"><a href="#__codelineno-209-11">11</a></span>
<span class="normal"><a href="#__codelineno-209-12">12</a></span>
<span class="normal"><a href="#__codelineno-209-13">13</a></span>
<span class="normal"><a href="#__codelineno-209-14">14</a></span>
<span class="normal"><a href="#__codelineno-209-15">15</a></span>
<span class="normal"><a href="#__codelineno-209-16">16</a></span>
<span class="normal"><a href="#__codelineno-209-17">17</a></span>
<span class="normal"><a href="#__codelineno-209-18">18</a></span>
<span class="normal"><a href="#__codelineno-209-19">19</a></span>
<span class="normal"><a href="#__codelineno-209-20">20</a></span>
<span class="normal"><a href="#__codelineno-209-21">21</a></span>
<span class="normal"><a href="#__codelineno-209-22">22</a></span>
<span class="normal"><a href="#__codelineno-209-23">23</a></span>
<span class="normal"><a href="#__codelineno-209-24">24</a></span>
<span class="normal"><a href="#__codelineno-209-25">25</a></span>
<span class="normal"><a href="#__codelineno-209-26">26</a></span>
<span class="normal"><a href="#__codelineno-209-27">27</a></span>
<span class="normal"><a href="#__codelineno-209-28">28</a></span>
<span class="normal"><a href="#__codelineno-209-29">29</a></span>
<span class="normal"><a href="#__codelineno-209-30">30</a></span>
<span class="normal"><a href="#__codelineno-209-31">31</a></span>
<span class="normal"><a href="#__codelineno-209-32">32</a></span>
<span class="normal"><a href="#__codelineno-209-33">33</a></span>
<span class="normal"><a href="#__codelineno-209-34">34</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-209-1" name="__codelineno-209-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;functional&gt;</span>
<a id="__codelineno-209-2" name="__codelineno-209-2"></a>
<a id="__codelineno-209-3" name="__codelineno-209-3"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span>
<a id="__codelineno-209-4" name="__codelineno-209-4"></a><span class="p">{</span>
<a id="__codelineno-209-5" name="__codelineno-209-5"></a><span class="c1">// A regular function pointer. Only works with an empty capture clause (empty []).</span>
<a id="__codelineno-209-6" name="__codelineno-209-6"></a><span class="kt">double</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="n">addNumbers1</span><span class="p">)(</span><span class="kt">double</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="p">){</span>
<a id="__codelineno-209-7" name="__codelineno-209-7"></a><span class="w">    </span><span class="p">[](</span><span class="kt">double</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">b</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-209-8" name="__codelineno-209-8"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">b</span><span class="p">;</span>
<a id="__codelineno-209-9" name="__codelineno-209-9"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-209-10" name="__codelineno-209-10"></a><span class="p">};</span>
<a id="__codelineno-209-11" name="__codelineno-209-11"></a>
<a id="__codelineno-209-12" name="__codelineno-209-12"></a><span class="n">addNumbers1</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">);</span>
<a id="__codelineno-209-13" name="__codelineno-209-13"></a>
<a id="__codelineno-209-14" name="__codelineno-209-14"></a><span class="c1">// Using std::function. The lambda could have a non-empty capture clause (discussed next lesson).</span>
<a id="__codelineno-209-15" name="__codelineno-209-15"></a><span class="c1">// note: pre-C++17, use std::function&lt;double(double, double)&gt; instead</span>
<a id="__codelineno-209-16" name="__codelineno-209-16"></a><span class="n">std</span><span class="o">::</span><span class="n">function</span><span class="w"> </span><span class="n">addNumbers2</span><span class="p">{</span><span class="w"> </span>
<a id="__codelineno-209-17" name="__codelineno-209-17"></a><span class="w">    </span><span class="p">[](</span><span class="kt">double</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">b</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-209-18" name="__codelineno-209-18"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">b</span><span class="p">;</span>
<a id="__codelineno-209-19" name="__codelineno-209-19"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-209-20" name="__codelineno-209-20"></a><span class="p">};</span>
<a id="__codelineno-209-21" name="__codelineno-209-21"></a>
<a id="__codelineno-209-22" name="__codelineno-209-22"></a><span class="n">addNumbers2</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">);</span>
<a id="__codelineno-209-23" name="__codelineno-209-23"></a>
<a id="__codelineno-209-24" name="__codelineno-209-24"></a><span class="c1">// Using auto. Stores the lambda with its real type.</span>
<a id="__codelineno-209-25" name="__codelineno-209-25"></a><span class="k">auto</span><span class="w"> </span><span class="n">addNumbers3</span><span class="p">{</span>
<a id="__codelineno-209-26" name="__codelineno-209-26"></a><span class="w">    </span><span class="p">[](</span><span class="kt">double</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">b</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-209-27" name="__codelineno-209-27"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">b</span><span class="p">;</span>
<a id="__codelineno-209-28" name="__codelineno-209-28"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-209-29" name="__codelineno-209-29"></a><span class="p">};</span>
<a id="__codelineno-209-30" name="__codelineno-209-30"></a>
<a id="__codelineno-209-31" name="__codelineno-209-31"></a><span class="n">addNumbers3</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="p">);</span>
<a id="__codelineno-209-32" name="__codelineno-209-32"></a>
<a id="__codelineno-209-33" name="__codelineno-209-33"></a><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-209-34" name="__codelineno-209-34"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
</details>
<div class="admonition note">
<p class="admonition-title">将 lambda 作为参数传递给函数</p>
<p>lambda 表达式可以作为函数的参数传递，通常有 4 中方法</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-210-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-210-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-210-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-210-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-210-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-210-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-210-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-210-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-210-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-210-10">10</a></span>
<span class="normal"><a href="#__codelineno-210-11">11</a></span>
<span class="normal"><a href="#__codelineno-210-12">12</a></span>
<span class="normal"><a href="#__codelineno-210-13">13</a></span>
<span class="normal"><a href="#__codelineno-210-14">14</a></span>
<span class="normal"><a href="#__codelineno-210-15">15</a></span>
<span class="normal"><a href="#__codelineno-210-16">16</a></span>
<span class="normal"><a href="#__codelineno-210-17">17</a></span>
<span class="normal"><a href="#__codelineno-210-18">18</a></span>
<span class="normal"><a href="#__codelineno-210-19">19</a></span>
<span class="normal"><a href="#__codelineno-210-20">20</a></span>
<span class="normal"><a href="#__codelineno-210-21">21</a></span>
<span class="normal"><a href="#__codelineno-210-22">22</a></span>
<span class="normal"><a href="#__codelineno-210-23">23</a></span>
<span class="normal"><a href="#__codelineno-210-24">24</a></span>
<span class="normal"><a href="#__codelineno-210-25">25</a></span>
<span class="normal"><a href="#__codelineno-210-26">26</a></span>
<span class="normal"><a href="#__codelineno-210-27">27</a></span>
<span class="normal"><a href="#__codelineno-210-28">28</a></span>
<span class="normal"><a href="#__codelineno-210-29">29</a></span>
<span class="normal"><a href="#__codelineno-210-30">30</a></span>
<span class="normal"><a href="#__codelineno-210-31">31</a></span>
<span class="normal"><a href="#__codelineno-210-32">32</a></span>
<span class="normal"><a href="#__codelineno-210-33">33</a></span>
<span class="normal"><a href="#__codelineno-210-34">34</a></span>
<span class="normal"><a href="#__codelineno-210-35">35</a></span>
<span class="normal"><a href="#__codelineno-210-36">36</a></span>
<span class="normal"><a href="#__codelineno-210-37">37</a></span>
<span class="normal"><a href="#__codelineno-210-38">38</a></span>
<span class="normal"><a href="#__codelineno-210-39">39</a></span>
<span class="normal"><a href="#__codelineno-210-40">40</a></span>
<span class="normal"><a href="#__codelineno-210-41">41</a></span>
<span class="normal"><a href="#__codelineno-210-42">42</a></span>
<span class="normal"><a href="#__codelineno-210-43">43</a></span>
<span class="normal"><a href="#__codelineno-210-44">44</a></span>
<span class="normal"><a href="#__codelineno-210-45">45</a></span>
<span class="normal"><a href="#__codelineno-210-46">46</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-210-1" name="__codelineno-210-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;functional&gt;</span>
<a id="__codelineno-210-2" name="__codelineno-210-2"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span>
<a id="__codelineno-210-3" name="__codelineno-210-3"></a>
<a id="__codelineno-210-4" name="__codelineno-210-4"></a><span class="c1">// Case 1: use a `std::function` parameter</span>
<a id="__codelineno-210-5" name="__codelineno-210-5"></a><span class="kt">void</span><span class="w"> </span><span class="nf">repeat1</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">repetitions</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">function</span><span class="o">&lt;</span><span class="kt">void</span><span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="o">&gt;&amp;</span><span class="w"> </span><span class="n">fn</span><span class="p">)</span>
<a id="__codelineno-210-6" name="__codelineno-210-6"></a><span class="p">{</span>
<a id="__codelineno-210-7" name="__codelineno-210-7"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="p">{</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">};</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">repetitions</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">i</span><span class="p">)</span>
<a id="__codelineno-210-8" name="__codelineno-210-8"></a><span class="w">        </span><span class="n">fn</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
<a id="__codelineno-210-9" name="__codelineno-210-9"></a><span class="p">}</span>
<a id="__codelineno-210-10" name="__codelineno-210-10"></a>
<a id="__codelineno-210-11" name="__codelineno-210-11"></a><span class="c1">// Case 2: use a function template with a type template parameter</span>
<a id="__codelineno-210-12" name="__codelineno-210-12"></a><span class="k">template</span><span class="w"> </span><span class="o">&lt;</span><span class="k">typename</span><span class="w"> </span><span class="nc">T</span><span class="o">&gt;</span>
<a id="__codelineno-210-13" name="__codelineno-210-13"></a><span class="kt">void</span><span class="w"> </span><span class="n">repeat2</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">repetitions</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">T</span><span class="o">&amp;</span><span class="w"> </span><span class="n">fn</span><span class="p">)</span>
<a id="__codelineno-210-14" name="__codelineno-210-14"></a><span class="p">{</span>
<a id="__codelineno-210-15" name="__codelineno-210-15"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="p">{</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">};</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">repetitions</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">i</span><span class="p">)</span>
<a id="__codelineno-210-16" name="__codelineno-210-16"></a><span class="w">        </span><span class="n">fn</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
<a id="__codelineno-210-17" name="__codelineno-210-17"></a><span class="p">}</span>
<a id="__codelineno-210-18" name="__codelineno-210-18"></a>
<a id="__codelineno-210-19" name="__codelineno-210-19"></a><span class="c1">// Case 3: use the abbreviated function template syntax (C++20)</span>
<a id="__codelineno-210-20" name="__codelineno-210-20"></a><span class="kt">void</span><span class="w"> </span><span class="n">repeat3</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">repetitions</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="o">&amp;</span><span class="w"> </span><span class="n">fn</span><span class="p">)</span>
<a id="__codelineno-210-21" name="__codelineno-210-21"></a><span class="p">{</span>
<a id="__codelineno-210-22" name="__codelineno-210-22"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="p">{</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">};</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">repetitions</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">i</span><span class="p">)</span>
<a id="__codelineno-210-23" name="__codelineno-210-23"></a><span class="w">        </span><span class="n">fn</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
<a id="__codelineno-210-24" name="__codelineno-210-24"></a><span class="p">}</span>
<a id="__codelineno-210-25" name="__codelineno-210-25"></a>
<a id="__codelineno-210-26" name="__codelineno-210-26"></a><span class="c1">// Case 4: use function pointer (only for lambda with no captures)</span>
<a id="__codelineno-210-27" name="__codelineno-210-27"></a><span class="kt">void</span><span class="w"> </span><span class="n">repeat4</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">repetitions</span><span class="p">,</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="n">fn</span><span class="p">)(</span><span class="kt">int</span><span class="p">))</span>
<a id="__codelineno-210-28" name="__codelineno-210-28"></a><span class="p">{</span>
<a id="__codelineno-210-29" name="__codelineno-210-29"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="p">{</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">};</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">repetitions</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">i</span><span class="p">)</span>
<a id="__codelineno-210-30" name="__codelineno-210-30"></a><span class="w">        </span><span class="n">fn</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
<a id="__codelineno-210-31" name="__codelineno-210-31"></a><span class="p">}</span>
<a id="__codelineno-210-32" name="__codelineno-210-32"></a>
<a id="__codelineno-210-33" name="__codelineno-210-33"></a><span class="kt">int</span><span class="w"> </span><span class="n">main</span><span class="p">()</span>
<a id="__codelineno-210-34" name="__codelineno-210-34"></a><span class="p">{</span>
<a id="__codelineno-210-35" name="__codelineno-210-35"></a><span class="w">    </span><span class="k">auto</span><span class="w"> </span><span class="n">lambda</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[](</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="p">)</span>
<a id="__codelineno-210-36" name="__codelineno-210-36"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-210-37" name="__codelineno-210-37"></a><span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="sc">'\n'</span><span class="p">;</span>
<a id="__codelineno-210-38" name="__codelineno-210-38"></a><span class="w">    </span><span class="p">};</span>
<a id="__codelineno-210-39" name="__codelineno-210-39"></a>
<a id="__codelineno-210-40" name="__codelineno-210-40"></a><span class="w">    </span><span class="n">repeat1</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="n">lambda</span><span class="p">);</span>
<a id="__codelineno-210-41" name="__codelineno-210-41"></a><span class="w">    </span><span class="n">repeat2</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="n">lambda</span><span class="p">);</span>
<a id="__codelineno-210-42" name="__codelineno-210-42"></a><span class="w">    </span><span class="n">repeat3</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="n">lambda</span><span class="p">);</span>
<a id="__codelineno-210-43" name="__codelineno-210-43"></a><span class="w">    </span><span class="n">repeat4</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="n">lambda</span><span class="p">);</span>
<a id="__codelineno-210-44" name="__codelineno-210-44"></a>
<a id="__codelineno-210-45" name="__codelineno-210-45"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-210-46" name="__codelineno-210-46"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>case 1 中，函数 <code>repeat1</code> 接受一个 <code>std::function</code> 参数，这个参数可以接受任何可调用对象，包括函数指针、函数对象、成员函数指针、lambda 表达式等。但当我们向它传递一个 lambda 表达式时，会发生隐式类型转换，有一定额外开销。</li>
<li>case 2 中，我们使用类型模板参数为 <code>T</code> 的函数模板，这样做的缺点在于 <code>T</code> 的参数和返回类型并不明显。</li>
<li>case 3 是在 C++20 中引入的简化函数模板语法，它可以自动推断模板参数类型。</li>
<li>case 4 使用函数指针，但这种方法只适用于没有捕获子句的 lambda 表达式。 </li>
</ul>
</div>
<div class="admonition abstract">
<p class="admonition-title">Abstract</p>
<ul>
<li>使用 auto 来把 lambda 表达式存储在变量中</li>
<li>
<p>当我们把 lambda 作为参数传递给函数时</p>
<ul>
<li>如果支持 C++20，就使用 auto 来推导函数参数类型</li>
<li>否则，就使用类型模板参数或 <code>std::function</code> 参数，仅在捕获子句为空时才考虑使用函数指针</li>
</ul>
</li>
</ul>
</div>
<div class="admonition info">
<p class="admonition-title">constexpr lambda</p>
<p>从 C++17 开始，如果下面的要求的都得到了满足，那么 lambda 就是隐式的 constexpr：</p>
<ul>
<li>lambda 表达式没有捕获子句，或者所有的捕获都是 constexpr 的</li>
<li>lambda 函数体内调用的所有函数都是 constexpr 的</li>
</ul>
</div>
<h3 id="_57">捕获子句<a class="headerlink" href="#_57" title="Permanent link">¶</a></h3>
<p>捕获子句可以使 lambda 表达式访问函数外部的变量。捕获子句有两种形式：</p>
<ul>
<li><strong>值捕获</strong>（value capture）：捕获的变量的值在 lambda 表达式创建时被复制，然后在 lambda 表达式内部使用这个复制的值创建一个同名的内部变量。lambda 表达式内部的变量不会影响外部的变量。</li>
<li><strong>引用捕获</strong>（reference capture）：捕获的变量的引用在 lambda 表达式创建时被保存，然后在 lambda 表达式内部使用这个引用来访问外部变量。lambda 表达式可以通过这个引用来修改外部变量。</li>
</ul>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>传递进 lambda 表达式的捕获变量在某种程度上类似于函数参数，但是它们不是函数参数，而是 lambda 表达式的一部分。</p>
</div>
<p>在默认情况下，lambda 表达式不能修改值捕获的变量，下面这段程序就无法通过编译，因为<code>value</code> 在 lambda1 内部会被视为 const 的对象。与通过值捕获得到的变量不同，通过引用捕获得到的变量可以被修改，除非它捕获的变量是 const 的。</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-211-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-211-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-211-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-211-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-211-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-211-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-211-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-211-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-211-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-211-10">10</a></span>
<span class="normal"><a href="#__codelineno-211-11">11</a></span>
<span class="normal"><a href="#__codelineno-211-12">12</a></span>
<span class="normal"><a href="#__codelineno-211-13">13</a></span>
<span class="normal"><a href="#__codelineno-211-14">14</a></span>
<span class="normal"><a href="#__codelineno-211-15">15</a></span>
<span class="normal"><a href="#__codelineno-211-16">16</a></span>
<span class="normal"><a href="#__codelineno-211-17">17</a></span>
<span class="normal"><a href="#__codelineno-211-18">18</a></span>
<span class="normal"><a href="#__codelineno-211-19">19</a></span>
<span class="normal"><a href="#__codelineno-211-20">20</a></span>
<span class="normal"><a href="#__codelineno-211-21">21</a></span>
<span class="normal"><a href="#__codelineno-211-22">22</a></span>
<span class="normal"><a href="#__codelineno-211-23">23</a></span>
<span class="normal"><a href="#__codelineno-211-24">24</a></span>
<span class="normal"><a href="#__codelineno-211-25">25</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-211-1" name="__codelineno-211-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span>
<a id="__codelineno-211-2" name="__codelineno-211-2"></a>
<a id="__codelineno-211-3" name="__codelineno-211-3"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span>
<a id="__codelineno-211-4" name="__codelineno-211-4"></a><span class="p">{</span>
<a id="__codelineno-211-5" name="__codelineno-211-5"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">value</span><span class="p">{</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="p">};</span>
<a id="__codelineno-211-6" name="__codelineno-211-6"></a>
<a id="__codelineno-211-7" name="__codelineno-211-7"></a><span class="w">    </span><span class="k">auto</span><span class="w"> </span><span class="n">lambda1</span><span class="p">{</span><span class="w"> </span>
<a id="__codelineno-211-8" name="__codelineno-211-8"></a><span class="w">        </span><span class="p">[</span><span class="n">value</span><span class="p">]</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>
<a id="__codelineno-211-9" name="__codelineno-211-9"></a><span class="w">            </span><span class="o">--</span><span class="n">value</span><span class="p">;</span><span class="w"> </span>
<a id="__codelineno-211-10" name="__codelineno-211-10"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span>
<a id="__codelineno-211-11" name="__codelineno-211-11"></a><span class="w">    </span><span class="p">};</span>
<a id="__codelineno-211-12" name="__codelineno-211-12"></a>
<a id="__codelineno-211-13" name="__codelineno-211-13"></a><span class="w">    </span><span class="k">auto</span><span class="w"> </span><span class="n">lambda2</span><span class="p">{</span><span class="w"> </span>
<a id="__codelineno-211-14" name="__codelineno-211-14"></a><span class="w">        </span><span class="p">[</span><span class="o">&amp;</span><span class="n">value</span><span class="p">]</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>
<a id="__codelineno-211-15" name="__codelineno-211-15"></a><span class="w">            </span><span class="o">--</span><span class="n">value</span><span class="p">;</span><span class="w"> </span>
<a id="__codelineno-211-16" name="__codelineno-211-16"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span>
<a id="__codelineno-211-17" name="__codelineno-211-17"></a><span class="w">    </span><span class="p">};</span>
<a id="__codelineno-211-18" name="__codelineno-211-18"></a>
<a id="__codelineno-211-19" name="__codelineno-211-19"></a><span class="w">    </span><span class="n">lambda1</span><span class="p">();</span>
<a id="__codelineno-211-20" name="__codelineno-211-20"></a><span class="w">    </span><span class="n">lambda2</span><span class="p">();</span>
<a id="__codelineno-211-21" name="__codelineno-211-21"></a>
<a id="__codelineno-211-22" name="__codelineno-211-22"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="sc">'\n'</span><span class="p">;</span>
<a id="__codelineno-211-23" name="__codelineno-211-23"></a>
<a id="__codelineno-211-24" name="__codelineno-211-24"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-211-25" name="__codelineno-211-25"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>如果我们希望修改被捕获的变量，我们可以把 lambda 标记为 <code>mutable</code></p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-212-1">1</a></span>
<span class="normal"><a href="#__codelineno-212-2">2</a></span>
<span class="normal"><a href="#__codelineno-212-3">3</a></span>
<span class="normal"><a href="#__codelineno-212-4">4</a></span>
<span class="normal"><a href="#__codelineno-212-5">5</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-212-1" name="__codelineno-212-1"></a><span class="k">auto</span><span class="w"> </span><span class="n">lambda1</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>
<a id="__codelineno-212-2" name="__codelineno-212-2"></a><span class="w">        </span><span class="p">[</span><span class="n">value</span><span class="p">]</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="k">mutable</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>
<a id="__codelineno-212-3" name="__codelineno-212-3"></a><span class="w">            </span><span class="o">--</span><span class="n">value</span><span class="p">;</span><span class="w"> </span>
<a id="__codelineno-212-4" name="__codelineno-212-4"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span>
<a id="__codelineno-212-5" name="__codelineno-212-5"></a><span class="w">    </span><span class="p">};</span>
</code></pre></div></td></tr></table></div>
<p>如果我们想要捕获多个变量，用逗号分隔即可</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-213-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-213-1" name="__codelineno-213-1"></a><span class="p">[</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="n">z</span><span class="p">](){};</span>
</code></pre></div></td></tr></table></div>
<h4 id="_58">默认捕获<a class="headerlink" href="#_58" title="Permanent link">¶</a></h4>
<p>手动把所有需要使用的变量都完整地写进捕获子句中很容易出错，尤其是 lambda 被修改时，我们可能会忘记添加或删除捕获的变量。为此，我们可以使用<strong>默认捕获</strong>（default capture，or capture-default）来让编译器为我们自动生成需要捕获变量列表。</p>
<ul>
<li><code>[=]</code>：以值捕获的方式捕获所有 lambda 中使用到的外部变量</li>
<li><code>[&amp;]</code>：以引用捕获的方式捕获所有 lambda 中使用到的外部变量</li>
</ul>
<p>默认捕获可以和普通的手动捕获一起使用，但是需要注意的是，如果一个变量不能被多次捕获，并且默认捕获必须作为捕获列表的第一个元素。</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-214-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-214-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-214-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-214-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-214-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-214-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-214-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-214-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-214-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-214-10">10</a></span>
<span class="normal"><a href="#__codelineno-214-11">11</a></span>
<span class="normal"><a href="#__codelineno-214-12">12</a></span>
<span class="normal"><a href="#__codelineno-214-13">13</a></span>
<span class="normal"><a href="#__codelineno-214-14">14</a></span>
<span class="normal"><a href="#__codelineno-214-15">15</a></span>
<span class="normal"><a href="#__codelineno-214-16">16</a></span>
<span class="normal"><a href="#__codelineno-214-17">17</a></span>
<span class="normal"><a href="#__codelineno-214-18">18</a></span>
<span class="normal"><a href="#__codelineno-214-19">19</a></span>
<span class="normal"><a href="#__codelineno-214-20">20</a></span>
<span class="normal"><a href="#__codelineno-214-21">21</a></span>
<span class="normal"><a href="#__codelineno-214-22">22</a></span>
<span class="normal"><a href="#__codelineno-214-23">23</a></span>
<span class="normal"><a href="#__codelineno-214-24">24</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-214-1" name="__codelineno-214-1"></a><span class="kt">int</span><span class="w"> </span><span class="n">health</span><span class="p">{</span><span class="w"> </span><span class="mi">33</span><span class="w"> </span><span class="p">};</span>
<a id="__codelineno-214-2" name="__codelineno-214-2"></a><span class="kt">int</span><span class="w"> </span><span class="n">armor</span><span class="p">{</span><span class="w"> </span><span class="mi">100</span><span class="w"> </span><span class="p">};</span>
<a id="__codelineno-214-3" name="__codelineno-214-3"></a><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">CEnemy</span><span class="o">&gt;</span><span class="w"> </span><span class="n">enemies</span><span class="p">{};</span>
<a id="__codelineno-214-4" name="__codelineno-214-4"></a>
<a id="__codelineno-214-5" name="__codelineno-214-5"></a><span class="c1">// Capture health and armor by value, and enemies by reference.</span>
<a id="__codelineno-214-6" name="__codelineno-214-6"></a><span class="p">[</span><span class="n">health</span><span class="p">,</span><span class="w"> </span><span class="n">armor</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">enemies</span><span class="p">](){};</span>
<a id="__codelineno-214-7" name="__codelineno-214-7"></a>
<a id="__codelineno-214-8" name="__codelineno-214-8"></a><span class="c1">// Capture enemies by reference and everything else by value.</span>
<a id="__codelineno-214-9" name="__codelineno-214-9"></a><span class="p">[</span><span class="o">=</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">enemies</span><span class="p">](){};</span>
<a id="__codelineno-214-10" name="__codelineno-214-10"></a>
<a id="__codelineno-214-11" name="__codelineno-214-11"></a><span class="c1">// Capture armor by value and everything else by reference.</span>
<a id="__codelineno-214-12" name="__codelineno-214-12"></a><span class="p">[</span><span class="o">&amp;</span><span class="p">,</span><span class="w"> </span><span class="n">armor</span><span class="p">](){};</span>
<a id="__codelineno-214-13" name="__codelineno-214-13"></a>
<a id="__codelineno-214-14" name="__codelineno-214-14"></a><span class="c1">// Illegal, we already said we want to capture everything by reference.</span>
<a id="__codelineno-214-15" name="__codelineno-214-15"></a><span class="p">[</span><span class="o">&amp;</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">armor</span><span class="p">](){};</span>
<a id="__codelineno-214-16" name="__codelineno-214-16"></a>
<a id="__codelineno-214-17" name="__codelineno-214-17"></a><span class="c1">// Illegal, we already said we want to capture everything by value.</span>
<a id="__codelineno-214-18" name="__codelineno-214-18"></a><span class="p">[</span><span class="o">=</span><span class="p">,</span><span class="w"> </span><span class="n">armor</span><span class="p">](){};</span>
<a id="__codelineno-214-19" name="__codelineno-214-19"></a>
<a id="__codelineno-214-20" name="__codelineno-214-20"></a><span class="c1">// Illegal, armor appears twice.</span>
<a id="__codelineno-214-21" name="__codelineno-214-21"></a><span class="p">[</span><span class="n">armor</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">health</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">armor</span><span class="p">](){};</span>
<a id="__codelineno-214-22" name="__codelineno-214-22"></a>
<a id="__codelineno-214-23" name="__codelineno-214-23"></a><span class="c1">// Illegal, the default capture has to be the first element in the capture group.</span>
<a id="__codelineno-214-24" name="__codelineno-214-24"></a><span class="p">[</span><span class="n">armor</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="p">](){};</span>
</code></pre></div></td></tr></table></div>
<div class="admonition extra">
<p class="admonition-title">在捕获子句中定义新变量</p>
<p>如果我们希望捕获到一个被轻微修改后的外部变量，或声明一个仅在 lambda 内可见的新变量，我们可以在捕获子句中不指定其类型地定义一个新变量。</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-215-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-215-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-215-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-215-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-215-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-215-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-215-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-215-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-215-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-215-10">10</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-215-1" name="__codelineno-215-1"></a><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">{</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="p">};</span>
<a id="__codelineno-215-2" name="__codelineno-215-2"></a><span class="kt">int</span><span class="w"> </span><span class="n">y</span><span class="p">{</span><span class="w"> </span><span class="mi">7</span><span class="w"> </span><span class="p">};</span>
<a id="__codelineno-215-3" name="__codelineno-215-3"></a><span class="kt">int</span><span class="w"> </span><span class="n">z</span><span class="p">{</span><span class="w"> </span><span class="mi">9</span><span class="w"> </span><span class="p">};</span>
<a id="__codelineno-215-4" name="__codelineno-215-4"></a>
<a id="__codelineno-215-5" name="__codelineno-215-5"></a><span class="k">auto</span><span class="w"> </span><span class="n">equal</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>
<a id="__codelineno-215-6" name="__codelineno-215-6"></a><span class="w">    </span><span class="c1">// w 的类型将被推断为 int</span>
<a id="__codelineno-215-7" name="__codelineno-215-7"></a><span class="w">        </span><span class="p">[</span><span class="w"> </span><span class="n">w</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">z</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-215-8" name="__codelineno-215-8"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">z</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">w</span><span class="p">;</span>
<a id="__codelineno-215-9" name="__codelineno-215-9"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span>
<a id="__codelineno-215-10" name="__codelineno-215-10"></a><span class="w">    </span><span class="p">};</span>
</code></pre></div></td></tr></table></div>
<p>我们最好仅在变量的类型很明显并且它的定义很简短时才考虑在捕获子句中定义新变量，否则最好在 lambda 之外定义一个变量，然后捕获它。</p>
</div>
<hr/>
<h2 id="_59">运算符重载<a class="headerlink" href="#_59" title="Permanent link">¶</a></h2>
<h3 id="_60">简单的运算符重载<a class="headerlink" href="#_60" title="Permanent link">¶</a></h3>
<p>最基础的运算符重载非常简单</p>
<ul>
<li>使用运算符名称作为函数名称来定义一个函数</li>
<li>从左到右为每个操作数添加适当的类型定义，这些参数至少有一个是用户定义的类型（包括枚举类型、类类型等）</li>
<li>将返回类型设置为相应的有意义的类型</li>
<li>使用 return 语句返回操作的结果</li>
</ul>
<p>我们首先回顾一下运算符 <code>&lt;&lt;</code> 用于输出时的工作原理：考虑一个简单的表达式 <code>std::cout &lt;&lt; 5</code>，<code>std::cout</code> 具有类型<code>std::ostream</code>，而 <code>5</code> 是 <code>int</code> 类型的字面量。计算这个表达式时，编译器首先查找可以处理<code>std::ostream</code>和<code>int</code>类型的重载函数并调用它。在这个函数内部，<code>std::cout</code> 用于将右操作数<code>x</code>输出到控制台，然后<code>operator&lt;&lt;</code>函数返回其左操作数（在本例中为<code>std::cout</code>），以便可以对<code>operator&lt;&lt;</code>进行后续的调用。</p>
<p>下面我们考虑一个自定义的枚举类型 <code>Color</code></p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-216-1">1</a></span>
<span class="normal"><a href="#__codelineno-216-2">2</a></span>
<span class="normal"><a href="#__codelineno-216-3">3</a></span>
<span class="normal"><a href="#__codelineno-216-4">4</a></span>
<span class="normal"><a href="#__codelineno-216-5">5</a></span>
<span class="normal"><a href="#__codelineno-216-6">6</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-216-1" name="__codelineno-216-1"></a><span class="k">enum</span><span class="w"> </span><span class="nc">Color</span>
<a id="__codelineno-216-2" name="__codelineno-216-2"></a><span class="p">{</span>
<a id="__codelineno-216-3" name="__codelineno-216-3"></a><span class="w">    </span><span class="n">black</span><span class="p">,</span>
<a id="__codelineno-216-4" name="__codelineno-216-4"></a><span class="w">    </span><span class="n">red</span><span class="p">,</span>
<a id="__codelineno-216-5" name="__codelineno-216-5"></a><span class="w">    </span><span class="n">blue</span><span class="p">,</span>
<a id="__codelineno-216-6" name="__codelineno-216-6"></a><span class="p">};</span>
</code></pre></div></td></tr></table></div>
<p>如果我们直接使用 <code>std::cout &lt;&lt; black</code>，得到的输出结果将是 <code>0</code>，因为这时候编译器会把枚举值隐式转换为整数。如果我们希望输出结果是 <code>black</code> 而非 <code>0</code>，就需要重载运算符 <code>&lt;&lt;</code>。</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-217-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-217-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-217-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-217-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-217-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-217-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-217-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-217-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-217-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-217-10">10</a></span>
<span class="normal"><a href="#__codelineno-217-11">11</a></span>
<span class="normal"><a href="#__codelineno-217-12">12</a></span>
<span class="normal"><a href="#__codelineno-217-13">13</a></span>
<span class="normal"><a href="#__codelineno-217-14">14</a></span>
<span class="normal"><a href="#__codelineno-217-15">15</a></span>
<span class="normal"><a href="#__codelineno-217-16">16</a></span>
<span class="normal"><a href="#__codelineno-217-17">17</a></span>
<span class="normal"><a href="#__codelineno-217-18">18</a></span>
<span class="normal"><a href="#__codelineno-217-19">19</a></span>
<span class="normal"><a href="#__codelineno-217-20">20</a></span>
<span class="normal"><a href="#__codelineno-217-21">21</a></span>
<span class="normal"><a href="#__codelineno-217-22">22</a></span>
<span class="normal"><a href="#__codelineno-217-23">23</a></span>
<span class="normal"><a href="#__codelineno-217-24">24</a></span>
<span class="normal"><a href="#__codelineno-217-25">25</a></span>
<span class="normal"><a href="#__codelineno-217-26">26</a></span>
<span class="normal"><a href="#__codelineno-217-27">27</a></span>
<span class="normal"><a href="#__codelineno-217-28">28</a></span>
<span class="normal"><a href="#__codelineno-217-29">29</a></span>
<span class="normal"><a href="#__codelineno-217-30">30</a></span>
<span class="normal"><a href="#__codelineno-217-31">31</a></span>
<span class="normal"><a href="#__codelineno-217-32">32</a></span>
<span class="normal"><a href="#__codelineno-217-33">33</a></span>
<span class="normal"><a href="#__codelineno-217-34">34</a></span>
<span class="normal"><a href="#__codelineno-217-35">35</a></span>
<span class="normal"><a href="#__codelineno-217-36">36</a></span>
<span class="normal"><a href="#__codelineno-217-37">37</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-217-1" name="__codelineno-217-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span>
<a id="__codelineno-217-2" name="__codelineno-217-2"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;string_view&gt;</span>
<a id="__codelineno-217-3" name="__codelineno-217-3"></a>
<a id="__codelineno-217-4" name="__codelineno-217-4"></a><span class="k">enum</span><span class="w"> </span><span class="nc">Color</span>
<a id="__codelineno-217-5" name="__codelineno-217-5"></a><span class="p">{</span>
<a id="__codelineno-217-6" name="__codelineno-217-6"></a><span class="w">    </span><span class="n">black</span><span class="p">,</span>
<a id="__codelineno-217-7" name="__codelineno-217-7"></a><span class="w">    </span><span class="n">red</span><span class="p">,</span>
<a id="__codelineno-217-8" name="__codelineno-217-8"></a><span class="w">    </span><span class="n">blue</span><span class="p">,</span>
<a id="__codelineno-217-9" name="__codelineno-217-9"></a><span class="p">};</span>
<a id="__codelineno-217-10" name="__codelineno-217-10"></a>
<a id="__codelineno-217-11" name="__codelineno-217-11"></a><span class="k">constexpr</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string_view</span><span class="w"> </span><span class="nf">getColorName</span><span class="p">(</span><span class="n">Color</span><span class="w"> </span><span class="n">color</span><span class="p">)</span>
<a id="__codelineno-217-12" name="__codelineno-217-12"></a><span class="p">{</span>
<a id="__codelineno-217-13" name="__codelineno-217-13"></a><span class="w">    </span><span class="k">switch</span><span class="w"> </span><span class="p">(</span><span class="n">color</span><span class="p">)</span>
<a id="__codelineno-217-14" name="__codelineno-217-14"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-217-15" name="__codelineno-217-15"></a><span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="no">black</span><span class="p">:</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="s">"black"</span><span class="p">;</span>
<a id="__codelineno-217-16" name="__codelineno-217-16"></a><span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="no">red</span><span class="p">:</span><span class="w">   </span><span class="k">return</span><span class="w"> </span><span class="s">"red"</span><span class="p">;</span>
<a id="__codelineno-217-17" name="__codelineno-217-17"></a><span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="no">blue</span><span class="p">:</span><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="s">"blue"</span><span class="p">;</span>
<a id="__codelineno-217-18" name="__codelineno-217-18"></a><span class="w">    </span><span class="k">default</span><span class="o">:</span><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="s">"???"</span><span class="p">;</span>
<a id="__codelineno-217-19" name="__codelineno-217-19"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-217-20" name="__codelineno-217-20"></a><span class="p">}</span>
<a id="__codelineno-217-21" name="__codelineno-217-21"></a>
<a id="__codelineno-217-22" name="__codelineno-217-22"></a><span class="n">std</span><span class="o">::</span><span class="n">ostream</span><span class="o">&amp;</span><span class="w"> </span><span class="k">operator</span><span class="o">&lt;&lt;</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">ostream</span><span class="o">&amp;</span><span class="w"> </span><span class="n">out</span><span class="p">,</span><span class="w"> </span><span class="n">Color</span><span class="w"> </span><span class="n">color</span><span class="p">)</span>
<a id="__codelineno-217-23" name="__codelineno-217-23"></a><span class="p">{</span>
<a id="__codelineno-217-24" name="__codelineno-217-24"></a><span class="w">    </span><span class="n">out</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">getColorName</span><span class="p">(</span><span class="n">color</span><span class="p">);</span><span class="w"> </span>
<a id="__codelineno-217-25" name="__codelineno-217-25"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">out</span><span class="p">;</span><span class="w">                 </span>
<a id="__codelineno-217-26" name="__codelineno-217-26"></a>
<a id="__codelineno-217-27" name="__codelineno-217-27"></a><span class="w">    </span><span class="c1">// 也可简写为一行代码：</span>
<a id="__codelineno-217-28" name="__codelineno-217-28"></a><span class="w">    </span><span class="c1">// return out &lt;&lt; getColorName(color)</span>
<a id="__codelineno-217-29" name="__codelineno-217-29"></a><span class="p">}</span>
<a id="__codelineno-217-30" name="__codelineno-217-30"></a>
<a id="__codelineno-217-31" name="__codelineno-217-31"></a><span class="kt">int</span><span class="w"> </span><span class="n">main</span><span class="p">()</span>
<a id="__codelineno-217-32" name="__codelineno-217-32"></a><span class="p">{</span>
<a id="__codelineno-217-33" name="__codelineno-217-33"></a><span class="w">    </span><span class="n">Color</span><span class="w"> </span><span class="n">shirt</span><span class="p">{</span><span class="w"> </span><span class="n">blue</span><span class="w"> </span><span class="p">};</span>
<a id="__codelineno-217-34" name="__codelineno-217-34"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"Your shirt is "</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">shirt</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="sc">'\n'</span><span class="p">;</span>
<a id="__codelineno-217-35" name="__codelineno-217-35"></a>
<a id="__codelineno-217-36" name="__codelineno-217-36"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-217-37" name="__codelineno-217-37"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>这段程序的输出结果是</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-218-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-218-1" name="__codelineno-218-1"></a>Your shirt is blue
</code></pre></div></td></tr></table></div>
<details class="example">
<summary>重载 <code>operator&gt;&gt;</code> 以输入枚举类型</summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-219-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-219-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-219-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-219-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-219-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-219-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-219-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-219-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-219-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-219-10">10</a></span>
<span class="normal"><a href="#__codelineno-219-11">11</a></span>
<span class="normal"><a href="#__codelineno-219-12">12</a></span>
<span class="normal"><a href="#__codelineno-219-13">13</a></span>
<span class="normal"><a href="#__codelineno-219-14">14</a></span>
<span class="normal"><a href="#__codelineno-219-15">15</a></span>
<span class="normal"><a href="#__codelineno-219-16">16</a></span>
<span class="normal"><a href="#__codelineno-219-17">17</a></span>
<span class="normal"><a href="#__codelineno-219-18">18</a></span>
<span class="normal"><a href="#__codelineno-219-19">19</a></span>
<span class="normal"><a href="#__codelineno-219-20">20</a></span>
<span class="normal"><a href="#__codelineno-219-21">21</a></span>
<span class="normal"><a href="#__codelineno-219-22">22</a></span>
<span class="normal"><a href="#__codelineno-219-23">23</a></span>
<span class="normal"><a href="#__codelineno-219-24">24</a></span>
<span class="normal"><a href="#__codelineno-219-25">25</a></span>
<span class="normal"><a href="#__codelineno-219-26">26</a></span>
<span class="normal"><a href="#__codelineno-219-27">27</a></span>
<span class="normal"><a href="#__codelineno-219-28">28</a></span>
<span class="normal"><a href="#__codelineno-219-29">29</a></span>
<span class="normal"><a href="#__codelineno-219-30">30</a></span>
<span class="normal"><a href="#__codelineno-219-31">31</a></span>
<span class="normal"><a href="#__codelineno-219-32">32</a></span>
<span class="normal"><a href="#__codelineno-219-33">33</a></span>
<span class="normal"><a href="#__codelineno-219-34">34</a></span>
<span class="normal"><a href="#__codelineno-219-35">35</a></span>
<span class="normal"><a href="#__codelineno-219-36">36</a></span>
<span class="normal"><a href="#__codelineno-219-37">37</a></span>
<span class="normal"><a href="#__codelineno-219-38">38</a></span>
<span class="normal"><a href="#__codelineno-219-39">39</a></span>
<span class="normal"><a href="#__codelineno-219-40">40</a></span>
<span class="normal"><a href="#__codelineno-219-41">41</a></span>
<span class="normal"><a href="#__codelineno-219-42">42</a></span>
<span class="normal"><a href="#__codelineno-219-43">43</a></span>
<span class="normal"><a href="#__codelineno-219-44">44</a></span>
<span class="normal"><a href="#__codelineno-219-45">45</a></span>
<span class="normal"><a href="#__codelineno-219-46">46</a></span>
<span class="normal"><a href="#__codelineno-219-47">47</a></span>
<span class="normal"><a href="#__codelineno-219-48">48</a></span>
<span class="normal"><a href="#__codelineno-219-49">49</a></span>
<span class="normal"><a href="#__codelineno-219-50">50</a></span>
<span class="normal"><a href="#__codelineno-219-51">51</a></span>
<span class="normal"><a href="#__codelineno-219-52">52</a></span>
<span class="normal"><a href="#__codelineno-219-53">53</a></span>
<span class="normal"><a href="#__codelineno-219-54">54</a></span>
<span class="normal"><a href="#__codelineno-219-55">55</a></span>
<span class="normal"><a href="#__codelineno-219-56">56</a></span>
<span class="normal"><a href="#__codelineno-219-57">57</a></span>
<span class="normal"><a href="#__codelineno-219-58">58</a></span>
<span class="normal"><a href="#__codelineno-219-59">59</a></span>
<span class="normal"><a href="#__codelineno-219-60">60</a></span>
<span class="normal"><a href="#__codelineno-219-61">61</a></span>
<span class="normal"><a href="#__codelineno-219-62">62</a></span>
<span class="normal"><a href="#__codelineno-219-63">63</a></span>
<span class="normal"><a href="#__codelineno-219-64">64</a></span>
<span class="normal"><a href="#__codelineno-219-65">65</a></span>
<span class="normal"><a href="#__codelineno-219-66">66</a></span>
<span class="normal"><a href="#__codelineno-219-67">67</a></span>
<span class="normal"><a href="#__codelineno-219-68">68</a></span>
<span class="normal"><a href="#__codelineno-219-69">69</a></span>
<span class="normal"><a href="#__codelineno-219-70">70</a></span>
<span class="normal"><a href="#__codelineno-219-71">71</a></span>
<span class="normal"><a href="#__codelineno-219-72">72</a></span>
<span class="normal"><a href="#__codelineno-219-73">73</a></span>
<span class="normal"><a href="#__codelineno-219-74">74</a></span>
<span class="normal"><a href="#__codelineno-219-75">75</a></span>
<span class="normal"><a href="#__codelineno-219-76">76</a></span>
<span class="normal"><a href="#__codelineno-219-77">77</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-219-1" name="__codelineno-219-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span>
<a id="__codelineno-219-2" name="__codelineno-219-2"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;limits&gt;</span>
<a id="__codelineno-219-3" name="__codelineno-219-3"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;optional&gt;</span>
<a id="__codelineno-219-4" name="__codelineno-219-4"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;string&gt;</span>
<a id="__codelineno-219-5" name="__codelineno-219-5"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;string_view&gt;</span>
<a id="__codelineno-219-6" name="__codelineno-219-6"></a>
<a id="__codelineno-219-7" name="__codelineno-219-7"></a><span class="k">enum</span><span class="w"> </span><span class="nc">Pet</span>
<a id="__codelineno-219-8" name="__codelineno-219-8"></a><span class="p">{</span>
<a id="__codelineno-219-9" name="__codelineno-219-9"></a><span class="w">    </span><span class="n">cat</span><span class="p">,</span><span class="w">   </span><span class="c1">// 0</span>
<a id="__codelineno-219-10" name="__codelineno-219-10"></a><span class="w">    </span><span class="n">dog</span><span class="p">,</span><span class="w">   </span><span class="c1">// 1</span>
<a id="__codelineno-219-11" name="__codelineno-219-11"></a><span class="w">    </span><span class="n">pig</span><span class="p">,</span><span class="w">   </span><span class="c1">// 2</span>
<a id="__codelineno-219-12" name="__codelineno-219-12"></a><span class="w">    </span><span class="n">whale</span><span class="p">,</span><span class="w"> </span><span class="c1">// 3</span>
<a id="__codelineno-219-13" name="__codelineno-219-13"></a><span class="p">};</span>
<a id="__codelineno-219-14" name="__codelineno-219-14"></a>
<a id="__codelineno-219-15" name="__codelineno-219-15"></a><span class="k">constexpr</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string_view</span><span class="w"> </span><span class="nf">getPetName</span><span class="p">(</span><span class="n">Pet</span><span class="w"> </span><span class="n">pet</span><span class="p">)</span>
<a id="__codelineno-219-16" name="__codelineno-219-16"></a><span class="p">{</span>
<a id="__codelineno-219-17" name="__codelineno-219-17"></a><span class="w">    </span><span class="k">switch</span><span class="w"> </span><span class="p">(</span><span class="n">pet</span><span class="p">)</span>
<a id="__codelineno-219-18" name="__codelineno-219-18"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-219-19" name="__codelineno-219-19"></a><span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="no">cat</span><span class="p">:</span><span class="w">   </span><span class="k">return</span><span class="w"> </span><span class="s">"cat"</span><span class="p">;</span>
<a id="__codelineno-219-20" name="__codelineno-219-20"></a><span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="no">dog</span><span class="p">:</span><span class="w">   </span><span class="k">return</span><span class="w"> </span><span class="s">"dog"</span><span class="p">;</span>
<a id="__codelineno-219-21" name="__codelineno-219-21"></a><span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="no">pig</span><span class="p">:</span><span class="w">   </span><span class="k">return</span><span class="w"> </span><span class="s">"pig"</span><span class="p">;</span>
<a id="__codelineno-219-22" name="__codelineno-219-22"></a><span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="no">whale</span><span class="p">:</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="s">"whale"</span><span class="p">;</span>
<a id="__codelineno-219-23" name="__codelineno-219-23"></a><span class="w">    </span><span class="k">default</span><span class="o">:</span><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="s">"???"</span><span class="p">;</span>
<a id="__codelineno-219-24" name="__codelineno-219-24"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-219-25" name="__codelineno-219-25"></a><span class="p">}</span>
<a id="__codelineno-219-26" name="__codelineno-219-26"></a>
<a id="__codelineno-219-27" name="__codelineno-219-27"></a><span class="k">constexpr</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">optional</span><span class="o">&lt;</span><span class="n">Pet</span><span class="o">&gt;</span><span class="w"> </span><span class="n">getPetFromString</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">string_view</span><span class="w"> </span><span class="n">sv</span><span class="p">)</span>
<a id="__codelineno-219-28" name="__codelineno-219-28"></a><span class="p">{</span>
<a id="__codelineno-219-29" name="__codelineno-219-29"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">sv</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">"cat"</span><span class="p">)</span><span class="w">   </span><span class="k">return</span><span class="w"> </span><span class="n">cat</span><span class="p">;</span>
<a id="__codelineno-219-30" name="__codelineno-219-30"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">sv</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">"dog"</span><span class="p">)</span><span class="w">   </span><span class="k">return</span><span class="w"> </span><span class="n">dog</span><span class="p">;</span>
<a id="__codelineno-219-31" name="__codelineno-219-31"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">sv</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">"pig"</span><span class="p">)</span><span class="w">   </span><span class="k">return</span><span class="w"> </span><span class="n">pig</span><span class="p">;</span>
<a id="__codelineno-219-32" name="__codelineno-219-32"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">sv</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">"whale"</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">whale</span><span class="p">;</span>
<a id="__codelineno-219-33" name="__codelineno-219-33"></a>
<a id="__codelineno-219-34" name="__codelineno-219-34"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">{};</span>
<a id="__codelineno-219-35" name="__codelineno-219-35"></a><span class="p">}</span>
<a id="__codelineno-219-36" name="__codelineno-219-36"></a>
<a id="__codelineno-219-37" name="__codelineno-219-37"></a><span class="c1">// pet is an in/out parameter</span>
<a id="__codelineno-219-38" name="__codelineno-219-38"></a><span class="n">std</span><span class="o">::</span><span class="n">istream</span><span class="o">&amp;</span><span class="w"> </span><span class="k">operator</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">istream</span><span class="o">&amp;</span><span class="w"> </span><span class="n">in</span><span class="p">,</span><span class="w"> </span><span class="n">Pet</span><span class="o">&amp;</span><span class="w"> </span><span class="n">pet</span><span class="p">)</span>
<a id="__codelineno-219-39" name="__codelineno-219-39"></a><span class="p">{</span>
<a id="__codelineno-219-40" name="__codelineno-219-40"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">s</span><span class="p">{};</span>
<a id="__codelineno-219-41" name="__codelineno-219-41"></a><span class="w">    </span><span class="n">in</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">s</span><span class="p">;</span><span class="w"> </span><span class="c1">// get input string from user</span>
<a id="__codelineno-219-42" name="__codelineno-219-42"></a>
<a id="__codelineno-219-43" name="__codelineno-219-43"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">optional</span><span class="o">&lt;</span><span class="n">Pet</span><span class="o">&gt;</span><span class="w"> </span><span class="n">match</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">getPetFromString</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="w"> </span><span class="p">};</span>
<a id="__codelineno-219-44" name="__codelineno-219-44"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">match</span><span class="p">)</span><span class="w"> </span><span class="c1">// if we found a match</span>
<a id="__codelineno-219-45" name="__codelineno-219-45"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-219-46" name="__codelineno-219-46"></a><span class="w">        </span><span class="n">pet</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">*</span><span class="n">match</span><span class="p">;</span><span class="w"> </span><span class="c1">// dereference std::optional to get matching enumerator</span>
<a id="__codelineno-219-47" name="__codelineno-219-47"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">in</span><span class="p">;</span>
<a id="__codelineno-219-48" name="__codelineno-219-48"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-219-49" name="__codelineno-219-49"></a>
<a id="__codelineno-219-50" name="__codelineno-219-50"></a><span class="w">    </span><span class="c1">// We didn't find a match, so input must have been invalid</span>
<a id="__codelineno-219-51" name="__codelineno-219-51"></a><span class="w">    </span><span class="c1">// so we will set input stream to fail state</span>
<a id="__codelineno-219-52" name="__codelineno-219-52"></a><span class="w">    </span><span class="n">in</span><span class="p">.</span><span class="n">setstate</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">ios_base</span><span class="o">::</span><span class="n">failbit</span><span class="p">);</span>
<a id="__codelineno-219-53" name="__codelineno-219-53"></a>
<a id="__codelineno-219-54" name="__codelineno-219-54"></a><span class="w">    </span><span class="c1">// On an extraction failure, operator&gt;&gt; zero-initializes fundamental types</span>
<a id="__codelineno-219-55" name="__codelineno-219-55"></a><span class="w">    </span><span class="c1">// Uncomment the following line to make this operator do the same thing</span>
<a id="__codelineno-219-56" name="__codelineno-219-56"></a><span class="w">    </span><span class="c1">// pet = {};</span>
<a id="__codelineno-219-57" name="__codelineno-219-57"></a>
<a id="__codelineno-219-58" name="__codelineno-219-58"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">in</span><span class="p">;</span>
<a id="__codelineno-219-59" name="__codelineno-219-59"></a><span class="p">}</span>
<a id="__codelineno-219-60" name="__codelineno-219-60"></a>
<a id="__codelineno-219-61" name="__codelineno-219-61"></a><span class="kt">int</span><span class="w"> </span><span class="n">main</span><span class="p">()</span>
<a id="__codelineno-219-62" name="__codelineno-219-62"></a><span class="p">{</span>
<a id="__codelineno-219-63" name="__codelineno-219-63"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"Enter a pet: cat, dog, pig, or whale: "</span><span class="p">;</span>
<a id="__codelineno-219-64" name="__codelineno-219-64"></a><span class="w">    </span><span class="n">Pet</span><span class="w"> </span><span class="n">pet</span><span class="p">{};</span>
<a id="__codelineno-219-65" name="__codelineno-219-65"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cin</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">pet</span><span class="p">;</span>
<a id="__codelineno-219-66" name="__codelineno-219-66"></a>
<a id="__codelineno-219-67" name="__codelineno-219-67"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">cin</span><span class="p">)</span><span class="w"> </span><span class="c1">// if we found a match</span>
<a id="__codelineno-219-68" name="__codelineno-219-68"></a><span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"You chose: "</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">getPetName</span><span class="p">(</span><span class="n">pet</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="sc">'\n'</span><span class="p">;</span>
<a id="__codelineno-219-69" name="__codelineno-219-69"></a><span class="w">    </span><span class="k">else</span>
<a id="__codelineno-219-70" name="__codelineno-219-70"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-219-71" name="__codelineno-219-71"></a><span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">cin</span><span class="p">.</span><span class="n">clear</span><span class="p">();</span><span class="w"> </span><span class="c1">// reset the input stream to good</span>
<a id="__codelineno-219-72" name="__codelineno-219-72"></a><span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">cin</span><span class="p">.</span><span class="n">ignore</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">numeric_limits</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">streamsize</span><span class="o">&gt;::</span><span class="n">max</span><span class="p">(),</span><span class="w"> </span><span class="sc">'\n'</span><span class="p">);</span>
<a id="__codelineno-219-73" name="__codelineno-219-73"></a><span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"Your pet was not valid</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
<a id="__codelineno-219-74" name="__codelineno-219-74"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-219-75" name="__codelineno-219-75"></a>
<a id="__codelineno-219-76" name="__codelineno-219-76"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-219-77" name="__codelineno-219-77"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ul>
<li><code>std::cin</code>具有类型的<code>std::istream</code>，因此我们使用<code>std::istream&amp;</code>作为左参数的类型和返回值，而不是<code>std::ostream&amp;</code>。</li>
<li>pet 参数是一个非 const 引用，这允许我们在提取结果匹配的情况下用<code>operator&gt;&gt;</code> 给 pet 赋值。</li>
<li>在函数内部，我们使用<code>operator&gt;&gt;</code>输入<code>std::string</code>，如果用户输入的值与我们预先设置好的宠物种类匹配，那么我们就可以为 pet 分配适当的值并返回左操作数 in。</li>
<li>如果用户没有输入有效的宠物种类，那么我们就通过将<code>std::cin</code>置于“失败模式”来处理这种情况。</li>
</ul>
</details>
<div class="admonition warning">
<p class="admonition-title">运算符重载的限制</p>
<ol>
<li>少部分运算符不允许重载：条件选择运算符（<code>?:</code>）、作用域解析运算符（<code>::</code>）、成员选择运算符（<code>.</code> 和 <code>.*</code>）、sizeof 运算符、typeid、类型转换运算符（<code>static_cast</code>、<code>dynamic_cast</code>、<code>const_cast</code>、<code>reinterpret_cast</code>）。</li>
<li>只能重载现有的运算符，不能创建新的运算符或重命名现有的运算符。</li>
<li>重载的运算符必须至少有一个用户定义的类型作为操作数。</li>
<li>操作符的操作数数量不可被改变</li>
<li>不能改变操作符的优先级或结合性</li>
</ol>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul>
<li>不修改其操作数的运算符（例如算术运算符）通常按值返回结果</li>
<li>修改其最左侧操作数的运算符（例如赋值运算符）通常返回最左侧操作数的引用</li>
</ul>
</div>
<h3 id="_61">使用友元函数重载操作符<a class="headerlink" href="#_61" title="Permanent link">¶</a></h3>
<p>考虑一个简单的类，我们可以使用友元函数来重载操作符<code>+</code></p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-220-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-220-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-220-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-220-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-220-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-220-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-220-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-220-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-220-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-220-10">10</a></span>
<span class="normal"><a href="#__codelineno-220-11">11</a></span>
<span class="normal"><a href="#__codelineno-220-12">12</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-220-1" name="__codelineno-220-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">Cents</span>
<a id="__codelineno-220-2" name="__codelineno-220-2"></a><span class="p">{</span>
<a id="__codelineno-220-3" name="__codelineno-220-3"></a><span class="k">private</span><span class="o">:</span>
<a id="__codelineno-220-4" name="__codelineno-220-4"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">m_cents</span><span class="w"> </span><span class="p">{};</span>
<a id="__codelineno-220-5" name="__codelineno-220-5"></a>
<a id="__codelineno-220-6" name="__codelineno-220-6"></a><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-220-7" name="__codelineno-220-7"></a><span class="w">    </span><span class="n">Cents</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">cents</span><span class="p">)</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">m_cents</span><span class="p">{</span><span class="w"> </span><span class="n">cents</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-220-8" name="__codelineno-220-8"></a>
<a id="__codelineno-220-9" name="__codelineno-220-9"></a><span class="hll"><span class="w">    </span><span class="k">friend</span><span class="w"> </span><span class="n">Cents</span><span class="w"> </span><span class="k">operator</span><span class="o">+</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">Cents</span><span class="o">&amp;</span><span class="w"> </span><span class="n">c1</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">Cents</span><span class="o">&amp;</span><span class="w"> </span><span class="n">c2</span><span class="p">);</span>
</span><a id="__codelineno-220-10" name="__codelineno-220-10"></a>
<a id="__codelineno-220-11" name="__codelineno-220-11"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="nf">getCents</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">m_cents</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-220-12" name="__codelineno-220-12"></a><span class="p">};</span>
</code></pre></div></td></tr></table></div>
<div class="tabbed-set tabbed-alternate" data-tabs="4:2"><input checked="checked" id="__tabbed_4_1" name="__tabbed_4" type="radio"><input id="__tabbed_4_2" name="__tabbed_4" type="radio"><div class="tabbed-labels"><label for="__tabbed_4_1">类定义之外声明友元函数</label><label for="__tabbed_4_2">类定义内声明友元函数</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-221-1">1</a></span>
<span class="normal"><a href="#__codelineno-221-2">2</a></span>
<span class="normal"><a href="#__codelineno-221-3">3</a></span>
<span class="normal"><a href="#__codelineno-221-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-221-1" name="__codelineno-221-1"></a><span class="n">Cents</span><span class="w"> </span><span class="k">operator</span><span class="o">+</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">Cents</span><span class="o">&amp;</span><span class="w"> </span><span class="n">c1</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">Cents</span><span class="o">&amp;</span><span class="w"> </span><span class="n">c2</span><span class="p">)</span>
<a id="__codelineno-221-2" name="__codelineno-221-2"></a><span class="p">{</span>
<a id="__codelineno-221-3" name="__codelineno-221-3"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">c1</span><span class="p">.</span><span class="n">m_cents</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">c2</span><span class="p">.</span><span class="n">m_cents</span><span class="p">;</span>
<a id="__codelineno-221-4" name="__codelineno-221-4"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
</div>
<div class="tabbed-block">
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-222-1">1</a></span>
<span class="normal"><a href="#__codelineno-222-2">2</a></span>
<span class="normal"><a href="#__codelineno-222-3">3</a></span>
<span class="normal"><a href="#__codelineno-222-4">4</a></span>
<span class="normal"><a href="#__codelineno-222-5">5</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-222-1" name="__codelineno-222-1"></a><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-222-2" name="__codelineno-222-2"></a><span class="w">    </span><span class="k">friend</span><span class="w"> </span><span class="n">Cents</span><span class="w"> </span><span class="k">operator</span><span class="o">+</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">Cents</span><span class="o">&amp;</span><span class="w"> </span><span class="n">c1</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">Cents</span><span class="o">&amp;</span><span class="w"> </span><span class="n">c2</span><span class="p">)</span>
<a id="__codelineno-222-3" name="__codelineno-222-3"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-222-4" name="__codelineno-222-4"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">Cents</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">c1</span><span class="p">.</span><span class="n">m_cents</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">c2</span><span class="p">.</span><span class="n">m_cents</span><span class="w"> </span><span class="p">};</span>
<a id="__codelineno-222-5" name="__codelineno-222-5"></a><span class="w">    </span><span class="p">}</span>
</code></pre></div></td></tr></table></div>
</div>
</div>
</input></input></div>
<p>如果我们希望 Cent 类的对象可以与整数相加，我们也可以用类似的方式重载 <code>+</code> 运算符。但是需要注意的是 <code>Cents(4) + 6</code> 和 <code>6 + Cents(4)</code> 是不同的，前者调用 operate+(Cents, int)，后者调用 operate+(int, Cents)，我们需要对这两种情况分别进行重载。</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-223-1">1</a></span>
<span class="normal"><a href="#__codelineno-223-2">2</a></span>
<span class="normal"><a href="#__codelineno-223-3">3</a></span>
<span class="normal"><a href="#__codelineno-223-4">4</a></span>
<span class="normal"><a href="#__codelineno-223-5">5</a></span>
<span class="normal"><a href="#__codelineno-223-6">6</a></span>
<span class="normal"><a href="#__codelineno-223-7">7</a></span>
<span class="normal"><a href="#__codelineno-223-8">8</a></span>
<span class="normal"><a href="#__codelineno-223-9">9</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-223-1" name="__codelineno-223-1"></a><span class="n">Cents</span><span class="w"> </span><span class="k">operator</span><span class="o">+</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">Cents</span><span class="o">&amp;</span><span class="w"> </span><span class="n">c1</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">value</span><span class="p">)</span>
<a id="__codelineno-223-2" name="__codelineno-223-2"></a><span class="p">{</span>
<a id="__codelineno-223-3" name="__codelineno-223-3"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">Cents</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">c1</span><span class="p">.</span><span class="n">m_cents</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="p">};</span>
<a id="__codelineno-223-4" name="__codelineno-223-4"></a><span class="p">}</span>
<a id="__codelineno-223-5" name="__codelineno-223-5"></a>
<a id="__codelineno-223-6" name="__codelineno-223-6"></a><span class="n">Cents</span><span class="w"> </span><span class="k">operator</span><span class="o">+</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">value</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">Cents</span><span class="o">&amp;</span><span class="w"> </span><span class="n">c1</span><span class="p">)</span>
<a id="__codelineno-223-7" name="__codelineno-223-7"></a><span class="p">{</span>
<a id="__codelineno-223-8" name="__codelineno-223-8"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">Cents</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">c1</span><span class="p">.</span><span class="n">m_cents</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="p">};</span>
<a id="__codelineno-223-9" name="__codelineno-223-9"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>值得一提的是，我们可以用其他经过重载后运算符来重载运算符，例如上面第二个形式我们可以写成</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-224-1">1</a></span>
<span class="normal"><a href="#__codelineno-224-2">2</a></span>
<span class="normal"><a href="#__codelineno-224-3">3</a></span>
<span class="normal"><a href="#__codelineno-224-4">4</a></span>
<span class="normal"><a href="#__codelineno-224-5">5</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-224-1" name="__codelineno-224-1"></a><span class="n">Cents</span><span class="w"> </span><span class="k">operator</span><span class="o">+</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">value</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">Cents</span><span class="o">&amp;</span><span class="w"> </span><span class="n">c1</span><span class="p">)</span>
<a id="__codelineno-224-2" name="__codelineno-224-2"></a><span class="p">{</span>
<a id="__codelineno-224-3" name="__codelineno-224-3"></a><span class="w">    </span><span class="c1">// 调用 operator+(const Cents&amp;, int)</span>
<a id="__codelineno-224-4" name="__codelineno-224-4"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">c1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">value</span><span class="p">;</span>
<a id="__codelineno-224-5" name="__codelineno-224-5"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h3 id="_62">使用普通函数重载运算符<a class="headerlink" href="#_62" title="Permanent link">¶</a></h3>
<p>使用普通函数对我们的类进行运算符重载实际上和友元函数没有太大区别，唯一的区别在于普通函数不能直接访问类的 private 和 protected 成员，需要通过 public 的访问函数来访问。</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-225-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-225-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-225-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-225-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-225-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-225-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-225-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-225-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-225-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-225-10">10</a></span>
<span class="normal"><a href="#__codelineno-225-11">11</a></span>
<span class="normal"><a href="#__codelineno-225-12">12</a></span>
<span class="normal"><a href="#__codelineno-225-13">13</a></span>
<span class="normal"><a href="#__codelineno-225-14">14</a></span>
<span class="normal"><a href="#__codelineno-225-15">15</a></span>
<span class="normal"><a href="#__codelineno-225-16">16</a></span>
<span class="normal"><a href="#__codelineno-225-17">17</a></span>
<span class="normal"><a href="#__codelineno-225-18">18</a></span>
<span class="normal"><a href="#__codelineno-225-19">19</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-225-1" name="__codelineno-225-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">Cents</span>
<a id="__codelineno-225-2" name="__codelineno-225-2"></a><span class="p">{</span>
<a id="__codelineno-225-3" name="__codelineno-225-3"></a><span class="k">private</span><span class="o">:</span>
<a id="__codelineno-225-4" name="__codelineno-225-4"></a><span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">m_cents</span><span class="p">{};</span>
<a id="__codelineno-225-5" name="__codelineno-225-5"></a>
<a id="__codelineno-225-6" name="__codelineno-225-6"></a><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-225-7" name="__codelineno-225-7"></a><span class="w">  </span><span class="n">Cents</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">cents</span><span class="p">)</span>
<a id="__codelineno-225-8" name="__codelineno-225-8"></a><span class="w">    </span><span class="o">:</span><span class="w"> </span><span class="n">m_cents</span><span class="p">{</span><span class="w"> </span><span class="n">cents</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-225-9" name="__codelineno-225-9"></a><span class="w">  </span><span class="p">{}</span>
<a id="__codelineno-225-10" name="__codelineno-225-10"></a>
<a id="__codelineno-225-11" name="__codelineno-225-11"></a><span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">getCents</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">m_cents</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-225-12" name="__codelineno-225-12"></a><span class="p">};</span>
<a id="__codelineno-225-13" name="__codelineno-225-13"></a>
<a id="__codelineno-225-14" name="__codelineno-225-14"></a><span class="c1">// not a member function, nor a friend function!</span>
<a id="__codelineno-225-15" name="__codelineno-225-15"></a><span class="n">Cents</span><span class="w"> </span><span class="k">operator</span><span class="o">+</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">Cents</span><span class="o">&amp;</span><span class="w"> </span><span class="n">c1</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">Cents</span><span class="o">&amp;</span><span class="w"> </span><span class="n">c2</span><span class="p">)</span>
<a id="__codelineno-225-16" name="__codelineno-225-16"></a><span class="p">{</span>
<a id="__codelineno-225-17" name="__codelineno-225-17"></a><span class="w">  </span><span class="c1">// 需要通过访问函数来访问 private 成员  </span>
<a id="__codelineno-225-18" name="__codelineno-225-18"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">Cents</span><span class="p">{</span><span class="w"> </span><span class="n">c1</span><span class="p">.</span><span class="n">getCents</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">c2</span><span class="p">.</span><span class="n">getCents</span><span class="p">()</span><span class="w"> </span><span class="p">};</span>
<a id="__codelineno-225-19" name="__codelineno-225-19"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<div class="admonition note">
<p class="admonition-title">Best practice</p>
<p>在不添加其他额外的函数的情况下，最好通过普通函数对运算符进行重载，而非友元函数。</p>
</div>
<h3 id="_63">使用成员函数重载运算符<a class="headerlink" href="#_63" title="Permanent link">¶</a></h3>
<p>使用成员函数重载运算符和使用友元函数也很类似，但区别在于：</p>
<ul>
<li>被重载的运算符必须作为左操作数的成员函数</li>
<li>左操作数是调用运算符的对象，是隐式的 <code>*this</code> 指针</li>
<li>其他操作数作为参数传递给成员函数</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-226-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-226-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-226-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-226-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-226-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-226-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-226-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-226-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-226-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-226-10">10</a></span>
<span class="normal"><a href="#__codelineno-226-11">11</a></span>
<span class="normal"><a href="#__codelineno-226-12">12</a></span>
<span class="normal"><a href="#__codelineno-226-13">13</a></span>
<span class="normal"><a href="#__codelineno-226-14">14</a></span>
<span class="normal"><a href="#__codelineno-226-15">15</a></span>
<span class="normal"><a href="#__codelineno-226-16">16</a></span>
<span class="normal"><a href="#__codelineno-226-17">17</a></span>
<span class="normal"><a href="#__codelineno-226-18">18</a></span>
<span class="normal"><a href="#__codelineno-226-19">19</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-226-1" name="__codelineno-226-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">Cents</span>
<a id="__codelineno-226-2" name="__codelineno-226-2"></a><span class="p">{</span>
<a id="__codelineno-226-3" name="__codelineno-226-3"></a><span class="k">private</span><span class="o">:</span>
<a id="__codelineno-226-4" name="__codelineno-226-4"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">m_cents</span><span class="w"> </span><span class="p">{};</span>
<a id="__codelineno-226-5" name="__codelineno-226-5"></a>
<a id="__codelineno-226-6" name="__codelineno-226-6"></a><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-226-7" name="__codelineno-226-7"></a><span class="w">    </span><span class="n">Cents</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">cents</span><span class="p">)</span>
<a id="__codelineno-226-8" name="__codelineno-226-8"></a><span class="w">        </span><span class="o">:</span><span class="w"> </span><span class="n">m_cents</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">cents</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-226-9" name="__codelineno-226-9"></a>
<a id="__codelineno-226-10" name="__codelineno-226-10"></a><span class="w">    </span><span class="c1">// Overload Cents + int</span>
<a id="__codelineno-226-11" name="__codelineno-226-11"></a><span class="w">    </span><span class="n">Cents</span><span class="w"> </span><span class="k">operator</span><span class="o">+</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">value</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="p">;</span>
<a id="__codelineno-226-12" name="__codelineno-226-12"></a>
<a id="__codelineno-226-13" name="__codelineno-226-13"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="nf">getCents</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">m_cents</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-226-14" name="__codelineno-226-14"></a><span class="p">};</span>
<a id="__codelineno-226-15" name="__codelineno-226-15"></a>
<a id="__codelineno-226-16" name="__codelineno-226-16"></a><span class="n">Cents</span><span class="w"> </span><span class="n">Cents</span><span class="o">::</span><span class="k">operator</span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">value</span><span class="p">)</span><span class="w"> </span><span class="k">const</span>
<a id="__codelineno-226-17" name="__codelineno-226-17"></a><span class="p">{</span>
<a id="__codelineno-226-18" name="__codelineno-226-18"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">Cents</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">m_cents</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="p">};</span>
<a id="__codelineno-226-19" name="__codelineno-226-19"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>在友元函数的版本中，表达式 <code>cents1 + 2</code> 调用的是 <code>operator+(cents1, 2)</code></li>
<li>而在成员函数的版本中，表达式 <code>cents1 + 2</code> 调用的是 <code>cents1.operator+(2)</code>，考虑到成员函数隐式地传入了 <code>this</code> 指针，这个调用实际上是 <code>operator+(&amp;​cents1, 2)</code></li>
</ul>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<ul>
<li>
<p>并非所有运算符都可以作为友元函数重载</p>
<ul>
<li>例如赋值运算符 <code>=</code>、下标运算符 <code>[]</code>、函数调用运算符 <code>()</code> 和成员访问运算符 <code>-&gt;</code> 等必须作为成员函数重载。</li>
</ul>
</li>
<li>
<p>并非所有运算符都可以作为成员函数重载</p>
<ul>
<li>例如运算符 <code>&lt;&lt;</code> 和 <code>&gt;&gt;</code> 不能作为成员函数重载，因为它们的左操作数分别是 <code>std::ostream</code> 和 <code>std::istream</code>，而成员函数重载的运算符要求左操作数一定是我们自定义的类。</li>
</ul>
</li>
</ul>
</div>
<div class="admonition question">
<p class="admonition-title">何时用何种形式重载运算符？</p>
<ul>
<li>如果需要重载 <code>=</code>、<code>[]</code>、<code>()</code> 或 <code>-&gt;</code> 等运算符，必须使用成员函数重载</li>
<li>如果需要重载一元运算符（例如 <code>+</code>、<code>-</code>、<code>++</code>、<code>--</code> 等），通常使用成员函数重载</li>
<li>如果要重载一个不会修改其左操作数的运算符（例如 <code>+</code> 等），使用普通函数（首选）或友元函数重载。</li>
<li>如果要重载一个修改其左操作数的运算符，但我们无法把它添加为左操作数的成员函数时（例如 <code>&lt;&lt;</code> 等），使用普通函数（首选）或友元函数重载。</li>
<li>如果要重载一个修改其左操作数的运算符，并且我们可以把它添加为左操作数的成员函数时（例如 <code>+=</code> 等），使用成员函数重载。</li>
</ul>
</div>
<h3 id="-">重载 ++ 和 -- 运算符<a class="headerlink" href="#-" title="Permanent link">¶</a></h3>
<p>由于递增和递减运算符 <code>++</code> 和 <code>--</code> 有前缀和后缀两种形式，因此我们需要重载两个版本的运算符。因为它们都是一元运算符，并且会修改操作数，所以我们最好将其作为成员函数重载。</p>
<h4 id="_64">前缀递增和递减<a class="headerlink" href="#_64" title="Permanent link">¶</a></h4>
<p>我们实现一个简单的类，用于存储一位的十进制数字，然后重载前缀递增和递减运算符。</p>
<details class="example">
<summary>code</summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-227-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-227-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-227-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-227-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-227-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-227-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-227-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-227-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-227-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-227-10">10</a></span>
<span class="normal"><a href="#__codelineno-227-11">11</a></span>
<span class="normal"><a href="#__codelineno-227-12">12</a></span>
<span class="normal"><a href="#__codelineno-227-13">13</a></span>
<span class="normal"><a href="#__codelineno-227-14">14</a></span>
<span class="normal"><a href="#__codelineno-227-15">15</a></span>
<span class="normal"><a href="#__codelineno-227-16">16</a></span>
<span class="normal"><a href="#__codelineno-227-17">17</a></span>
<span class="normal"><a href="#__codelineno-227-18">18</a></span>
<span class="normal"><a href="#__codelineno-227-19">19</a></span>
<span class="normal"><a href="#__codelineno-227-20">20</a></span>
<span class="normal"><a href="#__codelineno-227-21">21</a></span>
<span class="normal"><a href="#__codelineno-227-22">22</a></span>
<span class="normal"><a href="#__codelineno-227-23">23</a></span>
<span class="normal"><a href="#__codelineno-227-24">24</a></span>
<span class="normal"><a href="#__codelineno-227-25">25</a></span>
<span class="normal"><a href="#__codelineno-227-26">26</a></span>
<span class="normal"><a href="#__codelineno-227-27">27</a></span>
<span class="normal"><a href="#__codelineno-227-28">28</a></span>
<span class="normal"><a href="#__codelineno-227-29">29</a></span>
<span class="normal"><a href="#__codelineno-227-30">30</a></span>
<span class="normal"><a href="#__codelineno-227-31">31</a></span>
<span class="normal"><a href="#__codelineno-227-32">32</a></span>
<span class="normal"><a href="#__codelineno-227-33">33</a></span>
<span class="normal"><a href="#__codelineno-227-34">34</a></span>
<span class="normal"><a href="#__codelineno-227-35">35</a></span>
<span class="normal"><a href="#__codelineno-227-36">36</a></span>
<span class="normal"><a href="#__codelineno-227-37">37</a></span>
<span class="normal"><a href="#__codelineno-227-38">38</a></span>
<span class="normal"><a href="#__codelineno-227-39">39</a></span>
<span class="normal"><a href="#__codelineno-227-40">40</a></span>
<span class="normal"><a href="#__codelineno-227-41">41</a></span>
<span class="normal"><a href="#__codelineno-227-42">42</a></span>
<span class="normal"><a href="#__codelineno-227-43">43</a></span>
<span class="normal"><a href="#__codelineno-227-44">44</a></span>
<span class="normal"><a href="#__codelineno-227-45">45</a></span>
<span class="normal"><a href="#__codelineno-227-46">46</a></span>
<span class="normal"><a href="#__codelineno-227-47">47</a></span>
<span class="normal"><a href="#__codelineno-227-48">48</a></span>
<span class="normal"><a href="#__codelineno-227-49">49</a></span>
<span class="normal"><a href="#__codelineno-227-50">50</a></span>
<span class="normal"><a href="#__codelineno-227-51">51</a></span>
<span class="normal"><a href="#__codelineno-227-52">52</a></span>
<span class="normal"><a href="#__codelineno-227-53">53</a></span>
<span class="normal"><a href="#__codelineno-227-54">54</a></span>
<span class="normal"><a href="#__codelineno-227-55">55</a></span>
<span class="normal"><a href="#__codelineno-227-56">56</a></span>
<span class="normal"><a href="#__codelineno-227-57">57</a></span>
<span class="normal"><a href="#__codelineno-227-58">58</a></span>
<span class="normal"><a href="#__codelineno-227-59">59</a></span>
<span class="normal"><a href="#__codelineno-227-60">60</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-227-1" name="__codelineno-227-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span>
<a id="__codelineno-227-2" name="__codelineno-227-2"></a>
<a id="__codelineno-227-3" name="__codelineno-227-3"></a><span class="k">class</span><span class="w"> </span><span class="nc">Digit</span>
<a id="__codelineno-227-4" name="__codelineno-227-4"></a><span class="p">{</span>
<a id="__codelineno-227-5" name="__codelineno-227-5"></a><span class="k">private</span><span class="o">:</span>
<a id="__codelineno-227-6" name="__codelineno-227-6"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">m_digit</span><span class="p">{};</span>
<a id="__codelineno-227-7" name="__codelineno-227-7"></a><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-227-8" name="__codelineno-227-8"></a><span class="w">    </span><span class="n">Digit</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">digit</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-227-9" name="__codelineno-227-9"></a><span class="w">        </span><span class="o">:</span><span class="w"> </span><span class="n">m_digit</span><span class="p">{</span><span class="n">digit</span><span class="p">}</span>
<a id="__codelineno-227-10" name="__codelineno-227-10"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-227-11" name="__codelineno-227-11"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-227-12" name="__codelineno-227-12"></a>
<a id="__codelineno-227-13" name="__codelineno-227-13"></a><span class="w">    </span><span class="n">Digit</span><span class="o">&amp;</span><span class="w"> </span><span class="k">operator</span><span class="o">++</span><span class="p">();</span>
<a id="__codelineno-227-14" name="__codelineno-227-14"></a><span class="w">    </span><span class="n">Digit</span><span class="o">&amp;</span><span class="w"> </span><span class="k">operator</span><span class="o">--</span><span class="p">();</span>
<a id="__codelineno-227-15" name="__codelineno-227-15"></a>
<a id="__codelineno-227-16" name="__codelineno-227-16"></a><span class="w">    </span><span class="k">friend</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">ostream</span><span class="o">&amp;</span><span class="w"> </span><span class="k">operator</span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">ostream</span><span class="o">&amp;</span><span class="w"> </span><span class="n">out</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">Digit</span><span class="o">&amp;</span><span class="w"> </span><span class="n">d</span><span class="p">);</span>
<a id="__codelineno-227-17" name="__codelineno-227-17"></a><span class="p">};</span>
<a id="__codelineno-227-18" name="__codelineno-227-18"></a>
<a id="__codelineno-227-19" name="__codelineno-227-19"></a><span class="n">Digit</span><span class="o">&amp;</span><span class="w"> </span><span class="n">Digit</span><span class="o">::</span><span class="k">operator</span><span class="o">++</span><span class="p">()</span>
<a id="__codelineno-227-20" name="__codelineno-227-20"></a><span class="p">{</span>
<a id="__codelineno-227-21" name="__codelineno-227-21"></a><span class="w">    </span><span class="c1">// If our number is already at 9, wrap around to 0</span>
<a id="__codelineno-227-22" name="__codelineno-227-22"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">m_digit</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">9</span><span class="p">)</span>
<a id="__codelineno-227-23" name="__codelineno-227-23"></a><span class="w">        </span><span class="n">m_digit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-227-24" name="__codelineno-227-24"></a><span class="w">    </span><span class="c1">// otherwise just increment to next number</span>
<a id="__codelineno-227-25" name="__codelineno-227-25"></a><span class="w">    </span><span class="k">else</span>
<a id="__codelineno-227-26" name="__codelineno-227-26"></a><span class="w">        </span><span class="o">++</span><span class="n">m_digit</span><span class="p">;</span>
<a id="__codelineno-227-27" name="__codelineno-227-27"></a>
<a id="__codelineno-227-28" name="__codelineno-227-28"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="o">*</span><span class="k">this</span><span class="p">;</span>
<a id="__codelineno-227-29" name="__codelineno-227-29"></a><span class="p">}</span>
<a id="__codelineno-227-30" name="__codelineno-227-30"></a>
<a id="__codelineno-227-31" name="__codelineno-227-31"></a><span class="n">Digit</span><span class="o">&amp;</span><span class="w"> </span><span class="n">Digit</span><span class="o">::</span><span class="k">operator</span><span class="o">--</span><span class="p">()</span>
<a id="__codelineno-227-32" name="__codelineno-227-32"></a><span class="p">{</span>
<a id="__codelineno-227-33" name="__codelineno-227-33"></a><span class="w">    </span><span class="c1">// If our number is already at 0, wrap around to 9</span>
<a id="__codelineno-227-34" name="__codelineno-227-34"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">m_digit</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-227-35" name="__codelineno-227-35"></a><span class="w">        </span><span class="n">m_digit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">9</span><span class="p">;</span>
<a id="__codelineno-227-36" name="__codelineno-227-36"></a><span class="w">    </span><span class="c1">// otherwise just decrement to next number</span>
<a id="__codelineno-227-37" name="__codelineno-227-37"></a><span class="w">    </span><span class="k">else</span>
<a id="__codelineno-227-38" name="__codelineno-227-38"></a><span class="w">        </span><span class="o">--</span><span class="n">m_digit</span><span class="p">;</span>
<a id="__codelineno-227-39" name="__codelineno-227-39"></a>
<a id="__codelineno-227-40" name="__codelineno-227-40"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="o">*</span><span class="k">this</span><span class="p">;</span>
<a id="__codelineno-227-41" name="__codelineno-227-41"></a><span class="p">}</span>
<a id="__codelineno-227-42" name="__codelineno-227-42"></a>
<a id="__codelineno-227-43" name="__codelineno-227-43"></a><span class="n">std</span><span class="o">::</span><span class="n">ostream</span><span class="o">&amp;</span><span class="w"> </span><span class="k">operator</span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">ostream</span><span class="o">&amp;</span><span class="w"> </span><span class="n">out</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">Digit</span><span class="o">&amp;</span><span class="w"> </span><span class="n">d</span><span class="p">)</span>
<a id="__codelineno-227-44" name="__codelineno-227-44"></a><span class="p">{</span>
<a id="__codelineno-227-45" name="__codelineno-227-45"></a><span class="w">    </span><span class="n">out</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">d</span><span class="p">.</span><span class="n">m_digit</span><span class="p">;</span>
<a id="__codelineno-227-46" name="__codelineno-227-46"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">out</span><span class="p">;</span>
<a id="__codelineno-227-47" name="__codelineno-227-47"></a><span class="p">}</span>
<a id="__codelineno-227-48" name="__codelineno-227-48"></a>
<a id="__codelineno-227-49" name="__codelineno-227-49"></a><span class="kt">int</span><span class="w"> </span><span class="n">main</span><span class="p">()</span>
<a id="__codelineno-227-50" name="__codelineno-227-50"></a><span class="p">{</span>
<a id="__codelineno-227-51" name="__codelineno-227-51"></a><span class="w">    </span><span class="n">Digit</span><span class="w"> </span><span class="n">digit</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="mi">8</span><span class="w"> </span><span class="p">};</span>
<a id="__codelineno-227-52" name="__codelineno-227-52"></a>
<a id="__codelineno-227-53" name="__codelineno-227-53"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">digit</span><span class="p">;</span>
<a id="__codelineno-227-54" name="__codelineno-227-54"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="o">++</span><span class="n">digit</span><span class="p">;</span>
<a id="__codelineno-227-55" name="__codelineno-227-55"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="o">++</span><span class="n">digit</span><span class="p">;</span>
<a id="__codelineno-227-56" name="__codelineno-227-56"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="o">--</span><span class="n">digit</span><span class="p">;</span>
<a id="__codelineno-227-57" name="__codelineno-227-57"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="o">--</span><span class="n">digit</span><span class="p">;</span>
<a id="__codelineno-227-58" name="__codelineno-227-58"></a>
<a id="__codelineno-227-59" name="__codelineno-227-59"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-227-60" name="__codelineno-227-60"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
</details>
<p>需要注意的是我们对前缀递增和递减运算符的重载函数不需要任何参数（隐式传入了 <code>*this</code>），并且返回的是当前隐式对象的引用，这是因为我们希望能够把多个操作<em>链接</em>在一起</p>
<h4 id="_65">后缀递增和递减<a class="headerlink" href="#_65" title="Permanent link">¶</a></h4>
<p>当我们对后缀递增和递减运算符进行重载时，我们需要添加一个额外的 int 参数，以便告诉编译器我们是在重载后缀运算符。</p>
<details class="example">
<summary>code</summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-228-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-228-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-228-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-228-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-228-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-228-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-228-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-228-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-228-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-228-10">10</a></span>
<span class="normal"><a href="#__codelineno-228-11">11</a></span>
<span class="normal"><a href="#__codelineno-228-12">12</a></span>
<span class="normal"><a href="#__codelineno-228-13">13</a></span>
<span class="normal"><a href="#__codelineno-228-14">14</a></span>
<span class="normal"><a href="#__codelineno-228-15">15</a></span>
<span class="normal"><a href="#__codelineno-228-16">16</a></span>
<span class="normal"><a href="#__codelineno-228-17">17</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-228-1" name="__codelineno-228-1"></a><span class="n">Digit</span><span class="w"> </span><span class="n">Digit</span><span class="o">::</span><span class="k">operator</span><span class="o">++</span><span class="p">(</span><span class="kt">int</span><span class="p">)</span>
<a id="__codelineno-228-2" name="__codelineno-228-2"></a><span class="p">{</span>
<a id="__codelineno-228-3" name="__codelineno-228-3"></a><span class="w">    </span><span class="n">Digit</span><span class="w"> </span><span class="n">temp</span><span class="p">{</span><span class="o">*</span><span class="k">this</span><span class="p">};</span>
<a id="__codelineno-228-4" name="__codelineno-228-4"></a>
<a id="__codelineno-228-5" name="__codelineno-228-5"></a><span class="w">    </span><span class="o">++</span><span class="p">(</span><span class="o">*</span><span class="k">this</span><span class="p">);</span><span class="w"> </span><span class="c1">// apply operator</span>
<a id="__codelineno-228-6" name="__codelineno-228-6"></a>
<a id="__codelineno-228-7" name="__codelineno-228-7"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">temp</span><span class="p">;</span><span class="w"> </span><span class="c1">// return saved state</span>
<a id="__codelineno-228-8" name="__codelineno-228-8"></a><span class="p">}</span>
<a id="__codelineno-228-9" name="__codelineno-228-9"></a>
<a id="__codelineno-228-10" name="__codelineno-228-10"></a><span class="n">Digit</span><span class="w"> </span><span class="n">Digit</span><span class="o">::</span><span class="k">operator</span><span class="o">--</span><span class="p">(</span><span class="kt">int</span><span class="p">)</span>
<a id="__codelineno-228-11" name="__codelineno-228-11"></a><span class="p">{</span>
<a id="__codelineno-228-12" name="__codelineno-228-12"></a><span class="w">    </span><span class="n">Digit</span><span class="w"> </span><span class="n">temp</span><span class="p">{</span><span class="o">*</span><span class="k">this</span><span class="p">};</span>
<a id="__codelineno-228-13" name="__codelineno-228-13"></a>
<a id="__codelineno-228-14" name="__codelineno-228-14"></a><span class="w">    </span><span class="o">--</span><span class="p">(</span><span class="o">*</span><span class="k">this</span><span class="p">);</span><span class="w"> </span><span class="c1">// apply operator</span>
<a id="__codelineno-228-15" name="__codelineno-228-15"></a>
<a id="__codelineno-228-16" name="__codelineno-228-16"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">temp</span><span class="p">;</span><span class="w"> </span><span class="c1">// return saved state</span>
<a id="__codelineno-228-17" name="__codelineno-228-17"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
</details>
<p>由于后缀递增和递减运算符返回的是操作数的旧值，我们需要在函数内部先用一个临时变量保存当前对象的状态，再对当前对象进行操作，最后返回临时变量。</p>
<h3 id="_66">重载括号运算符 ()<a class="headerlink" href="#_66" title="Permanent link">¶</a></h3>
<p>括号运算符的特殊之处在于它可以重载多种不同的参数类型，也可以重载不同的参数数量。</p>
<ul>
<li>括号运算符必须作为成员函数重载</li>
<li>在非面对对象的 C++ 中，<code>()</code> 用于调用一个函数；但是在面向对象的语境中，<code>()</code> 只是一个普通的运算符，就和其他运算符一样会调用类的一个成员函数（名为 <code>operator()</code>）。</li>
</ul>
<p>现在我们考虑一个简单的类 <code>Matrix</code>，我们希望能够通过 <code>()</code> 运算符来访问矩阵的元素，例如 <code>matrix(1, 2)</code>。</p>
<details class="example">
<summary>code</summary>
<div class="highlight"><table class="highlighttable"><tr><th class="filename" colspan="2"><span class="filename">Matrix.h</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-229-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-229-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-229-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-229-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-229-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-229-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-229-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-229-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-229-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-229-10">10</a></span>
<span class="normal"><a href="#__codelineno-229-11">11</a></span>
<span class="normal"><a href="#__codelineno-229-12">12</a></span>
<span class="normal"><a href="#__codelineno-229-13">13</a></span>
<span class="normal"><a href="#__codelineno-229-14">14</a></span>
<span class="normal"><a href="#__codelineno-229-15">15</a></span>
<span class="normal"><a href="#__codelineno-229-16">16</a></span>
<span class="normal"><a href="#__codelineno-229-17">17</a></span>
<span class="normal"><a href="#__codelineno-229-18">18</a></span>
<span class="normal"><a href="#__codelineno-229-19">19</a></span>
<span class="normal"><a href="#__codelineno-229-20">20</a></span>
<span class="normal"><a href="#__codelineno-229-21">21</a></span>
<span class="normal"><a href="#__codelineno-229-22">22</a></span>
<span class="normal"><a href="#__codelineno-229-23">23</a></span>
<span class="normal"><a href="#__codelineno-229-24">24</a></span>
<span class="normal"><a href="#__codelineno-229-25">25</a></span>
<span class="normal"><a href="#__codelineno-229-26">26</a></span>
<span class="normal"><a href="#__codelineno-229-27">27</a></span>
<span class="normal"><a href="#__codelineno-229-28">28</a></span>
<span class="normal"><a href="#__codelineno-229-29">29</a></span>
<span class="normal"><a href="#__codelineno-229-30">30</a></span>
<span class="normal"><a href="#__codelineno-229-31">31</a></span>
<span class="normal"><a href="#__codelineno-229-32">32</a></span>
<span class="normal"><a href="#__codelineno-229-33">33</a></span>
<span class="normal"><a href="#__codelineno-229-34">34</a></span>
<span class="normal"><a href="#__codelineno-229-35">35</a></span>
<span class="normal"><a href="#__codelineno-229-36">36</a></span>
<span class="normal"><a href="#__codelineno-229-37">37</a></span>
<span class="normal"><a href="#__codelineno-229-38">38</a></span>
<span class="normal"><a href="#__codelineno-229-39">39</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-229-1" name="__codelineno-229-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;cassert&gt;</span><span class="c1"> // for assert()</span>
<a id="__codelineno-229-2" name="__codelineno-229-2"></a><span class="k">class</span><span class="w"> </span><span class="nc">Matrix</span>
<a id="__codelineno-229-3" name="__codelineno-229-3"></a><span class="p">{</span>
<a id="__codelineno-229-4" name="__codelineno-229-4"></a><span class="k">private</span><span class="o">:</span>
<a id="__codelineno-229-5" name="__codelineno-229-5"></a><span class="w">    </span><span class="kt">double</span><span class="w"> </span><span class="n">m_data</span><span class="p">[</span><span class="mi">4</span><span class="p">][</span><span class="mi">4</span><span class="p">]{};</span>
<a id="__codelineno-229-6" name="__codelineno-229-6"></a>
<a id="__codelineno-229-7" name="__codelineno-229-7"></a><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-229-8" name="__codelineno-229-8"></a><span class="w">    </span><span class="kt">double</span><span class="o">&amp;</span><span class="w"> </span><span class="k">operator</span><span class="p">()(</span><span class="kt">int</span><span class="w"> </span><span class="n">row</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">col</span><span class="p">);</span>
<a id="__codelineno-229-9" name="__codelineno-229-9"></a><span class="w">    </span><span class="kt">double</span><span class="w"> </span><span class="nf">operator</span><span class="p">()(</span><span class="kt">int</span><span class="w"> </span><span class="n">row</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">col</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="p">;</span>
<a id="__codelineno-229-10" name="__codelineno-229-10"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">operator</span><span class="p">()();</span>
<a id="__codelineno-229-11" name="__codelineno-229-11"></a><span class="p">};</span>
<a id="__codelineno-229-12" name="__codelineno-229-12"></a>
<a id="__codelineno-229-13" name="__codelineno-229-13"></a><span class="kt">double</span><span class="o">&amp;</span><span class="w"> </span><span class="nf">Matrix::operator</span><span class="p">()(</span><span class="kt">int</span><span class="w"> </span><span class="n">row</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">col</span><span class="p">)</span>
<a id="__codelineno-229-14" name="__codelineno-229-14"></a><span class="p">{</span>
<a id="__codelineno-229-15" name="__codelineno-229-15"></a><span class="w">    </span><span class="n">assert</span><span class="p">(</span><span class="n">row</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">row</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">4</span><span class="p">);</span>
<a id="__codelineno-229-16" name="__codelineno-229-16"></a><span class="w">    </span><span class="n">assert</span><span class="p">(</span><span class="n">col</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">col</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">4</span><span class="p">);</span>
<a id="__codelineno-229-17" name="__codelineno-229-17"></a>
<a id="__codelineno-229-18" name="__codelineno-229-18"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">m_data</span><span class="p">[</span><span class="n">row</span><span class="p">][</span><span class="n">col</span><span class="p">];</span>
<a id="__codelineno-229-19" name="__codelineno-229-19"></a><span class="p">}</span>
<a id="__codelineno-229-20" name="__codelineno-229-20"></a>
<a id="__codelineno-229-21" name="__codelineno-229-21"></a><span class="kt">double</span><span class="w"> </span><span class="nf">Matrix::operator</span><span class="p">()(</span><span class="kt">int</span><span class="w"> </span><span class="n">row</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">col</span><span class="p">)</span><span class="w"> </span><span class="k">const</span>
<a id="__codelineno-229-22" name="__codelineno-229-22"></a><span class="p">{</span>
<a id="__codelineno-229-23" name="__codelineno-229-23"></a><span class="w">    </span><span class="n">assert</span><span class="p">(</span><span class="n">row</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">row</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">4</span><span class="p">);</span>
<a id="__codelineno-229-24" name="__codelineno-229-24"></a><span class="w">    </span><span class="n">assert</span><span class="p">(</span><span class="n">col</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">col</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">4</span><span class="p">);</span>
<a id="__codelineno-229-25" name="__codelineno-229-25"></a>
<a id="__codelineno-229-26" name="__codelineno-229-26"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">m_data</span><span class="p">[</span><span class="n">row</span><span class="p">][</span><span class="n">col</span><span class="p">];</span>
<a id="__codelineno-229-27" name="__codelineno-229-27"></a><span class="p">}</span>
<a id="__codelineno-229-28" name="__codelineno-229-28"></a>
<a id="__codelineno-229-29" name="__codelineno-229-29"></a><span class="kt">void</span><span class="w"> </span><span class="nf">Matrix::operator</span><span class="p">()()</span>
<a id="__codelineno-229-30" name="__codelineno-229-30"></a><span class="p">{</span>
<a id="__codelineno-229-31" name="__codelineno-229-31"></a><span class="w">    </span><span class="c1">// reset all elements of the matrix to 0.0</span>
<a id="__codelineno-229-32" name="__codelineno-229-32"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">row</span><span class="p">{</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">};</span><span class="w"> </span><span class="n">row</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">4</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">row</span><span class="p">)</span>
<a id="__codelineno-229-33" name="__codelineno-229-33"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-229-34" name="__codelineno-229-34"></a><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">col</span><span class="p">{</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">};</span><span class="w"> </span><span class="n">col</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">4</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">col</span><span class="p">)</span>
<a id="__codelineno-229-35" name="__codelineno-229-35"></a><span class="w">        </span><span class="p">{</span>
<a id="__codelineno-229-36" name="__codelineno-229-36"></a><span class="w">            </span><span class="n">m_data</span><span class="p">[</span><span class="n">row</span><span class="p">][</span><span class="n">col</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<a id="__codelineno-229-37" name="__codelineno-229-37"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-229-38" name="__codelineno-229-38"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-229-39" name="__codelineno-229-39"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
</details>
<p>这里我们重载了三种不同的括号运算符：</p>
<ul>
<li>第一个是非 const 的版本，返回一个引用，用于修改矩阵的元素</li>
<li>第二个是 const 的版本，返回一个常量，仅可用于访问矩阵的元素</li>
<li>第三个是不带参数的版本，用于重置矩阵的所有元素为 0.0</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-230-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-230-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-230-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-230-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-230-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-230-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-230-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-230-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-230-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-230-10">10</a></span>
<span class="normal"><a href="#__codelineno-230-11">11</a></span>
<span class="normal"><a href="#__codelineno-230-12">12</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-230-1" name="__codelineno-230-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span>
<a id="__codelineno-230-2" name="__codelineno-230-2"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">"Matrix.h"</span>
<a id="__codelineno-230-3" name="__codelineno-230-3"></a>
<a id="__codelineno-230-4" name="__codelineno-230-4"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span>
<a id="__codelineno-230-5" name="__codelineno-230-5"></a><span class="p">{</span>
<a id="__codelineno-230-6" name="__codelineno-230-6"></a><span class="w">    </span><span class="n">Matrix</span><span class="w"> </span><span class="n">matrix</span><span class="p">{};</span>
<a id="__codelineno-230-7" name="__codelineno-230-7"></a><span class="w">    </span><span class="n">matrix</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">4.5</span><span class="p">;</span>
<a id="__codelineno-230-8" name="__codelineno-230-8"></a><span class="w">    </span><span class="n">matrix</span><span class="p">();</span><span class="w"> </span><span class="c1">// erase matrix</span>
<a id="__codelineno-230-9" name="__codelineno-230-9"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">matrix</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="sc">'\n'</span><span class="p">;</span>
<a id="__codelineno-230-10" name="__codelineno-230-10"></a>
<a id="__codelineno-230-11" name="__codelineno-230-11"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-230-12" name="__codelineno-230-12"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>这段程序的输出结果是 <code>0</code>。</p>
<p>因为括号运算符非常灵活，有时候我们并不能确定在某些参数列表的情况下它会做出什么样的操作，因此在使用括号运算符时需要格外小心。例如上面的例子中，参数列表为空时括号运算符的行为是清空矩阵，我们最好用一个名称更为明确的函数来实现这个功能，例如 <code>clear()</code> 或 <code>reset()</code>。</p>
<hr/>
<h2 id="_67">智能指针和移动语义<a class="headerlink" href="#_67" title="Permanent link">¶</a></h2>
<h3 id="_68">简单概念和引入<a class="headerlink" href="#_68" title="Permanent link">¶</a></h3>
<h4 id="_69">智能指针<a class="headerlink" href="#_69" title="Permanent link">¶</a></h4>
<p>当我们给一个指针动态分配内存时，我们需要在不再使用这个指针时释放这块内存，但在实际的代码中，常常会因为各种原因导致忘记释放内存，从而造成内存泄漏。例如</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-231-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-231-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-231-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-231-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-231-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-231-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-231-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-231-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-231-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-231-10">10</a></span>
<span class="normal"><a href="#__codelineno-231-11">11</a></span>
<span class="normal"><a href="#__codelineno-231-12">12</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-231-1" name="__codelineno-231-1"></a><span class="kt">void</span><span class="w"> </span><span class="nf">someFunction</span><span class="p">()</span>
<a id="__codelineno-231-2" name="__codelineno-231-2"></a><span class="p">{</span>
<a id="__codelineno-231-3" name="__codelineno-231-3"></a><span class="w">    </span><span class="n">Resource</span><span class="o">*</span><span class="w"> </span><span class="n">ptr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Resource</span><span class="p">();</span>
<a id="__codelineno-231-4" name="__codelineno-231-4"></a>
<a id="__codelineno-231-5" name="__codelineno-231-5"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">;</span>
<a id="__codelineno-231-6" name="__codelineno-231-6"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cin</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">x</span><span class="p">;</span>
<a id="__codelineno-231-7" name="__codelineno-231-7"></a>
<a id="__codelineno-231-8" name="__codelineno-231-8"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-231-9" name="__codelineno-231-9"></a><span class="w">        </span><span class="k">return</span><span class="p">;</span>
<a id="__codelineno-231-10" name="__codelineno-231-10"></a>
<a id="__codelineno-231-11" name="__codelineno-231-11"></a><span class="w">    </span><span class="k">delete</span><span class="w"> </span><span class="n">ptr</span><span class="p">;</span>
<a id="__codelineno-231-12" name="__codelineno-231-12"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>出现上述问题的本质原因是指针变量没有一个能自我清理的固有机制。为了解决这个问题，我们可以考虑使用一个类来负责管理这个指针，让这个类“持有”这个指针，当这个类的生命周期结束时，利用析构函数来释放这个指针。</p>
<details class="example">
<summary>Auto_ptr1</summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-232-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-232-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-232-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-232-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-232-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-232-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-232-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-232-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-232-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-232-10">10</a></span>
<span class="normal"><a href="#__codelineno-232-11">11</a></span>
<span class="normal"><a href="#__codelineno-232-12">12</a></span>
<span class="normal"><a href="#__codelineno-232-13">13</a></span>
<span class="normal"><a href="#__codelineno-232-14">14</a></span>
<span class="normal"><a href="#__codelineno-232-15">15</a></span>
<span class="normal"><a href="#__codelineno-232-16">16</a></span>
<span class="normal"><a href="#__codelineno-232-17">17</a></span>
<span class="normal"><a href="#__codelineno-232-18">18</a></span>
<span class="normal"><a href="#__codelineno-232-19">19</a></span>
<span class="normal"><a href="#__codelineno-232-20">20</a></span>
<span class="normal"><a href="#__codelineno-232-21">21</a></span>
<span class="normal"><a href="#__codelineno-232-22">22</a></span>
<span class="normal"><a href="#__codelineno-232-23">23</a></span>
<span class="normal"><a href="#__codelineno-232-24">24</a></span>
<span class="normal"><a href="#__codelineno-232-25">25</a></span>
<span class="normal"><a href="#__codelineno-232-26">26</a></span>
<span class="normal"><a href="#__codelineno-232-27">27</a></span>
<span class="normal"><a href="#__codelineno-232-28">28</a></span>
<span class="normal"><a href="#__codelineno-232-29">29</a></span>
<span class="normal"><a href="#__codelineno-232-30">30</a></span>
<span class="normal"><a href="#__codelineno-232-31">31</a></span>
<span class="normal"><a href="#__codelineno-232-32">32</a></span>
<span class="normal"><a href="#__codelineno-232-33">33</a></span>
<span class="normal"><a href="#__codelineno-232-34">34</a></span>
<span class="normal"><a href="#__codelineno-232-35">35</a></span>
<span class="normal"><a href="#__codelineno-232-36">36</a></span>
<span class="normal"><a href="#__codelineno-232-37">37</a></span>
<span class="normal"><a href="#__codelineno-232-38">38</a></span>
<span class="normal"><a href="#__codelineno-232-39">39</a></span>
<span class="normal"><a href="#__codelineno-232-40">40</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-232-1" name="__codelineno-232-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span>
<a id="__codelineno-232-2" name="__codelineno-232-2"></a>
<a id="__codelineno-232-3" name="__codelineno-232-3"></a><span class="k">template</span><span class="w"> </span><span class="o">&lt;</span><span class="k">typename</span><span class="w"> </span><span class="nc">T</span><span class="o">&gt;</span>
<a id="__codelineno-232-4" name="__codelineno-232-4"></a><span class="k">class</span><span class="w"> </span><span class="nc">Auto_ptr1</span>
<a id="__codelineno-232-5" name="__codelineno-232-5"></a><span class="p">{</span>
<a id="__codelineno-232-6" name="__codelineno-232-6"></a><span class="w">    </span><span class="n">T</span><span class="o">*</span><span class="w"> </span><span class="n">m_ptr</span><span class="w"> </span><span class="p">{};</span>
<a id="__codelineno-232-7" name="__codelineno-232-7"></a><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-232-8" name="__codelineno-232-8"></a><span class="w">    </span><span class="c1">// Pass in a pointer to "own" via the constructor</span>
<a id="__codelineno-232-9" name="__codelineno-232-9"></a><span class="w">    </span><span class="n">Auto_ptr1</span><span class="p">(</span><span class="n">T</span><span class="o">*</span><span class="w"> </span><span class="n">ptr</span><span class="o">=</span><span class="k">nullptr</span><span class="p">)</span>
<a id="__codelineno-232-10" name="__codelineno-232-10"></a><span class="w">        </span><span class="o">:</span><span class="n">m_ptr</span><span class="p">(</span><span class="n">ptr</span><span class="p">)</span>
<a id="__codelineno-232-11" name="__codelineno-232-11"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-232-12" name="__codelineno-232-12"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-232-13" name="__codelineno-232-13"></a>
<a id="__codelineno-232-14" name="__codelineno-232-14"></a><span class="w">    </span><span class="c1">// The destructor will make sure it gets deallocated</span>
<a id="__codelineno-232-15" name="__codelineno-232-15"></a><span class="w">    </span><span class="o">~</span><span class="n">Auto_ptr1</span><span class="p">()</span>
<a id="__codelineno-232-16" name="__codelineno-232-16"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-232-17" name="__codelineno-232-17"></a><span class="w">        </span><span class="k">delete</span><span class="w"> </span><span class="n">m_ptr</span><span class="p">;</span>
<a id="__codelineno-232-18" name="__codelineno-232-18"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-232-19" name="__codelineno-232-19"></a>
<a id="__codelineno-232-20" name="__codelineno-232-20"></a><span class="w">    </span><span class="c1">// Overload dereference and operator-&gt; so we can use Auto_ptr1 like m_ptr.</span>
<a id="__codelineno-232-21" name="__codelineno-232-21"></a><span class="w">    </span><span class="n">T</span><span class="o">&amp;</span><span class="w"> </span><span class="k">operator</span><span class="o">*</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="o">*</span><span class="n">m_ptr</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-232-22" name="__codelineno-232-22"></a><span class="w">    </span><span class="n">T</span><span class="o">*</span><span class="w"> </span><span class="k">operator</span><span class="o">-&gt;</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">m_ptr</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-232-23" name="__codelineno-232-23"></a><span class="p">};</span>
<a id="__codelineno-232-24" name="__codelineno-232-24"></a>
<a id="__codelineno-232-25" name="__codelineno-232-25"></a><span class="c1">// A sample class to prove the above works</span>
<a id="__codelineno-232-26" name="__codelineno-232-26"></a><span class="k">class</span><span class="w"> </span><span class="nc">Resource</span>
<a id="__codelineno-232-27" name="__codelineno-232-27"></a><span class="p">{</span>
<a id="__codelineno-232-28" name="__codelineno-232-28"></a><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-232-29" name="__codelineno-232-29"></a><span class="w">    </span><span class="n">Resource</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"Resource acquired</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-232-30" name="__codelineno-232-30"></a><span class="w">    </span><span class="o">~</span><span class="n">Resource</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"Resource destroyed</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-232-31" name="__codelineno-232-31"></a><span class="p">};</span>
<a id="__codelineno-232-32" name="__codelineno-232-32"></a>
<a id="__codelineno-232-33" name="__codelineno-232-33"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span>
<a id="__codelineno-232-34" name="__codelineno-232-34"></a><span class="p">{</span>
<a id="__codelineno-232-35" name="__codelineno-232-35"></a><span class="w">    </span><span class="c1">// Note that we use &lt;Resource&gt;, not &lt;Resource*&gt;</span>
<a id="__codelineno-232-36" name="__codelineno-232-36"></a><span class="w">    </span><span class="c1">// This is because we've defined m_ptr to have type T* (not T)</span>
<a id="__codelineno-232-37" name="__codelineno-232-37"></a><span class="w">    </span><span class="n">Auto_ptr1</span><span class="o">&lt;</span><span class="n">Resource</span><span class="o">&gt;</span><span class="w"> </span><span class="n">res</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">Resource</span><span class="p">());</span><span class="w">        </span>
<a id="__codelineno-232-38" name="__codelineno-232-38"></a>
<a id="__codelineno-232-39" name="__codelineno-232-39"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-232-40" name="__codelineno-232-40"></a><span class="p">}</span><span class="w"> </span><span class="c1">// res goes out of scope here, and destroys the allocated Resource for us</span>
</code></pre></div></td></tr></table></div>
<p>这个程序将会输出</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-233-1">1</a></span>
<span class="normal"><a href="#__codelineno-233-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-233-1" name="__codelineno-233-1"></a>Resource acquired
<a id="__codelineno-233-2" name="__codelineno-233-2"></a>Resource destroyed
</code></pre></div></td></tr></table></div>
<p>由于 <code>res</code> 对象在 <code>main</code> 函数结束时被销毁，<code>Auto_ptr1</code> 类的析构函数会被调用，从而释放 <code>Resource</code> 指针所指向的内存。</p>
</details>
<p>像我们上面实现的类被称为<strong>智能指针</strong>（smart pointer），它是一个复合类，旨在管理动态分配的内存，使得指针的生命周期和指向的资源的生命周期保持一致。</p>
<div class="admonition info">
<p class="admonition-title">dumb pointer</p>
<p>与智能指针相对应的是，我们通常使用的指针有时会被称为 dump pointer（愚蠢指针），因为它们没有自我清理的能力。</p>
</div>
<p>但是我们刚刚实现的 <code>Auto_ptr1</code> 存在一个巨大的问题：当它被作为复制初始化的初始化器时，会使得复制出来的 <code>Auto_ptr1</code> 也指向同一块内存，这样当其中一个 <code>Auto_ptr1</code> 被销毁时，会导致另一个 <code>Auto_ptr1</code> 指向的内存被释放，从而导致内存泄漏。</p>
<details class="example">
<summary>Example</summary>
<p>下面两种情况都会导致两个指针指向同一块内存，当其中一个对象被销毁时，另一个对象指向的内存也会被释放。如果我们通过未被销毁的 <code>Auto_ptr1</code> 对象来使用这块内存，就会导致未定义行为</p>
<div class="tabbed-set tabbed-alternate" data-tabs="5:2"><input checked="checked" id="__tabbed_5_1" name="__tabbed_5" type="radio"><input id="__tabbed_5_2" name="__tabbed_5" type="radio"><div class="tabbed-labels"><label for="__tabbed_5_1">case 1</label><label for="__tabbed_5_2">case 2</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-234-1">1</a></span>
<span class="normal"><a href="#__codelineno-234-2">2</a></span>
<span class="normal"><a href="#__codelineno-234-3">3</a></span>
<span class="normal"><a href="#__codelineno-234-4">4</a></span>
<span class="normal"><a href="#__codelineno-234-5">5</a></span>
<span class="normal"><a href="#__codelineno-234-6">6</a></span>
<span class="normal"><a href="#__codelineno-234-7">7</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-234-1" name="__codelineno-234-1"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span>
<a id="__codelineno-234-2" name="__codelineno-234-2"></a><span class="p">{</span>
<a id="__codelineno-234-3" name="__codelineno-234-3"></a><span class="w">    </span><span class="n">Auto_ptr1</span><span class="o">&lt;</span><span class="n">Resource</span><span class="o">&gt;</span><span class="w"> </span><span class="n">res1</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">Resource</span><span class="p">());</span>
<a id="__codelineno-234-4" name="__codelineno-234-4"></a><span class="w">    </span><span class="n">Auto_ptr1</span><span class="o">&lt;</span><span class="n">Resource</span><span class="o">&gt;</span><span class="w"> </span><span class="n">res2</span><span class="p">(</span><span class="n">res1</span><span class="p">);</span><span class="w"> </span><span class="c1">// Alternatively, don't initialize res2 and then assign res2 = res1;</span>
<a id="__codelineno-234-5" name="__codelineno-234-5"></a>
<a id="__codelineno-234-6" name="__codelineno-234-6"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-234-7" name="__codelineno-234-7"></a><span class="p">}</span><span class="w"> </span><span class="c1">// res1 and res2 go out of scope here</span>
</code></pre></div></td></tr></table></div>
<p>当我们使用 res1 去初始化 res2 时，res1 和 res2 指向同一块内存。当 res1 和 res2 被销毁时，这块内存会被释放两次，这会导致未定义行为。</p>
</div>
<div class="tabbed-block">
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-235-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-235-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-235-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-235-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-235-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-235-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-235-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-235-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-235-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-235-10">10</a></span>
<span class="normal"><a href="#__codelineno-235-11">11</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-235-1" name="__codelineno-235-1"></a><span class="kt">void</span><span class="w"> </span><span class="nf">passByValue</span><span class="p">(</span><span class="n">Auto_ptr1</span><span class="o">&lt;</span><span class="n">Resource</span><span class="o">&gt;</span><span class="w"> </span><span class="n">res</span><span class="p">)</span>
<a id="__codelineno-235-2" name="__codelineno-235-2"></a><span class="p">{</span>
<a id="__codelineno-235-3" name="__codelineno-235-3"></a><span class="p">}</span>
<a id="__codelineno-235-4" name="__codelineno-235-4"></a>
<a id="__codelineno-235-5" name="__codelineno-235-5"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span>
<a id="__codelineno-235-6" name="__codelineno-235-6"></a><span class="p">{</span>
<a id="__codelineno-235-7" name="__codelineno-235-7"></a><span class="w">    </span><span class="n">Auto_ptr1</span><span class="o">&lt;</span><span class="n">Resource</span><span class="o">&gt;</span><span class="w"> </span><span class="n">res1</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">Resource</span><span class="p">());</span>
<a id="__codelineno-235-8" name="__codelineno-235-8"></a><span class="w">    </span><span class="n">passByValue</span><span class="p">(</span><span class="n">res1</span><span class="p">);</span>
<a id="__codelineno-235-9" name="__codelineno-235-9"></a>
<a id="__codelineno-235-10" name="__codelineno-235-10"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-235-11" name="__codelineno-235-11"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>这段程序中，res1 将按值复制到参数 res 中，因此 <code>res1.m_ptr</code> 和 <code>res.m_ptr</code> 将保存相同的地址。当 passByValue 函数返回时，res 被销毁，从而导致 <code>res.m_ptr</code> 指向的内存被释放。但是 res1 仍然持有这块内存的指针，当 res1 被销毁时，这块内存会被释放第二次，这也会导致未定义行为。</p>
</div>
</div>
</input></input></div>
</details>
<p>为了解决这个问题，我们可以很快联想到一种方法：重载赋值运算符和复制构造函数，使得当一个 <code>Auto_ptr1</code> 对象被复制时，会创建一个深度拷贝的对象，而不是简单地复制指针。但是这么做的开销将是很大的，因为我们希望避免仅为了复制一个对象而动态分配内存。</p>
<p>那么我们该怎么办呢？这就是引入移动语义的时候了。</p>
<h4 id="_70">移动语义<a class="headerlink" href="#_70" title="Permanent link">¶</a></h4>
<p><strong>移动语义</strong>（move semantics）意味着类对象将把一些资源的所有权转移给另一个类对象，而非进行拷贝。在上面这个问题中，就是把指针的所有权从源对象（source）转一个目标对象（destination）。</p>
<p>我们对 <code>Auto_ptr1</code> 稍作修改就可以得到实现了上述效果的 <code>Auto_ptr2</code> </p>
<details class="note">
<summary>Auto_ptr2</summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-236-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-236-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-236-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-236-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-236-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-236-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-236-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-236-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-236-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-236-10">10</a></span>
<span class="normal"><a href="#__codelineno-236-11">11</a></span>
<span class="normal"><a href="#__codelineno-236-12">12</a></span>
<span class="normal"><a href="#__codelineno-236-13">13</a></span>
<span class="normal"><a href="#__codelineno-236-14">14</a></span>
<span class="normal"><a href="#__codelineno-236-15">15</a></span>
<span class="normal"><a href="#__codelineno-236-16">16</a></span>
<span class="normal"><a href="#__codelineno-236-17">17</a></span>
<span class="normal"><a href="#__codelineno-236-18">18</a></span>
<span class="normal"><a href="#__codelineno-236-19">19</a></span>
<span class="normal"><a href="#__codelineno-236-20">20</a></span>
<span class="normal"><a href="#__codelineno-236-21">21</a></span>
<span class="normal"><a href="#__codelineno-236-22">22</a></span>
<span class="normal"><a href="#__codelineno-236-23">23</a></span>
<span class="normal"><a href="#__codelineno-236-24">24</a></span>
<span class="normal"><a href="#__codelineno-236-25">25</a></span>
<span class="normal"><a href="#__codelineno-236-26">26</a></span>
<span class="normal"><a href="#__codelineno-236-27">27</a></span>
<span class="normal"><a href="#__codelineno-236-28">28</a></span>
<span class="normal"><a href="#__codelineno-236-29">29</a></span>
<span class="normal"><a href="#__codelineno-236-30">30</a></span>
<span class="normal"><a href="#__codelineno-236-31">31</a></span>
<span class="normal"><a href="#__codelineno-236-32">32</a></span>
<span class="normal"><a href="#__codelineno-236-33">33</a></span>
<span class="normal"><a href="#__codelineno-236-34">34</a></span>
<span class="normal"><a href="#__codelineno-236-35">35</a></span>
<span class="normal"><a href="#__codelineno-236-36">36</a></span>
<span class="normal"><a href="#__codelineno-236-37">37</a></span>
<span class="normal"><a href="#__codelineno-236-38">38</a></span>
<span class="normal"><a href="#__codelineno-236-39">39</a></span>
<span class="normal"><a href="#__codelineno-236-40">40</a></span>
<span class="normal"><a href="#__codelineno-236-41">41</a></span>
<span class="normal"><a href="#__codelineno-236-42">42</a></span>
<span class="normal"><a href="#__codelineno-236-43">43</a></span>
<span class="normal"><a href="#__codelineno-236-44">44</a></span>
<span class="normal"><a href="#__codelineno-236-45">45</a></span>
<span class="normal"><a href="#__codelineno-236-46">46</a></span>
<span class="normal"><a href="#__codelineno-236-47">47</a></span>
<span class="normal"><a href="#__codelineno-236-48">48</a></span>
<span class="normal"><a href="#__codelineno-236-49">49</a></span>
<span class="normal"><a href="#__codelineno-236-50">50</a></span>
<span class="normal"><a href="#__codelineno-236-51">51</a></span>
<span class="normal"><a href="#__codelineno-236-52">52</a></span>
<span class="normal"><a href="#__codelineno-236-53">53</a></span>
<span class="normal"><a href="#__codelineno-236-54">54</a></span>
<span class="normal"><a href="#__codelineno-236-55">55</a></span>
<span class="normal"><a href="#__codelineno-236-56">56</a></span>
<span class="normal"><a href="#__codelineno-236-57">57</a></span>
<span class="normal"><a href="#__codelineno-236-58">58</a></span>
<span class="normal"><a href="#__codelineno-236-59">59</a></span>
<span class="normal"><a href="#__codelineno-236-60">60</a></span>
<span class="normal"><a href="#__codelineno-236-61">61</a></span>
<span class="normal"><a href="#__codelineno-236-62">62</a></span>
<span class="normal"><a href="#__codelineno-236-63">63</a></span>
<span class="normal"><a href="#__codelineno-236-64">64</a></span>
<span class="normal"><a href="#__codelineno-236-65">65</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-236-1" name="__codelineno-236-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span>
<a id="__codelineno-236-2" name="__codelineno-236-2"></a>
<a id="__codelineno-236-3" name="__codelineno-236-3"></a><span class="k">template</span><span class="w"> </span><span class="o">&lt;</span><span class="k">typename</span><span class="w"> </span><span class="nc">T</span><span class="o">&gt;</span>
<a id="__codelineno-236-4" name="__codelineno-236-4"></a><span class="k">class</span><span class="w"> </span><span class="nc">Auto_ptr2</span>
<a id="__codelineno-236-5" name="__codelineno-236-5"></a><span class="p">{</span>
<a id="__codelineno-236-6" name="__codelineno-236-6"></a><span class="w">    </span><span class="n">T</span><span class="o">*</span><span class="w"> </span><span class="n">m_ptr</span><span class="w"> </span><span class="p">{};</span>
<a id="__codelineno-236-7" name="__codelineno-236-7"></a><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-236-8" name="__codelineno-236-8"></a><span class="w">    </span><span class="n">Auto_ptr2</span><span class="p">(</span><span class="n">T</span><span class="o">*</span><span class="w"> </span><span class="n">ptr</span><span class="o">=</span><span class="k">nullptr</span><span class="p">)</span>
<a id="__codelineno-236-9" name="__codelineno-236-9"></a><span class="w">        </span><span class="o">:</span><span class="n">m_ptr</span><span class="p">(</span><span class="n">ptr</span><span class="p">)</span>
<a id="__codelineno-236-10" name="__codelineno-236-10"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-236-11" name="__codelineno-236-11"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-236-12" name="__codelineno-236-12"></a>
<a id="__codelineno-236-13" name="__codelineno-236-13"></a><span class="w">    </span><span class="o">~</span><span class="n">Auto_ptr2</span><span class="p">()</span>
<a id="__codelineno-236-14" name="__codelineno-236-14"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-236-15" name="__codelineno-236-15"></a><span class="w">        </span><span class="k">delete</span><span class="w"> </span><span class="n">m_ptr</span><span class="p">;</span>
<a id="__codelineno-236-16" name="__codelineno-236-16"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-236-17" name="__codelineno-236-17"></a>
<a id="__codelineno-236-18" name="__codelineno-236-18"></a><span class="w">    </span><span class="c1">// A copy constructor that implements move semantics</span>
<a id="__codelineno-236-19" name="__codelineno-236-19"></a><span class="w">    </span><span class="n">Auto_ptr2</span><span class="p">(</span><span class="n">Auto_ptr2</span><span class="o">&amp;</span><span class="w"> </span><span class="n">a</span><span class="p">)</span><span class="w"> </span><span class="c1">// note: not const</span>
<a id="__codelineno-236-20" name="__codelineno-236-20"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-236-21" name="__codelineno-236-21"></a><span class="w">        </span><span class="n">m_ptr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">m_ptr</span><span class="p">;</span><span class="w"> </span><span class="c1">// transfer our dumb pointer from the source to our local object</span>
<a id="__codelineno-236-22" name="__codelineno-236-22"></a><span class="w">        </span><span class="n">a</span><span class="p">.</span><span class="n">m_ptr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">;</span><span class="w"> </span><span class="c1">// make sure the source no longer owns the pointer</span>
<a id="__codelineno-236-23" name="__codelineno-236-23"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-236-24" name="__codelineno-236-24"></a>
<a id="__codelineno-236-25" name="__codelineno-236-25"></a><span class="w">    </span><span class="c1">// An assignment operator that implements move semantics</span>
<a id="__codelineno-236-26" name="__codelineno-236-26"></a><span class="w">    </span><span class="n">Auto_ptr2</span><span class="o">&amp;</span><span class="w"> </span><span class="k">operator</span><span class="o">=</span><span class="p">(</span><span class="n">Auto_ptr2</span><span class="o">&amp;</span><span class="w"> </span><span class="n">a</span><span class="p">)</span><span class="w"> </span><span class="c1">// note: not const</span>
<a id="__codelineno-236-27" name="__codelineno-236-27"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-236-28" name="__codelineno-236-28"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">&amp;</span><span class="n">a</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">this</span><span class="p">)</span>
<a id="__codelineno-236-29" name="__codelineno-236-29"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="o">*</span><span class="k">this</span><span class="p">;</span>
<a id="__codelineno-236-30" name="__codelineno-236-30"></a>
<a id="__codelineno-236-31" name="__codelineno-236-31"></a><span class="w">        </span><span class="k">delete</span><span class="w"> </span><span class="n">m_ptr</span><span class="p">;</span><span class="w"> </span><span class="c1">// make sure we deallocate any pointer the destination is already holding first</span>
<a id="__codelineno-236-32" name="__codelineno-236-32"></a><span class="w">        </span><span class="n">m_ptr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">m_ptr</span><span class="p">;</span><span class="w"> </span><span class="c1">// then transfer our dumb pointer from the source to the local object</span>
<a id="__codelineno-236-33" name="__codelineno-236-33"></a><span class="w">        </span><span class="n">a</span><span class="p">.</span><span class="n">m_ptr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">;</span><span class="w"> </span><span class="c1">// make sure the source no longer owns the pointer</span>
<a id="__codelineno-236-34" name="__codelineno-236-34"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="o">*</span><span class="k">this</span><span class="p">;</span>
<a id="__codelineno-236-35" name="__codelineno-236-35"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-236-36" name="__codelineno-236-36"></a>
<a id="__codelineno-236-37" name="__codelineno-236-37"></a><span class="w">    </span><span class="n">T</span><span class="o">&amp;</span><span class="w"> </span><span class="k">operator</span><span class="o">*</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="o">*</span><span class="n">m_ptr</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-236-38" name="__codelineno-236-38"></a><span class="w">    </span><span class="n">T</span><span class="o">*</span><span class="w"> </span><span class="k">operator</span><span class="o">-&gt;</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">m_ptr</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-236-39" name="__codelineno-236-39"></a><span class="w">    </span><span class="kt">bool</span><span class="w"> </span><span class="n">isNull</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">m_ptr</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">nullptr</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-236-40" name="__codelineno-236-40"></a><span class="p">};</span>
<a id="__codelineno-236-41" name="__codelineno-236-41"></a>
<a id="__codelineno-236-42" name="__codelineno-236-42"></a><span class="k">class</span><span class="w"> </span><span class="nc">Resource</span>
<a id="__codelineno-236-43" name="__codelineno-236-43"></a><span class="p">{</span>
<a id="__codelineno-236-44" name="__codelineno-236-44"></a><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-236-45" name="__codelineno-236-45"></a><span class="w">    </span><span class="n">Resource</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"Resource acquired</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-236-46" name="__codelineno-236-46"></a><span class="w">    </span><span class="o">~</span><span class="n">Resource</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"Resource destroyed</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-236-47" name="__codelineno-236-47"></a><span class="p">};</span>
<a id="__codelineno-236-48" name="__codelineno-236-48"></a>
<a id="__codelineno-236-49" name="__codelineno-236-49"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span>
<a id="__codelineno-236-50" name="__codelineno-236-50"></a><span class="p">{</span>
<a id="__codelineno-236-51" name="__codelineno-236-51"></a><span class="w">    </span><span class="n">Auto_ptr2</span><span class="o">&lt;</span><span class="n">Resource</span><span class="o">&gt;</span><span class="w"> </span><span class="n">res1</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">Resource</span><span class="p">());</span>
<a id="__codelineno-236-52" name="__codelineno-236-52"></a><span class="w">    </span><span class="n">Auto_ptr2</span><span class="o">&lt;</span><span class="n">Resource</span><span class="o">&gt;</span><span class="w"> </span><span class="n">res2</span><span class="p">;</span><span class="w"> </span><span class="c1">// Start as nullptr</span>
<a id="__codelineno-236-53" name="__codelineno-236-53"></a>
<a id="__codelineno-236-54" name="__codelineno-236-54"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"res1 is "</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="p">(</span><span class="n">res1</span><span class="p">.</span><span class="n">isNull</span><span class="p">()</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="s">"null</span><span class="se">\n</span><span class="s">"</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s">"not null</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
<a id="__codelineno-236-55" name="__codelineno-236-55"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"res2 is "</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="p">(</span><span class="n">res2</span><span class="p">.</span><span class="n">isNull</span><span class="p">()</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="s">"null</span><span class="se">\n</span><span class="s">"</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s">"not null</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
<a id="__codelineno-236-56" name="__codelineno-236-56"></a>
<a id="__codelineno-236-57" name="__codelineno-236-57"></a><span class="w">    </span><span class="n">res2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">res1</span><span class="p">;</span><span class="w"> </span><span class="c1">// res2 assumes ownership, res1 is set to null</span>
<a id="__codelineno-236-58" name="__codelineno-236-58"></a>
<a id="__codelineno-236-59" name="__codelineno-236-59"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"Ownership transferred</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
<a id="__codelineno-236-60" name="__codelineno-236-60"></a>
<a id="__codelineno-236-61" name="__codelineno-236-61"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"res1 is "</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="p">(</span><span class="n">res1</span><span class="p">.</span><span class="n">isNull</span><span class="p">()</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="s">"null</span><span class="se">\n</span><span class="s">"</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s">"not null</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
<a id="__codelineno-236-62" name="__codelineno-236-62"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"res2 is "</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="p">(</span><span class="n">res2</span><span class="p">.</span><span class="n">isNull</span><span class="p">()</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="s">"null</span><span class="se">\n</span><span class="s">"</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s">"not null</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
<a id="__codelineno-236-63" name="__codelineno-236-63"></a>
<a id="__codelineno-236-64" name="__codelineno-236-64"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-236-65" name="__codelineno-236-65"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>这段程序将输出</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-237-1">1</a></span>
<span class="normal"><a href="#__codelineno-237-2">2</a></span>
<span class="normal"><a href="#__codelineno-237-3">3</a></span>
<span class="normal"><a href="#__codelineno-237-4">4</a></span>
<span class="normal"><a href="#__codelineno-237-5">5</a></span>
<span class="normal"><a href="#__codelineno-237-6">6</a></span>
<span class="normal"><a href="#__codelineno-237-7">7</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-237-1" name="__codelineno-237-1"></a>Resource acquired
<a id="__codelineno-237-2" name="__codelineno-237-2"></a>res1 is not null
<a id="__codelineno-237-3" name="__codelineno-237-3"></a>res2 is null
<a id="__codelineno-237-4" name="__codelineno-237-4"></a>Ownership transferred
<a id="__codelineno-237-5" name="__codelineno-237-5"></a>res1 is null
<a id="__codelineno-237-6" name="__codelineno-237-6"></a>res2 is not null
<a id="__codelineno-237-7" name="__codelineno-237-7"></a>Resource destroyed
</code></pre></div></td></tr></table></div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p><code>delete</code> 一个 <code>nullptr</code> 不会发生任何事情，因此不需要担心会导致什么意外后果。</p>
</div>
</details>
<div class="admonition info">
<p class="admonition-title">std::auto_ptr</p>
<p>在 C++98 中引入，并在 C++17 中删除的 <code>std::auto_ptr</code> 是 C++ 对于标准化的智能指针的首次尝试，它实现移动语义的方式和我们的 <code>Auto_ptr2</code> 相当类似，也和我们的 <code>Auto_ptr2</code> 一样具有许多问题。</p>
<ol>
<li><code>std::auto_ptr</code> 通过复制构造函数和赋值运算符来实现移动语义，按值传递将会导致资源的所有权转移到函数的参数变量上，当函数返回时函数内的变量会被销毁，从而使这些资源被释放——这些资源不在能被原来的 <code>std::auto_ptr</code> 对象访问。</li>
<li><code>std::auto_ptr</code> 始终使用非数组的 <code>delete</code> 来释放资源，这意味着 <code>std::auto_ptr</code> 无法正确管理一个动态数组，并且它也不会阻止我们传入一个动态数组，从而引发内存泄漏。</li>
<li>C++ 标准库中的许多类（包括大多数容器）对于 <code>std::auto_ptr</code> 的行为并不友好，因为这些标准库假设当他们复制一个对象时，发生的是 copy 而非 move。</li>
</ol>
<p>综合以上原因，<code>std::auto_ptr</code> 在 C++11 中被弃用，在 C++17 中被移除。</p>
<p>在 C++11 中，<code>std::auto_ptr</code> 已被其他的支持 move-aware（移动感知）的智能指针所取代：<code>std::unique_ptr</code>、<code>std::shared_ptr</code> 和 <code>std::weak_ptr</code>。</p>
</div>
<h3 id="_71">移动构造函数和移动赋值运算符<a class="headerlink" href="#_71" title="Permanent link">¶</a></h3>
<p>C++11 中引入了移动构造函数和移动赋值运算符，用于实现移动语义。复制构造函数和赋值运算符用于将一个对象的副本制成另一个对象，而移动构造函数和移动赋值运算符用于把一个对象的资源所有权转移给另一个对象。</p>
<p>定义移动构造函数和移动赋值运算符的语法和定义复制构造函数和赋值运算符的语法非常相似，后两者使用的是 const 左值引用，而前两者使用的是非 const 右值引用。</p>
<details class="example">
<summary>code</summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-238-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-238-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-238-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-238-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-238-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-238-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-238-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-238-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-238-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-238-10">10</a></span>
<span class="normal"><a href="#__codelineno-238-11">11</a></span>
<span class="normal"><a href="#__codelineno-238-12">12</a></span>
<span class="normal"><a href="#__codelineno-238-13">13</a></span>
<span class="normal"><a href="#__codelineno-238-14">14</a></span>
<span class="normal"><a href="#__codelineno-238-15">15</a></span>
<span class="normal"><a href="#__codelineno-238-16">16</a></span>
<span class="normal"><a href="#__codelineno-238-17">17</a></span>
<span class="normal"><a href="#__codelineno-238-18">18</a></span>
<span class="normal"><a href="#__codelineno-238-19">19</a></span>
<span class="normal"><a href="#__codelineno-238-20">20</a></span>
<span class="normal"><a href="#__codelineno-238-21">21</a></span>
<span class="normal"><a href="#__codelineno-238-22">22</a></span>
<span class="normal"><a href="#__codelineno-238-23">23</a></span>
<span class="normal"><a href="#__codelineno-238-24">24</a></span>
<span class="normal"><a href="#__codelineno-238-25">25</a></span>
<span class="normal"><a href="#__codelineno-238-26">26</a></span>
<span class="normal"><a href="#__codelineno-238-27">27</a></span>
<span class="normal"><a href="#__codelineno-238-28">28</a></span>
<span class="normal"><a href="#__codelineno-238-29">29</a></span>
<span class="normal"><a href="#__codelineno-238-30">30</a></span>
<span class="normal"><a href="#__codelineno-238-31">31</a></span>
<span class="normal"><a href="#__codelineno-238-32">32</a></span>
<span class="normal"><a href="#__codelineno-238-33">33</a></span>
<span class="normal"><a href="#__codelineno-238-34">34</a></span>
<span class="normal"><a href="#__codelineno-238-35">35</a></span>
<span class="normal"><a href="#__codelineno-238-36">36</a></span>
<span class="normal"><a href="#__codelineno-238-37">37</a></span>
<span class="normal"><a href="#__codelineno-238-38">38</a></span>
<span class="normal"><a href="#__codelineno-238-39">39</a></span>
<span class="normal"><a href="#__codelineno-238-40">40</a></span>
<span class="normal"><a href="#__codelineno-238-41">41</a></span>
<span class="normal"><a href="#__codelineno-238-42">42</a></span>
<span class="normal"><a href="#__codelineno-238-43">43</a></span>
<span class="normal"><a href="#__codelineno-238-44">44</a></span>
<span class="normal"><a href="#__codelineno-238-45">45</a></span>
<span class="normal"><a href="#__codelineno-238-46">46</a></span>
<span class="normal"><a href="#__codelineno-238-47">47</a></span>
<span class="normal"><a href="#__codelineno-238-48">48</a></span>
<span class="normal"><a href="#__codelineno-238-49">49</a></span>
<span class="normal"><a href="#__codelineno-238-50">50</a></span>
<span class="normal"><a href="#__codelineno-238-51">51</a></span>
<span class="normal"><a href="#__codelineno-238-52">52</a></span>
<span class="normal"><a href="#__codelineno-238-53">53</a></span>
<span class="normal"><a href="#__codelineno-238-54">54</a></span>
<span class="normal"><a href="#__codelineno-238-55">55</a></span>
<span class="normal"><a href="#__codelineno-238-56">56</a></span>
<span class="normal"><a href="#__codelineno-238-57">57</a></span>
<span class="normal"><a href="#__codelineno-238-58">58</a></span>
<span class="normal"><a href="#__codelineno-238-59">59</a></span>
<span class="normal"><a href="#__codelineno-238-60">60</a></span>
<span class="normal"><a href="#__codelineno-238-61">61</a></span>
<span class="normal"><a href="#__codelineno-238-62">62</a></span>
<span class="normal"><a href="#__codelineno-238-63">63</a></span>
<span class="normal"><a href="#__codelineno-238-64">64</a></span>
<span class="normal"><a href="#__codelineno-238-65">65</a></span>
<span class="normal"><a href="#__codelineno-238-66">66</a></span>
<span class="normal"><a href="#__codelineno-238-67">67</a></span>
<span class="normal"><a href="#__codelineno-238-68">68</a></span>
<span class="normal"><a href="#__codelineno-238-69">69</a></span>
<span class="normal"><a href="#__codelineno-238-70">70</a></span>
<span class="normal"><a href="#__codelineno-238-71">71</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-238-1" name="__codelineno-238-1"></a><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span><span class="w"> </span><span class="nc">T</span><span class="o">&gt;</span>
<a id="__codelineno-238-2" name="__codelineno-238-2"></a><span class="k">class</span><span class="w"> </span><span class="nc">Auto_ptr4</span>
<a id="__codelineno-238-3" name="__codelineno-238-3"></a><span class="p">{</span>
<a id="__codelineno-238-4" name="__codelineno-238-4"></a><span class="w">    </span><span class="n">T</span><span class="o">*</span><span class="w"> </span><span class="n">m_ptr</span><span class="w"> </span><span class="p">{};</span>
<a id="__codelineno-238-5" name="__codelineno-238-5"></a><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-238-6" name="__codelineno-238-6"></a><span class="w">    </span><span class="n">Auto_ptr4</span><span class="p">(</span><span class="n">T</span><span class="o">*</span><span class="w"> </span><span class="n">ptr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">)</span>
<a id="__codelineno-238-7" name="__codelineno-238-7"></a><span class="w">        </span><span class="o">:</span><span class="w"> </span><span class="n">m_ptr</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">ptr</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-238-8" name="__codelineno-238-8"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-238-9" name="__codelineno-238-9"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-238-10" name="__codelineno-238-10"></a>
<a id="__codelineno-238-11" name="__codelineno-238-11"></a><span class="w">    </span><span class="o">~</span><span class="n">Auto_ptr4</span><span class="p">()</span>
<a id="__codelineno-238-12" name="__codelineno-238-12"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-238-13" name="__codelineno-238-13"></a><span class="w">        </span><span class="k">delete</span><span class="w"> </span><span class="n">m_ptr</span><span class="p">;</span>
<a id="__codelineno-238-14" name="__codelineno-238-14"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-238-15" name="__codelineno-238-15"></a>
<a id="__codelineno-238-16" name="__codelineno-238-16"></a><span class="w">    </span><span class="c1">// Copy constructor</span>
<a id="__codelineno-238-17" name="__codelineno-238-17"></a><span class="w">    </span><span class="c1">// Do deep copy of a.m_ptr to m_ptr</span>
<a id="__codelineno-238-18" name="__codelineno-238-18"></a><span class="w">    </span><span class="n">Auto_ptr4</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">Auto_ptr4</span><span class="o">&amp;</span><span class="w"> </span><span class="n">a</span><span class="p">)</span>
<a id="__codelineno-238-19" name="__codelineno-238-19"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-238-20" name="__codelineno-238-20"></a><span class="w">        </span><span class="n">m_ptr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">T</span><span class="p">;</span>
<a id="__codelineno-238-21" name="__codelineno-238-21"></a><span class="w">        </span><span class="o">*</span><span class="n">m_ptr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">*</span><span class="n">a</span><span class="p">.</span><span class="n">m_ptr</span><span class="p">;</span>
<a id="__codelineno-238-22" name="__codelineno-238-22"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-238-23" name="__codelineno-238-23"></a>
<a id="__codelineno-238-24" name="__codelineno-238-24"></a><span class="w">    </span><span class="c1">// Move constructor</span>
<a id="__codelineno-238-25" name="__codelineno-238-25"></a><span class="w">    </span><span class="c1">// Transfer ownership of a.m_ptr to m_ptr</span>
<a id="__codelineno-238-26" name="__codelineno-238-26"></a><span class="w">    </span><span class="n">Auto_ptr4</span><span class="p">(</span><span class="n">Auto_ptr4</span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">a</span><span class="p">)</span><span class="w"> </span><span class="k">noexcept</span>
<a id="__codelineno-238-27" name="__codelineno-238-27"></a><span class="w">        </span><span class="o">:</span><span class="w"> </span><span class="n">m_ptr</span><span class="p">(</span><span class="n">a</span><span class="p">.</span><span class="n">m_ptr</span><span class="p">)</span>
<a id="__codelineno-238-28" name="__codelineno-238-28"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-238-29" name="__codelineno-238-29"></a><span class="w">        </span><span class="n">a</span><span class="p">.</span><span class="n">m_ptr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">;</span>
<a id="__codelineno-238-30" name="__codelineno-238-30"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-238-31" name="__codelineno-238-31"></a>
<a id="__codelineno-238-32" name="__codelineno-238-32"></a><span class="w">    </span><span class="c1">// Copy assignment</span>
<a id="__codelineno-238-33" name="__codelineno-238-33"></a><span class="w">    </span><span class="c1">// Do deep copy of a.m_ptr to m_ptr</span>
<a id="__codelineno-238-34" name="__codelineno-238-34"></a><span class="w">    </span><span class="n">Auto_ptr4</span><span class="o">&amp;</span><span class="w"> </span><span class="k">operator</span><span class="o">=</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">Auto_ptr4</span><span class="o">&amp;</span><span class="w"> </span><span class="n">a</span><span class="p">)</span>
<a id="__codelineno-238-35" name="__codelineno-238-35"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-238-36" name="__codelineno-238-36"></a><span class="w">        </span><span class="c1">// Self-assignment detection</span>
<a id="__codelineno-238-37" name="__codelineno-238-37"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">&amp;</span><span class="n">a</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">this</span><span class="p">)</span>
<a id="__codelineno-238-38" name="__codelineno-238-38"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="o">*</span><span class="k">this</span><span class="p">;</span>
<a id="__codelineno-238-39" name="__codelineno-238-39"></a>
<a id="__codelineno-238-40" name="__codelineno-238-40"></a><span class="w">        </span><span class="c1">// Release any resource we're holding</span>
<a id="__codelineno-238-41" name="__codelineno-238-41"></a><span class="w">        </span><span class="k">delete</span><span class="w"> </span><span class="n">m_ptr</span><span class="p">;</span>
<a id="__codelineno-238-42" name="__codelineno-238-42"></a>
<a id="__codelineno-238-43" name="__codelineno-238-43"></a><span class="w">        </span><span class="c1">// Copy the resource</span>
<a id="__codelineno-238-44" name="__codelineno-238-44"></a><span class="w">        </span><span class="n">m_ptr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">T</span><span class="p">;</span>
<a id="__codelineno-238-45" name="__codelineno-238-45"></a><span class="w">        </span><span class="o">*</span><span class="n">m_ptr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">*</span><span class="n">a</span><span class="p">.</span><span class="n">m_ptr</span><span class="p">;</span>
<a id="__codelineno-238-46" name="__codelineno-238-46"></a>
<a id="__codelineno-238-47" name="__codelineno-238-47"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="o">*</span><span class="k">this</span><span class="p">;</span>
<a id="__codelineno-238-48" name="__codelineno-238-48"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-238-49" name="__codelineno-238-49"></a>
<a id="__codelineno-238-50" name="__codelineno-238-50"></a><span class="w">    </span><span class="c1">// Move assignment</span>
<a id="__codelineno-238-51" name="__codelineno-238-51"></a><span class="w">    </span><span class="c1">// Transfer ownership of a.m_ptr to m_ptr</span>
<a id="__codelineno-238-52" name="__codelineno-238-52"></a><span class="w">    </span><span class="n">Auto_ptr4</span><span class="o">&amp;</span><span class="w"> </span><span class="k">operator</span><span class="o">=</span><span class="p">(</span><span class="n">Auto_ptr4</span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">a</span><span class="p">)</span><span class="w"> </span><span class="k">noexcept</span>
<a id="__codelineno-238-53" name="__codelineno-238-53"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-238-54" name="__codelineno-238-54"></a><span class="w">        </span><span class="c1">// Self-assignment detection</span>
<a id="__codelineno-238-55" name="__codelineno-238-55"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">&amp;</span><span class="n">a</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">this</span><span class="p">)</span>
<a id="__codelineno-238-56" name="__codelineno-238-56"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="o">*</span><span class="k">this</span><span class="p">;</span>
<a id="__codelineno-238-57" name="__codelineno-238-57"></a>
<a id="__codelineno-238-58" name="__codelineno-238-58"></a><span class="w">        </span><span class="c1">// Release any resource we're holding</span>
<a id="__codelineno-238-59" name="__codelineno-238-59"></a><span class="w">        </span><span class="k">delete</span><span class="w"> </span><span class="n">m_ptr</span><span class="p">;</span>
<a id="__codelineno-238-60" name="__codelineno-238-60"></a>
<a id="__codelineno-238-61" name="__codelineno-238-61"></a><span class="w">        </span><span class="c1">// Transfer ownership of a.m_ptr to m_ptr</span>
<a id="__codelineno-238-62" name="__codelineno-238-62"></a><span class="w">        </span><span class="n">m_ptr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">m_ptr</span><span class="p">;</span>
<a id="__codelineno-238-63" name="__codelineno-238-63"></a><span class="w">        </span><span class="n">a</span><span class="p">.</span><span class="n">m_ptr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">;</span>
<a id="__codelineno-238-64" name="__codelineno-238-64"></a>
<a id="__codelineno-238-65" name="__codelineno-238-65"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="o">*</span><span class="k">this</span><span class="p">;</span>
<a id="__codelineno-238-66" name="__codelineno-238-66"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-238-67" name="__codelineno-238-67"></a>
<a id="__codelineno-238-68" name="__codelineno-238-68"></a><span class="w">    </span><span class="n">T</span><span class="o">&amp;</span><span class="w"> </span><span class="k">operator</span><span class="o">*</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="o">*</span><span class="n">m_ptr</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-238-69" name="__codelineno-238-69"></a><span class="w">    </span><span class="n">T</span><span class="o">*</span><span class="w"> </span><span class="k">operator</span><span class="o">-&gt;</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">m_ptr</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-238-70" name="__codelineno-238-70"></a><span class="w">    </span><span class="kt">bool</span><span class="w"> </span><span class="n">isNull</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">m_ptr</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">nullptr</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-238-71" name="__codelineno-238-71"></a><span class="p">};</span>
</code></pre></div></td></tr></table></div>
</details>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>移动构造函数和移动赋值运算符通常会在函数名后面加上 <code>noexcept</code> 说明符，以告知编译器这两个函数不会抛出异常。这样做的好处是，当我们在使用这两个函数时，编译器可以对这两个函数进行优化，从而提高程序的性能。</p>
</div>
<div class="admonition note">
<p class="admonition-title">隐式移动构造函数和移动赋值运算符</p>
<p>当下列条件全部满足时，编译器将会自动生成一个隐式的移动构造函数和移动赋值运算符：</p>
<ul>
<li>没有用户声明的复制构造函数、复制赋值运算符</li>
<li>没有用户声明的移动构造函数、移动赋值运算符</li>
<li>没有用户声明的析构函数</li>
</ul>
<p>需要注意的是，隐式移动构造函数和移动赋值运算符对指针进行操作时，指挥进行复制，而不是移动。因此如果我们希望移动指针成员，需要自行定义移动构造函数和移动赋值运算符。</p>
</div>
<div class="admonition property">
<p class="admonition-title">The rule of five</p>
<p>复制构造函数、复制赋值运算符、移动构造函数、移动赋值运算符、析构函数被称为<strong>五个特殊成员函数</strong>，它们通常一起出现，因此被称为<strong>五法则</strong>（rule of five）。</p>
<p>当我们需要自行定义它们中的任何一个时，通常也需要定义其他四个。</p>
</div>
<p>我们可以使用 <code>= delete</code> 关键字来禁用移动构造函数和移动赋值运算符，这样我们就可以确保我们的类不会被移动。虽然这看起来能为我们提供一个可复制但不可被移动的对象，但很遗憾，被 delete 的函数仍然会被视为已声明的函数，也会参与重载解析，这可能会导致一些问题。</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-239-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-239-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-239-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-239-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-239-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-239-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-239-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-239-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-239-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-239-10">10</a></span>
<span class="normal"><a href="#__codelineno-239-11">11</a></span>
<span class="normal"><a href="#__codelineno-239-12">12</a></span>
<span class="normal"><a href="#__codelineno-239-13">13</a></span>
<span class="normal"><a href="#__codelineno-239-14">14</a></span>
<span class="normal"><a href="#__codelineno-239-15">15</a></span>
<span class="normal"><a href="#__codelineno-239-16">16</a></span>
<span class="normal"><a href="#__codelineno-239-17">17</a></span>
<span class="normal"><a href="#__codelineno-239-18">18</a></span>
<span class="normal"><a href="#__codelineno-239-19">19</a></span>
<span class="normal"><a href="#__codelineno-239-20">20</a></span>
<span class="normal"><a href="#__codelineno-239-21">21</a></span>
<span class="normal"><a href="#__codelineno-239-22">22</a></span>
<span class="normal"><a href="#__codelineno-239-23">23</a></span>
<span class="normal"><a href="#__codelineno-239-24">24</a></span>
<span class="normal"><a href="#__codelineno-239-25">25</a></span>
<span class="normal"><a href="#__codelineno-239-26">26</a></span>
<span class="normal"><a href="#__codelineno-239-27">27</a></span>
<span class="normal"><a href="#__codelineno-239-28">28</a></span>
<span class="normal"><a href="#__codelineno-239-29">29</a></span>
<span class="normal"><a href="#__codelineno-239-30">30</a></span>
<span class="normal"><a href="#__codelineno-239-31">31</a></span>
<span class="normal"><a href="#__codelineno-239-32">32</a></span>
<span class="normal"><a href="#__codelineno-239-33">33</a></span>
<span class="normal"><a href="#__codelineno-239-34">34</a></span>
<span class="normal"><a href="#__codelineno-239-35">35</a></span>
<span class="normal"><a href="#__codelineno-239-36">36</a></span>
<span class="normal"><a href="#__codelineno-239-37">37</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-239-1" name="__codelineno-239-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span>
<a id="__codelineno-239-2" name="__codelineno-239-2"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;string&gt;</span>
<a id="__codelineno-239-3" name="__codelineno-239-3"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;string_view&gt;</span>
<a id="__codelineno-239-4" name="__codelineno-239-4"></a>
<a id="__codelineno-239-5" name="__codelineno-239-5"></a><span class="k">class</span><span class="w"> </span><span class="nc">Name</span>
<a id="__codelineno-239-6" name="__codelineno-239-6"></a><span class="p">{</span>
<a id="__codelineno-239-7" name="__codelineno-239-7"></a><span class="k">private</span><span class="o">:</span>
<a id="__codelineno-239-8" name="__codelineno-239-8"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">m_name</span><span class="w"> </span><span class="p">{};</span>
<a id="__codelineno-239-9" name="__codelineno-239-9"></a>
<a id="__codelineno-239-10" name="__codelineno-239-10"></a><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-239-11" name="__codelineno-239-11"></a><span class="w">    </span><span class="n">Name</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">string_view</span><span class="w"> </span><span class="n">name</span><span class="p">)</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">m_name</span><span class="p">{</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-239-12" name="__codelineno-239-12"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-239-13" name="__codelineno-239-13"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-239-14" name="__codelineno-239-14"></a>
<a id="__codelineno-239-15" name="__codelineno-239-15"></a><span class="w">    </span><span class="n">Name</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">Name</span><span class="o">&amp;</span><span class="w"> </span><span class="n">name</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">default</span><span class="p">;</span>
<a id="__codelineno-239-16" name="__codelineno-239-16"></a><span class="w">    </span><span class="n">Name</span><span class="o">&amp;</span><span class="w"> </span><span class="k">operator</span><span class="o">=</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">Name</span><span class="o">&amp;</span><span class="w"> </span><span class="n">name</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">default</span><span class="p">;</span>
<a id="__codelineno-239-17" name="__codelineno-239-17"></a>
<a id="__codelineno-239-18" name="__codelineno-239-18"></a><span class="w">    </span><span class="n">Name</span><span class="p">(</span><span class="n">Name</span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">name</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">delete</span><span class="p">;</span>
<a id="__codelineno-239-19" name="__codelineno-239-19"></a><span class="w">    </span><span class="n">Name</span><span class="o">&amp;</span><span class="w"> </span><span class="k">operator</span><span class="o">=</span><span class="p">(</span><span class="n">Name</span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">name</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">delete</span><span class="p">;</span>
<a id="__codelineno-239-20" name="__codelineno-239-20"></a>
<a id="__codelineno-239-21" name="__codelineno-239-21"></a><span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="nf">get</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">m_name</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-239-22" name="__codelineno-239-22"></a><span class="p">};</span>
<a id="__codelineno-239-23" name="__codelineno-239-23"></a>
<a id="__codelineno-239-24" name="__codelineno-239-24"></a><span class="n">Name</span><span class="w"> </span><span class="nf">getJoe</span><span class="p">()</span>
<a id="__codelineno-239-25" name="__codelineno-239-25"></a><span class="p">{</span>
<a id="__codelineno-239-26" name="__codelineno-239-26"></a><span class="w">    </span><span class="n">Name</span><span class="w"> </span><span class="n">joe</span><span class="p">{</span><span class="w"> </span><span class="s">"Joe"</span><span class="w"> </span><span class="p">};</span>
<a id="__codelineno-239-27" name="__codelineno-239-27"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">joe</span><span class="p">;</span><span class="w"> </span><span class="c1">// error: Move constructor was deleted</span>
<a id="__codelineno-239-28" name="__codelineno-239-28"></a><span class="p">}</span>
<a id="__codelineno-239-29" name="__codelineno-239-29"></a>
<a id="__codelineno-239-30" name="__codelineno-239-30"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span>
<a id="__codelineno-239-31" name="__codelineno-239-31"></a><span class="p">{</span>
<a id="__codelineno-239-32" name="__codelineno-239-32"></a><span class="w">    </span><span class="n">Name</span><span class="w"> </span><span class="n">n</span><span class="p">{</span><span class="w"> </span><span class="n">getJoe</span><span class="p">()</span><span class="w"> </span><span class="p">};</span>
<a id="__codelineno-239-33" name="__codelineno-239-33"></a>
<a id="__codelineno-239-34" name="__codelineno-239-34"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">n</span><span class="p">.</span><span class="n">get</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="sc">'\n'</span><span class="p">;</span>
<a id="__codelineno-239-35" name="__codelineno-239-35"></a>
<a id="__codelineno-239-36" name="__codelineno-239-36"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-239-37" name="__codelineno-239-37"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>比如在这个例子中，在函数 <code>getJoe()</code> 中，我们试图返回一个 <code>Name</code> 临时对象，编译器解析后决定通过移动语义返回这个临时对象，但是因为 <code>Name</code> 的移动构造函数被删除了，无法进行移动，因此编译器报错。</p>
<h3 id="stdmove">std::move<a class="headerlink" href="#stdmove" title="Permanent link">¶</a></h3>
<p><code>std::move</code> 是 C++11 引入的一个标准库函数，位于 <code>&lt;utility&gt;</code> 中，它把传入的参数转换为一个右值引用，从而可以调用移动语义。</p>
<details class="example">
<summary>通过 std::move 调用移动语义</summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-240-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-240-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-240-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-240-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-240-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-240-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-240-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-240-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-240-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-240-10">10</a></span>
<span class="normal"><a href="#__codelineno-240-11">11</a></span>
<span class="normal"><a href="#__codelineno-240-12">12</a></span>
<span class="normal"><a href="#__codelineno-240-13">13</a></span>
<span class="normal"><a href="#__codelineno-240-14">14</a></span>
<span class="normal"><a href="#__codelineno-240-15">15</a></span>
<span class="normal"><a href="#__codelineno-240-16">16</a></span>
<span class="normal"><a href="#__codelineno-240-17">17</a></span>
<span class="normal"><a href="#__codelineno-240-18">18</a></span>
<span class="normal"><a href="#__codelineno-240-19">19</a></span>
<span class="normal"><a href="#__codelineno-240-20">20</a></span>
<span class="normal"><a href="#__codelineno-240-21">21</a></span>
<span class="normal"><a href="#__codelineno-240-22">22</a></span>
<span class="normal"><a href="#__codelineno-240-23">23</a></span>
<span class="normal"><a href="#__codelineno-240-24">24</a></span>
<span class="normal"><a href="#__codelineno-240-25">25</a></span>
<span class="normal"><a href="#__codelineno-240-26">26</a></span>
<span class="normal"><a href="#__codelineno-240-27">27</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-240-1" name="__codelineno-240-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span>
<a id="__codelineno-240-2" name="__codelineno-240-2"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;string&gt;</span>
<a id="__codelineno-240-3" name="__codelineno-240-3"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;utility&gt;</span><span class="c1"> // for std::move</span>
<a id="__codelineno-240-4" name="__codelineno-240-4"></a>
<a id="__codelineno-240-5" name="__codelineno-240-5"></a><span class="k">template</span><span class="w"> </span><span class="o">&lt;</span><span class="k">typename</span><span class="w"> </span><span class="nc">T</span><span class="o">&gt;</span>
<a id="__codelineno-240-6" name="__codelineno-240-6"></a><span class="kt">void</span><span class="w"> </span><span class="n">mySwapMove</span><span class="p">(</span><span class="n">T</span><span class="o">&amp;</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="o">&amp;</span><span class="w"> </span><span class="n">b</span><span class="p">)</span>
<a id="__codelineno-240-7" name="__codelineno-240-7"></a><span class="p">{</span>
<a id="__codelineno-240-8" name="__codelineno-240-8"></a><span class="w">    </span><span class="n">T</span><span class="w"> </span><span class="n">tmp</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">move</span><span class="p">(</span><span class="n">a</span><span class="p">)</span><span class="w"> </span><span class="p">};</span><span class="w"> </span><span class="c1">// invokes move constructor</span>
<a id="__codelineno-240-9" name="__codelineno-240-9"></a><span class="w">    </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">move</span><span class="p">(</span><span class="n">b</span><span class="p">);</span><span class="w">   </span><span class="c1">// invokes move assignment</span>
<a id="__codelineno-240-10" name="__codelineno-240-10"></a><span class="w">    </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">move</span><span class="p">(</span><span class="n">tmp</span><span class="p">);</span><span class="w"> </span><span class="c1">// invokes move assignment</span>
<a id="__codelineno-240-11" name="__codelineno-240-11"></a><span class="p">}</span>
<a id="__codelineno-240-12" name="__codelineno-240-12"></a>
<a id="__codelineno-240-13" name="__codelineno-240-13"></a><span class="kt">int</span><span class="w"> </span><span class="n">main</span><span class="p">()</span>
<a id="__codelineno-240-14" name="__codelineno-240-14"></a><span class="p">{</span>
<a id="__codelineno-240-15" name="__codelineno-240-15"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">x</span><span class="p">{</span><span class="w"> </span><span class="s">"abc"</span><span class="w"> </span><span class="p">};</span>
<a id="__codelineno-240-16" name="__codelineno-240-16"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">y</span><span class="p">{</span><span class="w"> </span><span class="s">"de"</span><span class="w"> </span><span class="p">};</span>
<a id="__codelineno-240-17" name="__codelineno-240-17"></a>
<a id="__codelineno-240-18" name="__codelineno-240-18"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"x: "</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="sc">'\n'</span><span class="p">;</span>
<a id="__codelineno-240-19" name="__codelineno-240-19"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"y: "</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="sc">'\n'</span><span class="p">;</span>
<a id="__codelineno-240-20" name="__codelineno-240-20"></a>
<a id="__codelineno-240-21" name="__codelineno-240-21"></a><span class="w">    </span><span class="n">mySwapMove</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">);</span>
<a id="__codelineno-240-22" name="__codelineno-240-22"></a>
<a id="__codelineno-240-23" name="__codelineno-240-23"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"x: "</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="sc">'\n'</span><span class="p">;</span>
<a id="__codelineno-240-24" name="__codelineno-240-24"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"y: "</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="sc">'\n'</span><span class="p">;</span>
<a id="__codelineno-240-25" name="__codelineno-240-25"></a>
<a id="__codelineno-240-26" name="__codelineno-240-26"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-240-27" name="__codelineno-240-27"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>这段程序将输出</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-241-1">1</a></span>
<span class="normal"><a href="#__codelineno-241-2">2</a></span>
<span class="normal"><a href="#__codelineno-241-3">3</a></span>
<span class="normal"><a href="#__codelineno-241-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-241-1" name="__codelineno-241-1"></a>x: abc
<a id="__codelineno-241-2" name="__codelineno-241-2"></a>y: de
<a id="__codelineno-241-3" name="__codelineno-241-3"></a>x: de
<a id="__codelineno-241-4" name="__codelineno-241-4"></a>y: abc
</code></pre></div></td></tr></table></div>
</details>
<p>我们还可以在向一个容器填充左值元素时使用 <code>std::move</code>。在下面的程序中，我们首先使用复制语义添加一个元素，然后再使用移动语义给 vector 添加一个元素。</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-242-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-242-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-242-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-242-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-242-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-242-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-242-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-242-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-242-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-242-10">10</a></span>
<span class="normal"><a href="#__codelineno-242-11">11</a></span>
<span class="normal"><a href="#__codelineno-242-12">12</a></span>
<span class="normal"><a href="#__codelineno-242-13">13</a></span>
<span class="normal"><a href="#__codelineno-242-14">14</a></span>
<span class="normal"><a href="#__codelineno-242-15">15</a></span>
<span class="normal"><a href="#__codelineno-242-16">16</a></span>
<span class="normal"><a href="#__codelineno-242-17">17</a></span>
<span class="normal"><a href="#__codelineno-242-18">18</a></span>
<span class="normal"><a href="#__codelineno-242-19">19</a></span>
<span class="normal"><a href="#__codelineno-242-20">20</a></span>
<span class="normal"><a href="#__codelineno-242-21">21</a></span>
<span class="normal"><a href="#__codelineno-242-22">22</a></span>
<span class="normal"><a href="#__codelineno-242-23">23</a></span>
<span class="normal"><a href="#__codelineno-242-24">24</a></span>
<span class="normal"><a href="#__codelineno-242-25">25</a></span>
<span class="normal"><a href="#__codelineno-242-26">26</a></span>
<span class="normal"><a href="#__codelineno-242-27">27</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-242-1" name="__codelineno-242-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span>
<a id="__codelineno-242-2" name="__codelineno-242-2"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;string&gt;</span>
<a id="__codelineno-242-3" name="__codelineno-242-3"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;utility&gt;</span><span class="c1"> // for std::move</span>
<a id="__codelineno-242-4" name="__codelineno-242-4"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;vector&gt;</span>
<a id="__codelineno-242-5" name="__codelineno-242-5"></a>
<a id="__codelineno-242-6" name="__codelineno-242-6"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span>
<a id="__codelineno-242-7" name="__codelineno-242-7"></a><span class="p">{</span>
<a id="__codelineno-242-8" name="__codelineno-242-8"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span><span class="w"> </span><span class="n">v</span><span class="p">;</span>
<a id="__codelineno-242-9" name="__codelineno-242-9"></a>
<a id="__codelineno-242-10" name="__codelineno-242-10"></a><span class="w">    </span><span class="c1">// We use std::string because it is movable (std::string_view is not)</span>
<a id="__codelineno-242-11" name="__codelineno-242-11"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">str</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s">"Knock"</span><span class="w"> </span><span class="p">};</span>
<a id="__codelineno-242-12" name="__codelineno-242-12"></a>
<a id="__codelineno-242-13" name="__codelineno-242-13"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"Copying str</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
<a id="__codelineno-242-14" name="__codelineno-242-14"></a><span class="w">    </span><span class="n">v</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">str</span><span class="p">);</span><span class="w"> </span><span class="c1">// calls l-value version of push_back, which copies str into the array element</span>
<a id="__codelineno-242-15" name="__codelineno-242-15"></a>
<a id="__codelineno-242-16" name="__codelineno-242-16"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"str: "</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">str</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="sc">'\n'</span><span class="p">;</span>
<a id="__codelineno-242-17" name="__codelineno-242-17"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"vector: "</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="sc">'\n'</span><span class="p">;</span>
<a id="__codelineno-242-18" name="__codelineno-242-18"></a>
<a id="__codelineno-242-19" name="__codelineno-242-19"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"</span><span class="se">\n</span><span class="s">Moving str</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
<a id="__codelineno-242-20" name="__codelineno-242-20"></a>
<a id="__codelineno-242-21" name="__codelineno-242-21"></a><span class="w">    </span><span class="n">v</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">move</span><span class="p">(</span><span class="n">str</span><span class="p">));</span><span class="w"> </span><span class="c1">// calls r-value version of push_back, which moves str into the array element</span>
<a id="__codelineno-242-22" name="__codelineno-242-22"></a>
<a id="__codelineno-242-23" name="__codelineno-242-23"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"str: "</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">str</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="sc">'\n'</span><span class="p">;</span><span class="w"> </span><span class="c1">// The result of this is indeterminate</span>
<a id="__codelineno-242-24" name="__codelineno-242-24"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"vector:"</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="sc">' '</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="sc">'\n'</span><span class="p">;</span>
<a id="__codelineno-242-25" name="__codelineno-242-25"></a>
<a id="__codelineno-242-26" name="__codelineno-242-26"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-242-27" name="__codelineno-242-27"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>在我的 wsl 上，这个程序的输出是</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-243-1">1</a></span>
<span class="normal"><a href="#__codelineno-243-2">2</a></span>
<span class="normal"><a href="#__codelineno-243-3">3</a></span>
<span class="normal"><a href="#__codelineno-243-4">4</a></span>
<span class="normal"><a href="#__codelineno-243-5">5</a></span>
<span class="normal"><a href="#__codelineno-243-6">6</a></span>
<span class="normal"><a href="#__codelineno-243-7">7</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-243-1" name="__codelineno-243-1"></a>Copying str
<a id="__codelineno-243-2" name="__codelineno-243-2"></a>str: Knock
<a id="__codelineno-243-3" name="__codelineno-243-3"></a>vector: Knock
<a id="__codelineno-243-4" name="__codelineno-243-4"></a>
<a id="__codelineno-243-5" name="__codelineno-243-5"></a>Moving str
<a id="__codelineno-243-6" name="__codelineno-243-6"></a>str: 
<a id="__codelineno-243-7" name="__codelineno-243-7"></a>vector:Knock Knock
</code></pre></div></td></tr></table></div>
<ul>
<li>调用复制语义时，我们通过 <code>push_back</code> 将 <code>str</code> <strong>复制</strong>到了 vector 中，因此 <code>str</code> 保持不变。</li>
<li>调用移动语义时，我们通过 <code>push_back</code> 将 <code>str</code> <strong>移动</strong>到了 vector 中，但是这个操作会使得 <code>str</code> 的值变为<strong>不确定的值</strong>，在我的测试中，<code>str</code> 变为空字符串。</li>
</ul>
<p>问题在于，当我们通过 <code>std::move</code> 将一个左值对象的值移动之后，它还会剩下什么呢？C++ 标准规定，当一个对象的值被移动之后，这个对象的状态是<strong>有效但不确定的</strong>。</p>
<blockquote>
<p>The C++ standard library guarantees that moved-from objects are in a valid but unspecified state. The value of an object is not specified except that the object’s invariants are met and operations on the object behave as specified for its type</p>
<p>For all objects and types you use in the C++ standard library you should ensure that moved-from objects also support all requirements of the functions called</p>
</blockquote>
<p>因此当我们想要使用一个值已经被移动走的对象时，我们可以调用这个不依赖于这个对象当前值的任何函数（例如 <code>set()</code>、<code>reset()</code>、<code>clear()</code> 等），我们也可以使用 <code>empty()</code> 等函数测试这个对象的当前状态。但是我们应该避免使用 <code>front()</code>、<code>back()</code>、<code>pop_back()</code> 等函数，因为这些函数依赖于对象的当前值。</p>
<div class="admonition key-point">
<p class="admonition-title">Key-point</p>
<p>当一个对象的值被移动后，我们不应对这个对象的值有任何假设（包括假设它的值保留不变和假设它的值变为某个特定值），我们只能知道这个对象的状态是有效的，但是具体的值是不确定的。</p>
</div>
<h3 id="stdunique_ptr">std::unique_ptr<a class="headerlink" href="#stdunique_ptr" title="Permanent link">¶</a></h3>
<p><code>std::unique_ptr</code> 是 C++11 中 <code>std::auto_ptr</code> 的一个完全替代方案，位于 <code>&lt;memory&gt;</code> 头文件中，它应用于未被多个对象共享的动态分配的对象，也就是说它应该完全拥有这块内存，不能和其他类共享。</p>
<ul>
<li>std::unique_ptr 具有重载过后的 <code>*</code> 和 <code>-&gt;</code> 运算符，前者返回它正在管理的资源，后者返回这个资源的指针。</li>
<li>std::unique_ptr 并不总是在管理一个对象——它可以因默认初始化或传入 nullptr 而是空的，也可以因为管理的资源被移动给另一个 std::unique_ptr 而是空的。</li>
</ul>
<details class="example">
<summary>Example</summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-244-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-244-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-244-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-244-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-244-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-244-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-244-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-244-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-244-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-244-10">10</a></span>
<span class="normal"><a href="#__codelineno-244-11">11</a></span>
<span class="normal"><a href="#__codelineno-244-12">12</a></span>
<span class="normal"><a href="#__codelineno-244-13">13</a></span>
<span class="normal"><a href="#__codelineno-244-14">14</a></span>
<span class="normal"><a href="#__codelineno-244-15">15</a></span>
<span class="normal"><a href="#__codelineno-244-16">16</a></span>
<span class="normal"><a href="#__codelineno-244-17">17</a></span>
<span class="normal"><a href="#__codelineno-244-18">18</a></span>
<span class="normal"><a href="#__codelineno-244-19">19</a></span>
<span class="normal"><a href="#__codelineno-244-20">20</a></span>
<span class="normal"><a href="#__codelineno-244-21">21</a></span>
<span class="normal"><a href="#__codelineno-244-22">22</a></span>
<span class="normal"><a href="#__codelineno-244-23">23</a></span>
<span class="normal"><a href="#__codelineno-244-24">24</a></span>
<span class="normal"><a href="#__codelineno-244-25">25</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-244-1" name="__codelineno-244-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span>
<a id="__codelineno-244-2" name="__codelineno-244-2"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;memory&gt;</span><span class="c1"> // for std::unique_ptr</span>
<a id="__codelineno-244-3" name="__codelineno-244-3"></a>
<a id="__codelineno-244-4" name="__codelineno-244-4"></a><span class="k">class</span><span class="w"> </span><span class="nc">Resource</span>
<a id="__codelineno-244-5" name="__codelineno-244-5"></a><span class="p">{</span>
<a id="__codelineno-244-6" name="__codelineno-244-6"></a><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-244-7" name="__codelineno-244-7"></a><span class="w">    </span><span class="n">Resource</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"Resource acquired</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-244-8" name="__codelineno-244-8"></a><span class="w">    </span><span class="o">~</span><span class="n">Resource</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"Resource destroyed</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-244-9" name="__codelineno-244-9"></a><span class="p">};</span>
<a id="__codelineno-244-10" name="__codelineno-244-10"></a>
<a id="__codelineno-244-11" name="__codelineno-244-11"></a><span class="n">std</span><span class="o">::</span><span class="n">ostream</span><span class="o">&amp;</span><span class="w"> </span><span class="k">operator</span><span class="o">&lt;&lt;</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">ostream</span><span class="o">&amp;</span><span class="w"> </span><span class="n">out</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">Resource</span><span class="o">&amp;</span><span class="p">)</span>
<a id="__codelineno-244-12" name="__codelineno-244-12"></a><span class="p">{</span>
<a id="__codelineno-244-13" name="__codelineno-244-13"></a><span class="w">    </span><span class="n">out</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"I am a resource"</span><span class="p">;</span>
<a id="__codelineno-244-14" name="__codelineno-244-14"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">out</span><span class="p">;</span>
<a id="__codelineno-244-15" name="__codelineno-244-15"></a><span class="p">}</span>
<a id="__codelineno-244-16" name="__codelineno-244-16"></a>
<a id="__codelineno-244-17" name="__codelineno-244-17"></a><span class="kt">int</span><span class="w"> </span><span class="n">main</span><span class="p">()</span>
<a id="__codelineno-244-18" name="__codelineno-244-18"></a><span class="p">{</span>
<a id="__codelineno-244-19" name="__codelineno-244-19"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">Resource</span><span class="o">&gt;</span><span class="w"> </span><span class="n">res</span><span class="p">{</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Resource</span><span class="p">{}</span><span class="w"> </span><span class="p">};</span>
<a id="__codelineno-244-20" name="__codelineno-244-20"></a>
<a id="__codelineno-244-21" name="__codelineno-244-21"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
<a id="__codelineno-244-22" name="__codelineno-244-22"></a><span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="o">*</span><span class="n">res</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="sc">'\n'</span><span class="p">;</span>
<a id="__codelineno-244-23" name="__codelineno-244-23"></a>
<a id="__codelineno-244-24" name="__codelineno-244-24"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-244-25" name="__codelineno-244-25"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>这段程序将输出</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-245-1">1</a></span>
<span class="normal"><a href="#__codelineno-245-2">2</a></span>
<span class="normal"><a href="#__codelineno-245-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-245-1" name="__codelineno-245-1"></a>Resource acquired
<a id="__codelineno-245-2" name="__codelineno-245-2"></a>I am a resource
<a id="__codelineno-245-3" name="__codelineno-245-3"></a>Resource destroyed
</code></pre></div></td></tr></table></div>
</details>
<p>与 std::auto_ptr 不同的是，std::unique_ptr 知道何时使用 delete，何时使用 delete[]，因此它可以正确地管理动态数组。但相较于用 std::unique_ptr 来管理动态数组，使用 std::vector 或 std::array 总是更好的选择。</p>
<h4 id="stdmake_unique">std::make_unique<a class="headerlink" href="#stdmake_unique" title="Permanent link">¶</a></h4>
<p>C++14 具有一个名为 <code>std::make_unique</code> 的函数，它可以用来创建一个 <code>std::unique_ptr</code> 对象。</p>
<div class="admonition example">
<p class="admonition-title">Example</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-246-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-246-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-246-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-246-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-246-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-246-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-246-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-246-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-246-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-246-10">10</a></span>
<span class="normal"><a href="#__codelineno-246-11">11</a></span>
<span class="normal"><a href="#__codelineno-246-12">12</a></span>
<span class="normal"><a href="#__codelineno-246-13">13</a></span>
<span class="normal"><a href="#__codelineno-246-14">14</a></span>
<span class="normal"><a href="#__codelineno-246-15">15</a></span>
<span class="normal"><a href="#__codelineno-246-16">16</a></span>
<span class="normal"><a href="#__codelineno-246-17">17</a></span>
<span class="normal"><a href="#__codelineno-246-18">18</a></span>
<span class="normal"><a href="#__codelineno-246-19">19</a></span>
<span class="normal"><a href="#__codelineno-246-20">20</a></span>
<span class="normal"><a href="#__codelineno-246-21">21</a></span>
<span class="normal"><a href="#__codelineno-246-22">22</a></span>
<span class="normal"><a href="#__codelineno-246-23">23</a></span>
<span class="normal"><a href="#__codelineno-246-24">24</a></span>
<span class="normal"><a href="#__codelineno-246-25">25</a></span>
<span class="normal"><a href="#__codelineno-246-26">26</a></span>
<span class="normal"><a href="#__codelineno-246-27">27</a></span>
<span class="normal"><a href="#__codelineno-246-28">28</a></span>
<span class="normal"><a href="#__codelineno-246-29">29</a></span>
<span class="normal"><a href="#__codelineno-246-30">30</a></span>
<span class="normal"><a href="#__codelineno-246-31">31</a></span>
<span class="normal"><a href="#__codelineno-246-32">32</a></span>
<span class="normal"><a href="#__codelineno-246-33">33</a></span>
<span class="normal"><a href="#__codelineno-246-34">34</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-246-1" name="__codelineno-246-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;memory&gt;</span><span class="c1"> // for std::unique_ptr and std::make_unique</span>
<a id="__codelineno-246-2" name="__codelineno-246-2"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span>
<a id="__codelineno-246-3" name="__codelineno-246-3"></a>
<a id="__codelineno-246-4" name="__codelineno-246-4"></a><span class="k">class</span><span class="w"> </span><span class="nc">Fraction</span>
<a id="__codelineno-246-5" name="__codelineno-246-5"></a><span class="p">{</span>
<a id="__codelineno-246-6" name="__codelineno-246-6"></a><span class="k">private</span><span class="o">:</span>
<a id="__codelineno-246-7" name="__codelineno-246-7"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">m_numerator</span><span class="p">{</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">};</span>
<a id="__codelineno-246-8" name="__codelineno-246-8"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">m_denominator</span><span class="p">{</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">};</span>
<a id="__codelineno-246-9" name="__codelineno-246-9"></a>
<a id="__codelineno-246-10" name="__codelineno-246-10"></a><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-246-11" name="__codelineno-246-11"></a><span class="w">    </span><span class="n">Fraction</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">numerator</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">denominator</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">:</span>
<a id="__codelineno-246-12" name="__codelineno-246-12"></a><span class="w">        </span><span class="n">m_numerator</span><span class="p">{</span><span class="w"> </span><span class="n">numerator</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">m_denominator</span><span class="p">{</span><span class="w"> </span><span class="n">denominator</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-246-13" name="__codelineno-246-13"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-246-14" name="__codelineno-246-14"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-246-15" name="__codelineno-246-15"></a>
<a id="__codelineno-246-16" name="__codelineno-246-16"></a><span class="w">    </span><span class="k">friend</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">ostream</span><span class="o">&amp;</span><span class="w"> </span><span class="k">operator</span><span class="o">&lt;&lt;</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">ostream</span><span class="o">&amp;</span><span class="w"> </span><span class="n">out</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">Fraction</span><span class="w"> </span><span class="o">&amp;</span><span class="n">f1</span><span class="p">)</span>
<a id="__codelineno-246-17" name="__codelineno-246-17"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-246-18" name="__codelineno-246-18"></a><span class="w">        </span><span class="n">out</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">f1</span><span class="p">.</span><span class="n">m_numerator</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="sc">'/'</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">f1</span><span class="p">.</span><span class="n">m_denominator</span><span class="p">;</span>
<a id="__codelineno-246-19" name="__codelineno-246-19"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">out</span><span class="p">;</span>
<a id="__codelineno-246-20" name="__codelineno-246-20"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-246-21" name="__codelineno-246-21"></a><span class="p">};</span>
<a id="__codelineno-246-22" name="__codelineno-246-22"></a>
<a id="__codelineno-246-23" name="__codelineno-246-23"></a>
<a id="__codelineno-246-24" name="__codelineno-246-24"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span>
<a id="__codelineno-246-25" name="__codelineno-246-25"></a><span class="p">{</span>
<a id="__codelineno-246-26" name="__codelineno-246-26"></a><span class="w">    </span><span class="k">auto</span><span class="w"> </span><span class="n">f1</span><span class="p">{</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">make_unique</span><span class="o">&lt;</span><span class="n">Fraction</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">)</span><span class="w"> </span><span class="p">};</span>
<a id="__codelineno-246-27" name="__codelineno-246-27"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="o">*</span><span class="n">f1</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="sc">'\n'</span><span class="p">;</span>
<a id="__codelineno-246-28" name="__codelineno-246-28"></a>
<a id="__codelineno-246-29" name="__codelineno-246-29"></a><span class="w">    </span><span class="c1">// Create a dynamically allocated array of Fractions of length 4</span>
<a id="__codelineno-246-30" name="__codelineno-246-30"></a><span class="w">    </span><span class="k">auto</span><span class="w"> </span><span class="n">f2</span><span class="p">{</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">make_unique</span><span class="o">&lt;</span><span class="n">Fraction</span><span class="p">[]</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="p">};</span>
<a id="__codelineno-246-31" name="__codelineno-246-31"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">f2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="sc">'\n'</span><span class="p">;</span>
<a id="__codelineno-246-32" name="__codelineno-246-32"></a>
<a id="__codelineno-246-33" name="__codelineno-246-33"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-246-34" name="__codelineno-246-34"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>输出为</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-247-1">1</a></span>
<span class="normal"><a href="#__codelineno-247-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-247-1" name="__codelineno-247-1"></a>3/5
<a id="__codelineno-247-2" name="__codelineno-247-2"></a>0/1
</code></pre></div></td></tr></table></div>
</div>
<p>一般而言，更建议使用 <code>std::make_unique</code> 来创建 <code>std::unique_ptr</code> 对象，除了实际使用时更加简洁外，它还可以避免一些潜在的内存泄漏问题。</p>
<h4 id="stdunique_ptr_1">std::unique_ptr 的实际应用<a class="headerlink" href="#stdunique_ptr_1" title="Permanent link">¶</a></h4>
<ul>
<li><strong>按值返回 std::unique_ptr </strong>通常比直接返回原始指针更加安全，并且除非拥有什么特殊的理由，我们不应按指针或引用返回 std::unique_ptr。</li>
<li>按值传递 std::unique_ptr 会使得资源的所有权发生转移</li>
<li>
<p>如果我们想要从 std::unique_ptr 中获取一个原始指针，我们可以使用 <code>get()</code> 成员函数，例如</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-248-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-248-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-248-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-248-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-248-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-248-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-248-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-248-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-248-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-248-10">10</a></span>
<span class="normal"><a href="#__codelineno-248-11">11</a></span>
<span class="normal"><a href="#__codelineno-248-12">12</a></span>
<span class="normal"><a href="#__codelineno-248-13">13</a></span>
<span class="normal"><a href="#__codelineno-248-14">14</a></span>
<span class="normal"><a href="#__codelineno-248-15">15</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-248-1" name="__codelineno-248-1"></a><span class="kt">void</span><span class="w"> </span><span class="nf">useResource</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">Resource</span><span class="o">*</span><span class="w"> </span><span class="n">res</span><span class="p">)</span>
<a id="__codelineno-248-2" name="__codelineno-248-2"></a><span class="p">{</span>
<a id="__codelineno-248-3" name="__codelineno-248-3"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
<a id="__codelineno-248-4" name="__codelineno-248-4"></a><span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="o">*</span><span class="n">res</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="sc">'\n'</span><span class="p">;</span>
<a id="__codelineno-248-5" name="__codelineno-248-5"></a><span class="w">    </span><span class="k">else</span>
<a id="__codelineno-248-6" name="__codelineno-248-6"></a><span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"No resource</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
<a id="__codelineno-248-7" name="__codelineno-248-7"></a><span class="p">}</span>
<a id="__codelineno-248-8" name="__codelineno-248-8"></a>
<a id="__codelineno-248-9" name="__codelineno-248-9"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span>
<a id="__codelineno-248-10" name="__codelineno-248-10"></a><span class="p">{</span>
<a id="__codelineno-248-11" name="__codelineno-248-11"></a><span class="w">    </span><span class="k">auto</span><span class="w"> </span><span class="n">ptr</span><span class="p">{</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">make_unique</span><span class="o">&lt;</span><span class="n">Resource</span><span class="o">&gt;</span><span class="p">()</span><span class="w"> </span><span class="p">};</span>
<a id="__codelineno-248-12" name="__codelineno-248-12"></a><span class="w">    </span><span class="n">useResource</span><span class="p">(</span><span class="n">ptr</span><span class="p">.</span><span class="n">get</span><span class="p">());</span>
<a id="__codelineno-248-13" name="__codelineno-248-13"></a>
<a id="__codelineno-248-14" name="__codelineno-248-14"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-248-15" name="__codelineno-248-15"></a><span class="p">}</span><span class="w"> </span>
</code></pre></div></td></tr></table></div>
</li>
<li>
<p>当 std::unique_ptr 作为类的成员时，当这个类对象被销毁，std::unique_ptr 也会被销毁，从而释放它所管理的资源。</p>
<p>但是，如果类对象没有被正确销毁（例如它是动态分配的，并且没有正确地被 delete），那么这个 std::unique_ptr 也不会被销毁，从而导致资源泄漏。</p>
</li>
</ul>
<h3 id="stdshared_ptr">std::shared_ptr<a class="headerlink" href="#stdshared_ptr" title="Permanent link">¶</a></h3>
<p>std::shared_ptr 和 std::unique_ptr 的不同之处在于它旨在处理多个智能指针共享同一个资源的情况。</p>
<p>std::shared_ptr 的内部通过一种计数机制来跟踪有多少个 std::shared_ptr 在共同指向同一个资源，至少有一个 std::shared_ptr 仍指向这个资源时，std::shared_ptr 的销毁不会导致这块内存的释放，仅当最后一个指向这块资源的 std::shared_ptr 被销毁时，资源才会被销毁。</p>
<div class="admonition example">
<p class="admonition-title">Example</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-249-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-249-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-249-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-249-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-249-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-249-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-249-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-249-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-249-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-249-10">10</a></span>
<span class="normal"><a href="#__codelineno-249-11">11</a></span>
<span class="normal"><a href="#__codelineno-249-12">12</a></span>
<span class="normal"><a href="#__codelineno-249-13">13</a></span>
<span class="normal"><a href="#__codelineno-249-14">14</a></span>
<span class="normal"><a href="#__codelineno-249-15">15</a></span>
<span class="normal"><a href="#__codelineno-249-16">16</a></span>
<span class="normal"><a href="#__codelineno-249-17">17</a></span>
<span class="normal"><a href="#__codelineno-249-18">18</a></span>
<span class="normal"><a href="#__codelineno-249-19">19</a></span>
<span class="normal"><a href="#__codelineno-249-20">20</a></span>
<span class="normal"><a href="#__codelineno-249-21">21</a></span>
<span class="normal"><a href="#__codelineno-249-22">22</a></span>
<span class="normal"><a href="#__codelineno-249-23">23</a></span>
<span class="normal"><a href="#__codelineno-249-24">24</a></span>
<span class="normal"><a href="#__codelineno-249-25">25</a></span>
<span class="normal"><a href="#__codelineno-249-26">26</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-249-1" name="__codelineno-249-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span>
<a id="__codelineno-249-2" name="__codelineno-249-2"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;memory&gt;</span><span class="c1"> // for std::shared_ptr</span>
<a id="__codelineno-249-3" name="__codelineno-249-3"></a>
<a id="__codelineno-249-4" name="__codelineno-249-4"></a><span class="k">class</span><span class="w"> </span><span class="nc">Resource</span>
<a id="__codelineno-249-5" name="__codelineno-249-5"></a><span class="p">{</span>
<a id="__codelineno-249-6" name="__codelineno-249-6"></a><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-249-7" name="__codelineno-249-7"></a><span class="w">    </span><span class="n">Resource</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"Resource acquired</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-249-8" name="__codelineno-249-8"></a><span class="w">    </span><span class="o">~</span><span class="n">Resource</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"Resource destroyed</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-249-9" name="__codelineno-249-9"></a><span class="p">};</span>
<a id="__codelineno-249-10" name="__codelineno-249-10"></a>
<a id="__codelineno-249-11" name="__codelineno-249-11"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span>
<a id="__codelineno-249-12" name="__codelineno-249-12"></a><span class="p">{</span>
<a id="__codelineno-249-13" name="__codelineno-249-13"></a><span class="w">    </span><span class="c1">// allocate a Resource object and have it owned by std::shared_ptr</span>
<a id="__codelineno-249-14" name="__codelineno-249-14"></a><span class="w">    </span><span class="n">Resource</span><span class="o">*</span><span class="w"> </span><span class="n">res</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Resource</span><span class="w"> </span><span class="p">};</span>
<a id="__codelineno-249-15" name="__codelineno-249-15"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Resource</span><span class="o">&gt;</span><span class="w"> </span><span class="n">ptr1</span><span class="p">{</span><span class="w"> </span><span class="n">res</span><span class="w"> </span><span class="p">};</span>
<a id="__codelineno-249-16" name="__codelineno-249-16"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-249-17" name="__codelineno-249-17"></a><span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Resource</span><span class="o">&gt;</span><span class="w"> </span><span class="n">ptr2</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">ptr1</span><span class="w"> </span><span class="p">};</span><span class="w"> </span>
<a id="__codelineno-249-18" name="__codelineno-249-18"></a><span class="w">        </span><span class="c1">// make another std::shared_ptr pointing to the same thing</span>
<a id="__codelineno-249-19" name="__codelineno-249-19"></a>
<a id="__codelineno-249-20" name="__codelineno-249-20"></a><span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"Killing one shared pointer</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
<a id="__codelineno-249-21" name="__codelineno-249-21"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="c1">// ptr2 goes out of scope here, but nothing happens</span>
<a id="__codelineno-249-22" name="__codelineno-249-22"></a>
<a id="__codelineno-249-23" name="__codelineno-249-23"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"Killing another shared pointer</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
<a id="__codelineno-249-24" name="__codelineno-249-24"></a>
<a id="__codelineno-249-25" name="__codelineno-249-25"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-249-26" name="__codelineno-249-26"></a><span class="p">}</span><span class="w"> </span><span class="c1">// ptr1 goes out of scope here, and the allocated Resource is destroyed</span>
</code></pre></div></td></tr></table></div>
<p>这段程序将输出</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-250-1">1</a></span>
<span class="normal"><a href="#__codelineno-250-2">2</a></span>
<span class="normal"><a href="#__codelineno-250-3">3</a></span>
<span class="normal"><a href="#__codelineno-250-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-250-1" name="__codelineno-250-1"></a>Resource acquired
<a id="__codelineno-250-2" name="__codelineno-250-2"></a>Killing one shared pointer
<a id="__codelineno-250-3" name="__codelineno-250-3"></a>Killing another shared pointer
<a id="__codelineno-250-4" name="__codelineno-250-4"></a>Resource destroyed
</code></pre></div></td></tr></table></div>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>需要格外强调的是，我们利用第一个 shared pointer 初始化了第二个 shared pointer，这样才能保证资源不会在第一个 shared pointer 被销毁时被释放。</p>
</div>
<p>考虑另一个例子</p>
<div class="admonition example">
<p class="admonition-title">Example</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-251-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-251-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-251-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-251-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-251-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-251-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-251-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-251-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-251-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-251-10">10</a></span>
<span class="normal"><a href="#__codelineno-251-11">11</a></span>
<span class="normal"><a href="#__codelineno-251-12">12</a></span>
<span class="normal"><a href="#__codelineno-251-13">13</a></span>
<span class="normal"><a href="#__codelineno-251-14">14</a></span>
<span class="normal"><a href="#__codelineno-251-15">15</a></span>
<span class="normal"><a href="#__codelineno-251-16">16</a></span>
<span class="normal"><a href="#__codelineno-251-17">17</a></span>
<span class="normal"><a href="#__codelineno-251-18">18</a></span>
<span class="normal"><a href="#__codelineno-251-19">19</a></span>
<span class="normal"><a href="#__codelineno-251-20">20</a></span>
<span class="normal"><a href="#__codelineno-251-21">21</a></span>
<span class="normal"><a href="#__codelineno-251-22">22</a></span>
<span class="normal"><a href="#__codelineno-251-23">23</a></span>
<span class="normal"><a href="#__codelineno-251-24">24</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-251-1" name="__codelineno-251-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span>
<a id="__codelineno-251-2" name="__codelineno-251-2"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;memory&gt;</span><span class="c1"> // for std::shared_ptr</span>
<a id="__codelineno-251-3" name="__codelineno-251-3"></a>
<a id="__codelineno-251-4" name="__codelineno-251-4"></a><span class="k">class</span><span class="w"> </span><span class="nc">Resource</span>
<a id="__codelineno-251-5" name="__codelineno-251-5"></a><span class="p">{</span>
<a id="__codelineno-251-6" name="__codelineno-251-6"></a><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-251-7" name="__codelineno-251-7"></a><span class="w">    </span><span class="n">Resource</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"Resource acquired</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-251-8" name="__codelineno-251-8"></a><span class="w">    </span><span class="o">~</span><span class="n">Resource</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"Resource destroyed</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-251-9" name="__codelineno-251-9"></a><span class="p">};</span>
<a id="__codelineno-251-10" name="__codelineno-251-10"></a>
<a id="__codelineno-251-11" name="__codelineno-251-11"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span>
<a id="__codelineno-251-12" name="__codelineno-251-12"></a><span class="p">{</span>
<a id="__codelineno-251-13" name="__codelineno-251-13"></a><span class="w">    </span><span class="n">Resource</span><span class="o">*</span><span class="w"> </span><span class="n">res</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Resource</span><span class="w"> </span><span class="p">};</span>
<a id="__codelineno-251-14" name="__codelineno-251-14"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Resource</span><span class="o">&gt;</span><span class="w"> </span><span class="n">ptr1</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">res</span><span class="w"> </span><span class="p">};</span>
<a id="__codelineno-251-15" name="__codelineno-251-15"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-251-16" name="__codelineno-251-16"></a><span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Resource</span><span class="o">&gt;</span><span class="w"> </span><span class="n">ptr2</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">res</span><span class="w"> </span><span class="p">};</span><span class="w"> </span><span class="c1">// create ptr2 directly from res (instead of ptr1)</span>
<a id="__codelineno-251-17" name="__codelineno-251-17"></a>
<a id="__codelineno-251-18" name="__codelineno-251-18"></a><span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"Killing one shared pointer</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
<a id="__codelineno-251-19" name="__codelineno-251-19"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="c1">// ptr2 goes out of scope here, and the allocated Resource is destroyed</span>
<a id="__codelineno-251-20" name="__codelineno-251-20"></a>
<a id="__codelineno-251-21" name="__codelineno-251-21"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"Killing another shared pointer</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
<a id="__codelineno-251-22" name="__codelineno-251-22"></a>
<a id="__codelineno-251-23" name="__codelineno-251-23"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-251-24" name="__codelineno-251-24"></a><span class="p">}</span><span class="w"> </span><span class="c1">// ptr1 goes out of scope here, and the allocated Resource is destroyed again</span>
</code></pre></div></td></tr></table></div>
<p>这段程序在输出以下内容后会崩溃（至少在我的机器上会）</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-252-1">1</a></span>
<span class="normal"><a href="#__codelineno-252-2">2</a></span>
<span class="normal"><a href="#__codelineno-252-3">3</a></span>
<span class="normal"><a href="#__codelineno-252-4">4</a></span>
<span class="normal"><a href="#__codelineno-252-5">5</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-252-1" name="__codelineno-252-1"></a>Resource acquired
<a id="__codelineno-252-2" name="__codelineno-252-2"></a>Killing one shared pointer
<a id="__codelineno-252-3" name="__codelineno-252-3"></a>Resource destroyed
<a id="__codelineno-252-4" name="__codelineno-252-4"></a>Killing another shared pointer
<a id="__codelineno-252-5" name="__codelineno-252-5"></a>Resource destroyed
</code></pre></div></td></tr></table></div>
</div>
<p>第二个例子的区别在于，我们相互独立的创建了两个 std::shared_ptr，即使它们都指向同一块资源，但它们不知道彼此的存在，都认为自己是资源的唯一持有者。当 <code>ptr2</code> 被销毁时，它会释放资源，但是 <code>ptr1</code> 仍持有指向这块资源的指针，当 <code>ptr1</code> 也被销毁时，它会再次尝试释放资源，这会导致程序崩溃。</p>
<div class="admonition info">
<p class="admonition-title">Best practice</p>
<p>如果我们需要让多个 std::shared_ptr 指向相同的资源，使用现有的 std::shared_ptr 来初始化新的 std::shared_ptr 是最好的选择。</p>
</div>
<div class="admonition note">
<p class="admonition-title">std::make_shared</p>
<p>类似与 <code>std::make_unique</code>，C++14 还引入了 <code>std::make_shared</code> 函数，用于创建 <code>std::shared_ptr</code> 对象。</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-253-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-253-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-253-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-253-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-253-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-253-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-253-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-253-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-253-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-253-10">10</a></span>
<span class="normal"><a href="#__codelineno-253-11">11</a></span>
<span class="normal"><a href="#__codelineno-253-12">12</a></span>
<span class="normal"><a href="#__codelineno-253-13">13</a></span>
<span class="normal"><a href="#__codelineno-253-14">14</a></span>
<span class="normal"><a href="#__codelineno-253-15">15</a></span>
<span class="normal"><a href="#__codelineno-253-16">16</a></span>
<span class="normal"><a href="#__codelineno-253-17">17</a></span>
<span class="normal"><a href="#__codelineno-253-18">18</a></span>
<span class="normal"><a href="#__codelineno-253-19">19</a></span>
<span class="normal"><a href="#__codelineno-253-20">20</a></span>
<span class="normal"><a href="#__codelineno-253-21">21</a></span>
<span class="normal"><a href="#__codelineno-253-22">22</a></span>
<span class="normal"><a href="#__codelineno-253-23">23</a></span>
<span class="normal"><a href="#__codelineno-253-24">24</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-253-1" name="__codelineno-253-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span>
<a id="__codelineno-253-2" name="__codelineno-253-2"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;memory&gt;</span><span class="c1"> // for std::shared_ptr</span>
<a id="__codelineno-253-3" name="__codelineno-253-3"></a>
<a id="__codelineno-253-4" name="__codelineno-253-4"></a><span class="k">class</span><span class="w"> </span><span class="nc">Resource</span>
<a id="__codelineno-253-5" name="__codelineno-253-5"></a><span class="p">{</span>
<a id="__codelineno-253-6" name="__codelineno-253-6"></a><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-253-7" name="__codelineno-253-7"></a><span class="w">    </span><span class="n">Resource</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"Resource acquired</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-253-8" name="__codelineno-253-8"></a><span class="w">    </span><span class="o">~</span><span class="n">Resource</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"Resource destroyed</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-253-9" name="__codelineno-253-9"></a><span class="p">};</span>
<a id="__codelineno-253-10" name="__codelineno-253-10"></a>
<a id="__codelineno-253-11" name="__codelineno-253-11"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span>
<a id="__codelineno-253-12" name="__codelineno-253-12"></a><span class="p">{</span>
<a id="__codelineno-253-13" name="__codelineno-253-13"></a><span class="w">    </span><span class="c1">// allocate a Resource object and have it owned by std::shared_ptr</span>
<a id="__codelineno-253-14" name="__codelineno-253-14"></a><span class="w">    </span><span class="k">auto</span><span class="w"> </span><span class="n">ptr1</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">make_shared</span><span class="o">&lt;</span><span class="n">Resource</span><span class="o">&gt;</span><span class="p">()</span><span class="w"> </span><span class="p">};</span>
<a id="__codelineno-253-15" name="__codelineno-253-15"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-253-16" name="__codelineno-253-16"></a><span class="w">        </span><span class="k">auto</span><span class="w"> </span><span class="n">ptr2</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">ptr1</span><span class="w"> </span><span class="p">};</span><span class="w"> </span><span class="c1">// create ptr2 using copy of ptr1</span>
<a id="__codelineno-253-17" name="__codelineno-253-17"></a>
<a id="__codelineno-253-18" name="__codelineno-253-18"></a><span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"Killing one shared pointer</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
<a id="__codelineno-253-19" name="__codelineno-253-19"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="c1">// ptr2 goes out of scope here, but nothing happens</span>
<a id="__codelineno-253-20" name="__codelineno-253-20"></a>
<a id="__codelineno-253-21" name="__codelineno-253-21"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"Killing another shared pointer</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
<a id="__codelineno-253-22" name="__codelineno-253-22"></a>
<a id="__codelineno-253-23" name="__codelineno-253-23"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-253-24" name="__codelineno-253-24"></a><span class="p">}</span><span class="w"> </span><span class="c1">// ptr1 goes out of scope here, and the allocated Resource is destroyed</span>
</code></pre></div></td></tr></table></div>
</div>
<p>与内部使用单个指针的 std::unique_ptr 不同，std::shared_ptr 使用两个指针：一个指向资源，另一个指向控制块（control block）。控制块包含了资源的引用计数，当 std::shared_ptr 被销毁时，引用计数减一，当引用计数为 0 时，资源被销毁。</p>
<p>这也解释了为什么独立地创建两个 std::shared_ptr 会导致资源被释放两次：因为这两个 std::shared_ptr 指向不同的控制块，它们各自维护着资源的引用计数，因此当其中一个 std::shared_ptr 被销毁时，它会减少资源的引用计数，但是另一个 std::shared_ptr 并不知道这个资源已经被销毁，因此当它被销毁时，它会再次尝试释放资源。</p>
<p>当我们用现有的 std::shared_ptr 初始化一个新的 std::shared_ptr 时，这两个 std::shared_ptr 指向同一个控制块，因此它们共享资源的引用计数，因此只有当最后一个 std::shared_ptr 被销毁时，资源才会被销毁。</p>
<hr/>
<h2 id="_72">继承<a class="headerlink" href="#_72" title="Permanent link">¶</a></h2>
<p>C++ 的继承发生在类与类之间，在继承关系中，被继承的类称为<strong>父类</strong>（parent class）、基类（base class）或超级类（superclass），继承的类称为子类（child class）、派生类（derived class）或衍生类（subclass）。</p>
<ul>
<li>子类会从父类中继承行为（成员函数）和属性（成员变量），这些变量和函数会成为子类的成员变量和函数，子类可以通过继承来重用父类的代码，从而减少代码的重复。</li>
<li>子类本身也是一个独立的类，可以定义自己的成员变量和成员函数，也可以重载父类的成员函数。</li>
</ul>
<p>假设我们有一个类 A，并且 B 继承自 A</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-254-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-254-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-254-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-254-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-254-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-254-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-254-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-254-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-254-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-254-10">10</a></span>
<span class="normal"><a href="#__codelineno-254-11">11</a></span>
<span class="normal"><a href="#__codelineno-254-12">12</a></span>
<span class="normal"><a href="#__codelineno-254-13">13</a></span>
<span class="normal"><a href="#__codelineno-254-14">14</a></span>
<span class="normal"><a href="#__codelineno-254-15">15</a></span>
<span class="normal"><a href="#__codelineno-254-16">16</a></span>
<span class="normal"><a href="#__codelineno-254-17">17</a></span>
<span class="normal"><a href="#__codelineno-254-18">18</a></span>
<span class="normal"><a href="#__codelineno-254-19">19</a></span>
<span class="normal"><a href="#__codelineno-254-20">20</a></span>
<span class="normal"><a href="#__codelineno-254-21">21</a></span>
<span class="normal"><a href="#__codelineno-254-22">22</a></span>
<span class="normal"><a href="#__codelineno-254-23">23</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-254-1" name="__codelineno-254-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">A</span>
<a id="__codelineno-254-2" name="__codelineno-254-2"></a><span class="p">{</span>
<a id="__codelineno-254-3" name="__codelineno-254-3"></a><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-254-4" name="__codelineno-254-4"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">m_a</span><span class="w"> </span><span class="p">{};</span>
<a id="__codelineno-254-5" name="__codelineno-254-5"></a>
<a id="__codelineno-254-6" name="__codelineno-254-6"></a><span class="w">    </span><span class="n">A</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">a</span><span class="p">)</span><span class="w"> </span><span class="o">:</span><span class="w"> </span>
<a id="__codelineno-254-7" name="__codelineno-254-7"></a><span class="w">        </span><span class="n">m_a</span><span class="p">{</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="p">}</span><span class="w"> </span>
<a id="__codelineno-254-8" name="__codelineno-254-8"></a><span class="w">    </span><span class="p">{</span><span class="w"> </span>
<a id="__codelineno-254-9" name="__codelineno-254-9"></a><span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"A</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
<a id="__codelineno-254-10" name="__codelineno-254-10"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-254-11" name="__codelineno-254-11"></a><span class="p">};</span>
<a id="__codelineno-254-12" name="__codelineno-254-12"></a>
<a id="__codelineno-254-13" name="__codelineno-254-13"></a><span class="k">class</span><span class="w"> </span><span class="nc">B</span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">A</span>
<a id="__codelineno-254-14" name="__codelineno-254-14"></a><span class="p">{</span>
<a id="__codelineno-254-15" name="__codelineno-254-15"></a><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-254-16" name="__codelineno-254-16"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">m_b</span><span class="w"> </span><span class="p">{};</span>
<a id="__codelineno-254-17" name="__codelineno-254-17"></a>
<a id="__codelineno-254-18" name="__codelineno-254-18"></a><span class="w">    </span><span class="n">B</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">b</span><span class="p">)</span><span class="w"> </span><span class="o">:</span><span class="w"> </span>
<a id="__codelineno-254-19" name="__codelineno-254-19"></a><span class="w">        </span><span class="n">m_b</span><span class="p">{</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="p">}</span><span class="w"> </span>
<a id="__codelineno-254-20" name="__codelineno-254-20"></a><span class="w">    </span><span class="p">{</span><span class="w"> </span>
<a id="__codelineno-254-21" name="__codelineno-254-21"></a><span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"B</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
<a id="__codelineno-254-22" name="__codelineno-254-22"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-254-23" name="__codelineno-254-23"></a><span class="p">};</span>
</code></pre></div></td></tr></table></div>
<p>像这样在 <code>: public</code> 后接上要继承的类的名称，我们称之为公共继承（public inheritance）。</p>
<p>如果我们再让一个类 C 也继承 A，一个类 D 继承 B，那么派生图（derivation diagram）看起来就像下面这样，形成了一个树形结构，我们称之为继承树（inheritance tree）。</p>
<details class="note">
<summary>派生图</summary>
<pre class="mermaid"><code>graph BT;

B---&gt;A
C---&gt;A
D---&gt;B
</code></pre>
</details>
<p>派生类有两部分内容，一部分内容来自于它继承的类，另一部分内容是它自己的。当我们构造一个派生类时，会首先构造基类的部分（调用基类的构造函数），然后再构造自己特有的部分（调用派生类的构造函数）。</p>
<p>继承树中的一个派生类在构造时，会从最基本的类（继承树的顶端）开始，从上至下一次构造每一个子类，最后达到我们希望构造的类为止。</p>
<details class="example">
<summary>继承链</summary>
<p>这个例子中，B 继承自 A，C 继承自 B，D 继承自 C，构成了一条继承链。</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-255-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-255-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-255-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-255-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-255-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-255-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-255-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-255-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-255-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-255-10">10</a></span>
<span class="normal"><a href="#__codelineno-255-11">11</a></span>
<span class="normal"><a href="#__codelineno-255-12">12</a></span>
<span class="normal"><a href="#__codelineno-255-13">13</a></span>
<span class="normal"><a href="#__codelineno-255-14">14</a></span>
<span class="normal"><a href="#__codelineno-255-15">15</a></span>
<span class="normal"><a href="#__codelineno-255-16">16</a></span>
<span class="normal"><a href="#__codelineno-255-17">17</a></span>
<span class="normal"><a href="#__codelineno-255-18">18</a></span>
<span class="normal"><a href="#__codelineno-255-19">19</a></span>
<span class="normal"><a href="#__codelineno-255-20">20</a></span>
<span class="normal"><a href="#__codelineno-255-21">21</a></span>
<span class="normal"><a href="#__codelineno-255-22">22</a></span>
<span class="normal"><a href="#__codelineno-255-23">23</a></span>
<span class="normal"><a href="#__codelineno-255-24">24</a></span>
<span class="normal"><a href="#__codelineno-255-25">25</a></span>
<span class="normal"><a href="#__codelineno-255-26">26</a></span>
<span class="normal"><a href="#__codelineno-255-27">27</a></span>
<span class="normal"><a href="#__codelineno-255-28">28</a></span>
<span class="normal"><a href="#__codelineno-255-29">29</a></span>
<span class="normal"><a href="#__codelineno-255-30">30</a></span>
<span class="normal"><a href="#__codelineno-255-31">31</a></span>
<span class="normal"><a href="#__codelineno-255-32">32</a></span>
<span class="normal"><a href="#__codelineno-255-33">33</a></span>
<span class="normal"><a href="#__codelineno-255-34">34</a></span>
<span class="normal"><a href="#__codelineno-255-35">35</a></span>
<span class="normal"><a href="#__codelineno-255-36">36</a></span>
<span class="normal"><a href="#__codelineno-255-37">37</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-255-1" name="__codelineno-255-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span>
<a id="__codelineno-255-2" name="__codelineno-255-2"></a>
<a id="__codelineno-255-3" name="__codelineno-255-3"></a><span class="k">class</span><span class="w"> </span><span class="nc">A</span>
<a id="__codelineno-255-4" name="__codelineno-255-4"></a><span class="p">{</span>
<a id="__codelineno-255-5" name="__codelineno-255-5"></a><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-255-6" name="__codelineno-255-6"></a><span class="w">    </span><span class="n">A</span><span class="p">()</span>
<a id="__codelineno-255-7" name="__codelineno-255-7"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-255-8" name="__codelineno-255-8"></a><span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"A</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
<a id="__codelineno-255-9" name="__codelineno-255-9"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-255-10" name="__codelineno-255-10"></a><span class="p">};</span>
<a id="__codelineno-255-11" name="__codelineno-255-11"></a>
<a id="__codelineno-255-12" name="__codelineno-255-12"></a><span class="k">class</span><span class="w"> </span><span class="nc">B</span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">A</span>
<a id="__codelineno-255-13" name="__codelineno-255-13"></a><span class="p">{</span>
<a id="__codelineno-255-14" name="__codelineno-255-14"></a><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-255-15" name="__codelineno-255-15"></a><span class="w">    </span><span class="n">B</span><span class="p">()</span>
<a id="__codelineno-255-16" name="__codelineno-255-16"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-255-17" name="__codelineno-255-17"></a><span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"B</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
<a id="__codelineno-255-18" name="__codelineno-255-18"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-255-19" name="__codelineno-255-19"></a><span class="p">};</span>
<a id="__codelineno-255-20" name="__codelineno-255-20"></a>
<a id="__codelineno-255-21" name="__codelineno-255-21"></a><span class="k">class</span><span class="w"> </span><span class="nc">C</span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">B</span>
<a id="__codelineno-255-22" name="__codelineno-255-22"></a><span class="p">{</span>
<a id="__codelineno-255-23" name="__codelineno-255-23"></a><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-255-24" name="__codelineno-255-24"></a><span class="w">    </span><span class="n">C</span><span class="p">()</span>
<a id="__codelineno-255-25" name="__codelineno-255-25"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-255-26" name="__codelineno-255-26"></a><span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"C</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
<a id="__codelineno-255-27" name="__codelineno-255-27"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-255-28" name="__codelineno-255-28"></a><span class="p">};</span>
<a id="__codelineno-255-29" name="__codelineno-255-29"></a>
<a id="__codelineno-255-30" name="__codelineno-255-30"></a><span class="k">class</span><span class="w"> </span><span class="nc">D</span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">C</span>
<a id="__codelineno-255-31" name="__codelineno-255-31"></a><span class="p">{</span>
<a id="__codelineno-255-32" name="__codelineno-255-32"></a><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-255-33" name="__codelineno-255-33"></a><span class="w">    </span><span class="n">D</span><span class="p">()</span>
<a id="__codelineno-255-34" name="__codelineno-255-34"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-255-35" name="__codelineno-255-35"></a><span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"D</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
<a id="__codelineno-255-36" name="__codelineno-255-36"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-255-37" name="__codelineno-255-37"></a><span class="p">};</span>
</code></pre></div></td></tr></table></div>
<p>当我们通过下面的程序构造这些类时</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-256-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-256-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-256-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-256-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-256-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-256-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-256-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-256-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-256-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-256-10">10</a></span>
<span class="normal"><a href="#__codelineno-256-11">11</a></span>
<span class="normal"><a href="#__codelineno-256-12">12</a></span>
<span class="normal"><a href="#__codelineno-256-13">13</a></span>
<span class="normal"><a href="#__codelineno-256-14">14</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-256-1" name="__codelineno-256-1"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span>
<a id="__codelineno-256-2" name="__codelineno-256-2"></a><span class="p">{</span>
<a id="__codelineno-256-3" name="__codelineno-256-3"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"Constructing A: </span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
<a id="__codelineno-256-4" name="__codelineno-256-4"></a><span class="w">    </span><span class="n">A</span><span class="w"> </span><span class="n">a</span><span class="p">;</span>
<a id="__codelineno-256-5" name="__codelineno-256-5"></a>
<a id="__codelineno-256-6" name="__codelineno-256-6"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"Constructing B: </span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
<a id="__codelineno-256-7" name="__codelineno-256-7"></a><span class="w">    </span><span class="n">B</span><span class="w"> </span><span class="n">b</span><span class="p">;</span>
<a id="__codelineno-256-8" name="__codelineno-256-8"></a>
<a id="__codelineno-256-9" name="__codelineno-256-9"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"Constructing C: </span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
<a id="__codelineno-256-10" name="__codelineno-256-10"></a><span class="w">    </span><span class="n">C</span><span class="w"> </span><span class="n">c</span><span class="p">;</span>
<a id="__codelineno-256-11" name="__codelineno-256-11"></a>
<a id="__codelineno-256-12" name="__codelineno-256-12"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"Constructing D: </span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
<a id="__codelineno-256-13" name="__codelineno-256-13"></a><span class="w">    </span><span class="n">D</span><span class="w"> </span><span class="n">d</span><span class="p">;</span>
<a id="__codelineno-256-14" name="__codelineno-256-14"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>得到的输出结果将是</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-257-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-257-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-257-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-257-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-257-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-257-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-257-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-257-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-257-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-257-10">10</a></span>
<span class="normal"><a href="#__codelineno-257-11">11</a></span>
<span class="normal"><a href="#__codelineno-257-12">12</a></span>
<span class="normal"><a href="#__codelineno-257-13">13</a></span>
<span class="normal"><a href="#__codelineno-257-14">14</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-257-1" name="__codelineno-257-1"></a>Constructing A:
<a id="__codelineno-257-2" name="__codelineno-257-2"></a>A
<a id="__codelineno-257-3" name="__codelineno-257-3"></a>Constructing B:
<a id="__codelineno-257-4" name="__codelineno-257-4"></a>A
<a id="__codelineno-257-5" name="__codelineno-257-5"></a>B
<a id="__codelineno-257-6" name="__codelineno-257-6"></a>Constructing C:
<a id="__codelineno-257-7" name="__codelineno-257-7"></a>A
<a id="__codelineno-257-8" name="__codelineno-257-8"></a>B
<a id="__codelineno-257-9" name="__codelineno-257-9"></a>C
<a id="__codelineno-257-10" name="__codelineno-257-10"></a>Constructing D:
<a id="__codelineno-257-11" name="__codelineno-257-11"></a>A
<a id="__codelineno-257-12" name="__codelineno-257-12"></a>B
<a id="__codelineno-257-13" name="__codelineno-257-13"></a>C
<a id="__codelineno-257-14" name="__codelineno-257-14"></a>D
</code></pre></div></td></tr></table></div>
<p>从中我们可以看出整个继承链的构造顺序。</p>
</details>
<h3 id="_73">派生类的初始化<a class="headerlink" href="#_73" title="Permanent link">¶</a></h3>
<p>派生类的缺点之一是当我们创建一个派生类对象时，不能直接在派生类的构造函数中初始化来自于基类的成员变量。</p>
<p>考虑下面两个类，其中 Derived 类继承自 Base 类，并且<em>所有的成员变量都是 public 的</em>。</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-258-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-258-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-258-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-258-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-258-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-258-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-258-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-258-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-258-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-258-10">10</a></span>
<span class="normal"><a href="#__codelineno-258-11">11</a></span>
<span class="normal"><a href="#__codelineno-258-12">12</a></span>
<span class="normal"><a href="#__codelineno-258-13">13</a></span>
<span class="normal"><a href="#__codelineno-258-14">14</a></span>
<span class="normal"><a href="#__codelineno-258-15">15</a></span>
<span class="normal"><a href="#__codelineno-258-16">16</a></span>
<span class="normal"><a href="#__codelineno-258-17">17</a></span>
<span class="normal"><a href="#__codelineno-258-18">18</a></span>
<span class="normal"><a href="#__codelineno-258-19">19</a></span>
<span class="normal"><a href="#__codelineno-258-20">20</a></span>
<span class="normal"><a href="#__codelineno-258-21">21</a></span>
<span class="normal"><a href="#__codelineno-258-22">22</a></span>
<span class="normal"><a href="#__codelineno-258-23">23</a></span>
<span class="normal"><a href="#__codelineno-258-24">24</a></span>
<span class="normal"><a href="#__codelineno-258-25">25</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-258-1" name="__codelineno-258-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">Base</span>
<a id="__codelineno-258-2" name="__codelineno-258-2"></a><span class="p">{</span>
<a id="__codelineno-258-3" name="__codelineno-258-3"></a><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-258-4" name="__codelineno-258-4"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">m_id</span><span class="w"> </span><span class="p">{};</span>
<a id="__codelineno-258-5" name="__codelineno-258-5"></a>
<a id="__codelineno-258-6" name="__codelineno-258-6"></a><span class="w">    </span><span class="n">Base</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">id</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-258-7" name="__codelineno-258-7"></a><span class="w">        </span><span class="o">:</span><span class="w"> </span><span class="n">m_id</span><span class="p">{</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-258-8" name="__codelineno-258-8"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-258-9" name="__codelineno-258-9"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-258-10" name="__codelineno-258-10"></a>
<a id="__codelineno-258-11" name="__codelineno-258-11"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">getId</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">m_id</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-258-12" name="__codelineno-258-12"></a><span class="p">};</span>
<a id="__codelineno-258-13" name="__codelineno-258-13"></a>
<a id="__codelineno-258-14" name="__codelineno-258-14"></a><span class="k">class</span><span class="w"> </span><span class="nc">Derived</span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">Base</span>
<a id="__codelineno-258-15" name="__codelineno-258-15"></a><span class="p">{</span>
<a id="__codelineno-258-16" name="__codelineno-258-16"></a><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-258-17" name="__codelineno-258-17"></a><span class="w">    </span><span class="kt">double</span><span class="w"> </span><span class="n">m_cost</span><span class="w"> </span><span class="p">{};</span>
<a id="__codelineno-258-18" name="__codelineno-258-18"></a>
<a id="__codelineno-258-19" name="__codelineno-258-19"></a><span class="w">    </span><span class="n">Derived</span><span class="p">(</span><span class="kt">double</span><span class="w"> </span><span class="n">cost</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>
<a id="__codelineno-258-20" name="__codelineno-258-20"></a><span class="w">        </span><span class="o">:</span><span class="w"> </span><span class="n">m_cost</span><span class="p">{</span><span class="w"> </span><span class="n">cost</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-258-21" name="__codelineno-258-21"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-258-22" name="__codelineno-258-22"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-258-23" name="__codelineno-258-23"></a>
<a id="__codelineno-258-24" name="__codelineno-258-24"></a><span class="w">    </span><span class="kt">double</span><span class="w"> </span><span class="n">getCost</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">m_cost</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-258-25" name="__codelineno-258-25"></a><span class="p">};</span>
</code></pre></div></td></tr></table></div>
<p>当我们想要创建一个 Derived 对象时，通常会这么做</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-259-1">1</a></span>
<span class="normal"><a href="#__codelineno-259-2">2</a></span>
<span class="normal"><a href="#__codelineno-259-3">3</a></span>
<span class="normal"><a href="#__codelineno-259-4">4</a></span>
<span class="normal"><a href="#__codelineno-259-5">5</a></span>
<span class="normal"><a href="#__codelineno-259-6">6</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-259-1" name="__codelineno-259-1"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span>
<a id="__codelineno-259-2" name="__codelineno-259-2"></a><span class="p">{</span>
<a id="__codelineno-259-3" name="__codelineno-259-3"></a><span class="w">    </span><span class="n">Derived</span><span class="w"> </span><span class="n">derived</span><span class="p">{</span><span class="w"> </span><span class="mf">1.3</span><span class="w"> </span><span class="p">};</span><span class="w"> </span><span class="c1">// use Derived(double) constructor</span>
<a id="__codelineno-259-4" name="__codelineno-259-4"></a>
<a id="__codelineno-259-5" name="__codelineno-259-5"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-259-6" name="__codelineno-259-6"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>显而易见的是，在构造函数里我们只能初始化 m_cost，而不能初始化 m_id。除此之外，把 Derived 类的构造函数修改成这样也是无效的。因为 C++ 不允许一个派生类直接在它的构造函数中初始化基类的成员变量——一个成员变量的值只能被它定义的那个类的构造函数中被初始化。</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-260-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-260-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-260-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-260-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-260-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-260-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-260-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-260-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-260-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-260-10">10</a></span>
<span class="normal"><a href="#__codelineno-260-11">11</a></span>
<span class="normal"><a href="#__codelineno-260-12">12</a></span>
<span class="normal"><a href="#__codelineno-260-13">13</a></span>
<span class="normal"><a href="#__codelineno-260-14">14</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-260-1" name="__codelineno-260-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">Derived</span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">Base</span>
<a id="__codelineno-260-2" name="__codelineno-260-2"></a><span class="p">{</span>
<a id="__codelineno-260-3" name="__codelineno-260-3"></a><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-260-4" name="__codelineno-260-4"></a><span class="w">    </span><span class="kt">double</span><span class="w"> </span><span class="n">m_cost</span><span class="w"> </span><span class="p">{};</span>
<a id="__codelineno-260-5" name="__codelineno-260-5"></a>
<a id="__codelineno-260-6" name="__codelineno-260-6"></a><span class="w">    </span><span class="n">Derived</span><span class="p">(</span><span class="kt">double</span><span class="w"> </span><span class="n">cost</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">id</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-260-7" name="__codelineno-260-7"></a><span class="w">        </span><span class="c1">// does not work</span>
<a id="__codelineno-260-8" name="__codelineno-260-8"></a><span class="w">        </span><span class="o">:</span><span class="w"> </span><span class="n">m_cost</span><span class="p">{</span><span class="w"> </span><span class="n">cost</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-260-9" name="__codelineno-260-9"></a><span class="w">        </span><span class="p">,</span><span class="w"> </span><span class="n">m_id</span><span class="p">{</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-260-10" name="__codelineno-260-10"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-260-11" name="__codelineno-260-11"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-260-12" name="__codelineno-260-12"></a>
<a id="__codelineno-260-13" name="__codelineno-260-13"></a><span class="w">    </span><span class="kt">double</span><span class="w"> </span><span class="n">getCost</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">m_cost</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-260-14" name="__codelineno-260-14"></a><span class="p">};</span>
</code></pre></div></td></tr></table></div>
<p>除此之外，我们也不能像这样在构造函数中手动给成员变量赋值：</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-261-1">1</a></span>
<span class="normal"><a href="#__codelineno-261-2">2</a></span>
<span class="normal"><a href="#__codelineno-261-3">3</a></span>
<span class="normal"><a href="#__codelineno-261-4">4</a></span>
<span class="normal"><a href="#__codelineno-261-5">5</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-261-1" name="__codelineno-261-1"></a><span class="n">Derived</span><span class="p">(</span><span class="kt">double</span><span class="w"> </span><span class="n">cost</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">id</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-261-2" name="__codelineno-261-2"></a><span class="w">    </span><span class="o">:</span><span class="w"> </span><span class="n">m_cost</span><span class="p">{</span><span class="w"> </span><span class="n">cost</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-261-3" name="__codelineno-261-3"></a><span class="p">{</span>
<a id="__codelineno-261-4" name="__codelineno-261-4"></a><span class="w">    </span><span class="n">m_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">id</span><span class="p">;</span>
<a id="__codelineno-261-5" name="__codelineno-261-5"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>因为如果 m_id 是一个 const 成员变量，它就必须在构造函数的函数体执行前就被初始化，此后它不能再被赋值。</li>
<li>即使 m_id 不是 const 成员变量，假如我们允许在构造函数的函数体中给成员变量赋值，那么继承链上的每一个构造函数都有机会修改这个的成员变量，我们无法保证这个成员变量的值是我们预期的那样。</li>
</ul>
<p>那么我们该如何初始化基类的成员变量呢？答案是调用基类的构造函数！</p>
<p>我们可以在派生类的成员初始化列表中明确选择一个想要调用的基类构造函数，就可以初始化基类的成员变量。</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-262-1">1</a></span>
<span class="normal"><a href="#__codelineno-262-2">2</a></span>
<span class="normal"><a href="#__codelineno-262-3">3</a></span>
<span class="normal"><a href="#__codelineno-262-4">4</a></span>
<span class="normal"><a href="#__codelineno-262-5">5</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-262-1" name="__codelineno-262-1"></a><span class="n">Derived</span><span class="p">(</span><span class="kt">double</span><span class="w"> </span><span class="n">cost</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">id</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-262-2" name="__codelineno-262-2"></a><span class="w">    </span><span class="o">:</span><span class="w"> </span><span class="n">Base</span><span class="p">{</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="c1">// Call Base(int) constructor with value id!</span>
<a id="__codelineno-262-3" name="__codelineno-262-3"></a><span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="n">m_cost</span><span class="p">{</span><span class="w"> </span><span class="n">cost</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-262-4" name="__codelineno-262-4"></a><span class="p">{</span>
<a id="__codelineno-262-5" name="__codelineno-262-5"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>当我们执行下面的代码时：</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-263-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-263-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-263-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-263-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-263-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-263-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-263-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-263-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-263-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-263-10">10</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-263-1" name="__codelineno-263-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span>
<a id="__codelineno-263-2" name="__codelineno-263-2"></a>
<a id="__codelineno-263-3" name="__codelineno-263-3"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span>
<a id="__codelineno-263-4" name="__codelineno-263-4"></a><span class="p">{</span>
<a id="__codelineno-263-5" name="__codelineno-263-5"></a><span class="w">    </span><span class="n">Derived</span><span class="w"> </span><span class="n">derived</span><span class="p">{</span><span class="w"> </span><span class="mf">1.3</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="p">};</span><span class="w"> </span><span class="c1">// use Derived(double, int) constructor</span>
<a id="__codelineno-263-6" name="__codelineno-263-6"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"Id: "</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">derived</span><span class="p">.</span><span class="n">getId</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="sc">'\n'</span><span class="p">;</span>
<a id="__codelineno-263-7" name="__codelineno-263-7"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"Cost: "</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">derived</span><span class="p">.</span><span class="n">getCost</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="sc">'\n'</span><span class="p">;</span>
<a id="__codelineno-263-8" name="__codelineno-263-8"></a>
<a id="__codelineno-263-9" name="__codelineno-263-9"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-263-10" name="__codelineno-263-10"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>m_id 和 m_cost 都将会被正确地初始化，得到的输出是</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-264-1">1</a></span>
<span class="normal"><a href="#__codelineno-264-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-264-1" name="__codelineno-264-1"></a>Id: 5
<a id="__codelineno-264-2" name="__codelineno-264-2"></a>Cost: 1.3
</code></pre></div></td></tr></table></div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<ul>
<li>在派生类的构造函数中，我们可以选择调用基类的任何一个构造函数，只要这个构造函数是合法的。</li>
<li>无论基类的构造函数出现于派生类的成员初始化列表中的什么位置，它都会首先被执行。</li>
</ul>
</div>
<p>现在我们可以把 Base 和 Derived 类的成员变量都设置为 private，然后通过成员函数来访问这些成员变量。</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-265-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-265-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-265-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-265-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-265-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-265-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-265-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-265-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-265-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-265-10">10</a></span>
<span class="normal"><a href="#__codelineno-265-11">11</a></span>
<span class="normal"><a href="#__codelineno-265-12">12</a></span>
<span class="normal"><a href="#__codelineno-265-13">13</a></span>
<span class="normal"><a href="#__codelineno-265-14">14</a></span>
<span class="normal"><a href="#__codelineno-265-15">15</a></span>
<span class="normal"><a href="#__codelineno-265-16">16</a></span>
<span class="normal"><a href="#__codelineno-265-17">17</a></span>
<span class="normal"><a href="#__codelineno-265-18">18</a></span>
<span class="normal"><a href="#__codelineno-265-19">19</a></span>
<span class="normal"><a href="#__codelineno-265-20">20</a></span>
<span class="normal"><a href="#__codelineno-265-21">21</a></span>
<span class="normal"><a href="#__codelineno-265-22">22</a></span>
<span class="normal"><a href="#__codelineno-265-23">23</a></span>
<span class="normal"><a href="#__codelineno-265-24">24</a></span>
<span class="normal"><a href="#__codelineno-265-25">25</a></span>
<span class="normal"><a href="#__codelineno-265-26">26</a></span>
<span class="normal"><a href="#__codelineno-265-27">27</a></span>
<span class="normal"><a href="#__codelineno-265-28">28</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-265-1" name="__codelineno-265-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">Base</span>
<a id="__codelineno-265-2" name="__codelineno-265-2"></a><span class="p">{</span>
<a id="__codelineno-265-3" name="__codelineno-265-3"></a><span class="k">private</span><span class="o">:</span><span class="w"> </span><span class="c1">// our member is now private</span>
<a id="__codelineno-265-4" name="__codelineno-265-4"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">m_id</span><span class="w"> </span><span class="p">{};</span>
<a id="__codelineno-265-5" name="__codelineno-265-5"></a>
<a id="__codelineno-265-6" name="__codelineno-265-6"></a><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-265-7" name="__codelineno-265-7"></a><span class="w">    </span><span class="n">Base</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">id</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-265-8" name="__codelineno-265-8"></a><span class="w">        </span><span class="o">:</span><span class="w"> </span><span class="n">m_id</span><span class="p">{</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-265-9" name="__codelineno-265-9"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-265-10" name="__codelineno-265-10"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-265-11" name="__codelineno-265-11"></a>
<a id="__codelineno-265-12" name="__codelineno-265-12"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">getId</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">m_id</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-265-13" name="__codelineno-265-13"></a><span class="p">};</span>
<a id="__codelineno-265-14" name="__codelineno-265-14"></a>
<a id="__codelineno-265-15" name="__codelineno-265-15"></a><span class="k">class</span><span class="w"> </span><span class="nc">Derived</span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">Base</span>
<a id="__codelineno-265-16" name="__codelineno-265-16"></a><span class="p">{</span>
<a id="__codelineno-265-17" name="__codelineno-265-17"></a><span class="k">private</span><span class="o">:</span><span class="w"> </span><span class="c1">// our member is now private</span>
<a id="__codelineno-265-18" name="__codelineno-265-18"></a><span class="w">    </span><span class="kt">double</span><span class="w"> </span><span class="n">m_cost</span><span class="p">;</span>
<a id="__codelineno-265-19" name="__codelineno-265-19"></a>
<a id="__codelineno-265-20" name="__codelineno-265-20"></a><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-265-21" name="__codelineno-265-21"></a><span class="w">    </span><span class="n">Derived</span><span class="p">(</span><span class="kt">double</span><span class="w"> </span><span class="n">cost</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">id</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-265-22" name="__codelineno-265-22"></a><span class="w">        </span><span class="o">:</span><span class="w"> </span><span class="n">Base</span><span class="p">{</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="c1">// Call Base(int) constructor with value id!</span>
<a id="__codelineno-265-23" name="__codelineno-265-23"></a><span class="w">        </span><span class="p">,</span><span class="w"> </span><span class="n">m_cost</span><span class="p">{</span><span class="w"> </span><span class="n">cost</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-265-24" name="__codelineno-265-24"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-265-25" name="__codelineno-265-25"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-265-26" name="__codelineno-265-26"></a>
<a id="__codelineno-265-27" name="__codelineno-265-27"></a><span class="w">    </span><span class="kt">double</span><span class="w"> </span><span class="n">getCost</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">m_cost</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-265-28" name="__codelineno-265-28"></a><span class="p">};</span>
</code></pre></div></td></tr></table></div>
<p>现在我们实例化的 Derived 对象不再能够直接访问 m_id 了，因为即使 m_id 也属于 Derived 类的一部分，它仍然是 Base 类的私有成员，因此我们只能通过访问函数 <code>getId()</code> 来访问 m_id。</p>
<p>main 函数运行后的输出结果不变，仍是</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-266-1">1</a></span>
<span class="normal"><a href="#__codelineno-266-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-266-1" name="__codelineno-266-1"></a>Id: 5
<a id="__codelineno-266-2" name="__codelineno-266-2"></a>Cost: 1.3
</code></pre></div></td></tr></table></div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>C++ 中，成员的访问级别是基于类的，这意味着即使 Derived 即使继承了 Base 的 m_id，它仍然是 Base 的私有成员，Derived 不能直接访问它，只能通过 Base 的公有成员函数来访问它。</p>
</div>
<details class="note" open="open">
<summary>继承链</summary>
<p>回到我们之前提到的继承链，假设 C 继承自 B，B 继承自 A，这时候 C 只能调用 B 的构造函数，而不能直接越过 B 去调用 A 的构造函数。</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-267-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-267-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-267-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-267-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-267-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-267-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-267-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-267-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-267-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-267-10">10</a></span>
<span class="normal"><a href="#__codelineno-267-11">11</a></span>
<span class="normal"><a href="#__codelineno-267-12">12</a></span>
<span class="normal"><a href="#__codelineno-267-13">13</a></span>
<span class="normal"><a href="#__codelineno-267-14">14</a></span>
<span class="normal"><a href="#__codelineno-267-15">15</a></span>
<span class="normal"><a href="#__codelineno-267-16">16</a></span>
<span class="normal"><a href="#__codelineno-267-17">17</a></span>
<span class="normal"><a href="#__codelineno-267-18">18</a></span>
<span class="normal"><a href="#__codelineno-267-19">19</a></span>
<span class="normal"><a href="#__codelineno-267-20">20</a></span>
<span class="normal"><a href="#__codelineno-267-21">21</a></span>
<span class="normal"><a href="#__codelineno-267-22">22</a></span>
<span class="normal"><a href="#__codelineno-267-23">23</a></span>
<span class="normal"><a href="#__codelineno-267-24">24</a></span>
<span class="normal"><a href="#__codelineno-267-25">25</a></span>
<span class="normal"><a href="#__codelineno-267-26">26</a></span>
<span class="normal"><a href="#__codelineno-267-27">27</a></span>
<span class="normal"><a href="#__codelineno-267-28">28</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-267-1" name="__codelineno-267-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">A</span>
<a id="__codelineno-267-2" name="__codelineno-267-2"></a><span class="p">{</span>
<a id="__codelineno-267-3" name="__codelineno-267-3"></a><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-267-4" name="__codelineno-267-4"></a><span class="w">    </span><span class="n">A</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">a</span><span class="p">)</span>
<a id="__codelineno-267-5" name="__codelineno-267-5"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-267-6" name="__codelineno-267-6"></a><span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"A: "</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="sc">'\n'</span><span class="p">;</span>
<a id="__codelineno-267-7" name="__codelineno-267-7"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-267-8" name="__codelineno-267-8"></a><span class="p">};</span>
<a id="__codelineno-267-9" name="__codelineno-267-9"></a>
<a id="__codelineno-267-10" name="__codelineno-267-10"></a><span class="k">class</span><span class="w"> </span><span class="nc">B</span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">A</span>
<a id="__codelineno-267-11" name="__codelineno-267-11"></a><span class="p">{</span>
<a id="__codelineno-267-12" name="__codelineno-267-12"></a><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-267-13" name="__codelineno-267-13"></a><span class="w">    </span><span class="n">B</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">b</span><span class="p">)</span>
<a id="__codelineno-267-14" name="__codelineno-267-14"></a><span class="w">    </span><span class="o">:</span><span class="w"> </span><span class="n">A</span><span class="p">{</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-267-15" name="__codelineno-267-15"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-267-16" name="__codelineno-267-16"></a><span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"B: "</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="sc">'\n'</span><span class="p">;</span>
<a id="__codelineno-267-17" name="__codelineno-267-17"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-267-18" name="__codelineno-267-18"></a><span class="p">};</span>
<a id="__codelineno-267-19" name="__codelineno-267-19"></a>
<a id="__codelineno-267-20" name="__codelineno-267-20"></a><span class="k">class</span><span class="w"> </span><span class="nc">C</span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">B</span>
<a id="__codelineno-267-21" name="__codelineno-267-21"></a><span class="p">{</span>
<a id="__codelineno-267-22" name="__codelineno-267-22"></a><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-267-23" name="__codelineno-267-23"></a><span class="w">    </span><span class="n">C</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="n">c</span><span class="p">)</span>
<a id="__codelineno-267-24" name="__codelineno-267-24"></a><span class="w">    </span><span class="o">:</span><span class="w"> </span><span class="n">B</span><span class="p">{</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-267-25" name="__codelineno-267-25"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-267-26" name="__codelineno-267-26"></a><span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"C: "</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="sc">'\n'</span><span class="p">;</span>
<a id="__codelineno-267-27" name="__codelineno-267-27"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-267-28" name="__codelineno-267-28"></a><span class="p">};</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>构造函数只能调用从其直接的父类/基类的构造函数，即只能一节一节沿着继承链向上</li>
</ul>
</details>
<p>当派生类被销毁时，析构函数会按照构造函数调用的相反顺序被调用。</p>
<p>例如我们实例化了上面例子的一个 <code>C c{ 5, 4.3, 'R' };</code>，构造函数调用的顺序是 A-&gt;B-&gt;C，那么析构函数调用的顺序就是 C-&gt;B-&gt;A。</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>如果基类具有虚函数，那么它的析构函数也应该是虚函数，并且继承自它的派生类的析构函数也都要是虚拟的。否则，当我们通过基类指针删除派生类对象时，派生类的析构函数将不会被调用，从而导致资源泄漏。</p>
</div>
<h3 id="_74">访问说明符<a class="headerlink" href="#_74" title="Permanent link">¶</a></h3>
<p>C++ 还有第三个访问说明符：<code>protected</code>，它仅在类继承的语境下有效。protected 访问说明符允许类成员被本类的其他成员、友元和派生类访问，但是不可从外界被访问。</p>
<p>类有三种不同的继承方式：public，protected 和 private。当不选择继承的类型时，默认选择 private 继承（类似于当不指定访问级别时，类中的成员默认为 private）。</p>
<p>下面我们将讨论三种继承类型，在此期间需要始终牢记下面的几条规则：</p>
<ul>
<li>一个类始终可以访问自己的（非继承的）成员</li>
<li>外界在访问一个类时，访问级别始终基于这个类的访问说明符</li>
<li>派生类访问继承于基类的成员时，始终基于基类的访问说明符和它所使用的继承类型</li>
</ul>
<h4 id="public-inheritance">public inheritance<a class="headerlink" href="#public-inheritance" title="Permanent link">¶</a></h4>
<p>公共继承是最常用的继承方式，其他两种继承事实上很少会遇见。公共继承一个基类时，继承的 public 成员仍是 public 的，继承的 protected 成员仍是 protected 的，继承的 private 成员仍是无法从派生类直接访问的。</p>
<details class="example">
<summary>public inheritance</summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-268-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-268-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-268-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-268-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-268-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-268-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-268-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-268-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-268-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-268-10">10</a></span>
<span class="normal"><a href="#__codelineno-268-11">11</a></span>
<span class="normal"><a href="#__codelineno-268-12">12</a></span>
<span class="normal"><a href="#__codelineno-268-13">13</a></span>
<span class="normal"><a href="#__codelineno-268-14">14</a></span>
<span class="normal"><a href="#__codelineno-268-15">15</a></span>
<span class="normal"><a href="#__codelineno-268-16">16</a></span>
<span class="normal"><a href="#__codelineno-268-17">17</a></span>
<span class="normal"><a href="#__codelineno-268-18">18</a></span>
<span class="normal"><a href="#__codelineno-268-19">19</a></span>
<span class="normal"><a href="#__codelineno-268-20">20</a></span>
<span class="normal"><a href="#__codelineno-268-21">21</a></span>
<span class="normal"><a href="#__codelineno-268-22">22</a></span>
<span class="normal"><a href="#__codelineno-268-23">23</a></span>
<span class="normal"><a href="#__codelineno-268-24">24</a></span>
<span class="normal"><a href="#__codelineno-268-25">25</a></span>
<span class="normal"><a href="#__codelineno-268-26">26</a></span>
<span class="normal"><a href="#__codelineno-268-27">27</a></span>
<span class="normal"><a href="#__codelineno-268-28">28</a></span>
<span class="normal"><a href="#__codelineno-268-29">29</a></span>
<span class="normal"><a href="#__codelineno-268-30">30</a></span>
<span class="normal"><a href="#__codelineno-268-31">31</a></span>
<span class="normal"><a href="#__codelineno-268-32">32</a></span>
<span class="normal"><a href="#__codelineno-268-33">33</a></span>
<span class="normal"><a href="#__codelineno-268-34">34</a></span>
<span class="normal"><a href="#__codelineno-268-35">35</a></span>
<span class="normal"><a href="#__codelineno-268-36">36</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-268-1" name="__codelineno-268-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">Base</span>
<a id="__codelineno-268-2" name="__codelineno-268-2"></a><span class="p">{</span>
<a id="__codelineno-268-3" name="__codelineno-268-3"></a><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-268-4" name="__codelineno-268-4"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">m_public</span><span class="w"> </span><span class="p">{};</span>
<a id="__codelineno-268-5" name="__codelineno-268-5"></a><span class="k">protected</span><span class="o">:</span>
<a id="__codelineno-268-6" name="__codelineno-268-6"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">m_protected</span><span class="w"> </span><span class="p">{};</span>
<a id="__codelineno-268-7" name="__codelineno-268-7"></a><span class="k">private</span><span class="o">:</span>
<a id="__codelineno-268-8" name="__codelineno-268-8"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">m_private</span><span class="w"> </span><span class="p">{};</span>
<a id="__codelineno-268-9" name="__codelineno-268-9"></a><span class="p">};</span>
<a id="__codelineno-268-10" name="__codelineno-268-10"></a>
<a id="__codelineno-268-11" name="__codelineno-268-11"></a><span class="k">class</span><span class="w"> </span><span class="nc">Pub</span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">Base</span><span class="w"> </span><span class="c1">// note: public inheritance</span>
<a id="__codelineno-268-12" name="__codelineno-268-12"></a><span class="p">{</span>
<a id="__codelineno-268-13" name="__codelineno-268-13"></a><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-268-14" name="__codelineno-268-14"></a><span class="w">    </span><span class="n">Pub</span><span class="p">()</span>
<a id="__codelineno-268-15" name="__codelineno-268-15"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-268-16" name="__codelineno-268-16"></a><span class="w">        </span><span class="n">m_public</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="c1">// okay: m_public was inherited as public</span>
<a id="__codelineno-268-17" name="__codelineno-268-17"></a><span class="w">        </span><span class="n">m_protected</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span><span class="w"> </span><span class="c1">// okay: m_protected was inherited as protected</span>
<a id="__codelineno-268-18" name="__codelineno-268-18"></a><span class="w">        </span><span class="n">m_private</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="p">;</span><span class="w"> </span><span class="c1">// not okay: m_private is inaccessible from derived class</span>
<a id="__codelineno-268-19" name="__codelineno-268-19"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-268-20" name="__codelineno-268-20"></a><span class="p">};</span>
<a id="__codelineno-268-21" name="__codelineno-268-21"></a>
<a id="__codelineno-268-22" name="__codelineno-268-22"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span>
<a id="__codelineno-268-23" name="__codelineno-268-23"></a><span class="p">{</span>
<a id="__codelineno-268-24" name="__codelineno-268-24"></a><span class="w">    </span><span class="c1">// Outside access uses the access specifiers of the class being accessed.</span>
<a id="__codelineno-268-25" name="__codelineno-268-25"></a><span class="w">    </span><span class="n">Base</span><span class="w"> </span><span class="n">base</span><span class="p">;</span>
<a id="__codelineno-268-26" name="__codelineno-268-26"></a><span class="w">    </span><span class="n">base</span><span class="p">.</span><span class="n">m_public</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="c1">// okay: m_public is public in Base</span>
<a id="__codelineno-268-27" name="__codelineno-268-27"></a><span class="w">    </span><span class="n">base</span><span class="p">.</span><span class="n">m_protected</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span><span class="w"> </span><span class="c1">// not okay: m_protected is protected in Base</span>
<a id="__codelineno-268-28" name="__codelineno-268-28"></a><span class="w">    </span><span class="n">base</span><span class="p">.</span><span class="n">m_private</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="p">;</span><span class="w"> </span><span class="c1">// not okay: m_private is private in Base</span>
<a id="__codelineno-268-29" name="__codelineno-268-29"></a>
<a id="__codelineno-268-30" name="__codelineno-268-30"></a><span class="w">    </span><span class="n">Pub</span><span class="w"> </span><span class="n">pub</span><span class="p">;</span>
<a id="__codelineno-268-31" name="__codelineno-268-31"></a><span class="w">    </span><span class="n">pub</span><span class="p">.</span><span class="n">m_public</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="c1">// okay: m_public is public in Pub</span>
<a id="__codelineno-268-32" name="__codelineno-268-32"></a><span class="w">    </span><span class="n">pub</span><span class="p">.</span><span class="n">m_protected</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span><span class="w"> </span><span class="c1">// not okay: m_protected is protected in Pub</span>
<a id="__codelineno-268-33" name="__codelineno-268-33"></a><span class="w">    </span><span class="n">pub</span><span class="p">.</span><span class="n">m_private</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="p">;</span><span class="w"> </span><span class="c1">// not okay: m_private is inaccessible in Pub</span>
<a id="__codelineno-268-34" name="__codelineno-268-34"></a>
<a id="__codelineno-268-35" name="__codelineno-268-35"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-268-36" name="__codelineno-268-36"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
</details>
<p>除非有一些特定的理由，否则一般而言都使用公共继承。</p>
<h4 id="protected-inheritance">protected inheritance<a class="headerlink" href="#protected-inheritance" title="Permanent link">¶</a></h4>
<p>保护继承是最少见的继承方式，除非在极其特殊的情况下，它几乎不会被使用。在保护继承中，继承的 public 和 protected 成员都变成了 protected 的，继承的 private 成员仍然是无法从派生类直接访问的。</p>
<h4 id="private-inheritance">private inheritance<a class="headerlink" href="#private-inheritance" title="Permanent link">¶</a></h4>
<p>在私有继承中，来自于基类的所有成员都会变成私有的，这意味着继承的 public 和 protected 成员都变成了 private 的，继承的 private 成员仍然是无法从派生类直接访问的。</p>
<p>变成 private 的成员并不影响派生类对这些成员的访问，这个变化仅影响在外界试图通过派生类访问这些成员的代码。</p>
<details class="example">
<summary>private inheritance</summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-269-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-269-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-269-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-269-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-269-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-269-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-269-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-269-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-269-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-269-10">10</a></span>
<span class="normal"><a href="#__codelineno-269-11">11</a></span>
<span class="normal"><a href="#__codelineno-269-12">12</a></span>
<span class="normal"><a href="#__codelineno-269-13">13</a></span>
<span class="normal"><a href="#__codelineno-269-14">14</a></span>
<span class="normal"><a href="#__codelineno-269-15">15</a></span>
<span class="normal"><a href="#__codelineno-269-16">16</a></span>
<span class="normal"><a href="#__codelineno-269-17">17</a></span>
<span class="normal"><a href="#__codelineno-269-18">18</a></span>
<span class="normal"><a href="#__codelineno-269-19">19</a></span>
<span class="normal"><a href="#__codelineno-269-20">20</a></span>
<span class="normal"><a href="#__codelineno-269-21">21</a></span>
<span class="normal"><a href="#__codelineno-269-22">22</a></span>
<span class="normal"><a href="#__codelineno-269-23">23</a></span>
<span class="normal"><a href="#__codelineno-269-24">24</a></span>
<span class="normal"><a href="#__codelineno-269-25">25</a></span>
<span class="normal"><a href="#__codelineno-269-26">26</a></span>
<span class="normal"><a href="#__codelineno-269-27">27</a></span>
<span class="normal"><a href="#__codelineno-269-28">28</a></span>
<span class="normal"><a href="#__codelineno-269-29">29</a></span>
<span class="normal"><a href="#__codelineno-269-30">30</a></span>
<span class="normal"><a href="#__codelineno-269-31">31</a></span>
<span class="normal"><a href="#__codelineno-269-32">32</a></span>
<span class="normal"><a href="#__codelineno-269-33">33</a></span>
<span class="normal"><a href="#__codelineno-269-34">34</a></span>
<span class="normal"><a href="#__codelineno-269-35">35</a></span>
<span class="normal"><a href="#__codelineno-269-36">36</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-269-1" name="__codelineno-269-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">Base</span>
<a id="__codelineno-269-2" name="__codelineno-269-2"></a><span class="p">{</span>
<a id="__codelineno-269-3" name="__codelineno-269-3"></a><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-269-4" name="__codelineno-269-4"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">m_public</span><span class="w"> </span><span class="p">{};</span>
<a id="__codelineno-269-5" name="__codelineno-269-5"></a><span class="k">protected</span><span class="o">:</span>
<a id="__codelineno-269-6" name="__codelineno-269-6"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">m_protected</span><span class="w"> </span><span class="p">{};</span>
<a id="__codelineno-269-7" name="__codelineno-269-7"></a><span class="k">private</span><span class="o">:</span>
<a id="__codelineno-269-8" name="__codelineno-269-8"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">m_private</span><span class="w"> </span><span class="p">{};</span>
<a id="__codelineno-269-9" name="__codelineno-269-9"></a><span class="p">};</span>
<a id="__codelineno-269-10" name="__codelineno-269-10"></a>
<a id="__codelineno-269-11" name="__codelineno-269-11"></a><span class="k">class</span><span class="w"> </span><span class="nc">Pri</span><span class="o">:</span><span class="w"> </span><span class="k">private</span><span class="w"> </span><span class="n">Base</span><span class="w"> </span><span class="c1">// note: private inheritance</span>
<a id="__codelineno-269-12" name="__codelineno-269-12"></a><span class="p">{</span>
<a id="__codelineno-269-13" name="__codelineno-269-13"></a><span class="w">    </span><span class="n">Pri</span><span class="p">()</span>
<a id="__codelineno-269-14" name="__codelineno-269-14"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-269-15" name="__codelineno-269-15"></a><span class="w">        </span><span class="n">m_public</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="c1">// okay: m_public is now private in Pri</span>
<a id="__codelineno-269-16" name="__codelineno-269-16"></a><span class="w">        </span><span class="n">m_protected</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span><span class="w"> </span><span class="c1">// okay: m_protected is now private in Pri</span>
<a id="__codelineno-269-17" name="__codelineno-269-17"></a><span class="w">        </span><span class="n">m_private</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="p">;</span><span class="w"> </span><span class="c1">// not okay: derived classes can't access private members in the base class</span>
<a id="__codelineno-269-18" name="__codelineno-269-18"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-269-19" name="__codelineno-269-19"></a><span class="p">};</span>
<a id="__codelineno-269-20" name="__codelineno-269-20"></a>
<a id="__codelineno-269-21" name="__codelineno-269-21"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span>
<a id="__codelineno-269-22" name="__codelineno-269-22"></a><span class="p">{</span>
<a id="__codelineno-269-23" name="__codelineno-269-23"></a><span class="w">    </span><span class="c1">// Outside access uses the access specifiers of the class being accessed.</span>
<a id="__codelineno-269-24" name="__codelineno-269-24"></a><span class="w">    </span><span class="c1">// In this case, the access specifiers of base.</span>
<a id="__codelineno-269-25" name="__codelineno-269-25"></a><span class="w">    </span><span class="n">Base</span><span class="w"> </span><span class="n">base</span><span class="p">;</span>
<a id="__codelineno-269-26" name="__codelineno-269-26"></a><span class="w">    </span><span class="n">base</span><span class="p">.</span><span class="n">m_public</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="c1">// okay: m_public is public in Base</span>
<a id="__codelineno-269-27" name="__codelineno-269-27"></a><span class="w">    </span><span class="n">base</span><span class="p">.</span><span class="n">m_protected</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span><span class="w"> </span><span class="c1">// not okay: m_protected is protected in Base</span>
<a id="__codelineno-269-28" name="__codelineno-269-28"></a><span class="w">    </span><span class="n">base</span><span class="p">.</span><span class="n">m_private</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="p">;</span><span class="w"> </span><span class="c1">// not okay: m_private is private in Base</span>
<a id="__codelineno-269-29" name="__codelineno-269-29"></a>
<a id="__codelineno-269-30" name="__codelineno-269-30"></a><span class="w">    </span><span class="n">Pri</span><span class="w"> </span><span class="n">pri</span><span class="p">;</span>
<a id="__codelineno-269-31" name="__codelineno-269-31"></a><span class="w">    </span><span class="n">pri</span><span class="p">.</span><span class="n">m_public</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="c1">// not okay: m_public is now private in Pri</span>
<a id="__codelineno-269-32" name="__codelineno-269-32"></a><span class="w">    </span><span class="n">pri</span><span class="p">.</span><span class="n">m_protected</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span><span class="w"> </span><span class="c1">// not okay: m_protected is now private in Pri</span>
<a id="__codelineno-269-33" name="__codelineno-269-33"></a><span class="w">    </span><span class="n">pri</span><span class="p">.</span><span class="n">m_private</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="p">;</span><span class="w"> </span><span class="c1">// not okay: m_private is inaccessible in Pri</span>
<a id="__codelineno-269-34" name="__codelineno-269-34"></a>
<a id="__codelineno-269-35" name="__codelineno-269-35"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-269-36" name="__codelineno-269-36"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
</details>
<p>我们可以在派生类和基类之间没有明显关系时使用私有继承，但在实践中私有继承的使用频率非常低。</p>
<h4 id="_75">一个例子<a class="headerlink" href="#_75" title="Permanent link">¶</a></h4>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-270-1">1</a></span>
<span class="normal"><a href="#__codelineno-270-2">2</a></span>
<span class="normal"><a href="#__codelineno-270-3">3</a></span>
<span class="normal"><a href="#__codelineno-270-4">4</a></span>
<span class="normal"><a href="#__codelineno-270-5">5</a></span>
<span class="normal"><a href="#__codelineno-270-6">6</a></span>
<span class="normal"><a href="#__codelineno-270-7">7</a></span>
<span class="normal"><a href="#__codelineno-270-8">8</a></span>
<span class="normal"><a href="#__codelineno-270-9">9</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-270-1" name="__codelineno-270-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">Base</span>
<a id="__codelineno-270-2" name="__codelineno-270-2"></a><span class="p">{</span>
<a id="__codelineno-270-3" name="__codelineno-270-3"></a><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-270-4" name="__codelineno-270-4"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">m_public</span><span class="w"> </span><span class="p">{};</span>
<a id="__codelineno-270-5" name="__codelineno-270-5"></a><span class="k">protected</span><span class="o">:</span>
<a id="__codelineno-270-6" name="__codelineno-270-6"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">m_protected</span><span class="w"> </span><span class="p">{};</span>
<a id="__codelineno-270-7" name="__codelineno-270-7"></a><span class="k">private</span><span class="o">:</span>
<a id="__codelineno-270-8" name="__codelineno-270-8"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">m_private</span><span class="w"> </span><span class="p">{};</span>
<a id="__codelineno-270-9" name="__codelineno-270-9"></a><span class="p">};</span>
</code></pre></div></td></tr></table></div>
<p>基类可以无限制地访问自己的成员，外界只能访问公有成员 m_public。</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-271-1">1</a></span>
<span class="normal"><a href="#__codelineno-271-2">2</a></span>
<span class="normal"><a href="#__codelineno-271-3">3</a></span>
<span class="normal"><a href="#__codelineno-271-4">4</a></span>
<span class="normal"><a href="#__codelineno-271-5">5</a></span>
<span class="normal"><a href="#__codelineno-271-6">6</a></span>
<span class="normal"><a href="#__codelineno-271-7">7</a></span>
<span class="normal"><a href="#__codelineno-271-8">8</a></span>
<span class="normal"><a href="#__codelineno-271-9">9</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-271-1" name="__codelineno-271-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">D2</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">private</span><span class="w"> </span><span class="n">Base</span><span class="w"> </span><span class="c1">// note: private inheritance</span>
<a id="__codelineno-271-2" name="__codelineno-271-2"></a><span class="p">{</span>
<a id="__codelineno-271-3" name="__codelineno-271-3"></a><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-271-4" name="__codelineno-271-4"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">m_public2</span><span class="w"> </span><span class="p">{};</span>
<a id="__codelineno-271-5" name="__codelineno-271-5"></a><span class="k">protected</span><span class="o">:</span>
<a id="__codelineno-271-6" name="__codelineno-271-6"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">m_protected2</span><span class="w"> </span><span class="p">{};</span>
<a id="__codelineno-271-7" name="__codelineno-271-7"></a><span class="k">private</span><span class="o">:</span>
<a id="__codelineno-271-8" name="__codelineno-271-8"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">m_private2</span><span class="w"> </span><span class="p">{};</span>
<a id="__codelineno-271-9" name="__codelineno-271-9"></a><span class="p">};</span>
</code></pre></div></td></tr></table></div>
<p>D2 可以无限制地访问自己的成员，也可以访问继承于 Base 的 m_public 和 m_protected，但不能访问 m_private。D2 采用的是私有继承，因此无论是外界代码还是从 D2 派生出来的类，都无法通过 D2 访问 m_public 和 m_protected，因为此时 m_public 和 m_protected 都变成了 private 成员。</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-272-1">1</a></span>
<span class="normal"><a href="#__codelineno-272-2">2</a></span>
<span class="normal"><a href="#__codelineno-272-3">3</a></span>
<span class="normal"><a href="#__codelineno-272-4">4</a></span>
<span class="normal"><a href="#__codelineno-272-5">5</a></span>
<span class="normal"><a href="#__codelineno-272-6">6</a></span>
<span class="normal"><a href="#__codelineno-272-7">7</a></span>
<span class="normal"><a href="#__codelineno-272-8">8</a></span>
<span class="normal"><a href="#__codelineno-272-9">9</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-272-1" name="__codelineno-272-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">D3</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">D2</span>
<a id="__codelineno-272-2" name="__codelineno-272-2"></a><span class="p">{</span>
<a id="__codelineno-272-3" name="__codelineno-272-3"></a><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-272-4" name="__codelineno-272-4"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">m_public3</span><span class="w"> </span><span class="p">{};</span>
<a id="__codelineno-272-5" name="__codelineno-272-5"></a><span class="k">protected</span><span class="o">:</span>
<a id="__codelineno-272-6" name="__codelineno-272-6"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">m_protected3</span><span class="w"> </span><span class="p">{};</span>
<a id="__codelineno-272-7" name="__codelineno-272-7"></a><span class="k">private</span><span class="o">:</span>
<a id="__codelineno-272-8" name="__codelineno-272-8"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">m_private3</span><span class="w"> </span><span class="p">{};</span>
<a id="__codelineno-272-9" name="__codelineno-272-9"></a><span class="p">};</span>
</code></pre></div></td></tr></table></div>
<p>D3 可以无限制地访问自己的成员，也可以访问 D2 的 m_public2 和 m_protected2，但不能访问 m_private2。D3 采用的是公共继承，所以 m_public2 和 m_protected2 将会保持自身的访问级别，即 m_public2 是 public 的，m_protected2 是 protected 的。</p>
<p>D3 无法直接访问 Base 的 m_public 和 m_protected，因为当 D2 继承它们时，它们变成了 private 成员。</p>
<div class="admonition abstract">
<p class="admonition-title">Abstract</p>
<table>
<thead>
<tr>
<th>Base class</th>
<th>inherited publicly</th>
<th>inherited privately</th>
<th>inherited protectedly</th>
</tr>
</thead>
<tbody>
<tr>
<td>Public</td>
<td>Public</td>
<td>Private</td>
<td>Protected</td>
</tr>
<tr>
<td>Protected</td>
<td>Protected</td>
<td>Private</td>
<td>Protected</td>
</tr>
<tr>
<td>Private</td>
<td>Inaccessible</td>
<td>Inaccessible</td>
<td>Inaccessible</td>
</tr>
</tbody>
</table>
</div>
<h3 id="_76">调用与覆盖继承的函数<a class="headerlink" href="#_76" title="Permanent link">¶</a></h3>
<p>默认情况下，派生类继承了基类中定义的所有行为（成员函数）。当在派生类对象上调用成员函数时，编译器首先查看派生类中是否存在名称匹配的函数</p>
<ul>
<li>如果存在，所有名称匹配的成员函数都将被考虑，并通过重载解析来寻找最佳匹配。</li>
<li>如果不存在，则沿着继承链向上通过同样的方式依次检查每一个父类。</li>
</ul>
<p>当我们在派生类中重新定义一个在基类中具有相同名称的成员函数时，函数调用的访问说明符将会与派生类中的函数的访问说明符相匹配。例如下面的例子中，<code>Base::print()</code> 是 private 的，但 <code>Derived::print()</code> 是 public 的，可以直接被外界代码调用。</p>
<details class="example">
<summary>Example</summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-273-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-273-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-273-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-273-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-273-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-273-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-273-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-273-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-273-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-273-10">10</a></span>
<span class="normal"><a href="#__codelineno-273-11">11</a></span>
<span class="normal"><a href="#__codelineno-273-12">12</a></span>
<span class="normal"><a href="#__codelineno-273-13">13</a></span>
<span class="normal"><a href="#__codelineno-273-14">14</a></span>
<span class="normal"><a href="#__codelineno-273-15">15</a></span>
<span class="normal"><a href="#__codelineno-273-16">16</a></span>
<span class="normal"><a href="#__codelineno-273-17">17</a></span>
<span class="normal"><a href="#__codelineno-273-18">18</a></span>
<span class="normal"><a href="#__codelineno-273-19">19</a></span>
<span class="normal"><a href="#__codelineno-273-20">20</a></span>
<span class="normal"><a href="#__codelineno-273-21">21</a></span>
<span class="normal"><a href="#__codelineno-273-22">22</a></span>
<span class="normal"><a href="#__codelineno-273-23">23</a></span>
<span class="normal"><a href="#__codelineno-273-24">24</a></span>
<span class="normal"><a href="#__codelineno-273-25">25</a></span>
<span class="normal"><a href="#__codelineno-273-26">26</a></span>
<span class="normal"><a href="#__codelineno-273-27">27</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-273-1" name="__codelineno-273-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span>
<a id="__codelineno-273-2" name="__codelineno-273-2"></a>
<a id="__codelineno-273-3" name="__codelineno-273-3"></a><span class="k">class</span><span class="w"> </span><span class="nc">Base</span>
<a id="__codelineno-273-4" name="__codelineno-273-4"></a><span class="p">{</span>
<a id="__codelineno-273-5" name="__codelineno-273-5"></a><span class="k">private</span><span class="o">:</span>
<a id="__codelineno-273-6" name="__codelineno-273-6"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">print</span><span class="p">()</span><span class="w"> </span><span class="k">const</span>
<a id="__codelineno-273-7" name="__codelineno-273-7"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-273-8" name="__codelineno-273-8"></a><span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"Base"</span><span class="p">;</span>
<a id="__codelineno-273-9" name="__codelineno-273-9"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-273-10" name="__codelineno-273-10"></a><span class="p">};</span>
<a id="__codelineno-273-11" name="__codelineno-273-11"></a>
<a id="__codelineno-273-12" name="__codelineno-273-12"></a><span class="k">class</span><span class="w"> </span><span class="nc">Derived</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">Base</span>
<a id="__codelineno-273-13" name="__codelineno-273-13"></a><span class="p">{</span>
<a id="__codelineno-273-14" name="__codelineno-273-14"></a><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-273-15" name="__codelineno-273-15"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">print</span><span class="p">()</span><span class="w"> </span><span class="k">const</span>
<a id="__codelineno-273-16" name="__codelineno-273-16"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-273-17" name="__codelineno-273-17"></a><span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"Derived"</span><span class="p">;</span>
<a id="__codelineno-273-18" name="__codelineno-273-18"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-273-19" name="__codelineno-273-19"></a><span class="p">};</span>
<a id="__codelineno-273-20" name="__codelineno-273-20"></a>
<a id="__codelineno-273-21" name="__codelineno-273-21"></a>
<a id="__codelineno-273-22" name="__codelineno-273-22"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span>
<a id="__codelineno-273-23" name="__codelineno-273-23"></a><span class="p">{</span>
<a id="__codelineno-273-24" name="__codelineno-273-24"></a><span class="w">    </span><span class="n">Derived</span><span class="w"> </span><span class="n">derived</span><span class="w"> </span><span class="p">{};</span>
<a id="__codelineno-273-25" name="__codelineno-273-25"></a><span class="w">    </span><span class="n">derived</span><span class="p">.</span><span class="n">print</span><span class="p">();</span><span class="w"> </span><span class="c1">// calls derived::print(), which is public</span>
<a id="__codelineno-273-26" name="__codelineno-273-26"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-273-27" name="__codelineno-273-27"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
</details>
<p>如果我们想要在派生类对象中调用基类的一个函数，我们可以使用作用域解析运算符 <code>::</code> 来指定我们想要调用的函数。</p>
<details class="example">
<summary>Example</summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-274-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-274-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-274-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-274-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-274-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-274-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-274-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-274-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-274-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-274-10">10</a></span>
<span class="normal"><a href="#__codelineno-274-11">11</a></span>
<span class="normal"><a href="#__codelineno-274-12">12</a></span>
<span class="normal"><a href="#__codelineno-274-13">13</a></span>
<span class="normal"><a href="#__codelineno-274-14">14</a></span>
<span class="normal"><a href="#__codelineno-274-15">15</a></span>
<span class="normal"><a href="#__codelineno-274-16">16</a></span>
<span class="normal"><a href="#__codelineno-274-17">17</a></span>
<span class="normal"><a href="#__codelineno-274-18">18</a></span>
<span class="normal"><a href="#__codelineno-274-19">19</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-274-1" name="__codelineno-274-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">Base</span>
<a id="__codelineno-274-2" name="__codelineno-274-2"></a><span class="p">{</span>
<a id="__codelineno-274-3" name="__codelineno-274-3"></a><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-274-4" name="__codelineno-274-4"></a><span class="w">    </span><span class="n">Base</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-274-5" name="__codelineno-274-5"></a>
<a id="__codelineno-274-6" name="__codelineno-274-6"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">identify</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"Base::identify()</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-274-7" name="__codelineno-274-7"></a><span class="p">};</span>
<a id="__codelineno-274-8" name="__codelineno-274-8"></a>
<a id="__codelineno-274-9" name="__codelineno-274-9"></a><span class="k">class</span><span class="w"> </span><span class="nc">Derived</span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">Base</span>
<a id="__codelineno-274-10" name="__codelineno-274-10"></a><span class="p">{</span>
<a id="__codelineno-274-11" name="__codelineno-274-11"></a><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-274-12" name="__codelineno-274-12"></a><span class="w">    </span><span class="n">Derived</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-274-13" name="__codelineno-274-13"></a>
<a id="__codelineno-274-14" name="__codelineno-274-14"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">identify</span><span class="p">()</span><span class="w"> </span><span class="k">const</span>
<a id="__codelineno-274-15" name="__codelineno-274-15"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-274-16" name="__codelineno-274-16"></a><span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"Derived::identify()</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
<a id="__codelineno-274-17" name="__codelineno-274-17"></a><span class="w">        </span><span class="n">Base</span><span class="o">::</span><span class="n">identify</span><span class="p">();</span><span class="w"> </span><span class="c1">// note call to Base::identify() here</span>
<a id="__codelineno-274-18" name="__codelineno-274-18"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-274-19" name="__codelineno-274-19"></a><span class="p">};</span>
</code></pre></div></td></tr></table></div>
<p>注意这里必须要使用 <code>Base::identify()</code>，而不是 <code>identify()</code>。如果直接调用 <code>identify()</code>，会导致递归调用 Derived::identify()，从而导致无限循环。</p>
</details>
<p><code>::</code> 并不适用于我们想要调用基类的友元函数的情况，因为本质来说友元函数并不属于积累的一部分，例如 <code>operator&lt;&lt;</code>。这时候我们可以通过 <code>static_cast</code> 进行类型转换，从而调用基类的友元函数。</p>
<details class="example">
<summary>Example</summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-275-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-275-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-275-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-275-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-275-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-275-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-275-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-275-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-275-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-275-10">10</a></span>
<span class="normal"><a href="#__codelineno-275-11">11</a></span>
<span class="normal"><a href="#__codelineno-275-12">12</a></span>
<span class="normal"><a href="#__codelineno-275-13">13</a></span>
<span class="normal"><a href="#__codelineno-275-14">14</a></span>
<span class="normal"><a href="#__codelineno-275-15">15</a></span>
<span class="normal"><a href="#__codelineno-275-16">16</a></span>
<span class="normal"><a href="#__codelineno-275-17">17</a></span>
<span class="normal"><a href="#__codelineno-275-18">18</a></span>
<span class="normal"><a href="#__codelineno-275-19">19</a></span>
<span class="normal"><a href="#__codelineno-275-20">20</a></span>
<span class="normal"><a href="#__codelineno-275-21">21</a></span>
<span class="normal"><a href="#__codelineno-275-22">22</a></span>
<span class="normal"><a href="#__codelineno-275-23">23</a></span>
<span class="normal"><a href="#__codelineno-275-24">24</a></span>
<span class="normal"><a href="#__codelineno-275-25">25</a></span>
<span class="normal"><a href="#__codelineno-275-26">26</a></span>
<span class="normal"><a href="#__codelineno-275-27">27</a></span>
<span class="normal"><a href="#__codelineno-275-28">28</a></span>
<span class="normal"><a href="#__codelineno-275-29">29</a></span>
<span class="normal"><a href="#__codelineno-275-30">30</a></span>
<span class="normal"><a href="#__codelineno-275-31">31</a></span>
<span class="normal"><a href="#__codelineno-275-32">32</a></span>
<span class="normal"><a href="#__codelineno-275-33">33</a></span>
<span class="normal"><a href="#__codelineno-275-34">34</a></span>
<span class="normal"><a href="#__codelineno-275-35">35</a></span>
<span class="normal"><a href="#__codelineno-275-36">36</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-275-1" name="__codelineno-275-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span>
<a id="__codelineno-275-2" name="__codelineno-275-2"></a>
<a id="__codelineno-275-3" name="__codelineno-275-3"></a><span class="k">class</span><span class="w"> </span><span class="nc">Base</span>
<a id="__codelineno-275-4" name="__codelineno-275-4"></a><span class="p">{</span>
<a id="__codelineno-275-5" name="__codelineno-275-5"></a><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-275-6" name="__codelineno-275-6"></a><span class="w">    </span><span class="n">Base</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-275-7" name="__codelineno-275-7"></a>
<a id="__codelineno-275-8" name="__codelineno-275-8"></a><span class="w">    </span><span class="k">friend</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">ostream</span><span class="o">&amp;</span><span class="w"> </span><span class="k">operator</span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">ostream</span><span class="o">&amp;</span><span class="w"> </span><span class="n">out</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">Base</span><span class="o">&amp;</span><span class="p">)</span>
<a id="__codelineno-275-9" name="__codelineno-275-9"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-275-10" name="__codelineno-275-10"></a><span class="w">        </span><span class="n">out</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"In Base</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
<a id="__codelineno-275-11" name="__codelineno-275-11"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">out</span><span class="p">;</span>
<a id="__codelineno-275-12" name="__codelineno-275-12"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-275-13" name="__codelineno-275-13"></a><span class="p">};</span>
<a id="__codelineno-275-14" name="__codelineno-275-14"></a>
<a id="__codelineno-275-15" name="__codelineno-275-15"></a><span class="k">class</span><span class="w"> </span><span class="nc">Derived</span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">Base</span>
<a id="__codelineno-275-16" name="__codelineno-275-16"></a><span class="p">{</span>
<a id="__codelineno-275-17" name="__codelineno-275-17"></a><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-275-18" name="__codelineno-275-18"></a><span class="w">    </span><span class="n">Derived</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-275-19" name="__codelineno-275-19"></a>
<a id="__codelineno-275-20" name="__codelineno-275-20"></a><span class="w">    </span><span class="k">friend</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">ostream</span><span class="o">&amp;</span><span class="w"> </span><span class="k">operator</span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">ostream</span><span class="o">&amp;</span><span class="w"> </span><span class="n">out</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">Derived</span><span class="o">&amp;</span><span class="w"> </span><span class="n">d</span><span class="p">)</span>
<a id="__codelineno-275-21" name="__codelineno-275-21"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-275-22" name="__codelineno-275-22"></a><span class="w">        </span><span class="n">out</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"In Derived</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
<a id="__codelineno-275-23" name="__codelineno-275-23"></a><span class="w">        </span><span class="c1">// static_cast Derived to a Base object, so we call the right version of operator&lt;&lt;</span>
<a id="__codelineno-275-24" name="__codelineno-275-24"></a><span class="w">        </span><span class="n">out</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="k">static_cast</span><span class="o">&lt;</span><span class="k">const</span><span class="w"> </span><span class="n">Base</span><span class="o">&amp;&gt;</span><span class="p">(</span><span class="n">d</span><span class="p">);</span>
<a id="__codelineno-275-25" name="__codelineno-275-25"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">out</span><span class="p">;</span>
<a id="__codelineno-275-26" name="__codelineno-275-26"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-275-27" name="__codelineno-275-27"></a><span class="p">};</span>
<a id="__codelineno-275-28" name="__codelineno-275-28"></a>
<a id="__codelineno-275-29" name="__codelineno-275-29"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span>
<a id="__codelineno-275-30" name="__codelineno-275-30"></a><span class="p">{</span>
<a id="__codelineno-275-31" name="__codelineno-275-31"></a><span class="w">    </span><span class="n">Derived</span><span class="w"> </span><span class="n">derived</span><span class="w"> </span><span class="p">{};</span>
<a id="__codelineno-275-32" name="__codelineno-275-32"></a>
<a id="__codelineno-275-33" name="__codelineno-275-33"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">derived</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="sc">'\n'</span><span class="p">;</span>
<a id="__codelineno-275-34" name="__codelineno-275-34"></a>
<a id="__codelineno-275-35" name="__codelineno-275-35"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-275-36" name="__codelineno-275-36"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>这里我们通过 <code>static_cast&lt;const Base&amp;&gt;(d)</code> 将 Derived 对象转换为 Base 对象，从而调用 Base 的 <code>operator&lt;&lt;</code>。</p>
<p>这段程序将会输出</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-276-1">1</a></span>
<span class="normal"><a href="#__codelineno-276-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-276-1" name="__codelineno-276-1"></a>In Derived
<a id="__codelineno-276-2" name="__codelineno-276-2"></a>In Base
</code></pre></div></td></tr></table></div>
</details>
<div class="admonition note">
<p class="admonition-title">派生类中的重载解析</p>
<p>考虑下面的代码</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-277-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-277-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-277-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-277-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-277-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-277-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-277-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-277-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-277-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-277-10">10</a></span>
<span class="normal"><a href="#__codelineno-277-11">11</a></span>
<span class="normal"><a href="#__codelineno-277-12">12</a></span>
<span class="normal"><a href="#__codelineno-277-13">13</a></span>
<span class="normal"><a href="#__codelineno-277-14">14</a></span>
<span class="normal"><a href="#__codelineno-277-15">15</a></span>
<span class="normal"><a href="#__codelineno-277-16">16</a></span>
<span class="normal"><a href="#__codelineno-277-17">17</a></span>
<span class="normal"><a href="#__codelineno-277-18">18</a></span>
<span class="normal"><a href="#__codelineno-277-19">19</a></span>
<span class="normal"><a href="#__codelineno-277-20">20</a></span>
<span class="normal"><a href="#__codelineno-277-21">21</a></span>
<span class="normal"><a href="#__codelineno-277-22">22</a></span>
<span class="normal"><a href="#__codelineno-277-23">23</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-277-1" name="__codelineno-277-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span>
<a id="__codelineno-277-2" name="__codelineno-277-2"></a>
<a id="__codelineno-277-3" name="__codelineno-277-3"></a><span class="k">class</span><span class="w"> </span><span class="nc">Base</span>
<a id="__codelineno-277-4" name="__codelineno-277-4"></a><span class="p">{</span>
<a id="__codelineno-277-5" name="__codelineno-277-5"></a><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-277-6" name="__codelineno-277-6"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">print</span><span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="w">    </span><span class="p">{</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"Base::print(int)</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-277-7" name="__codelineno-277-7"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">print</span><span class="p">(</span><span class="kt">double</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"Base::print(double)</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-277-8" name="__codelineno-277-8"></a><span class="p">};</span>
<a id="__codelineno-277-9" name="__codelineno-277-9"></a>
<a id="__codelineno-277-10" name="__codelineno-277-10"></a><span class="k">class</span><span class="w"> </span><span class="nc">Derived</span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">Base</span>
<a id="__codelineno-277-11" name="__codelineno-277-11"></a><span class="p">{</span>
<a id="__codelineno-277-12" name="__codelineno-277-12"></a><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-277-13" name="__codelineno-277-13"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">print</span><span class="p">(</span><span class="kt">double</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"Derived::print(double)"</span><span class="p">;</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="c1">// this function added</span>
<a id="__codelineno-277-14" name="__codelineno-277-14"></a><span class="p">};</span>
<a id="__codelineno-277-15" name="__codelineno-277-15"></a>
<a id="__codelineno-277-16" name="__codelineno-277-16"></a>
<a id="__codelineno-277-17" name="__codelineno-277-17"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span>
<a id="__codelineno-277-18" name="__codelineno-277-18"></a><span class="p">{</span>
<a id="__codelineno-277-19" name="__codelineno-277-19"></a><span class="w">    </span><span class="n">Derived</span><span class="w"> </span><span class="n">d</span><span class="p">{};</span>
<a id="__codelineno-277-20" name="__codelineno-277-20"></a><span class="w">    </span><span class="n">d</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span><span class="w"> </span><span class="c1">// calls Derived::print(double), not Base::print(int)</span>
<a id="__codelineno-277-21" name="__codelineno-277-21"></a>
<a id="__codelineno-277-22" name="__codelineno-277-22"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-277-23" name="__codelineno-277-23"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>当我们调用 <code>d.print(5)</code> 时，编译器会查找一个与 <code>print</code> 匹配的函数，它会首先查找 Derived 类中的函数。它找到了 <code>Derived::print(double)</code>，于是就把 5 隐式转换为 double，然后调用这个函数。它不会再去查找 Base 类中的函数，即使 Base 类中有一个 <code>print(int)</code> 函数。</p>
<p>如果我们确实希望 <code>d.print(5)</code> 调用 <code>Base::print(int)</code>，我们可以使用 using 来使 Base 类中的函数在 Derived 类中可见。</p>
<p>只需将 Derived 类修改为</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-278-1">1</a></span>
<span class="normal"><a href="#__codelineno-278-2">2</a></span>
<span class="normal"><a href="#__codelineno-278-3">3</a></span>
<span class="normal"><a href="#__codelineno-278-4">4</a></span>
<span class="normal"><a href="#__codelineno-278-5">5</a></span>
<span class="normal"><a href="#__codelineno-278-6">6</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-278-1" name="__codelineno-278-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">Derived</span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">Base</span>
<a id="__codelineno-278-2" name="__codelineno-278-2"></a><span class="p">{</span>
<a id="__codelineno-278-3" name="__codelineno-278-3"></a><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-278-4" name="__codelineno-278-4"></a><span class="w">    </span><span class="k">using</span><span class="w"> </span><span class="n">Base</span><span class="o">::</span><span class="n">print</span><span class="p">;</span><span class="w"> </span><span class="c1">// make all Base::print() functions eligible for overload resolution</span>
<a id="__codelineno-278-5" name="__codelineno-278-5"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">print</span><span class="p">(</span><span class="kt">double</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"Derived::print(double)"</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-278-6" name="__codelineno-278-6"></a><span class="p">};</span>
</code></pre></div></td></tr></table></div>
<p>即可</p>
</div>
<h3 id="_77">多重继承（多继承）<a class="headerlink" href="#_77" title="Permanent link">¶</a></h3>
<p><strong>多重继承（多继承）</strong>（multiple inheritance）是指一个类继承自多个基类的情况。在 C++ 中，一个类可以继承自多个基类，这种情况下，派生类将会继承所有基类的成员。</p>
<p>要使用多继承，我们只需要在继承时指定多个基类，基类之间用逗号隔开。</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-279-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-279-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-279-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-279-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-279-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-279-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-279-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-279-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-279-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-279-10">10</a></span>
<span class="normal"><a href="#__codelineno-279-11">11</a></span>
<span class="normal"><a href="#__codelineno-279-12">12</a></span>
<span class="normal"><a href="#__codelineno-279-13">13</a></span>
<span class="normal"><a href="#__codelineno-279-14">14</a></span>
<span class="normal"><a href="#__codelineno-279-15">15</a></span>
<span class="normal"><a href="#__codelineno-279-16">16</a></span>
<span class="normal"><a href="#__codelineno-279-17">17</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-279-1" name="__codelineno-279-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">A</span>
<a id="__codelineno-279-2" name="__codelineno-279-2"></a><span class="p">{</span>
<a id="__codelineno-279-3" name="__codelineno-279-3"></a><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-279-4" name="__codelineno-279-4"></a><span class="w">    </span><span class="n">A</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"A: "</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="sc">'\n'</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-279-5" name="__codelineno-279-5"></a><span class="p">};</span>
<a id="__codelineno-279-6" name="__codelineno-279-6"></a>
<a id="__codelineno-279-7" name="__codelineno-279-7"></a><span class="k">class</span><span class="w"> </span><span class="nc">B</span>
<a id="__codelineno-279-8" name="__codelineno-279-8"></a><span class="p">{</span>
<a id="__codelineno-279-9" name="__codelineno-279-9"></a><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-279-10" name="__codelineno-279-10"></a><span class="w">    </span><span class="n">B</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"B: "</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="sc">'\n'</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-279-11" name="__codelineno-279-11"></a><span class="p">};</span>
<a id="__codelineno-279-12" name="__codelineno-279-12"></a>
<a id="__codelineno-279-13" name="__codelineno-279-13"></a><span class="k">class</span><span class="w"> </span><span class="nc">C</span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">A</span><span class="p">,</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">B</span>
<a id="__codelineno-279-14" name="__codelineno-279-14"></a><span class="p">{</span>
<a id="__codelineno-279-15" name="__codelineno-279-15"></a><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-279-16" name="__codelineno-279-16"></a><span class="w">    </span><span class="n">C</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"C: "</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="sc">'\n'</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-279-17" name="__codelineno-279-17"></a><span class="p">};</span>
</code></pre></div></td></tr></table></div>
<p>继承图看起来像是这样</p>
<pre class="mermaid"><code>graph BT;

C---&gt;A
C---&gt;B
</code></pre>
<h4 id="_78">多继承导致的问题<a class="headerlink" href="#_78" title="Permanent link">¶</a></h4>
<p>当多个基类包含相同名称的函数时，会导致歧义。例如，如果 A 和 B 都有一个名为 <code>print()</code> 的函数，那么当我们在 C 中调用 <code>print()</code> 时，编译器无法确定我们想要调用哪一个 <code>print()</code>。</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-280-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-280-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-280-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-280-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-280-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-280-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-280-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-280-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-280-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-280-10">10</a></span>
<span class="normal"><a href="#__codelineno-280-11">11</a></span>
<span class="normal"><a href="#__codelineno-280-12">12</a></span>
<span class="normal"><a href="#__codelineno-280-13">13</a></span>
<span class="normal"><a href="#__codelineno-280-14">14</a></span>
<span class="normal"><a href="#__codelineno-280-15">15</a></span>
<span class="normal"><a href="#__codelineno-280-16">16</a></span>
<span class="normal"><a href="#__codelineno-280-17">17</a></span>
<span class="normal"><a href="#__codelineno-280-18">18</a></span>
<span class="normal"><a href="#__codelineno-280-19">19</a></span>
<span class="normal"><a href="#__codelineno-280-20">20</a></span>
<span class="normal"><a href="#__codelineno-280-21">21</a></span>
<span class="normal"><a href="#__codelineno-280-22">22</a></span>
<span class="normal"><a href="#__codelineno-280-23">23</a></span>
<span class="normal"><a href="#__codelineno-280-24">24</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-280-1" name="__codelineno-280-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">A</span>
<a id="__codelineno-280-2" name="__codelineno-280-2"></a><span class="p">{</span>
<a id="__codelineno-280-3" name="__codelineno-280-3"></a><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-280-4" name="__codelineno-280-4"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">print</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"A</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-280-5" name="__codelineno-280-5"></a><span class="p">};</span>
<a id="__codelineno-280-6" name="__codelineno-280-6"></a>
<a id="__codelineno-280-7" name="__codelineno-280-7"></a><span class="k">class</span><span class="w"> </span><span class="nc">B</span>
<a id="__codelineno-280-8" name="__codelineno-280-8"></a><span class="p">{</span>
<a id="__codelineno-280-9" name="__codelineno-280-9"></a><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-280-10" name="__codelineno-280-10"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">print</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"B</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-280-11" name="__codelineno-280-11"></a><span class="p">};</span>
<a id="__codelineno-280-12" name="__codelineno-280-12"></a>
<a id="__codelineno-280-13" name="__codelineno-280-13"></a><span class="k">class</span><span class="w"> </span><span class="nc">C</span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">A</span><span class="p">,</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">B</span>
<a id="__codelineno-280-14" name="__codelineno-280-14"></a><span class="p">{</span>
<a id="__codelineno-280-15" name="__codelineno-280-15"></a><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-280-16" name="__codelineno-280-16"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">print</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"C</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-280-17" name="__codelineno-280-17"></a><span class="p">};</span>
<a id="__codelineno-280-18" name="__codelineno-280-18"></a>
<a id="__codelineno-280-19" name="__codelineno-280-19"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span>
<a id="__codelineno-280-20" name="__codelineno-280-20"></a><span class="p">{</span>
<a id="__codelineno-280-21" name="__codelineno-280-21"></a><span class="w">    </span><span class="n">C</span><span class="w"> </span><span class="n">c</span><span class="p">;</span>
<a id="__codelineno-280-22" name="__codelineno-280-22"></a><span class="w">    </span><span class="n">c</span><span class="p">.</span><span class="n">print</span><span class="p">();</span><span class="w"> </span><span class="c1">// error: which print() do we want to call?</span>
<a id="__codelineno-280-23" name="__codelineno-280-23"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-280-24" name="__codelineno-280-24"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>我们可以通过明确指定要调用哪一个版本的 <code>print()</code> 来解决这个问题。</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-281-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-281-1" name="__codelineno-281-1"></a><span class="n">c</span><span class="p">.</span><span class="n">A</span><span class="o">::</span><span class="n">print</span><span class="p">();</span><span class="w"> </span><span class="c1">// prints A</span>
</code></pre></div></td></tr></table></div>
<p>尽管这种解决办法并不算复杂，但是当继承链较长并且包含多个基类时，这种问题可能会变得非常复杂。</p>
<p>比这更糟糕的是菱形继承（diamond inheritance）问题，这是一种特殊的多重继承问题，其中一个类继承自两个类，这两个类又继承自同一个类。例如下面的这个例子：</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-282-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-282-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-282-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-282-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-282-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-282-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-282-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-282-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-282-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-282-10">10</a></span>
<span class="normal"><a href="#__codelineno-282-11">11</a></span>
<span class="normal"><a href="#__codelineno-282-12">12</a></span>
<span class="normal"><a href="#__codelineno-282-13">13</a></span>
<span class="normal"><a href="#__codelineno-282-14">14</a></span>
<span class="normal"><a href="#__codelineno-282-15">15</a></span>
<span class="normal"><a href="#__codelineno-282-16">16</a></span>
<span class="normal"><a href="#__codelineno-282-17">17</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-282-1" name="__codelineno-282-1"></a><span class="err">```</span><span class="n">cpp</span>
<a id="__codelineno-282-2" name="__codelineno-282-2"></a><span class="k">class</span><span class="w"> </span><span class="nc">A</span>
<a id="__codelineno-282-3" name="__codelineno-282-3"></a><span class="p">{</span>
<a id="__codelineno-282-4" name="__codelineno-282-4"></a><span class="p">};</span>
<a id="__codelineno-282-5" name="__codelineno-282-5"></a>
<a id="__codelineno-282-6" name="__codelineno-282-6"></a><span class="k">class</span><span class="w"> </span><span class="nc">B</span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">A</span>
<a id="__codelineno-282-7" name="__codelineno-282-7"></a><span class="p">{</span>
<a id="__codelineno-282-8" name="__codelineno-282-8"></a><span class="p">};</span>
<a id="__codelineno-282-9" name="__codelineno-282-9"></a>
<a id="__codelineno-282-10" name="__codelineno-282-10"></a>
<a id="__codelineno-282-11" name="__codelineno-282-11"></a><span class="k">class</span><span class="w"> </span><span class="nc">C</span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">A</span>
<a id="__codelineno-282-12" name="__codelineno-282-12"></a><span class="p">{</span>
<a id="__codelineno-282-13" name="__codelineno-282-13"></a><span class="p">};</span>
<a id="__codelineno-282-14" name="__codelineno-282-14"></a>
<a id="__codelineno-282-15" name="__codelineno-282-15"></a><span class="k">class</span><span class="w"> </span><span class="nc">D</span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">B</span><span class="p">,</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">C</span>
<a id="__codelineno-282-16" name="__codelineno-282-16"></a><span class="p">{</span>
<a id="__codelineno-282-17" name="__codelineno-282-17"></a><span class="p">};</span>
</code></pre></div></td></tr></table></div>
<pre class="mermaid"><code>graph BT;

B---&gt;A
C---&gt;A
D---&gt;B
D---&gt;C
</code></pre>
<p>综合以上各种原因，我们最好避免使用多重继承。</p>
<h2 id="_79">虚函数（虚拟函数）<a class="headerlink" href="#_79" title="Permanent link">¶</a></h2>
<p><strong>虚函数</strong>（virtual function）是一种特殊的成员函数，当被调用时，它将被解析为最接近引用或指针所指的派生类对象的函数。</p>
<p>如果派生版本的函数与基类版本的函数具有相同的函数签名（函数名、参数类型以及 const）和返回类型，就称这样的函数是<strong>覆盖</strong>的（override）。</p>
<details class="example">
<summary>不使用虚函数</summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-283-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-283-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-283-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-283-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-283-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-283-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-283-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-283-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-283-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-283-10">10</a></span>
<span class="normal"><a href="#__codelineno-283-11">11</a></span>
<span class="normal"><a href="#__codelineno-283-12">12</a></span>
<span class="normal"><a href="#__codelineno-283-13">13</a></span>
<span class="normal"><a href="#__codelineno-283-14">14</a></span>
<span class="normal"><a href="#__codelineno-283-15">15</a></span>
<span class="normal"><a href="#__codelineno-283-16">16</a></span>
<span class="normal"><a href="#__codelineno-283-17">17</a></span>
<span class="normal"><a href="#__codelineno-283-18">18</a></span>
<span class="normal"><a href="#__codelineno-283-19">19</a></span>
<span class="normal"><a href="#__codelineno-283-20">20</a></span>
<span class="normal"><a href="#__codelineno-283-21">21</a></span>
<span class="normal"><a href="#__codelineno-283-22">22</a></span>
<span class="normal"><a href="#__codelineno-283-23">23</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-283-1" name="__codelineno-283-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span>
<a id="__codelineno-283-2" name="__codelineno-283-2"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;string_view&gt;</span>
<a id="__codelineno-283-3" name="__codelineno-283-3"></a>
<a id="__codelineno-283-4" name="__codelineno-283-4"></a><span class="k">class</span><span class="w"> </span><span class="nc">Base</span>
<a id="__codelineno-283-5" name="__codelineno-283-5"></a><span class="p">{</span>
<a id="__codelineno-283-6" name="__codelineno-283-6"></a><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-283-7" name="__codelineno-283-7"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">string_view</span><span class="w"> </span><span class="n">getName</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="s">"Base"</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-283-8" name="__codelineno-283-8"></a><span class="p">};</span>
<a id="__codelineno-283-9" name="__codelineno-283-9"></a>
<a id="__codelineno-283-10" name="__codelineno-283-10"></a><span class="k">class</span><span class="w"> </span><span class="nc">Derived</span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">Base</span>
<a id="__codelineno-283-11" name="__codelineno-283-11"></a><span class="p">{</span>
<a id="__codelineno-283-12" name="__codelineno-283-12"></a><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-283-13" name="__codelineno-283-13"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">string_view</span><span class="w"> </span><span class="n">getName</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="s">"Derived"</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-283-14" name="__codelineno-283-14"></a><span class="p">};</span>
<a id="__codelineno-283-15" name="__codelineno-283-15"></a>
<a id="__codelineno-283-16" name="__codelineno-283-16"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span>
<a id="__codelineno-283-17" name="__codelineno-283-17"></a><span class="p">{</span>
<a id="__codelineno-283-18" name="__codelineno-283-18"></a><span class="w">    </span><span class="n">Derived</span><span class="w"> </span><span class="n">derived</span><span class="w"> </span><span class="p">{};</span>
<a id="__codelineno-283-19" name="__codelineno-283-19"></a><span class="w">    </span><span class="n">Base</span><span class="o">&amp;</span><span class="w"> </span><span class="n">rBase</span><span class="p">{</span><span class="w"> </span><span class="n">derived</span><span class="w"> </span><span class="p">};</span>
<a id="__codelineno-283-20" name="__codelineno-283-20"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"rBase is a "</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">rBase</span><span class="p">.</span><span class="n">getName</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="sc">'\n'</span><span class="p">;</span>
<a id="__codelineno-283-21" name="__codelineno-283-21"></a>
<a id="__codelineno-283-22" name="__codelineno-283-22"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-283-23" name="__codelineno-283-23"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>这段代码的输出是 <code>rBase is a Base</code>，而不是 <code>rBase is a Derived</code>。这是因为 rBase 被认为是一个指向 Base 类型的指针，它只能访问 <code>derived</code> 的 Base 部分，因此它调用的是 Base::getName()，而不是 Derived::getName()。</p>
<p>上述情况对于 <code>Base* pBase{ &amp;derived };</code> 也是一样的。</p>
</details>
<p>要使一个函数成为虚函数，我们需要在函数声明前加上 <code>virtual</code> 关键字。</p>
<p>这是上面这个例子改为使用虚函数的版本。</p>
<details class="example">
<summary>使用虚函数</summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-284-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-284-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-284-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-284-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-284-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-284-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-284-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-284-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-284-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-284-10">10</a></span>
<span class="normal"><a href="#__codelineno-284-11">11</a></span>
<span class="normal"><a href="#__codelineno-284-12">12</a></span>
<span class="normal"><a href="#__codelineno-284-13">13</a></span>
<span class="normal"><a href="#__codelineno-284-14">14</a></span>
<span class="normal"><a href="#__codelineno-284-15">15</a></span>
<span class="normal"><a href="#__codelineno-284-16">16</a></span>
<span class="normal"><a href="#__codelineno-284-17">17</a></span>
<span class="normal"><a href="#__codelineno-284-18">18</a></span>
<span class="normal"><a href="#__codelineno-284-19">19</a></span>
<span class="normal"><a href="#__codelineno-284-20">20</a></span>
<span class="normal"><a href="#__codelineno-284-21">21</a></span>
<span class="normal"><a href="#__codelineno-284-22">22</a></span>
<span class="normal"><a href="#__codelineno-284-23">23</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-284-1" name="__codelineno-284-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span>
<a id="__codelineno-284-2" name="__codelineno-284-2"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;string_view&gt;</span>
<a id="__codelineno-284-3" name="__codelineno-284-3"></a>
<a id="__codelineno-284-4" name="__codelineno-284-4"></a><span class="k">class</span><span class="w"> </span><span class="nc">Base</span>
<a id="__codelineno-284-5" name="__codelineno-284-5"></a><span class="p">{</span>
<a id="__codelineno-284-6" name="__codelineno-284-6"></a><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-284-7" name="__codelineno-284-7"></a><span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string_view</span><span class="w"> </span><span class="n">getName</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="s">"Base"</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-284-8" name="__codelineno-284-8"></a><span class="p">};</span>
<a id="__codelineno-284-9" name="__codelineno-284-9"></a>
<a id="__codelineno-284-10" name="__codelineno-284-10"></a><span class="k">class</span><span class="w"> </span><span class="nc">Derived</span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">Base</span>
<a id="__codelineno-284-11" name="__codelineno-284-11"></a><span class="p">{</span>
<a id="__codelineno-284-12" name="__codelineno-284-12"></a><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-284-13" name="__codelineno-284-13"></a><span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string_view</span><span class="w"> </span><span class="n">getName</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="s">"Derived"</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-284-14" name="__codelineno-284-14"></a><span class="p">};</span>
<a id="__codelineno-284-15" name="__codelineno-284-15"></a>
<a id="__codelineno-284-16" name="__codelineno-284-16"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span>
<a id="__codelineno-284-17" name="__codelineno-284-17"></a><span class="p">{</span>
<a id="__codelineno-284-18" name="__codelineno-284-18"></a><span class="w">    </span><span class="n">Derived</span><span class="w"> </span><span class="n">derived</span><span class="w"> </span><span class="p">{};</span>
<a id="__codelineno-284-19" name="__codelineno-284-19"></a><span class="w">    </span><span class="n">Base</span><span class="o">&amp;</span><span class="w"> </span><span class="n">rBase</span><span class="p">{</span><span class="w"> </span><span class="n">derived</span><span class="w"> </span><span class="p">};</span>
<a id="__codelineno-284-20" name="__codelineno-284-20"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"rBase is a "</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">rBase</span><span class="p">.</span><span class="n">getName</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="sc">'\n'</span><span class="p">;</span>
<a id="__codelineno-284-21" name="__codelineno-284-21"></a>
<a id="__codelineno-284-22" name="__codelineno-284-22"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-284-23" name="__codelineno-284-23"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>这段代码的输出是 <code>rBase is a Derived</code>，这是因为 <code>getName()</code> 是一个虚函数，它会被解析为最接近引用或指针所指的派生类对象的函数。</p>
</details>
<p>由于 Base::getName() 是虚函数，因此在评估 <code>rBase.getName()</code> 时，编译器会查看是否有“更派生”的版本的 <code>getName()</code> 函数。在这种情况下，Derived::getName() 是一个更符合要求的版本，因此它将被调用。</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>虚函数解析仅在通过指针或引用去调用一个类类型对象的虚函数时发生。</p>
</div>
<p>虚函数让编译器能将指针/引用的类型和实际被指向的对象的类型区分开。当我们直接在一个对象上调用虚成员函数时，将始终调用与这个对象的派生类匹配的函数。</p>
<div class="admonition info">
<p class="admonition-title">多态</p>
<p>在编程中，<strong>多态</strong>（polymorphism）泛指一个实体具有多种形式的能力。</p>
<ul>
<li>编译时多态（compile-time polymorphism）是指编译器解析方式的多态性，包括重载解析和模板解析等。</li>
<li>运行时多态（run-time polymorphism）是指程序在运行时选择调用的函数的多态性，包括虚函数解析等。</li>
</ul>
</div>
<ul>
<li>派生类函数的签名必须与基类中虚拟函数的签名完全相同，否则它不会被视为覆盖，而是一个新的函数。这种情况下程序或许能正常编译，但将不会按照我们的预期运行</li>
<li>
<p>如果一个成员函数是 virtual 的，那么从这个类派生出来的所有类的相同函数都将被隐式声明为虚函数，除非它们被声明为非虚函数。</p>
<ul>
<li>这条规则并没有逆——如果派生类中的覆盖是一个虚函数，基类中的函数也不会自动变成虚函数。</li>
</ul>
</li>
</ul>
<div class="admonition warning">
<p class="admonition-title">不要在构造函数或析构函数中调用虚函数！</p>
<ul>
<li>当创建一个派生类时，它的基类部分会被首先构造，如果我们想要在 Base 的构造函数中调用一个虚函数，那么这个虚函数将会被解析为 Base 的版本，因为此时派生类部分还没有可以被调用的函数。</li>
<li>类似地，当我们在基类的析构函数中调用虚函数时，因为此时派生类的所有函数都已经被销毁，所以调用的将是 Base 的版本。</li>
</ul>
<p>综上所述，我们不应该在构造函数或析构函数中调用虚函数！</p>
</div>
<h3 id="overridefinal-covariant">override、final 和 covariant 返回类型<a class="headerlink" href="#overridefinal-covariant" title="Permanent link">¶</a></h3>
<div class="admonition info">
<p class="admonition-title">override 和 final</p>
<p>C++ 具有两个与继承相关的标识符：<code>override</code> 和 <code>final</code>。它们两个不是关键字，C++ 标准称它们为 <em>identifiers with special meaning</em>，即具有特殊含义的标识符，但通常被称为说明符。</p>
</div>
<h4 id="override">override<a class="headerlink" href="#override" title="Permanent link">¶</a></h4>
<p>正如我们之前提到的那样，仅当函数签名和返回类型都完全匹配时，派生类中的虚函数才被视为覆盖。我们有时候希望一个函数成为覆盖，但实际上由于各种原因它并没有把来自于基类的函数覆盖，而这就是 override 该发挥作用的时候了。</p>
<p>考虑下面的这个例子：</p>
<details class="example">
<summary>Example</summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-285-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-285-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-285-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-285-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-285-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-285-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-285-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-285-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-285-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-285-10">10</a></span>
<span class="normal"><a href="#__codelineno-285-11">11</a></span>
<span class="normal"><a href="#__codelineno-285-12">12</a></span>
<span class="normal"><a href="#__codelineno-285-13">13</a></span>
<span class="normal"><a href="#__codelineno-285-14">14</a></span>
<span class="normal"><a href="#__codelineno-285-15">15</a></span>
<span class="normal"><a href="#__codelineno-285-16">16</a></span>
<span class="normal"><a href="#__codelineno-285-17">17</a></span>
<span class="normal"><a href="#__codelineno-285-18">18</a></span>
<span class="normal"><a href="#__codelineno-285-19">19</a></span>
<span class="normal"><a href="#__codelineno-285-20">20</a></span>
<span class="normal"><a href="#__codelineno-285-21">21</a></span>
<span class="normal"><a href="#__codelineno-285-22">22</a></span>
<span class="normal"><a href="#__codelineno-285-23">23</a></span>
<span class="normal"><a href="#__codelineno-285-24">24</a></span>
<span class="normal"><a href="#__codelineno-285-25">25</a></span>
<span class="normal"><a href="#__codelineno-285-26">26</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-285-1" name="__codelineno-285-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span>
<a id="__codelineno-285-2" name="__codelineno-285-2"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;string_view&gt;</span>
<a id="__codelineno-285-3" name="__codelineno-285-3"></a>
<a id="__codelineno-285-4" name="__codelineno-285-4"></a><span class="k">class</span><span class="w"> </span><span class="nc">A</span>
<a id="__codelineno-285-5" name="__codelineno-285-5"></a><span class="p">{</span>
<a id="__codelineno-285-6" name="__codelineno-285-6"></a><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-285-7" name="__codelineno-285-7"></a><span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string_view</span><span class="w"> </span><span class="n">getName1</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="s">"A"</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-285-8" name="__codelineno-285-8"></a><span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string_view</span><span class="w"> </span><span class="n">getName2</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="s">"A"</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-285-9" name="__codelineno-285-9"></a><span class="p">};</span>
<a id="__codelineno-285-10" name="__codelineno-285-10"></a>
<a id="__codelineno-285-11" name="__codelineno-285-11"></a><span class="k">class</span><span class="w"> </span><span class="nc">B</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">A</span>
<a id="__codelineno-285-12" name="__codelineno-285-12"></a><span class="p">{</span>
<a id="__codelineno-285-13" name="__codelineno-285-13"></a><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-285-14" name="__codelineno-285-14"></a><span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string_view</span><span class="w"> </span><span class="n">getName1</span><span class="p">(</span><span class="kt">short</span><span class="w"> </span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="s">"B"</span><span class="p">;</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="c1">// note: parameter is a short</span>
<a id="__codelineno-285-15" name="__codelineno-285-15"></a><span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string_view</span><span class="w"> </span><span class="n">getName2</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="s">"B"</span><span class="p">;</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="c1">// note: function is const</span>
<a id="__codelineno-285-16" name="__codelineno-285-16"></a><span class="p">};</span>
<a id="__codelineno-285-17" name="__codelineno-285-17"></a>
<a id="__codelineno-285-18" name="__codelineno-285-18"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span>
<a id="__codelineno-285-19" name="__codelineno-285-19"></a><span class="p">{</span>
<a id="__codelineno-285-20" name="__codelineno-285-20"></a><span class="w">    </span><span class="n">B</span><span class="w"> </span><span class="n">b</span><span class="p">{};</span>
<a id="__codelineno-285-21" name="__codelineno-285-21"></a><span class="w">    </span><span class="n">A</span><span class="o">&amp;</span><span class="w"> </span><span class="n">rBase</span><span class="p">{</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="p">};</span>
<a id="__codelineno-285-22" name="__codelineno-285-22"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">rBase</span><span class="p">.</span><span class="n">getName1</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="sc">'\n'</span><span class="p">;</span>
<a id="__codelineno-285-23" name="__codelineno-285-23"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">rBase</span><span class="p">.</span><span class="n">getName2</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="sc">'\n'</span><span class="p">;</span>
<a id="__codelineno-285-24" name="__codelineno-285-24"></a>
<a id="__codelineno-285-25" name="__codelineno-285-25"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-285-26" name="__codelineno-285-26"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
</details>
<p>由于 rBase 是指向 B 对象的 A 类型参考，我们实际上想要做的是调用 B::getName1() 和 B::getName2()。但是由于 B::getName1 和 B::getName2 的签名与 A::getName1 和 A::getName2 不完全匹配，因此它们不会被视为覆盖。</p>
<p>因此，这段程序将会输出</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-286-1">1</a></span>
<span class="normal"><a href="#__codelineno-286-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-286-1" name="__codelineno-286-1"></a>A
<a id="__codelineno-286-2" name="__codelineno-286-2"></a>A
</code></pre></div></td></tr></table></div>
<p>在更复杂的程序中，像这样错误地调用了意料之外的函数可能导致更大的错误，并且这也难以调试。为了解决这种我们希望成为覆盖，但并没有成为覆盖的情况，我们可以把 override 说明符应用到一个虚拟函数上，以告知编译器这个函数必须是一个覆盖。</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>override 说明符应当被放置在成员函数声明的末尾，如果这个成员函数是 const 的，那么就放置在 const 关键字之后。例如</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-287-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-287-1" name="__codelineno-287-1"></a><span class="n">return_type</span><span class="w"> </span><span class="nf">function_name</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="k">override</span><span class="p">;</span>
</code></pre></div></td></tr></table></div>
</div>
<p>如果一个被标记为 override 的函数并没有覆盖任何基类的函数（或应用于一个非虚函数），那么编译器将会报错。</p>
<div class="admonition example">
<p class="admonition-title">Example</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-288-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-288-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-288-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-288-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-288-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-288-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-288-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-288-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-288-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-288-10">10</a></span>
<span class="normal"><a href="#__codelineno-288-11">11</a></span>
<span class="normal"><a href="#__codelineno-288-12">12</a></span>
<span class="normal"><a href="#__codelineno-288-13">13</a></span>
<span class="normal"><a href="#__codelineno-288-14">14</a></span>
<span class="normal"><a href="#__codelineno-288-15">15</a></span>
<span class="normal"><a href="#__codelineno-288-16">16</a></span>
<span class="normal"><a href="#__codelineno-288-17">17</a></span>
<span class="normal"><a href="#__codelineno-288-18">18</a></span>
<span class="normal"><a href="#__codelineno-288-19">19</a></span>
<span class="normal"><a href="#__codelineno-288-20">20</a></span>
<span class="normal"><a href="#__codelineno-288-21">21</a></span>
<span class="normal"><a href="#__codelineno-288-22">22</a></span>
<span class="normal"><a href="#__codelineno-288-23">23</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-288-1" name="__codelineno-288-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;string_view&gt;</span>
<a id="__codelineno-288-2" name="__codelineno-288-2"></a>
<a id="__codelineno-288-3" name="__codelineno-288-3"></a><span class="k">class</span><span class="w"> </span><span class="nc">A</span>
<a id="__codelineno-288-4" name="__codelineno-288-4"></a><span class="p">{</span>
<a id="__codelineno-288-5" name="__codelineno-288-5"></a><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-288-6" name="__codelineno-288-6"></a><span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string_view</span><span class="w"> </span><span class="n">getName1</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="s">"A"</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-288-7" name="__codelineno-288-7"></a><span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string_view</span><span class="w"> </span><span class="n">getName2</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="s">"A"</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-288-8" name="__codelineno-288-8"></a><span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string_view</span><span class="w"> </span><span class="n">getName3</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="s">"A"</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-288-9" name="__codelineno-288-9"></a><span class="p">};</span>
<a id="__codelineno-288-10" name="__codelineno-288-10"></a>
<a id="__codelineno-288-11" name="__codelineno-288-11"></a><span class="k">class</span><span class="w"> </span><span class="nc">B</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">A</span>
<a id="__codelineno-288-12" name="__codelineno-288-12"></a><span class="p">{</span>
<a id="__codelineno-288-13" name="__codelineno-288-13"></a><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-288-14" name="__codelineno-288-14"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">string_view</span><span class="w"> </span><span class="n">getName1</span><span class="p">(</span><span class="kt">short</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="s">"B"</span><span class="p">;</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="c1">// compile error, function is not an override</span>
<a id="__codelineno-288-15" name="__codelineno-288-15"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">string_view</span><span class="w"> </span><span class="n">getName2</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="s">"B"</span><span class="p">;</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="c1">// compile error, function is not an override</span>
<a id="__codelineno-288-16" name="__codelineno-288-16"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">string_view</span><span class="w"> </span><span class="n">getName3</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="s">"B"</span><span class="p">;</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="c1">// okay, function is an override of A::getName3(int)</span>
<a id="__codelineno-288-17" name="__codelineno-288-17"></a>
<a id="__codelineno-288-18" name="__codelineno-288-18"></a><span class="p">};</span>
<a id="__codelineno-288-19" name="__codelineno-288-19"></a>
<a id="__codelineno-288-20" name="__codelineno-288-20"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span>
<a id="__codelineno-288-21" name="__codelineno-288-21"></a><span class="p">{</span>
<a id="__codelineno-288-22" name="__codelineno-288-22"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-288-23" name="__codelineno-288-23"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>这段程序会产生两个编译错误，一个发生在 <code>B::getName1()</code>，另一个发生在 <code>B::getName2()</code>。这是因为 <code>B::getName1()</code> 的参数类型与 <code>A::getName1()</code> 不匹配，<code>B::getName2()</code> 比 <code>A::getName2(</code>) 多了一个 const。</p>
</div>
<p>使用 override 不会造成性能上的损失，并且它能确保我们确实覆盖了一个基类的函数，因此我们应该用 override 来标注所有的覆盖虚函数。</p>
<p>此外，由于 override 已经假定了这个成员函数是虚函数，因此我们不需要再次使用 virtual 关键字。</p>
<div class="admonition abstract">
<p class="admonition-title">Abstract</p>
<ul>
<li>在基类的虚函数上使用 virtual 关键字</li>
<li>在派生类的覆盖函数上使用 override 说明符，但不使用 virtual 关键字</li>
</ul>
</div>
<h4 id="final">final<a class="headerlink" href="#final" title="Permanent link">¶</a></h4>
<p>有时，我们不希望一个虚拟函数被派生类所覆盖，或是不希望一个类再被其他类所继承，那么我们就可以使用 final 说明符。被指定为 final 的虚函数将不能被覆盖，被指定为 final 的类也将不能被继承，否则将会出现编译错误。</p>
<p>final 说明符也同样应该出现在函数声明的最后位置，如果同时还有 const 和 override，那么就应按照 const override final 的顺序来书写。</p>
<div class="admonition example">
<p class="admonition-title">Example</p>
<div class="tabbed-set tabbed-alternate" data-tabs="6:2"><input checked="checked" id="__tabbed_6_1" name="__tabbed_6" type="radio"><input id="__tabbed_6_2" name="__tabbed_6" type="radio"><div class="tabbed-labels"><label for="__tabbed_6_1">虚函数使用 final" hl_lines="12</label><label for="__tabbed_6_2">类使用 final</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-289-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-289-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-289-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-289-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-289-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-289-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-289-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-289-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-289-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-289-10">10</a></span>
<span class="normal"><a href="#__codelineno-289-11">11</a></span>
<span class="normal"><a href="#__codelineno-289-12">12</a></span>
<span class="normal"><a href="#__codelineno-289-13">13</a></span>
<span class="normal"><a href="#__codelineno-289-14">14</a></span>
<span class="normal"><a href="#__codelineno-289-15">15</a></span>
<span class="normal"><a href="#__codelineno-289-16">16</a></span>
<span class="normal"><a href="#__codelineno-289-17">17</a></span>
<span class="normal"><a href="#__codelineno-289-18">18</a></span>
<span class="normal"><a href="#__codelineno-289-19">19</a></span>
<span class="normal"><a href="#__codelineno-289-20">20</a></span>
<span class="normal"><a href="#__codelineno-289-21">21</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-289-1" name="__codelineno-289-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;string_view&gt;</span>
<a id="__codelineno-289-2" name="__codelineno-289-2"></a>
<a id="__codelineno-289-3" name="__codelineno-289-3"></a><span class="k">class</span><span class="w"> </span><span class="nc">A</span>
<a id="__codelineno-289-4" name="__codelineno-289-4"></a><span class="p">{</span>
<a id="__codelineno-289-5" name="__codelineno-289-5"></a><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-289-6" name="__codelineno-289-6"></a><span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string_view</span><span class="w"> </span><span class="n">getName</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="s">"A"</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-289-7" name="__codelineno-289-7"></a><span class="p">};</span>
<a id="__codelineno-289-8" name="__codelineno-289-8"></a>
<a id="__codelineno-289-9" name="__codelineno-289-9"></a><span class="k">class</span><span class="w"> </span><span class="nc">B</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">A</span>
<a id="__codelineno-289-10" name="__codelineno-289-10"></a><span class="p">{</span>
<a id="__codelineno-289-11" name="__codelineno-289-11"></a><span class="k">public</span><span class="o">:</span><span class="n">s</span>
<a id="__codelineno-289-12" name="__codelineno-289-12"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">string_view</span><span class="w"> </span><span class="n">getName</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="k">final</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="s">"B"</span><span class="p">;</span><span class="w"> </span><span class="p">}</span><span class="w"> </span>
<a id="__codelineno-289-13" name="__codelineno-289-13"></a><span class="w">    </span><span class="c1">// okay, overrides A::getName()</span>
<a id="__codelineno-289-14" name="__codelineno-289-14"></a><span class="p">};</span>
<a id="__codelineno-289-15" name="__codelineno-289-15"></a>
<a id="__codelineno-289-16" name="__codelineno-289-16"></a><span class="k">class</span><span class="w"> </span><span class="nc">C</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">B</span>
<a id="__codelineno-289-17" name="__codelineno-289-17"></a><span class="p">{</span>
<a id="__codelineno-289-18" name="__codelineno-289-18"></a><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-289-19" name="__codelineno-289-19"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">string_view</span><span class="w"> </span><span class="n">getName</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="s">"C"</span><span class="p">;</span><span class="w"> </span><span class="p">}</span><span class="w"> </span>
<a id="__codelineno-289-20" name="__codelineno-289-20"></a><span class="w">    </span><span class="c1">// compile error: overrides B::getName(), which is final</span>
<a id="__codelineno-289-21" name="__codelineno-289-21"></a><span class="p">};</span>
</code></pre></div></td></tr></table></div>
<p>这里我们尝试在 C 类中覆盖一个在 B 类中已经被标注为 final 的函数，于是就出现了编译错误。</p>
</div>
<div class="tabbed-block">
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-290-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-290-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-290-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-290-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-290-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-290-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-290-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-290-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-290-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-290-10">10</a></span>
<span class="normal"><a href="#__codelineno-290-11">11</a></span>
<span class="normal"><a href="#__codelineno-290-12">12</a></span>
<span class="normal"><a href="#__codelineno-290-13">13</a></span>
<span class="normal"><a href="#__codelineno-290-14">14</a></span>
<span class="normal"><a href="#__codelineno-290-15">15</a></span>
<span class="normal"><a href="#__codelineno-290-16">16</a></span>
<span class="normal"><a href="#__codelineno-290-17">17</a></span>
<span class="normal"><a href="#__codelineno-290-18">18</a></span>
<span class="normal"><a href="#__codelineno-290-19">19</a></span>
<span class="normal"><a href="#__codelineno-290-20">20</a></span>
<span class="normal"><a href="#__codelineno-290-21">21</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-290-1" name="__codelineno-290-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;string_view&gt;</span>
<a id="__codelineno-290-2" name="__codelineno-290-2"></a>
<a id="__codelineno-290-3" name="__codelineno-290-3"></a><span class="k">class</span><span class="w"> </span><span class="nc">A</span>
<a id="__codelineno-290-4" name="__codelineno-290-4"></a><span class="p">{</span>
<a id="__codelineno-290-5" name="__codelineno-290-5"></a><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-290-6" name="__codelineno-290-6"></a><span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string_view</span><span class="w"> </span><span class="n">getName</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="s">"A"</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-290-7" name="__codelineno-290-7"></a><span class="p">};</span>
<a id="__codelineno-290-8" name="__codelineno-290-8"></a>
<a id="__codelineno-290-9" name="__codelineno-290-9"></a><span class="k">class</span><span class="w"> </span><span class="nc">B</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">A</span>
<a id="__codelineno-290-10" name="__codelineno-290-10"></a><span class="p">{</span>
<a id="__codelineno-290-11" name="__codelineno-290-11"></a><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-290-12" name="__codelineno-290-12"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">string_view</span><span class="w"> </span><span class="n">getName</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="k">final</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="s">"B"</span><span class="p">;</span><span class="w"> </span><span class="p">}</span><span class="w"> </span>
<a id="__codelineno-290-13" name="__codelineno-290-13"></a><span class="hll"><span class="w">    </span><span class="c1">// okay, overrides A::getName()</span>
</span><a id="__codelineno-290-14" name="__codelineno-290-14"></a><span class="p">};</span>
<a id="__codelineno-290-15" name="__codelineno-290-15"></a>
<a id="__codelineno-290-16" name="__codelineno-290-16"></a><span class="k">class</span><span class="w"> </span><span class="nc">C</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">B</span>
<a id="__codelineno-290-17" name="__codelineno-290-17"></a><span class="p">{</span>
<a id="__codelineno-290-18" name="__codelineno-290-18"></a><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-290-19" name="__codelineno-290-19"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">string_view</span><span class="w"> </span><span class="n">getName</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="s">"C"</span><span class="p">;</span><span class="w"> </span><span class="p">}</span><span class="w"> </span>
<a id="__codelineno-290-20" name="__codelineno-290-20"></a><span class="w">    </span><span class="c1">// compile error: overrides B::getName(), which is final</span>
<a id="__codelineno-290-21" name="__codelineno-290-21"></a><span class="p">};</span>
</code></pre></div></td></tr></table></div>
<p>这里类 B 被标注为 final，因此当我们试图让 C 继承 B 时就会出现编译错误。</p>
</div>
</div>
</input></input></div>
</div>
<h4 id="_80">协变返回类型<a class="headerlink" href="#_80" title="Permanent link">¶</a></h4>
<p>在某些情况下，我们希望派生类的覆盖函数能具有与基类函数不同的返回类型，并且仍被视为一个覆盖。如果虚函数的返回类型是指向某些类的指针或引用，那么覆盖函数将可以返回从<em>这个类派生出来的类的指针或引用</em>，并且仍被视为一个覆盖。这称之为<strong>协变返回类型</strong>（covariant return types）。</p>
<div class="admonition example">
<p class="admonition-title">Example</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-291-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-291-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-291-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-291-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-291-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-291-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-291-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-291-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-291-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-291-10">10</a></span>
<span class="normal"><a href="#__codelineno-291-11">11</a></span>
<span class="normal"><a href="#__codelineno-291-12">12</a></span>
<span class="normal"><a href="#__codelineno-291-13">13</a></span>
<span class="normal"><a href="#__codelineno-291-14">14</a></span>
<span class="normal"><a href="#__codelineno-291-15">15</a></span>
<span class="normal"><a href="#__codelineno-291-16">16</a></span>
<span class="normal"><a href="#__codelineno-291-17">17</a></span>
<span class="normal"><a href="#__codelineno-291-18">18</a></span>
<span class="normal"><a href="#__codelineno-291-19">19</a></span>
<span class="normal"><a href="#__codelineno-291-20">20</a></span>
<span class="normal"><a href="#__codelineno-291-21">21</a></span>
<span class="normal"><a href="#__codelineno-291-22">22</a></span>
<span class="normal"><a href="#__codelineno-291-23">23</a></span>
<span class="normal"><a href="#__codelineno-291-24">24</a></span>
<span class="normal"><a href="#__codelineno-291-25">25</a></span>
<span class="normal"><a href="#__codelineno-291-26">26</a></span>
<span class="normal"><a href="#__codelineno-291-27">27</a></span>
<span class="normal"><a href="#__codelineno-291-28">28</a></span>
<span class="normal"><a href="#__codelineno-291-29">29</a></span>
<span class="normal"><a href="#__codelineno-291-30">30</a></span>
<span class="normal"><a href="#__codelineno-291-31">31</a></span>
<span class="normal"><a href="#__codelineno-291-32">32</a></span>
<span class="normal"><a href="#__codelineno-291-33">33</a></span>
<span class="normal"><a href="#__codelineno-291-34">34</a></span>
<span class="normal"><a href="#__codelineno-291-35">35</a></span>
<span class="normal"><a href="#__codelineno-291-36">36</a></span>
<span class="normal"><a href="#__codelineno-291-37">37</a></span>
<span class="normal"><a href="#__codelineno-291-38">38</a></span>
<span class="normal"><a href="#__codelineno-291-39">39</a></span>
<span class="normal"><a href="#__codelineno-291-40">40</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-291-1" name="__codelineno-291-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span>
<a id="__codelineno-291-2" name="__codelineno-291-2"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;string_view&gt;</span>
<a id="__codelineno-291-3" name="__codelineno-291-3"></a>
<a id="__codelineno-291-4" name="__codelineno-291-4"></a><span class="k">class</span><span class="w"> </span><span class="nc">Base</span>
<a id="__codelineno-291-5" name="__codelineno-291-5"></a><span class="p">{</span>
<a id="__codelineno-291-6" name="__codelineno-291-6"></a><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-291-7" name="__codelineno-291-7"></a><span class="w">    </span><span class="c1">// returns a pointer to a Base class</span>
<a id="__codelineno-291-8" name="__codelineno-291-8"></a><span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="n">Base</span><span class="o">*</span><span class="w"> </span><span class="n">getThis</span><span class="p">()</span><span class="w"> </span>
<a id="__codelineno-291-9" name="__codelineno-291-9"></a><span class="w">    </span><span class="p">{</span><span class="w"> </span>
<a id="__codelineno-291-10" name="__codelineno-291-10"></a><span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"called Base::getThis()</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span><span class="w"> </span>
<a id="__codelineno-291-11" name="__codelineno-291-11"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">;</span><span class="w"> </span>
<a id="__codelineno-291-12" name="__codelineno-291-12"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-291-13" name="__codelineno-291-13"></a>
<a id="__codelineno-291-14" name="__codelineno-291-14"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">printType</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"returned a Base</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-291-15" name="__codelineno-291-15"></a><span class="p">};</span>
<a id="__codelineno-291-16" name="__codelineno-291-16"></a>
<a id="__codelineno-291-17" name="__codelineno-291-17"></a><span class="k">class</span><span class="w"> </span><span class="nc">Derived</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">Base</span>
<a id="__codelineno-291-18" name="__codelineno-291-18"></a><span class="p">{</span>
<a id="__codelineno-291-19" name="__codelineno-291-19"></a><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-291-20" name="__codelineno-291-20"></a><span class="w">    </span><span class="c1">// Because Derived is derived from Base, it's okay to return Derived* instead of Base*</span>
<a id="__codelineno-291-21" name="__codelineno-291-21"></a><span class="w">    </span><span class="n">Derived</span><span class="o">*</span><span class="w"> </span><span class="n">getThis</span><span class="p">()</span><span class="w"> </span><span class="k">override</span><span class="w"> </span>
<a id="__codelineno-291-22" name="__codelineno-291-22"></a><span class="w">    </span><span class="p">{</span><span class="w"> </span>
<a id="__codelineno-291-23" name="__codelineno-291-23"></a><span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"called Derived::getThis()</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span><span class="w">  </span>
<a id="__codelineno-291-24" name="__codelineno-291-24"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">;</span><span class="w"> </span>
<a id="__codelineno-291-25" name="__codelineno-291-25"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-291-26" name="__codelineno-291-26"></a>
<a id="__codelineno-291-27" name="__codelineno-291-27"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">printType</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"returned a Derived</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-291-28" name="__codelineno-291-28"></a><span class="p">};</span>
<a id="__codelineno-291-29" name="__codelineno-291-29"></a>
<a id="__codelineno-291-30" name="__codelineno-291-30"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span>
<a id="__codelineno-291-31" name="__codelineno-291-31"></a><span class="p">{</span>
<a id="__codelineno-291-32" name="__codelineno-291-32"></a><span class="w">    </span><span class="n">Derived</span><span class="w"> </span><span class="n">d</span><span class="p">{};</span>
<a id="__codelineno-291-33" name="__codelineno-291-33"></a><span class="w">    </span><span class="n">Base</span><span class="o">*</span><span class="w"> </span><span class="n">b</span><span class="p">{</span><span class="w"> </span><span class="o">&amp;</span><span class="n">d</span><span class="w"> </span><span class="p">};</span>
<a id="__codelineno-291-34" name="__codelineno-291-34"></a><span class="w">    </span><span class="c1">// calls Derived::getThis(), returns a Derived*, calls Derived::printType</span>
<a id="__codelineno-291-35" name="__codelineno-291-35"></a><span class="w">    </span><span class="n">d</span><span class="p">.</span><span class="n">getThis</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">printType</span><span class="p">();</span><span class="w"> </span>
<a id="__codelineno-291-36" name="__codelineno-291-36"></a><span class="w">    </span><span class="c1">// calls Derived::getThis(), returns a Base*, calls Base::printType</span>
<a id="__codelineno-291-37" name="__codelineno-291-37"></a><span class="w">    </span><span class="n">b</span><span class="o">-&gt;</span><span class="n">getThis</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">printType</span><span class="p">();</span><span class="w"> </span>
<a id="__codelineno-291-38" name="__codelineno-291-38"></a>
<a id="__codelineno-291-39" name="__codelineno-291-39"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-291-40" name="__codelineno-291-40"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>这段程序将会输出</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-292-1">1</a></span>
<span class="normal"><a href="#__codelineno-292-2">2</a></span>
<span class="normal"><a href="#__codelineno-292-3">3</a></span>
<span class="normal"><a href="#__codelineno-292-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-292-1" name="__codelineno-292-1"></a>called Derived::getThis()
<a id="__codelineno-292-2" name="__codelineno-292-2"></a>returned a Derived
<a id="__codelineno-292-3" name="__codelineno-292-3"></a>called Derived::getThis()
<a id="__codelineno-292-4" name="__codelineno-292-4"></a>returned a Base
</code></pre></div></td></tr></table></div>
<p>需要强调的是，C++ 无法动态选择类型，因此我们始终将获得与函数调用者相匹配的返回类型。</p>
<p>在上面的示例中，我们首先调用 <code>d.getThis()</code>。由于 d 是 <code>Derived</code> 类的，这将会调用 <code>Derived::getThis()</code>，于是我们得到 <code>Derived*</code>。接着我们使用这个指针调用了 <code>Derived::printType()</code>。</p>
<p>然而，当我们调用 <code>b-&gt;getThis()</code> 时，由于 b 是一个指向了 Derived 类的 Base 指针，而 <code>Base::getThis()</code> 是一个虚函数，所以我们实际上调用的是 <code>Derived::getThis()</code>。这时候有趣的事情就发生了，虽然 <code>Derived::getThis()</code> 返回的类型是 <code>Derived*</code>，但由于我们是通过 <code>Base*</code> 来调用的，我们将收到这个函数在 Base 版本的返回值 <code>Base*</code>。接着我们使用这个 <code>Base*</code> 调用了 <code>Base::printType()</code>，它不是一个虚函数，因此实际上调用的就是它自己，输出 <code>returned a Base</code>。</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>如果 <code>Base::printType()</code> 是一个虚拟函数，那么在第二种情况下被调用的将是 <code>Derived::getThis()</code>。</p>
</div>
</div>
<h3 id="_81">虚析构函数<a class="headerlink" href="#_81" title="Permanent link">¶</a></h3>
<p>当我们没有提供析构函数时，C++ 编译器会为我们的类提供一个默认的析构函数，但有时候我们需要自己定义一个析构函数（尤其是在这个类需要处理动态分配的资源时）。</p>
<p>在继承的语境下，我们始终应该让我们的析构函数是 virtual 的。这是因为当我们 delete 一个指向派生类对象的基类指针时，我们希望调用派生类的析构函数，而不是基类的析构函数。比如下面的这个例子：</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-293-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-293-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-293-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-293-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-293-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-293-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-293-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-293-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-293-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-293-10">10</a></span>
<span class="normal"><a href="#__codelineno-293-11">11</a></span>
<span class="normal"><a href="#__codelineno-293-12">12</a></span>
<span class="normal"><a href="#__codelineno-293-13">13</a></span>
<span class="normal"><a href="#__codelineno-293-14">14</a></span>
<span class="normal"><a href="#__codelineno-293-15">15</a></span>
<span class="normal"><a href="#__codelineno-293-16">16</a></span>
<span class="normal"><a href="#__codelineno-293-17">17</a></span>
<span class="normal"><a href="#__codelineno-293-18">18</a></span>
<span class="normal"><a href="#__codelineno-293-19">19</a></span>
<span class="normal"><a href="#__codelineno-293-20">20</a></span>
<span class="normal"><a href="#__codelineno-293-21">21</a></span>
<span class="normal"><a href="#__codelineno-293-22">22</a></span>
<span class="normal"><a href="#__codelineno-293-23">23</a></span>
<span class="normal"><a href="#__codelineno-293-24">24</a></span>
<span class="normal"><a href="#__codelineno-293-25">25</a></span>
<span class="normal"><a href="#__codelineno-293-26">26</a></span>
<span class="normal"><a href="#__codelineno-293-27">27</a></span>
<span class="normal"><a href="#__codelineno-293-28">28</a></span>
<span class="normal"><a href="#__codelineno-293-29">29</a></span>
<span class="normal"><a href="#__codelineno-293-30">30</a></span>
<span class="normal"><a href="#__codelineno-293-31">31</a></span>
<span class="normal"><a href="#__codelineno-293-32">32</a></span>
<span class="normal"><a href="#__codelineno-293-33">33</a></span>
<span class="normal"><a href="#__codelineno-293-34">34</a></span>
<span class="normal"><a href="#__codelineno-293-35">35</a></span>
<span class="normal"><a href="#__codelineno-293-36">36</a></span>
<span class="normal"><a href="#__codelineno-293-37">37</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-293-1" name="__codelineno-293-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span>
<a id="__codelineno-293-2" name="__codelineno-293-2"></a><span class="k">class</span><span class="w"> </span><span class="nc">Base</span>
<a id="__codelineno-293-3" name="__codelineno-293-3"></a><span class="p">{</span>
<a id="__codelineno-293-4" name="__codelineno-293-4"></a><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-293-5" name="__codelineno-293-5"></a><span class="w">    </span><span class="o">~</span><span class="n">Base</span><span class="p">()</span><span class="w"> </span><span class="c1">// note: not virtual</span>
<a id="__codelineno-293-6" name="__codelineno-293-6"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-293-7" name="__codelineno-293-7"></a><span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"Calling ~Base()</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
<a id="__codelineno-293-8" name="__codelineno-293-8"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-293-9" name="__codelineno-293-9"></a><span class="p">};</span>
<a id="__codelineno-293-10" name="__codelineno-293-10"></a>
<a id="__codelineno-293-11" name="__codelineno-293-11"></a><span class="k">class</span><span class="w"> </span><span class="nc">Derived</span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">Base</span>
<a id="__codelineno-293-12" name="__codelineno-293-12"></a><span class="p">{</span>
<a id="__codelineno-293-13" name="__codelineno-293-13"></a><span class="k">private</span><span class="o">:</span>
<a id="__codelineno-293-14" name="__codelineno-293-14"></a><span class="w">    </span><span class="kt">int</span><span class="o">*</span><span class="w"> </span><span class="n">m_array</span><span class="w"> </span><span class="p">{};</span>
<a id="__codelineno-293-15" name="__codelineno-293-15"></a>
<a id="__codelineno-293-16" name="__codelineno-293-16"></a><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-293-17" name="__codelineno-293-17"></a><span class="w">    </span><span class="n">Derived</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">length</span><span class="p">)</span>
<a id="__codelineno-293-18" name="__codelineno-293-18"></a><span class="w">      </span><span class="o">:</span><span class="w"> </span><span class="n">m_array</span><span class="p">{</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="kt">int</span><span class="p">[</span><span class="n">length</span><span class="p">]</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-293-19" name="__codelineno-293-19"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-293-20" name="__codelineno-293-20"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-293-21" name="__codelineno-293-21"></a>
<a id="__codelineno-293-22" name="__codelineno-293-22"></a><span class="w">    </span><span class="o">~</span><span class="n">Derived</span><span class="p">()</span><span class="w"> </span><span class="c1">// note: not virtual</span>
<a id="__codelineno-293-23" name="__codelineno-293-23"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-293-24" name="__codelineno-293-24"></a><span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"Calling ~Derived()</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
<a id="__codelineno-293-25" name="__codelineno-293-25"></a><span class="w">        </span><span class="k">delete</span><span class="p">[]</span><span class="w"> </span><span class="n">m_array</span><span class="p">;</span>
<a id="__codelineno-293-26" name="__codelineno-293-26"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-293-27" name="__codelineno-293-27"></a><span class="p">};</span>
<a id="__codelineno-293-28" name="__codelineno-293-28"></a>
<a id="__codelineno-293-29" name="__codelineno-293-29"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span>
<a id="__codelineno-293-30" name="__codelineno-293-30"></a><span class="p">{</span>
<a id="__codelineno-293-31" name="__codelineno-293-31"></a><span class="w">    </span><span class="n">Derived</span><span class="o">*</span><span class="w"> </span><span class="n">derived</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Derived</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="w"> </span><span class="p">};</span>
<a id="__codelineno-293-32" name="__codelineno-293-32"></a><span class="w">    </span><span class="n">Base</span><span class="o">*</span><span class="w"> </span><span class="n">base</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">derived</span><span class="w"> </span><span class="p">};</span>
<a id="__codelineno-293-33" name="__codelineno-293-33"></a>
<a id="__codelineno-293-34" name="__codelineno-293-34"></a><span class="w">    </span><span class="k">delete</span><span class="w"> </span><span class="n">base</span><span class="p">;</span>
<a id="__codelineno-293-35" name="__codelineno-293-35"></a>
<a id="__codelineno-293-36" name="__codelineno-293-36"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-293-37" name="__codelineno-293-37"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>因为 base 是一个 Base 指针，当我们对它使用 delete 时，程序发现 Base 的析构函数不是虚函数，因此它只会调用 Base 的析构函数，而不会调用 Derived 的析构函数。这将导致 Derived 类中动态分配的内存泄漏，并输出</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-294-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-294-1" name="__codelineno-294-1"></a>Calling ~Base()
</code></pre></div></td></tr></table></div>
<p>当我们希望调用派生类的析构函数时，我们应该将基类的析构函数声明为虚函数。</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-295-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-295-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-295-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-295-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-295-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-295-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-295-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-295-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-295-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-295-10">10</a></span>
<span class="normal"><a href="#__codelineno-295-11">11</a></span>
<span class="normal"><a href="#__codelineno-295-12">12</a></span>
<span class="normal"><a href="#__codelineno-295-13">13</a></span>
<span class="normal"><a href="#__codelineno-295-14">14</a></span>
<span class="normal"><a href="#__codelineno-295-15">15</a></span>
<span class="normal"><a href="#__codelineno-295-16">16</a></span>
<span class="normal"><a href="#__codelineno-295-17">17</a></span>
<span class="normal"><a href="#__codelineno-295-18">18</a></span>
<span class="normal"><a href="#__codelineno-295-19">19</a></span>
<span class="normal"><a href="#__codelineno-295-20">20</a></span>
<span class="normal"><a href="#__codelineno-295-21">21</a></span>
<span class="normal"><a href="#__codelineno-295-22">22</a></span>
<span class="normal"><a href="#__codelineno-295-23">23</a></span>
<span class="normal"><a href="#__codelineno-295-24">24</a></span>
<span class="normal"><a href="#__codelineno-295-25">25</a></span>
<span class="normal"><a href="#__codelineno-295-26">26</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-295-1" name="__codelineno-295-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">Base</span>
<a id="__codelineno-295-2" name="__codelineno-295-2"></a><span class="p">{</span>
<a id="__codelineno-295-3" name="__codelineno-295-3"></a><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-295-4" name="__codelineno-295-4"></a><span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="o">~</span><span class="n">Base</span><span class="p">()</span><span class="w"> </span><span class="c1">// note: virtual</span>
<a id="__codelineno-295-5" name="__codelineno-295-5"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-295-6" name="__codelineno-295-6"></a><span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"Calling ~Base()</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
<a id="__codelineno-295-7" name="__codelineno-295-7"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-295-8" name="__codelineno-295-8"></a><span class="p">};</span>
<a id="__codelineno-295-9" name="__codelineno-295-9"></a>
<a id="__codelineno-295-10" name="__codelineno-295-10"></a><span class="k">class</span><span class="w"> </span><span class="nc">Derived</span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">Base</span>
<a id="__codelineno-295-11" name="__codelineno-295-11"></a><span class="p">{</span>
<a id="__codelineno-295-12" name="__codelineno-295-12"></a><span class="k">private</span><span class="o">:</span>
<a id="__codelineno-295-13" name="__codelineno-295-13"></a><span class="w">    </span><span class="kt">int</span><span class="o">*</span><span class="w"> </span><span class="n">m_array</span><span class="w"> </span><span class="p">{};</span>
<a id="__codelineno-295-14" name="__codelineno-295-14"></a>
<a id="__codelineno-295-15" name="__codelineno-295-15"></a><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-295-16" name="__codelineno-295-16"></a><span class="w">    </span><span class="n">Derived</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">length</span><span class="p">)</span>
<a id="__codelineno-295-17" name="__codelineno-295-17"></a><span class="w">      </span><span class="o">:</span><span class="w"> </span><span class="n">m_array</span><span class="p">{</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="kt">int</span><span class="p">[</span><span class="n">length</span><span class="p">]</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-295-18" name="__codelineno-295-18"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-295-19" name="__codelineno-295-19"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-295-20" name="__codelineno-295-20"></a>
<a id="__codelineno-295-21" name="__codelineno-295-21"></a><span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="o">~</span><span class="n">Derived</span><span class="p">()</span><span class="w"> </span><span class="c1">// note: virtual</span>
<a id="__codelineno-295-22" name="__codelineno-295-22"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-295-23" name="__codelineno-295-23"></a><span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"Calling ~Derived()</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
<a id="__codelineno-295-24" name="__codelineno-295-24"></a><span class="w">        </span><span class="k">delete</span><span class="p">[]</span><span class="w"> </span><span class="n">m_array</span><span class="p">;</span>
<a id="__codelineno-295-25" name="__codelineno-295-25"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-295-26" name="__codelineno-295-26"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>现在这个动态数组的内存将会被正确地释放，输出</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-296-1">1</a></span>
<span class="normal"><a href="#__codelineno-296-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-296-1" name="__codelineno-296-1"></a>Calling ~Derived()
<a id="__codelineno-296-2" name="__codelineno-296-2"></a>Calling ~Base()
</code></pre></div></td></tr></table></div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>当处理继承关系时，我们应该始终将基类的析构函数显式声明为虚函数。</p>
</div>
<p>就像普通的虚函数一样，如果基类的析构函数是虚函数，那么派生类的析构函数也将自动成为虚函数，因此我们不需要仅仅为了把析构函数标记为 virtual 而在派生类中再次声明一个空的虚析构函数。</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>如果我们希望基类拥有一个空的虚析构函数，我们可以这么定义：</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-297-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-297-1" name="__codelineno-297-1"></a><span class="k">virtual</span><span class="w"> </span><span class="o">~</span><span class="n">Base</span><span class="p">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">default</span><span class="p">;</span><span class="w"> </span><span class="c1">// generate a virtual default destructor</span>
</code></pre></div></td></tr></table></div>
</div>
<h3 id="_82">纯虚函数、抽象类和接口类<a class="headerlink" href="#_82" title="Permanent link">¶</a></h3>
<h4 id="_83">纯虚函数和抽象基类<a class="headerlink" href="#_83" title="Permanent link">¶</a></h4>
<p>C++ 允许我们定义一种没有任何函数体的特殊的虚函数，称为<strong>纯虚函数</strong>（pure virtual function）。纯虚函数相当于一个占位符，它必须被派生类重新定义。</p>
<p>要创建一个纯虚函数，我们只需要将函数赋值为 0。</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-298-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-298-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-298-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-298-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-298-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-298-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-298-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-298-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-298-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-298-10">10</a></span>
<span class="normal"><a href="#__codelineno-298-11">11</a></span>
<span class="normal"><a href="#__codelineno-298-12">12</a></span>
<span class="normal"><a href="#__codelineno-298-13">13</a></span>
<span class="normal"><a href="#__codelineno-298-14">14</a></span>
<span class="normal"><a href="#__codelineno-298-15">15</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-298-1" name="__codelineno-298-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">Base</span>
<a id="__codelineno-298-2" name="__codelineno-298-2"></a><span class="p">{</span>
<a id="__codelineno-298-3" name="__codelineno-298-3"></a><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-298-4" name="__codelineno-298-4"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">string_view</span><span class="w"> </span><span class="n">sayHi</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="s">"Hi"</span><span class="p">;</span><span class="w"> </span><span class="p">}</span><span class="w"> </span>
<a id="__codelineno-298-5" name="__codelineno-298-5"></a><span class="w">    </span><span class="c1">// a normal non-virtual function</span>
<a id="__codelineno-298-6" name="__codelineno-298-6"></a>
<a id="__codelineno-298-7" name="__codelineno-298-7"></a><span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string_view</span><span class="w"> </span><span class="n">getName</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="s">"Base"</span><span class="p">;</span><span class="w"> </span><span class="p">}</span><span class="w"> </span>
<a id="__codelineno-298-8" name="__codelineno-298-8"></a><span class="w">    </span><span class="c1">// a normal virtual function</span>
<a id="__codelineno-298-9" name="__codelineno-298-9"></a>
<a id="__codelineno-298-10" name="__codelineno-298-10"></a><span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">getValue</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span>
<a id="__codelineno-298-11" name="__codelineno-298-11"></a><span class="w">    </span><span class="c1">// a pure virtual function</span>
<a id="__codelineno-298-12" name="__codelineno-298-12"></a>
<a id="__codelineno-298-13" name="__codelineno-298-13"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="nf">doSomething</span><span class="p">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span>
<a id="__codelineno-298-14" name="__codelineno-298-14"></a><span class="w">    </span><span class="c1">// Compile error: can not set non-virtual functions to 0</span>
<a id="__codelineno-298-15" name="__codelineno-298-15"></a><span class="p">};</span>
</code></pre></div></td></tr></table></div>
<p>一个类中包含了至少一个纯虚函数的类称为<strong>抽象基类</strong>（abstract base class）。抽象基类不可被实例化。</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-299-1">1</a></span>
<span class="normal"><a href="#__codelineno-299-2">2</a></span>
<span class="normal"><a href="#__codelineno-299-3">3</a></span>
<span class="normal"><a href="#__codelineno-299-4">4</a></span>
<span class="normal"><a href="#__codelineno-299-5">5</a></span>
<span class="normal"><a href="#__codelineno-299-6">6</a></span>
<span class="normal"><a href="#__codelineno-299-7">7</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-299-1" name="__codelineno-299-1"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span>
<a id="__codelineno-299-2" name="__codelineno-299-2"></a><span class="p">{</span>
<a id="__codelineno-299-3" name="__codelineno-299-3"></a><span class="w">    </span><span class="n">Base</span><span class="w"> </span><span class="n">base</span><span class="w"> </span><span class="p">{};</span><span class="w"> </span><span class="c1">// compile error: can't instantiate an abstract class</span>
<a id="__codelineno-299-4" name="__codelineno-299-4"></a><span class="w">    </span><span class="n">base</span><span class="p">.</span><span class="n">getValue</span><span class="p">();</span><span class="w"> </span>
<a id="__codelineno-299-5" name="__codelineno-299-5"></a>
<a id="__codelineno-299-6" name="__codelineno-299-6"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-299-7" name="__codelineno-299-7"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>任何具有纯虚函数的类也应该具有虚析构函数。</p>
</div>
<details class="extra">
<summary>带有定义的纯虚函数</summary>
<p>事实上我们也可以创建一个具有定义的纯虚函数，只不过这个定义是在类的外部。</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-300-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-300-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-300-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-300-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-300-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-300-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-300-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-300-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-300-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-300-10">10</a></span>
<span class="normal"><a href="#__codelineno-300-11">11</a></span>
<span class="normal"><a href="#__codelineno-300-12">12</a></span>
<span class="normal"><a href="#__codelineno-300-13">13</a></span>
<span class="normal"><a href="#__codelineno-300-14">14</a></span>
<span class="normal"><a href="#__codelineno-300-15">15</a></span>
<span class="normal"><a href="#__codelineno-300-16">16</a></span>
<span class="normal"><a href="#__codelineno-300-17">17</a></span>
<span class="normal"><a href="#__codelineno-300-18">18</a></span>
<span class="normal"><a href="#__codelineno-300-19">19</a></span>
<span class="normal"><a href="#__codelineno-300-20">20</a></span>
<span class="normal"><a href="#__codelineno-300-21">21</a></span>
<span class="normal"><a href="#__codelineno-300-22">22</a></span>
<span class="normal"><a href="#__codelineno-300-23">23</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-300-1" name="__codelineno-300-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span>
<a id="__codelineno-300-2" name="__codelineno-300-2"></a>
<a id="__codelineno-300-3" name="__codelineno-300-3"></a><span class="k">class</span><span class="w"> </span><span class="nc">A</span><span class="w"> </span><span class="c1">// This Animal is an abstract base class</span>
<a id="__codelineno-300-4" name="__codelineno-300-4"></a><span class="p">{</span>
<a id="__codelineno-300-5" name="__codelineno-300-5"></a><span class="k">protected</span><span class="o">:</span>
<a id="__codelineno-300-6" name="__codelineno-300-6"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">m_id</span><span class="w"> </span><span class="p">{};</span>
<a id="__codelineno-300-7" name="__codelineno-300-7"></a>
<a id="__codelineno-300-8" name="__codelineno-300-8"></a><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-300-9" name="__codelineno-300-9"></a><span class="w">    </span><span class="n">A</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">id</span><span class="p">)</span>
<a id="__codelineno-300-10" name="__codelineno-300-10"></a><span class="w">        </span><span class="o">:</span><span class="w"> </span><span class="n">m_id</span><span class="p">{</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-300-11" name="__codelineno-300-11"></a><span class="w">    </span><span class="p">{</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-300-12" name="__codelineno-300-12"></a>
<a id="__codelineno-300-13" name="__codelineno-300-13"></a><span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">getID</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">m_id</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-300-14" name="__codelineno-300-14"></a><span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">getOne</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span>
<a id="__codelineno-300-15" name="__codelineno-300-15"></a><span class="w">    </span><span class="c1">// The = 0 means this function is pure virtual</span>
<a id="__codelineno-300-16" name="__codelineno-300-16"></a>
<a id="__codelineno-300-17" name="__codelineno-300-17"></a><span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="o">~</span><span class="n">A</span><span class="p">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">default</span><span class="p">;</span>
<a id="__codelineno-300-18" name="__codelineno-300-18"></a><span class="p">};</span>
<a id="__codelineno-300-19" name="__codelineno-300-19"></a>
<a id="__codelineno-300-20" name="__codelineno-300-20"></a><span class="kt">int</span><span class="w"> </span><span class="n">A</span><span class="o">::</span><span class="n">getOne</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w">  </span><span class="c1">// even though it has a definition</span>
<a id="__codelineno-300-21" name="__codelineno-300-21"></a><span class="p">{</span>
<a id="__codelineno-300-22" name="__codelineno-300-22"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<a id="__codelineno-300-23" name="__codelineno-300-23"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>这种情况下 <code>getOne()</code> 仍被认为是一个纯虚函数，并且 A 仍被视为一个抽象基类（不可实例化）。继承 A 的所有类都必须为 <code>getOne()</code> 提供一个定义，否则也将被视为抽象基类。</p>
<p>如果我们对基类提供的默认纯虚函数的实现很满意，就可以直接调用抽象基类中的实现，例如：</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-301-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-301-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-301-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-301-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-301-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-301-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-301-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-301-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-301-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-301-10">10</a></span>
<span class="normal"><a href="#__codelineno-301-11">11</a></span>
<span class="normal"><a href="#__codelineno-301-12">12</a></span>
<span class="normal"><a href="#__codelineno-301-13">13</a></span>
<span class="normal"><a href="#__codelineno-301-14">14</a></span>
<span class="normal"><a href="#__codelineno-301-15">15</a></span>
<span class="normal"><a href="#__codelineno-301-16">16</a></span>
<span class="normal"><a href="#__codelineno-301-17">17</a></span>
<span class="normal"><a href="#__codelineno-301-18">18</a></span>
<span class="normal"><a href="#__codelineno-301-19">19</a></span>
<span class="normal"><a href="#__codelineno-301-20">20</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-301-1" name="__codelineno-301-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">B</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">A</span>
<a id="__codelineno-301-2" name="__codelineno-301-2"></a><span class="p">{</span>
<a id="__codelineno-301-3" name="__codelineno-301-3"></a><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-301-4" name="__codelineno-301-4"></a><span class="w">    </span><span class="n">B</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">id</span><span class="p">)</span>
<a id="__codelineno-301-5" name="__codelineno-301-5"></a><span class="w">        </span><span class="o">:</span><span class="w"> </span><span class="n">A</span><span class="p">{</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-301-6" name="__codelineno-301-6"></a><span class="w">    </span><span class="p">{</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-301-7" name="__codelineno-301-7"></a>
<a id="__codelineno-301-8" name="__codelineno-301-8"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">getOne</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="k">override</span>
<a id="__codelineno-301-9" name="__codelineno-301-9"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-301-10" name="__codelineno-301-10"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">A</span><span class="o">::</span><span class="n">getOne</span><span class="p">();</span>
<a id="__codelineno-301-11" name="__codelineno-301-11"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-301-12" name="__codelineno-301-12"></a><span class="p">};</span>
<a id="__codelineno-301-13" name="__codelineno-301-13"></a>
<a id="__codelineno-301-14" name="__codelineno-301-14"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span>
<a id="__codelineno-301-15" name="__codelineno-301-15"></a><span class="p">{</span>
<a id="__codelineno-301-16" name="__codelineno-301-16"></a><span class="w">    </span><span class="n">B</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="p">{</span><span class="mi">111</span><span class="p">};</span>
<a id="__codelineno-301-17" name="__codelineno-301-17"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">getID</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">" "</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">getOne</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="sc">'\n'</span><span class="p">;</span>
<a id="__codelineno-301-18" name="__codelineno-301-18"></a>
<a id="__codelineno-301-19" name="__codelineno-301-19"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-301-20" name="__codelineno-301-20"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
</details>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>析构函数也可以是纯虚的，但必须给出一个定义，以便于在销毁派生类对象时调用它。</p>
</div>
<h4 id="_84">接口类<a class="headerlink" href="#_84" title="Permanent link">¶</a></h4>
<p><strong>接口类</strong>（interface class）是一个没有成员变量的类，并且所有的函数都是纯虚的。</p>
<p>接口类有时以 I 开头来命名，例如</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-302-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-302-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-302-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-302-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-302-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-302-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-302-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-302-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-302-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-302-10">10</a></span>
<span class="normal"><a href="#__codelineno-302-11">11</a></span>
<span class="normal"><a href="#__codelineno-302-12">12</a></span>
<span class="normal"><a href="#__codelineno-302-13">13</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-302-1" name="__codelineno-302-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;string_view&gt;</span>
<a id="__codelineno-302-2" name="__codelineno-302-2"></a>
<a id="__codelineno-302-3" name="__codelineno-302-3"></a><span class="k">class</span><span class="w"> </span><span class="nc">IErrorLog</span>
<a id="__codelineno-302-4" name="__codelineno-302-4"></a><span class="p">{</span>
<a id="__codelineno-302-5" name="__codelineno-302-5"></a><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-302-6" name="__codelineno-302-6"></a><span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="n">openLog</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">string_view</span><span class="w"> </span><span class="n">filename</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-302-7" name="__codelineno-302-7"></a><span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="nf">closeLog</span><span class="p">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-302-8" name="__codelineno-302-8"></a>
<a id="__codelineno-302-9" name="__codelineno-302-9"></a><span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="nf">writeError</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">string_view</span><span class="w"> </span><span class="n">errorMessage</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-302-10" name="__codelineno-302-10"></a>
<a id="__codelineno-302-11" name="__codelineno-302-11"></a><span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="o">~</span><span class="n">IErrorLog</span><span class="p">()</span><span class="w"> </span><span class="p">{}</span><span class="w"> </span>
<a id="__codelineno-302-12" name="__codelineno-302-12"></a><span class="w">    </span><span class="c1">// 不要忘记在接口类中包含虚析构函数</span>
<a id="__codelineno-302-13" name="__codelineno-302-13"></a><span class="p">};</span>
</code></pre></div></td></tr></table></div>
<div class="admonition info">
<p class="admonition-title">面向对象语言中的接口类</p>
<p>在 Java 和 C# 等现代的编程语言中具有 interface 关键字，以便于直接定义接口类。虽然 Java 和 C# 不允许在普通的类上使用多继承，但它们允许类继承多个接口类。由于接口类中没有成员变量，也没有函数体，这避免了多继承带来的许多问题，同时也为类的应用提供了较多的灵活性。 </p>
</div>
<h3 id="dynamic-casting">dynamic casting<a class="headerlink" href="#dynamic-casting" title="Permanent link">¶</a></h3>
<p>C++ 允许隐式地将指向派生类的指针转换为指向基类的指针，如 <code>Derived*</code> 变为 <code>Base*</code>，这个构成有时称为 upcasting。反之，将指向基类的指针类型转换为指向派生类的指针称为 downcasting。</p>
<h4 id="dynamic_cast">dynamic_cast<a class="headerlink" href="#dynamic_cast" title="Permanent link">¶</a></h4>
<p>操作符 <code>dynamic_cast</code> 具有几种不同的功能，但它主要的用途就是用于实现 downcasting。<code>dynamic_cast</code> 会检查转换是否有效，如果有效，它将返回一个指向派生类对象的指针，否则返回一个空指针。</p>
<details class="example" open="open">
<summary>Example</summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-303-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-303-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-303-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-303-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-303-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-303-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-303-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-303-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-303-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-303-10">10</a></span>
<span class="normal"><a href="#__codelineno-303-11">11</a></span>
<span class="normal"><a href="#__codelineno-303-12">12</a></span>
<span class="normal"><a href="#__codelineno-303-13">13</a></span>
<span class="normal"><a href="#__codelineno-303-14">14</a></span>
<span class="normal"><a href="#__codelineno-303-15">15</a></span>
<span class="normal"><a href="#__codelineno-303-16">16</a></span>
<span class="normal"><a href="#__codelineno-303-17">17</a></span>
<span class="normal"><a href="#__codelineno-303-18">18</a></span>
<span class="normal"><a href="#__codelineno-303-19">19</a></span>
<span class="normal"><a href="#__codelineno-303-20">20</a></span>
<span class="normal"><a href="#__codelineno-303-21">21</a></span>
<span class="normal"><a href="#__codelineno-303-22">22</a></span>
<span class="normal"><a href="#__codelineno-303-23">23</a></span>
<span class="normal"><a href="#__codelineno-303-24">24</a></span>
<span class="normal"><a href="#__codelineno-303-25">25</a></span>
<span class="normal"><a href="#__codelineno-303-26">26</a></span>
<span class="normal"><a href="#__codelineno-303-27">27</a></span>
<span class="normal"><a href="#__codelineno-303-28">28</a></span>
<span class="normal"><a href="#__codelineno-303-29">29</a></span>
<span class="normal"><a href="#__codelineno-303-30">30</a></span>
<span class="normal"><a href="#__codelineno-303-31">31</a></span>
<span class="normal"><a href="#__codelineno-303-32">32</a></span>
<span class="normal"><a href="#__codelineno-303-33">33</a></span>
<span class="normal"><a href="#__codelineno-303-34">34</a></span>
<span class="normal"><a href="#__codelineno-303-35">35</a></span>
<span class="normal"><a href="#__codelineno-303-36">36</a></span>
<span class="normal"><a href="#__codelineno-303-37">37</a></span>
<span class="normal"><a href="#__codelineno-303-38">38</a></span>
<span class="normal"><a href="#__codelineno-303-39">39</a></span>
<span class="normal"><a href="#__codelineno-303-40">40</a></span>
<span class="normal"><a href="#__codelineno-303-41">41</a></span>
<span class="normal"><a href="#__codelineno-303-42">42</a></span>
<span class="normal"><a href="#__codelineno-303-43">43</a></span>
<span class="normal"><a href="#__codelineno-303-44">44</a></span>
<span class="normal"><a href="#__codelineno-303-45">45</a></span>
<span class="normal"><a href="#__codelineno-303-46">46</a></span>
<span class="normal"><a href="#__codelineno-303-47">47</a></span>
<span class="normal"><a href="#__codelineno-303-48">48</a></span>
<span class="normal"><a href="#__codelineno-303-49">49</a></span>
<span class="normal"><a href="#__codelineno-303-50">50</a></span>
<span class="normal"><a href="#__codelineno-303-51">51</a></span>
<span class="normal"><a href="#__codelineno-303-52">52</a></span>
<span class="normal"><a href="#__codelineno-303-53">53</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-303-1" name="__codelineno-303-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span>
<a id="__codelineno-303-2" name="__codelineno-303-2"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;string&gt;</span>
<a id="__codelineno-303-3" name="__codelineno-303-3"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;string_view&gt;</span>
<a id="__codelineno-303-4" name="__codelineno-303-4"></a>
<a id="__codelineno-303-5" name="__codelineno-303-5"></a><span class="k">class</span><span class="w"> </span><span class="nc">Base</span>
<a id="__codelineno-303-6" name="__codelineno-303-6"></a><span class="p">{</span>
<a id="__codelineno-303-7" name="__codelineno-303-7"></a><span class="k">protected</span><span class="o">:</span>
<a id="__codelineno-303-8" name="__codelineno-303-8"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">m_value</span><span class="p">{};</span>
<a id="__codelineno-303-9" name="__codelineno-303-9"></a>
<a id="__codelineno-303-10" name="__codelineno-303-10"></a><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-303-11" name="__codelineno-303-11"></a><span class="w">    </span><span class="n">Base</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">value</span><span class="p">)</span>
<a id="__codelineno-303-12" name="__codelineno-303-12"></a><span class="w">        </span><span class="o">:</span><span class="w"> </span><span class="n">m_value</span><span class="p">{</span><span class="n">value</span><span class="p">}</span>
<a id="__codelineno-303-13" name="__codelineno-303-13"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-303-14" name="__codelineno-303-14"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-303-15" name="__codelineno-303-15"></a>
<a id="__codelineno-303-16" name="__codelineno-303-16"></a><span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="o">~</span><span class="n">Base</span><span class="p">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">default</span><span class="p">;</span>
<a id="__codelineno-303-17" name="__codelineno-303-17"></a><span class="p">};</span>
<a id="__codelineno-303-18" name="__codelineno-303-18"></a>
<a id="__codelineno-303-19" name="__codelineno-303-19"></a><span class="k">class</span><span class="w"> </span><span class="nc">Derived</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">Base</span>
<a id="__codelineno-303-20" name="__codelineno-303-20"></a><span class="p">{</span>
<a id="__codelineno-303-21" name="__codelineno-303-21"></a><span class="k">protected</span><span class="o">:</span>
<a id="__codelineno-303-22" name="__codelineno-303-22"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">m_name</span><span class="p">{};</span>
<a id="__codelineno-303-23" name="__codelineno-303-23"></a>
<a id="__codelineno-303-24" name="__codelineno-303-24"></a><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-303-25" name="__codelineno-303-25"></a><span class="w">    </span><span class="n">Derived</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">value</span><span class="p">,</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string_view</span><span class="w"> </span><span class="n">name</span><span class="p">)</span>
<a id="__codelineno-303-26" name="__codelineno-303-26"></a><span class="w">        </span><span class="o">:</span><span class="w"> </span><span class="n">Base</span><span class="p">{</span><span class="n">value</span><span class="p">},</span><span class="w"> </span><span class="n">m_name</span><span class="p">{</span><span class="n">name</span><span class="p">}</span>
<a id="__codelineno-303-27" name="__codelineno-303-27"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-303-28" name="__codelineno-303-28"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-303-29" name="__codelineno-303-29"></a>
<a id="__codelineno-303-30" name="__codelineno-303-30"></a><span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">getName</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">m_name</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-303-31" name="__codelineno-303-31"></a><span class="p">};</span>
<a id="__codelineno-303-32" name="__codelineno-303-32"></a>
<a id="__codelineno-303-33" name="__codelineno-303-33"></a><span class="n">Base</span><span class="o">*</span><span class="w"> </span><span class="nf">getObject</span><span class="p">(</span><span class="kt">bool</span><span class="w"> </span><span class="n">returnDerived</span><span class="p">)</span>
<a id="__codelineno-303-34" name="__codelineno-303-34"></a><span class="p">{</span>
<a id="__codelineno-303-35" name="__codelineno-303-35"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">returnDerived</span><span class="p">)</span>
<a id="__codelineno-303-36" name="__codelineno-303-36"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Derived</span><span class="p">{</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="s">"Apple"</span><span class="p">};</span>
<a id="__codelineno-303-37" name="__codelineno-303-37"></a><span class="w">    </span><span class="k">else</span>
<a id="__codelineno-303-38" name="__codelineno-303-38"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Base</span><span class="p">{</span><span class="mi">2</span><span class="p">};</span>
<a id="__codelineno-303-39" name="__codelineno-303-39"></a><span class="p">}</span>
<a id="__codelineno-303-40" name="__codelineno-303-40"></a>
<a id="__codelineno-303-41" name="__codelineno-303-41"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span>
<a id="__codelineno-303-42" name="__codelineno-303-42"></a><span class="p">{</span>
<a id="__codelineno-303-43" name="__codelineno-303-43"></a><span class="w">    </span><span class="n">Base</span><span class="o">*</span><span class="w"> </span><span class="n">b</span><span class="p">{</span><span class="w"> </span><span class="n">getObject</span><span class="p">(</span><span class="nb">true</span><span class="p">)</span><span class="w"> </span><span class="p">};</span>
<a id="__codelineno-303-44" name="__codelineno-303-44"></a>
<a id="__codelineno-303-45" name="__codelineno-303-45"></a><span class="w">    </span><span class="n">Derived</span><span class="o">*</span><span class="w"> </span><span class="n">d</span><span class="p">{</span><span class="w"> </span><span class="k">dynamic_cast</span><span class="o">&lt;</span><span class="n">Derived</span><span class="o">*&gt;</span><span class="p">(</span><span class="n">b</span><span class="p">)</span><span class="w"> </span><span class="p">};</span><span class="w"> </span>
<a id="__codelineno-303-46" name="__codelineno-303-46"></a><span class="w">    </span><span class="c1">// use dynamic cast to convert Base pointer into Derived pointer</span>
<a id="__codelineno-303-47" name="__codelineno-303-47"></a>
<a id="__codelineno-303-48" name="__codelineno-303-48"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"The name of the Derived is: "</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">d</span><span class="o">-&gt;</span><span class="n">getName</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="sc">'\n'</span><span class="p">;</span>
<a id="__codelineno-303-49" name="__codelineno-303-49"></a>
<a id="__codelineno-303-50" name="__codelineno-303-50"></a><span class="w">    </span><span class="k">delete</span><span class="w"> </span><span class="n">b</span><span class="p">;</span>
<a id="__codelineno-303-51" name="__codelineno-303-51"></a>
<a id="__codelineno-303-52" name="__codelineno-303-52"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-303-53" name="__codelineno-303-53"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
</details>
<p>上面这个例子之所以起作用，是因为 b 实际上指向的对象确实是一个 <code>Derived</code> 对象，因此进行 dynamic_cast 不会出现问题。但是这里我们实际上做出了一个假设：假设 b 指向的对象确实是一个 <code>Derived</code> 对象。如果这个假设不成立，那么 dynamic_cast 将失败，它会返回一个空指针 nullptr。</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>dynamic_cast 成功时，返回一个指向派生类对象的指针；失败时，返回 nullptr。</p>
</div>
<p>为了让上面这个程序更安全，我们最好确保 dynamic_cast 确实成功了</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-304-1">1</a></span>
<span class="normal"><a href="#__codelineno-304-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-304-1" name="__codelineno-304-1"></a><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
<a id="__codelineno-304-2" name="__codelineno-304-2"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"The name of the Derived is: "</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">d</span><span class="o">-&gt;</span><span class="n">getName</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="sc">'\n'</span><span class="p">;</span>
</code></pre></div></td></tr></table></div>
<h4 id="static_cast-downcasting">使用 static_cast 进行 downcasting<a class="headerlink" href="#static_cast-downcasting" title="Permanent link">¶</a></h4>
<p><code>static_cast</code> 也可以用于 downcasting，它的区别在于 <code>static_cast</code> 不会检查转换是否有效，这让它更加快速，但也更加危险。如果这个指针指向的不是一个派生类对象，那么利用 <code>static_cast</code> 去访问派生类的成员将会导致未定义行为。</p>
<ul>
<li>我们最好仅在非常非常确定要进行转换的指针是指向派生类对象时才使用 <code>static_cast</code>。</li>
</ul>
<h4 id="dynamic_cast_1">dynamic_cast 与参考<a class="headerlink" href="#dynamic_cast_1" title="Permanent link">¶</a></h4>
<p>dynamic_cast 也可用于对参考的转换，但由于不存在所谓的“空参考”，因此如果转换失败，dynamic_cast 将抛出一个类型为 std::bad_cast 的异常。</p>
<hr/>
<h2 id="_85">异常<a class="headerlink" href="#_85" title="Permanent link">¶</a></h2>
<h3 id="_86">基本的异常处理<a class="headerlink" href="#_86" title="Permanent link">¶</a></h3>
<p>C++ 中的异常处理通常通过三个关键字来实现：<code>try</code>、<code>catch</code> 和 <code>throw</code>。</p>
<p>throw 语句用于发出信号，表示出现了异常或错误情况。throw 后面可以跟任何数据类型的值，通常是一个异常对象，但也可以是错误代码、问题描述、自定义的异常类等。</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-305-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-305-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-305-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-305-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-305-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-305-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-305-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-305-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-305-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-305-10">10</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-305-1" name="__codelineno-305-1"></a><span class="c1">// throw a literal integer value</span>
<a id="__codelineno-305-2" name="__codelineno-305-2"></a><span class="k">throw</span><span class="w"> </span><span class="mi">-1</span><span class="p">;</span>
<a id="__codelineno-305-3" name="__codelineno-305-3"></a><span class="c1">// throw an enum value</span>
<a id="__codelineno-305-4" name="__codelineno-305-4"></a><span class="k">throw</span><span class="w"> </span><span class="n">ENUM_INVALID_INDEX</span><span class="p">;</span><span class="w"> </span>
<a id="__codelineno-305-5" name="__codelineno-305-5"></a><span class="c1">// a literal C-style (const char*) string</span>
<a id="__codelineno-305-6" name="__codelineno-305-6"></a><span class="k">throw</span><span class="w"> </span><span class="s">"Can not take square root of negative number"</span><span class="p">;</span><span class="w"> </span>
<a id="__codelineno-305-7" name="__codelineno-305-7"></a><span class="c1">// throw a double variable that was previously defined</span>
<a id="__codelineno-305-8" name="__codelineno-305-8"></a><span class="k">throw</span><span class="w"> </span><span class="n">dX</span><span class="p">;</span><span class="w"> </span>
<a id="__codelineno-305-9" name="__codelineno-305-9"></a><span class="c1">// Throw an object of class MyException</span>
<a id="__codelineno-305-10" name="__codelineno-305-10"></a><span class="k">throw</span><span class="w"> </span><span class="n">MyException</span><span class="p">(</span><span class="s">"Fatal Error"</span><span class="p">);</span><span class="w"> </span>
</code></pre></div></td></tr></table></div>
<p>我们使用 try 关键字来定义一个语句块（称为 try 块），其中包含可能会抛出异常的代码。如果在 try 块中检测到了被抛出的异常，那么程序将跳转到与异常匹配的 catch 块。</p>
<p>try 块后面可以跟一个或多个 catch 块，每个 catch 块都是一个异常处理程序，用于处理特定类型的异常。一旦异常被 catch 块所捕获，就认为这个异常已经被处理，程序将从紧跟在最后一个 catch 块后面的代码开始继续执行。</p>
<p>catch 块参数的工作方式与函数参数类似，它们是用来接收被抛出的异常的。捕获到的参数可以在 catch 块中使用，如果不需要使用，可以省略参数名。</p>
<ul>
<li>基本类型的异常可以通过值捕获，其它类型的异常应该通过 const 引用捕获，以避免不必要的复制。</li>
<li>异常不会进行隐式类型转换，因此 int 类型的异常不会被一个 double 类型的 catch 块捕获。</li>
</ul>
<details class="example">
<summary>Example</summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-306-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-306-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-306-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-306-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-306-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-306-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-306-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-306-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-306-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-306-10">10</a></span>
<span class="normal"><a href="#__codelineno-306-11">11</a></span>
<span class="normal"><a href="#__codelineno-306-12">12</a></span>
<span class="normal"><a href="#__codelineno-306-13">13</a></span>
<span class="normal"><a href="#__codelineno-306-14">14</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-306-1" name="__codelineno-306-1"></a><span class="k">try</span>
<a id="__codelineno-306-2" name="__codelineno-306-2"></a><span class="p">{</span>
<a id="__codelineno-306-3" name="__codelineno-306-3"></a><span class="w">    </span><span class="k">throw</span><span class="w"> </span><span class="mi">-1</span><span class="p">;</span><span class="w"> </span><span class="c1">// here's a trivial throw statement</span>
<a id="__codelineno-306-4" name="__codelineno-306-4"></a><span class="p">}</span><span class="w"> </span>
<a id="__codelineno-306-5" name="__codelineno-306-5"></a><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="kt">double</span><span class="p">)</span><span class="w"> </span><span class="c1">// note: no variable name since we don't use it in the catch block below</span>
<a id="__codelineno-306-6" name="__codelineno-306-6"></a><span class="p">{</span>
<a id="__codelineno-306-7" name="__codelineno-306-7"></a><span class="w">    </span><span class="c1">// Handle exception of type double here</span>
<a id="__codelineno-306-8" name="__codelineno-306-8"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cerr</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"We caught an exception of type double</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
<a id="__codelineno-306-9" name="__codelineno-306-9"></a><span class="p">}</span>
<a id="__codelineno-306-10" name="__codelineno-306-10"></a><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="c1">// catch an exception of type int</span>
<a id="__codelineno-306-11" name="__codelineno-306-11"></a><span class="p">{</span>
<a id="__codelineno-306-12" name="__codelineno-306-12"></a><span class="w">    </span><span class="c1">// Handle exception of type int here</span>
<a id="__codelineno-306-13" name="__codelineno-306-13"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cerr</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"We caught an exception of type int: "</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="sc">'\n'</span><span class="p">;</span>
<a id="__codelineno-306-14" name="__codelineno-306-14"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
</details>
<h3 id="_87">异常处理的堆栈展开<a class="headerlink" href="#_87" title="Permanent link">¶</a></h3>
<p>在异常处理中一个相当有用的特性是，try 块不仅捕获 try 块内的语句直接 throw 出来的异常，还捕获 try 块内调用的函数产生的异常。</p>
<ul>
<li>当异常被抛出时，程序首先查看是否可以在当前函数内立即处理该异常（即该异常就在当前函数的 try 块内抛出），如果可以，程序将跳转到与异常匹配的 catch 块。</li>
<li>如果没有，当前函数会从调用堆栈上被移除（展开堆栈），程序会查看这个函数的调用者（call stack 上的下一个函数）是否可以处理异常。<ul>
<li>这要求该当前函数的调用处于调用者的 try 块内，如果是，程序将跳转到调用者的 catch 块。</li>
<li>否则，就继续把异常向上传递，直到找到一个可以处理异常的 catch 块，或到达调用堆栈的顶部（main 函数）为止。</li>
</ul>
</li>
<li>如果在 main 函数里也没有把异常处理掉，那么程序将会终止。</li>
</ul>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>展开堆栈（unwinding the stack）的过程会销毁函数中的局部变量，这会调用局部变量的析构函数。这意味着即使异常被捕获，局部变量也会被销毁。</p>
</div>
<details class="example" open="open">
<summary>Example</summary>
<p>在这个例子中，main() 调用 A()，A() 调用 B()，B() 调用 C()，C() 调用 D()，D() 抛出一个异常。</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-307-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-307-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-307-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-307-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-307-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-307-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-307-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-307-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-307-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-307-10">10</a></span>
<span class="normal"><a href="#__codelineno-307-11">11</a></span>
<span class="normal"><a href="#__codelineno-307-12">12</a></span>
<span class="normal"><a href="#__codelineno-307-13">13</a></span>
<span class="normal"><a href="#__codelineno-307-14">14</a></span>
<span class="normal"><a href="#__codelineno-307-15">15</a></span>
<span class="normal"><a href="#__codelineno-307-16">16</a></span>
<span class="normal"><a href="#__codelineno-307-17">17</a></span>
<span class="normal"><a href="#__codelineno-307-18">18</a></span>
<span class="normal"><a href="#__codelineno-307-19">19</a></span>
<span class="normal"><a href="#__codelineno-307-20">20</a></span>
<span class="normal"><a href="#__codelineno-307-21">21</a></span>
<span class="normal"><a href="#__codelineno-307-22">22</a></span>
<span class="normal"><a href="#__codelineno-307-23">23</a></span>
<span class="normal"><a href="#__codelineno-307-24">24</a></span>
<span class="normal"><a href="#__codelineno-307-25">25</a></span>
<span class="normal"><a href="#__codelineno-307-26">26</a></span>
<span class="normal"><a href="#__codelineno-307-27">27</a></span>
<span class="normal"><a href="#__codelineno-307-28">28</a></span>
<span class="normal"><a href="#__codelineno-307-29">29</a></span>
<span class="normal"><a href="#__codelineno-307-30">30</a></span>
<span class="normal"><a href="#__codelineno-307-31">31</a></span>
<span class="normal"><a href="#__codelineno-307-32">32</a></span>
<span class="normal"><a href="#__codelineno-307-33">33</a></span>
<span class="normal"><a href="#__codelineno-307-34">34</a></span>
<span class="normal"><a href="#__codelineno-307-35">35</a></span>
<span class="normal"><a href="#__codelineno-307-36">36</a></span>
<span class="normal"><a href="#__codelineno-307-37">37</a></span>
<span class="normal"><a href="#__codelineno-307-38">38</a></span>
<span class="normal"><a href="#__codelineno-307-39">39</a></span>
<span class="normal"><a href="#__codelineno-307-40">40</a></span>
<span class="normal"><a href="#__codelineno-307-41">41</a></span>
<span class="normal"><a href="#__codelineno-307-42">42</a></span>
<span class="normal"><a href="#__codelineno-307-43">43</a></span>
<span class="normal"><a href="#__codelineno-307-44">44</a></span>
<span class="normal"><a href="#__codelineno-307-45">45</a></span>
<span class="normal"><a href="#__codelineno-307-46">46</a></span>
<span class="normal"><a href="#__codelineno-307-47">47</a></span>
<span class="normal"><a href="#__codelineno-307-48">48</a></span>
<span class="normal"><a href="#__codelineno-307-49">49</a></span>
<span class="normal"><a href="#__codelineno-307-50">50</a></span>
<span class="normal"><a href="#__codelineno-307-51">51</a></span>
<span class="normal"><a href="#__codelineno-307-52">52</a></span>
<span class="normal"><a href="#__codelineno-307-53">53</a></span>
<span class="normal"><a href="#__codelineno-307-54">54</a></span>
<span class="normal"><a href="#__codelineno-307-55">55</a></span>
<span class="normal"><a href="#__codelineno-307-56">56</a></span>
<span class="normal"><a href="#__codelineno-307-57">57</a></span>
<span class="normal"><a href="#__codelineno-307-58">58</a></span>
<span class="normal"><a href="#__codelineno-307-59">59</a></span>
<span class="normal"><a href="#__codelineno-307-60">60</a></span>
<span class="normal"><a href="#__codelineno-307-61">61</a></span>
<span class="normal"><a href="#__codelineno-307-62">62</a></span>
<span class="normal"><a href="#__codelineno-307-63">63</a></span>
<span class="normal"><a href="#__codelineno-307-64">64</a></span>
<span class="normal"><a href="#__codelineno-307-65">65</a></span>
<span class="normal"><a href="#__codelineno-307-66">66</a></span>
<span class="normal"><a href="#__codelineno-307-67">67</a></span>
<span class="normal"><a href="#__codelineno-307-68">68</a></span>
<span class="normal"><a href="#__codelineno-307-69">69</a></span>
<span class="normal"><a href="#__codelineno-307-70">70</a></span>
<span class="normal"><a href="#__codelineno-307-71">71</a></span>
<span class="normal"><a href="#__codelineno-307-72">72</a></span>
<span class="normal"><a href="#__codelineno-307-73">73</a></span>
<span class="normal"><a href="#__codelineno-307-74">74</a></span>
<span class="normal"><a href="#__codelineno-307-75">75</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-307-1" name="__codelineno-307-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span>
<a id="__codelineno-307-2" name="__codelineno-307-2"></a>
<a id="__codelineno-307-3" name="__codelineno-307-3"></a><span class="kt">void</span><span class="w"> </span><span class="nf">D</span><span class="p">()</span><span class="w"> </span><span class="c1">// called by C()</span>
<a id="__codelineno-307-4" name="__codelineno-307-4"></a><span class="p">{</span>
<a id="__codelineno-307-5" name="__codelineno-307-5"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"Start D</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
<a id="__codelineno-307-6" name="__codelineno-307-6"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"D throwing int exception</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
<a id="__codelineno-307-7" name="__codelineno-307-7"></a>
<a id="__codelineno-307-8" name="__codelineno-307-8"></a><span class="w">    </span><span class="k">throw</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<a id="__codelineno-307-9" name="__codelineno-307-9"></a>
<a id="__codelineno-307-10" name="__codelineno-307-10"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"End D</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span><span class="w"> </span><span class="c1">// skipped over</span>
<a id="__codelineno-307-11" name="__codelineno-307-11"></a><span class="p">}</span>
<a id="__codelineno-307-12" name="__codelineno-307-12"></a>
<a id="__codelineno-307-13" name="__codelineno-307-13"></a><span class="kt">void</span><span class="w"> </span><span class="nf">C</span><span class="p">()</span><span class="w"> </span><span class="c1">// called by B()</span>
<a id="__codelineno-307-14" name="__codelineno-307-14"></a><span class="p">{</span>
<a id="__codelineno-307-15" name="__codelineno-307-15"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"Start C</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
<a id="__codelineno-307-16" name="__codelineno-307-16"></a><span class="w">    </span><span class="n">D</span><span class="p">();</span>
<a id="__codelineno-307-17" name="__codelineno-307-17"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"End C</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
<a id="__codelineno-307-18" name="__codelineno-307-18"></a><span class="p">}</span>
<a id="__codelineno-307-19" name="__codelineno-307-19"></a>
<a id="__codelineno-307-20" name="__codelineno-307-20"></a><span class="kt">void</span><span class="w"> </span><span class="nf">B</span><span class="p">()</span><span class="w"> </span><span class="c1">// called by A()</span>
<a id="__codelineno-307-21" name="__codelineno-307-21"></a><span class="p">{</span>
<a id="__codelineno-307-22" name="__codelineno-307-22"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"Start B</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
<a id="__codelineno-307-23" name="__codelineno-307-23"></a>
<a id="__codelineno-307-24" name="__codelineno-307-24"></a><span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-307-25" name="__codelineno-307-25"></a><span class="w">        </span><span class="n">C</span><span class="p">();</span>
<a id="__codelineno-307-26" name="__codelineno-307-26"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-307-27" name="__codelineno-307-27"></a><span class="w">    </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="kt">double</span><span class="p">)</span><span class="w"> </span><span class="c1">// not caught: exception type mismatch</span>
<a id="__codelineno-307-28" name="__codelineno-307-28"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-307-29" name="__codelineno-307-29"></a><span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">cerr</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"B caught double exception</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
<a id="__codelineno-307-30" name="__codelineno-307-30"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-307-31" name="__codelineno-307-31"></a>
<a id="__codelineno-307-32" name="__codelineno-307-32"></a><span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-307-33" name="__codelineno-307-33"></a><span class="w">    </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="c1">// not caught: exception not thrown within try</span>
<a id="__codelineno-307-34" name="__codelineno-307-34"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-307-35" name="__codelineno-307-35"></a><span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">cerr</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"B caught int exception</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
<a id="__codelineno-307-36" name="__codelineno-307-36"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-307-37" name="__codelineno-307-37"></a>
<a id="__codelineno-307-38" name="__codelineno-307-38"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"End B</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
<a id="__codelineno-307-39" name="__codelineno-307-39"></a><span class="p">}</span>
<a id="__codelineno-307-40" name="__codelineno-307-40"></a>
<a id="__codelineno-307-41" name="__codelineno-307-41"></a><span class="kt">void</span><span class="w"> </span><span class="nf">A</span><span class="p">()</span><span class="w"> </span><span class="c1">// called by main()</span>
<a id="__codelineno-307-42" name="__codelineno-307-42"></a><span class="p">{</span>
<a id="__codelineno-307-43" name="__codelineno-307-43"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"Start A</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
<a id="__codelineno-307-44" name="__codelineno-307-44"></a>
<a id="__codelineno-307-45" name="__codelineno-307-45"></a><span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-307-46" name="__codelineno-307-46"></a><span class="w">        </span><span class="n">B</span><span class="p">();</span>
<a id="__codelineno-307-47" name="__codelineno-307-47"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-307-48" name="__codelineno-307-48"></a><span class="w">    </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="c1">// exception caught here and handled</span>
<a id="__codelineno-307-49" name="__codelineno-307-49"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-307-50" name="__codelineno-307-50"></a><span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">cerr</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"A caught int exception</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
<a id="__codelineno-307-51" name="__codelineno-307-51"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-307-52" name="__codelineno-307-52"></a><span class="w">    </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="kt">double</span><span class="p">)</span><span class="w"> </span><span class="c1">// not called because exception was handled by prior catch block</span>
<a id="__codelineno-307-53" name="__codelineno-307-53"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-307-54" name="__codelineno-307-54"></a><span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">cerr</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"A caught double exception</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
<a id="__codelineno-307-55" name="__codelineno-307-55"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-307-56" name="__codelineno-307-56"></a>
<a id="__codelineno-307-57" name="__codelineno-307-57"></a><span class="w">    </span><span class="c1">// execution continues here after the exception is handled</span>
<a id="__codelineno-307-58" name="__codelineno-307-58"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"End A</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
<a id="__codelineno-307-59" name="__codelineno-307-59"></a><span class="p">}</span>
<a id="__codelineno-307-60" name="__codelineno-307-60"></a>
<a id="__codelineno-307-61" name="__codelineno-307-61"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span>
<a id="__codelineno-307-62" name="__codelineno-307-62"></a><span class="p">{</span>
<a id="__codelineno-307-63" name="__codelineno-307-63"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"Start main</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
<a id="__codelineno-307-64" name="__codelineno-307-64"></a>
<a id="__codelineno-307-65" name="__codelineno-307-65"></a><span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-307-66" name="__codelineno-307-66"></a><span class="w">        </span><span class="n">A</span><span class="p">();</span>
<a id="__codelineno-307-67" name="__codelineno-307-67"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-307-68" name="__codelineno-307-68"></a><span class="w">    </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="c1">// not called because exception was handled by A</span>
<a id="__codelineno-307-69" name="__codelineno-307-69"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-307-70" name="__codelineno-307-70"></a><span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">cerr</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"main caught int exception</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
<a id="__codelineno-307-71" name="__codelineno-307-71"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-307-72" name="__codelineno-307-72"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"End main</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
<a id="__codelineno-307-73" name="__codelineno-307-73"></a>
<a id="__codelineno-307-74" name="__codelineno-307-74"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-307-75" name="__codelineno-307-75"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>这段程序将会输出</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-308-1">1</a></span>
<span class="normal"><a href="#__codelineno-308-2">2</a></span>
<span class="normal"><a href="#__codelineno-308-3">3</a></span>
<span class="normal"><a href="#__codelineno-308-4">4</a></span>
<span class="normal"><a href="#__codelineno-308-5">5</a></span>
<span class="normal"><a href="#__codelineno-308-6">6</a></span>
<span class="normal"><a href="#__codelineno-308-7">7</a></span>
<span class="normal"><a href="#__codelineno-308-8">8</a></span>
<span class="normal"><a href="#__codelineno-308-9">9</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-308-1" name="__codelineno-308-1"></a>Start main
<a id="__codelineno-308-2" name="__codelineno-308-2"></a>Start A
<a id="__codelineno-308-3" name="__codelineno-308-3"></a>Start B
<a id="__codelineno-308-4" name="__codelineno-308-4"></a>Start C
<a id="__codelineno-308-5" name="__codelineno-308-5"></a>Start D
<a id="__codelineno-308-6" name="__codelineno-308-6"></a>D throwing int exception
<a id="__codelineno-308-7" name="__codelineno-308-7"></a>A caught int exception
<a id="__codelineno-308-8" name="__codelineno-308-8"></a>End A
<a id="__codelineno-308-9" name="__codelineno-308-9"></a>End main
</code></pre></div></td></tr></table></div>
<ul>
<li>D() 和 C() 都没有处理异常，因此异常会向上传递。</li>
<li>B() 没有捕获到类型为 double 的异常（D() 抛出的是 int 类型的异常），异常继续向上传递。</li>
<li>A() 捕获到了类型为 int 的异常，因此异常被处理，程序从最后一个 catch 块后面的代码开始继续执行。</li>
<li>A() 执行完毕后正常地回到 main()</li>
</ul>
</details>
<p>为了防止出现未捕获的异常导致程序终止，我们可以在 catch 的参数中使用省略号 <code>...</code> 来捕获所有类型的异常。</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-309-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-309-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-309-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-309-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-309-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-309-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-309-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-309-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-309-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-309-10">10</a></span>
<span class="normal"><a href="#__codelineno-309-11">11</a></span>
<span class="normal"><a href="#__codelineno-309-12">12</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-309-1" name="__codelineno-309-1"></a><span class="k">try</span>
<a id="__codelineno-309-2" name="__codelineno-309-2"></a><span class="p">{</span>
<a id="__codelineno-309-3" name="__codelineno-309-3"></a><span class="w">    </span><span class="c1">// code that may throw exceptions</span>
<a id="__codelineno-309-4" name="__codelineno-309-4"></a><span class="p">}</span>
<a id="__codelineno-309-5" name="__codelineno-309-5"></a><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="p">)</span>
<a id="__codelineno-309-6" name="__codelineno-309-6"></a><span class="p">{</span>
<a id="__codelineno-309-7" name="__codelineno-309-7"></a><span class="w">    </span><span class="c1">// handle int exceptions</span>
<a id="__codelineno-309-8" name="__codelineno-309-8"></a><span class="p">}</span>
<a id="__codelineno-309-9" name="__codelineno-309-9"></a><span class="k">catch</span><span class="w"> </span><span class="p">(...)</span><span class="w"> </span><span class="c1">// catch all exceptions</span>
<a id="__codelineno-309-10" name="__codelineno-309-10"></a><span class="p">{</span>
<a id="__codelineno-309-11" name="__codelineno-309-11"></a><span class="w">    </span><span class="c1">// handle the</span>
<a id="__codelineno-309-12" name="__codelineno-309-12"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h3 id="_88">异常类与派生<a class="headerlink" href="#_88" title="Permanent link">¶</a></h3>
<p>当我们把一个类作为异常抛出时，它不仅可以被以该类为参数的 catch 块捕获，还可以被以该类的基类为参数的 catch 块捕获。例如</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-310-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-310-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-310-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-310-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-310-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-310-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-310-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-310-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-310-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-310-10">10</a></span>
<span class="normal"><a href="#__codelineno-310-11">11</a></span>
<span class="normal"><a href="#__codelineno-310-12">12</a></span>
<span class="normal"><a href="#__codelineno-310-13">13</a></span>
<span class="normal"><a href="#__codelineno-310-14">14</a></span>
<span class="normal"><a href="#__codelineno-310-15">15</a></span>
<span class="normal"><a href="#__codelineno-310-16">16</a></span>
<span class="normal"><a href="#__codelineno-310-17">17</a></span>
<span class="normal"><a href="#__codelineno-310-18">18</a></span>
<span class="normal"><a href="#__codelineno-310-19">19</a></span>
<span class="normal"><a href="#__codelineno-310-20">20</a></span>
<span class="normal"><a href="#__codelineno-310-21">21</a></span>
<span class="normal"><a href="#__codelineno-310-22">22</a></span>
<span class="normal"><a href="#__codelineno-310-23">23</a></span>
<span class="normal"><a href="#__codelineno-310-24">24</a></span>
<span class="normal"><a href="#__codelineno-310-25">25</a></span>
<span class="normal"><a href="#__codelineno-310-26">26</a></span>
<span class="normal"><a href="#__codelineno-310-27">27</a></span>
<span class="normal"><a href="#__codelineno-310-28">28</a></span>
<span class="normal"><a href="#__codelineno-310-29">29</a></span>
<span class="normal"><a href="#__codelineno-310-30">30</a></span>
<span class="normal"><a href="#__codelineno-310-31">31</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-310-1" name="__codelineno-310-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span>
<a id="__codelineno-310-2" name="__codelineno-310-2"></a>
<a id="__codelineno-310-3" name="__codelineno-310-3"></a><span class="k">class</span><span class="w"> </span><span class="nc">Base</span>
<a id="__codelineno-310-4" name="__codelineno-310-4"></a><span class="p">{</span>
<a id="__codelineno-310-5" name="__codelineno-310-5"></a><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-310-6" name="__codelineno-310-6"></a><span class="w">    </span><span class="n">Base</span><span class="p">()</span><span class="w"> </span><span class="p">{}</span>
<a id="__codelineno-310-7" name="__codelineno-310-7"></a><span class="p">};</span>
<a id="__codelineno-310-8" name="__codelineno-310-8"></a>
<a id="__codelineno-310-9" name="__codelineno-310-9"></a><span class="k">class</span><span class="w"> </span><span class="nc">Derived</span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">Base</span>
<a id="__codelineno-310-10" name="__codelineno-310-10"></a><span class="p">{</span>
<a id="__codelineno-310-11" name="__codelineno-310-11"></a><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-310-12" name="__codelineno-310-12"></a><span class="w">    </span><span class="n">Derived</span><span class="p">()</span><span class="w"> </span><span class="p">{}</span>
<a id="__codelineno-310-13" name="__codelineno-310-13"></a><span class="p">};</span>
<a id="__codelineno-310-14" name="__codelineno-310-14"></a>
<a id="__codelineno-310-15" name="__codelineno-310-15"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span>
<a id="__codelineno-310-16" name="__codelineno-310-16"></a><span class="p">{</span>
<a id="__codelineno-310-17" name="__codelineno-310-17"></a><span class="w">    </span><span class="k">try</span>
<a id="__codelineno-310-18" name="__codelineno-310-18"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-310-19" name="__codelineno-310-19"></a><span class="w">        </span><span class="k">throw</span><span class="w"> </span><span class="n">Derived</span><span class="p">();</span>
<a id="__codelineno-310-20" name="__codelineno-310-20"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-310-21" name="__codelineno-310-21"></a><span class="w">    </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">Base</span><span class="o">&amp;</span><span class="w"> </span><span class="n">base</span><span class="p">)</span>
<a id="__codelineno-310-22" name="__codelineno-310-22"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-310-23" name="__codelineno-310-23"></a><span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">cerr</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"caught Base"</span><span class="p">;</span>
<a id="__codelineno-310-24" name="__codelineno-310-24"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-310-25" name="__codelineno-310-25"></a><span class="w">    </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">Derived</span><span class="o">&amp;</span><span class="w"> </span><span class="n">derived</span><span class="p">)</span>
<a id="__codelineno-310-26" name="__codelineno-310-26"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-310-27" name="__codelineno-310-27"></a><span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">cerr</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"caught Derived"</span><span class="p">;</span>
<a id="__codelineno-310-28" name="__codelineno-310-28"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-310-29" name="__codelineno-310-29"></a>
<a id="__codelineno-310-30" name="__codelineno-310-30"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-310-31" name="__codelineno-310-31"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>上面的程序将会输出 <code>caught Base</code>。由于 <code>Derived</code> 是 <code>Base</code> 的派生类，也就是说 <code>Derived</code> is-a <code>Base</code>，因此 <code>Base</code> 类型的 catch 块可以捕获 <code>Derived</code> 类型的异常。如果我们想让上面的例子正常工作，就需要将 catch 块的顺序调换，即先捕获 <code>Derived</code> 类型的异常，再捕获 <code>Base</code> 类型的异常。</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul>
<li>派生的异常类的处理应当列在基类的处理之前。</li>
<li>catch 一个异常类时，我们应当通过 const 引用捕获，这可以避免复制带来的额外开销，也可以避免对象的切片问题。</li>
</ul>
</div>
<p>C++ 的标准库中具有一些内置的异常类，例如 <code>std::exception</code>，它是小型的接口类，是所有标准异常类的基类。<code>std::exception</code> 具有一个虚函数 <code>what()</code>，返回一个描述异常信息的 C 风格字符串。</p>
<p>常用的标准异常类有 <code>std::runtime_error</code>、<code>std::out_of_range</code> 等，<code>std::runtime_error</code> 的构造函数接受一个描述异常的字符串，<code>std::out_of_range</code> 的构造函数接受一个描述异常的字符串和一个指向异常对象的指针。</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-311-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-311-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-311-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-311-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-311-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-311-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-311-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-311-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-311-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-311-10">10</a></span>
<span class="normal"><a href="#__codelineno-311-11">11</a></span>
<span class="normal"><a href="#__codelineno-311-12">12</a></span>
<span class="normal"><a href="#__codelineno-311-13">13</a></span>
<span class="normal"><a href="#__codelineno-311-14">14</a></span>
<span class="normal"><a href="#__codelineno-311-15">15</a></span>
<span class="normal"><a href="#__codelineno-311-16">16</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-311-1" name="__codelineno-311-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span>
<a id="__codelineno-311-2" name="__codelineno-311-2"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdexcept&gt;</span>
<a id="__codelineno-311-3" name="__codelineno-311-3"></a>
<a id="__codelineno-311-4" name="__codelineno-311-4"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span>
<a id="__codelineno-311-5" name="__codelineno-311-5"></a><span class="p">{</span>
<a id="__codelineno-311-6" name="__codelineno-311-6"></a><span class="w">    </span><span class="k">try</span>
<a id="__codelineno-311-7" name="__codelineno-311-7"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-311-8" name="__codelineno-311-8"></a><span class="w">        </span><span class="k">throw</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">runtime_error</span><span class="p">(</span><span class="s">"An error occurred"</span><span class="p">);</span>
<a id="__codelineno-311-9" name="__codelineno-311-9"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-311-10" name="__codelineno-311-10"></a><span class="w">    </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">exception</span><span class="o">&amp;</span><span class="w"> </span><span class="n">e</span><span class="p">)</span>
<a id="__codelineno-311-11" name="__codelineno-311-11"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-311-12" name="__codelineno-311-12"></a><span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">cerr</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"Caught exception: "</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="n">what</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="sc">'\n'</span><span class="p">;</span>
<a id="__codelineno-311-13" name="__codelineno-311-13"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-311-14" name="__codelineno-311-14"></a>
<a id="__codelineno-311-15" name="__codelineno-311-15"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-311-16" name="__codelineno-311-16"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>这将会输出 <code>Caught exception: An error occurred</code>。</p>
<h3 id="_89">重新抛出异常<a class="headerlink" href="#_89" title="Permanent link">¶</a></h3>
<p>当我们在 catch 块中捕获到异常后，有时我们希望在经过一些简单处理后重新抛出这个异常。我们可以使用 <code>throw</code> 语句来重新抛出异常，不过这里我们不需要指定异常类型，只需要使用 <code>throw</code> 关键字即可。</p>
<div class="admonition example">
<p class="admonition-title">Example</p>
<div class="tabbed-set tabbed-alternate" data-tabs="7:2"><input checked="checked" id="__tabbed_7_1" name="__tabbed_7" type="radio"><input id="__tabbed_7_2" name="__tabbed_7" type="radio"><div class="tabbed-labels"><label for="__tabbed_7_1">bad example</label><label for="__tabbed_7_2">good example</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-312-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-312-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-312-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-312-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-312-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-312-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-312-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-312-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-312-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-312-10">10</a></span>
<span class="normal"><a href="#__codelineno-312-11">11</a></span>
<span class="normal"><a href="#__codelineno-312-12">12</a></span>
<span class="normal"><a href="#__codelineno-312-13">13</a></span>
<span class="normal"><a href="#__codelineno-312-14">14</a></span>
<span class="normal"><a href="#__codelineno-312-15">15</a></span>
<span class="normal"><a href="#__codelineno-312-16">16</a></span>
<span class="normal"><a href="#__codelineno-312-17">17</a></span>
<span class="normal"><a href="#__codelineno-312-18">18</a></span>
<span class="normal"><a href="#__codelineno-312-19">19</a></span>
<span class="normal"><a href="#__codelineno-312-20">20</a></span>
<span class="normal"><a href="#__codelineno-312-21">21</a></span>
<span class="normal"><a href="#__codelineno-312-22">22</a></span>
<span class="normal"><a href="#__codelineno-312-23">23</a></span>
<span class="normal"><a href="#__codelineno-312-24">24</a></span>
<span class="normal"><a href="#__codelineno-312-25">25</a></span>
<span class="normal"><a href="#__codelineno-312-26">26</a></span>
<span class="normal"><a href="#__codelineno-312-27">27</a></span>
<span class="normal"><a href="#__codelineno-312-28">28</a></span>
<span class="normal"><a href="#__codelineno-312-29">29</a></span>
<span class="normal"><a href="#__codelineno-312-30">30</a></span>
<span class="normal"><a href="#__codelineno-312-31">31</a></span>
<span class="normal"><a href="#__codelineno-312-32">32</a></span>
<span class="normal"><a href="#__codelineno-312-33">33</a></span>
<span class="normal"><a href="#__codelineno-312-34">34</a></span>
<span class="normal"><a href="#__codelineno-312-35">35</a></span>
<span class="normal"><a href="#__codelineno-312-36">36</a></span>
<span class="normal"><a href="#__codelineno-312-37">37</a></span>
<span class="normal"><a href="#__codelineno-312-38">38</a></span>
<span class="normal"><a href="#__codelineno-312-39">39</a></span>
<span class="normal"><a href="#__codelineno-312-40">40</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-312-1" name="__codelineno-312-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span>
<a id="__codelineno-312-2" name="__codelineno-312-2"></a><span class="k">class</span><span class="w"> </span><span class="nc">Base</span>
<a id="__codelineno-312-3" name="__codelineno-312-3"></a><span class="p">{</span>
<a id="__codelineno-312-4" name="__codelineno-312-4"></a><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-312-5" name="__codelineno-312-5"></a><span class="w">    </span><span class="n">Base</span><span class="p">()</span><span class="w"> </span><span class="p">{}</span>
<a id="__codelineno-312-6" name="__codelineno-312-6"></a><span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="n">print</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"Base"</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-312-7" name="__codelineno-312-7"></a><span class="p">};</span>
<a id="__codelineno-312-8" name="__codelineno-312-8"></a>
<a id="__codelineno-312-9" name="__codelineno-312-9"></a><span class="k">class</span><span class="w"> </span><span class="nc">Derived</span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">Base</span>
<a id="__codelineno-312-10" name="__codelineno-312-10"></a><span class="p">{</span>
<a id="__codelineno-312-11" name="__codelineno-312-11"></a><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-312-12" name="__codelineno-312-12"></a><span class="w">    </span><span class="n">Derived</span><span class="p">()</span><span class="w"> </span><span class="p">{}</span>
<a id="__codelineno-312-13" name="__codelineno-312-13"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">print</span><span class="p">()</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"Derived"</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-312-14" name="__codelineno-312-14"></a><span class="p">};</span>
<a id="__codelineno-312-15" name="__codelineno-312-15"></a>
<a id="__codelineno-312-16" name="__codelineno-312-16"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span>
<a id="__codelineno-312-17" name="__codelineno-312-17"></a><span class="p">{</span>
<a id="__codelineno-312-18" name="__codelineno-312-18"></a><span class="w">    </span><span class="k">try</span>
<a id="__codelineno-312-19" name="__codelineno-312-19"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-312-20" name="__codelineno-312-20"></a><span class="w">        </span><span class="k">try</span>
<a id="__codelineno-312-21" name="__codelineno-312-21"></a><span class="w">        </span><span class="p">{</span>
<a id="__codelineno-312-22" name="__codelineno-312-22"></a><span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="n">Derived</span><span class="p">{};</span>
<a id="__codelineno-312-23" name="__codelineno-312-23"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-312-24" name="__codelineno-312-24"></a><span class="hll"><span class="w">        </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">Base</span><span class="o">&amp;</span><span class="w"> </span><span class="n">b</span><span class="p">)</span>
</span><a id="__codelineno-312-25" name="__codelineno-312-25"></a><span class="w">        </span><span class="p">{</span>
<a id="__codelineno-312-26" name="__codelineno-312-26"></a><span class="w">            </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"Caught Base b, which is actually a "</span><span class="p">;</span>
<a id="__codelineno-312-27" name="__codelineno-312-27"></a><span class="w">            </span><span class="n">b</span><span class="p">.</span><span class="n">print</span><span class="p">();</span>
<a id="__codelineno-312-28" name="__codelineno-312-28"></a><span class="w">            </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="sc">'\n'</span><span class="p">;</span>
<a id="__codelineno-312-29" name="__codelineno-312-29"></a><span class="hll"><span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="n">b</span><span class="p">;</span><span class="w"> </span><span class="c1">// the Derived object gets sliced here</span>
</span><a id="__codelineno-312-30" name="__codelineno-312-30"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-312-31" name="__codelineno-312-31"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-312-32" name="__codelineno-312-32"></a><span class="hll"><span class="w">    </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">Base</span><span class="o">&amp;</span><span class="w"> </span><span class="n">b</span><span class="p">)</span>
</span><a id="__codelineno-312-33" name="__codelineno-312-33"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-312-34" name="__codelineno-312-34"></a><span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"Caught Base b, which is actually a "</span><span class="p">;</span>
<a id="__codelineno-312-35" name="__codelineno-312-35"></a><span class="w">        </span><span class="n">b</span><span class="p">.</span><span class="n">print</span><span class="p">();</span>
<a id="__codelineno-312-36" name="__codelineno-312-36"></a><span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="sc">'\n'</span><span class="p">;</span>
<a id="__codelineno-312-37" name="__codelineno-312-37"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-312-38" name="__codelineno-312-38"></a>
<a id="__codelineno-312-39" name="__codelineno-312-39"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-312-40" name="__codelineno-312-40"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>当我们运行这段程序时，由于在最内层通过 <code>Base&amp; b</code> 来捕获异常，<code>Derived</code> 对象被切片，因此我们重复抛出时实际上抛出的是一个 <code>Base</code> 对象。因此在最外层的 catch 块中，我们将会看到输出</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-313-1">1</a></span>
<span class="normal"><a href="#__codelineno-313-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-313-1" name="__codelineno-313-1"></a>Caught Base b, which is actually a Derived
<a id="__codelineno-313-2" name="__codelineno-313-2"></a>Caught Base b, which is actually a Base
</code></pre></div></td></tr></table></div>
</div>
<div class="tabbed-block">
<p>如果我们想要在 catch 块中重新抛出异常刚刚抛出的异常，我们应当直接使用 <code>throw</code> 关键字，这样可以避免复制和切片问题。</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-314-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-314-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-314-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-314-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-314-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-314-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-314-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-314-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-314-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-314-10">10</a></span>
<span class="normal"><a href="#__codelineno-314-11">11</a></span>
<span class="normal"><a href="#__codelineno-314-12">12</a></span>
<span class="normal"><a href="#__codelineno-314-13">13</a></span>
<span class="normal"><a href="#__codelineno-314-14">14</a></span>
<span class="normal"><a href="#__codelineno-314-15">15</a></span>
<span class="normal"><a href="#__codelineno-314-16">16</a></span>
<span class="normal"><a href="#__codelineno-314-17">17</a></span>
<span class="normal"><a href="#__codelineno-314-18">18</a></span>
<span class="normal"><a href="#__codelineno-314-19">19</a></span>
<span class="normal"><a href="#__codelineno-314-20">20</a></span>
<span class="normal"><a href="#__codelineno-314-21">21</a></span>
<span class="normal"><a href="#__codelineno-314-22">22</a></span>
<span class="normal"><a href="#__codelineno-314-23">23</a></span>
<span class="normal"><a href="#__codelineno-314-24">24</a></span>
<span class="normal"><a href="#__codelineno-314-25">25</a></span>
<span class="normal"><a href="#__codelineno-314-26">26</a></span>
<span class="normal"><a href="#__codelineno-314-27">27</a></span>
<span class="normal"><a href="#__codelineno-314-28">28</a></span>
<span class="normal"><a href="#__codelineno-314-29">29</a></span>
<span class="normal"><a href="#__codelineno-314-30">30</a></span>
<span class="normal"><a href="#__codelineno-314-31">31</a></span>
<span class="normal"><a href="#__codelineno-314-32">32</a></span>
<span class="normal"><a href="#__codelineno-314-33">33</a></span>
<span class="normal"><a href="#__codelineno-314-34">34</a></span>
<span class="normal"><a href="#__codelineno-314-35">35</a></span>
<span class="normal"><a href="#__codelineno-314-36">36</a></span>
<span class="normal"><a href="#__codelineno-314-37">37</a></span>
<span class="normal"><a href="#__codelineno-314-38">38</a></span>
<span class="normal"><a href="#__codelineno-314-39">39</a></span>
<span class="normal"><a href="#__codelineno-314-40">40</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-314-1" name="__codelineno-314-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span>
<a id="__codelineno-314-2" name="__codelineno-314-2"></a><span class="k">class</span><span class="w"> </span><span class="nc">Base</span>
<a id="__codelineno-314-3" name="__codelineno-314-3"></a><span class="p">{</span>
<a id="__codelineno-314-4" name="__codelineno-314-4"></a><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-314-5" name="__codelineno-314-5"></a><span class="w">    </span><span class="n">Base</span><span class="p">()</span><span class="w"> </span><span class="p">{}</span>
<a id="__codelineno-314-6" name="__codelineno-314-6"></a><span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="n">print</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"Base"</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-314-7" name="__codelineno-314-7"></a><span class="p">};</span>
<a id="__codelineno-314-8" name="__codelineno-314-8"></a>
<a id="__codelineno-314-9" name="__codelineno-314-9"></a><span class="k">class</span><span class="w"> </span><span class="nc">Derived</span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">Base</span>
<a id="__codelineno-314-10" name="__codelineno-314-10"></a><span class="p">{</span>
<a id="__codelineno-314-11" name="__codelineno-314-11"></a><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-314-12" name="__codelineno-314-12"></a><span class="w">    </span><span class="n">Derived</span><span class="p">()</span><span class="w"> </span><span class="p">{}</span>
<a id="__codelineno-314-13" name="__codelineno-314-13"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">print</span><span class="p">()</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"Derived"</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-314-14" name="__codelineno-314-14"></a><span class="p">};</span>
<a id="__codelineno-314-15" name="__codelineno-314-15"></a>
<a id="__codelineno-314-16" name="__codelineno-314-16"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span>
<a id="__codelineno-314-17" name="__codelineno-314-17"></a><span class="p">{</span>
<a id="__codelineno-314-18" name="__codelineno-314-18"></a><span class="w">    </span><span class="k">try</span>
<a id="__codelineno-314-19" name="__codelineno-314-19"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-314-20" name="__codelineno-314-20"></a><span class="w">        </span><span class="k">try</span>
<a id="__codelineno-314-21" name="__codelineno-314-21"></a><span class="w">        </span><span class="p">{</span>
<a id="__codelineno-314-22" name="__codelineno-314-22"></a><span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="n">Derived</span><span class="p">{};</span>
<a id="__codelineno-314-23" name="__codelineno-314-23"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-314-24" name="__codelineno-314-24"></a><span class="hll"><span class="w">        </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">Base</span><span class="o">&amp;</span><span class="w"> </span><span class="n">b</span><span class="p">)</span>
</span><a id="__codelineno-314-25" name="__codelineno-314-25"></a><span class="w">        </span><span class="p">{</span>
<a id="__codelineno-314-26" name="__codelineno-314-26"></a><span class="w">            </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"Caught Base b, which is actually a "</span><span class="p">;</span>
<a id="__codelineno-314-27" name="__codelineno-314-27"></a><span class="w">            </span><span class="n">b</span><span class="p">.</span><span class="n">print</span><span class="p">();</span>
<a id="__codelineno-314-28" name="__codelineno-314-28"></a><span class="w">            </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="sc">'\n'</span><span class="p">;</span>
<a id="__codelineno-314-29" name="__codelineno-314-29"></a><span class="hll"><span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="n">b</span><span class="p">;</span><span class="w"> </span><span class="c1">// the Derived object gets sliced here</span>
</span><a id="__codelineno-314-30" name="__codelineno-314-30"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-314-31" name="__codelineno-314-31"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-314-32" name="__codelineno-314-32"></a><span class="hll"><span class="w">    </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">Base</span><span class="o">&amp;</span><span class="w"> </span><span class="n">b</span><span class="p">)</span>
</span><a id="__codelineno-314-33" name="__codelineno-314-33"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-314-34" name="__codelineno-314-34"></a><span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"Caught Base b, which is actually a "</span><span class="p">;</span>
<a id="__codelineno-314-35" name="__codelineno-314-35"></a><span class="w">        </span><span class="n">b</span><span class="p">.</span><span class="n">print</span><span class="p">();</span>
<a id="__codelineno-314-36" name="__codelineno-314-36"></a><span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="sc">'\n'</span><span class="p">;</span>
<a id="__codelineno-314-37" name="__codelineno-314-37"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-314-38" name="__codelineno-314-38"></a>
<a id="__codelineno-314-39" name="__codelineno-314-39"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-314-40" name="__codelineno-314-40"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>这段程序将会输出</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-315-1">1</a></span>
<span class="normal"><a href="#__codelineno-315-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-315-1" name="__codelineno-315-1"></a>Caught Base b, which is actually a Derived
<a id="__codelineno-315-2" name="__codelineno-315-2"></a>Caught Base b, which is actually a Derived
</code></pre></div></td></tr></table></div>
</div>
</div>
</input></input></div>
</div>
<h3 id="noexcept">noexcept 说明符<a class="headerlink" href="#noexcept" title="Permanent link">¶</a></h3>
<p>noexcept 说明符是 C++11 新增的一个特性，它用于指示一个函数不会抛出异常。noexcept 并不代表这个函数内部不会出现异常，而是表示这个函数不会抛出异常，也就是说，如果这个函数或它所调用的其他函数抛出了异常，只要在这个函数内把异常处理完毕，不向外抛出异常，那么这个函数就符合 noexcept 说明符的要求。</p>
<div class="admonition info">
<p class="admonition-title">Dynamic exception specifications</p>
<p>在 C++11 之前，我们可以使用 dynamic exception specifications 来指定一个函数可能抛出的异常类型。例如</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-316-1">1</a></span>
<span class="normal"><a href="#__codelineno-316-2">2</a></span>
<span class="normal"><a href="#__codelineno-316-3">3</a></span>
<span class="normal"><a href="#__codelineno-316-4">4</a></span>
<span class="normal"><a href="#__codelineno-316-5">5</a></span>
<span class="normal"><a href="#__codelineno-316-6">6</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-316-1" name="__codelineno-316-1"></a><span class="c1">// does not throw exceptions</span>
<a id="__codelineno-316-2" name="__codelineno-316-2"></a><span class="kt">int</span><span class="w"> </span><span class="nf">doSomething</span><span class="p">()</span><span class="w"> </span><span class="k">throw</span><span class="p">();</span><span class="w"> </span>
<a id="__codelineno-316-3" name="__codelineno-316-3"></a><span class="c1">// may throw either std::out_of_range or a pointer to an integer</span>
<a id="__codelineno-316-4" name="__codelineno-316-4"></a><span class="kt">int</span><span class="w"> </span><span class="nf">doSomething</span><span class="p">()</span><span class="w"> </span><span class="k">throw</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">out_of_range</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="o">*</span><span class="p">);</span><span class="w"> </span>
<a id="__codelineno-316-5" name="__codelineno-316-5"></a><span class="c1">// may throw anything</span>
<a id="__codelineno-316-6" name="__codelineno-316-6"></a><span class="kt">int</span><span class="w"> </span><span class="nf">doSomething</span><span class="p">()</span><span class="w"> </span><span class="k">throw</span><span class="p">(...);</span><span class="w"> </span>
</code></pre></div></td></tr></table></div>
<p>但由于编译器实现不完整、与模板函数不兼容等等问题，dynamic exception specifications 在 C++11 中被废弃，并在 C++17 和 C++20 中被移除。</p>
</div>
<hr/>
<h2 id="_90">其他<a class="headerlink" href="#_90" title="Permanent link">¶</a></h2>
<h3 id="_91">头文件<a class="headerlink" href="#_91" title="Permanent link">¶</a></h3>
<p>使用头文件的目的是为了将函数声明和定义分离，使得代码更加清晰易读。</p>
<p>为了避免头文件被多次包含，我们可以使用 <code>#pragma once</code> 或者 <code>#ifndef</code>、<code>#define</code>、<code>#endif</code> 来防止头文件被多次包含。</p>
<div class="highlight"><table class="highlighttable"><tr><th class="filename" colspan="2"><span class="filename">add.h（使用 #ifndef）</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-317-1">1</a></span>
<span class="normal"><a href="#__codelineno-317-2">2</a></span>
<span class="normal"><a href="#__codelineno-317-3">3</a></span>
<span class="normal"><a href="#__codelineno-317-4">4</a></span>
<span class="normal"><a href="#__codelineno-317-5">5</a></span>
<span class="normal"><a href="#__codelineno-317-6">6</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-317-1" name="__codelineno-317-1"></a><span class="cp">#ifndef ADD_H</span>
<a id="__codelineno-317-2" name="__codelineno-317-2"></a><span class="cp">#define ADD_H</span>
<a id="__codelineno-317-3" name="__codelineno-317-3"></a>
<a id="__codelineno-317-4" name="__codelineno-317-4"></a><span class="kt">int</span><span class="w"> </span><span class="nf">add</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">y</span><span class="p">);</span>
<a id="__codelineno-317-5" name="__codelineno-317-5"></a>
<a id="__codelineno-317-6" name="__codelineno-317-6"></a><span class="cp">#endif</span>
</code></pre></div></td></tr></table></div>
<div class="highlight"><table class="highlighttable"><tr><th class="filename" colspan="2"><span class="filename">add.cpp</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-318-1">1</a></span>
<span class="normal"><a href="#__codelineno-318-2">2</a></span>
<span class="normal"><a href="#__codelineno-318-3">3</a></span>
<span class="normal"><a href="#__codelineno-318-4">4</a></span>
<span class="normal"><a href="#__codelineno-318-5">5</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-318-1" name="__codelineno-318-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">"add.h"</span>
<a id="__codelineno-318-2" name="__codelineno-318-2"></a>
<a id="__codelineno-318-3" name="__codelineno-318-3"></a><span class="kt">int</span><span class="w"> </span><span class="nf">add</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">y</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-318-4" name="__codelineno-318-4"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">y</span><span class="p">;</span>
<a id="__codelineno-318-5" name="__codelineno-318-5"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<div class="highlight"><table class="highlighttable"><tr><th class="filename" colspan="2"><span class="filename">main.cpp</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-319-1">1</a></span>
<span class="normal"><a href="#__codelineno-319-2">2</a></span>
<span class="normal"><a href="#__codelineno-319-3">3</a></span>
<span class="normal"><a href="#__codelineno-319-4">4</a></span>
<span class="normal"><a href="#__codelineno-319-5">5</a></span>
<span class="normal"><a href="#__codelineno-319-6">6</a></span>
<span class="normal"><a href="#__codelineno-319-7">7</a></span>
<span class="normal"><a href="#__codelineno-319-8">8</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-319-1" name="__codelineno-319-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">"add.h"</span>
<a id="__codelineno-319-2" name="__codelineno-319-2"></a>
<a id="__codelineno-319-3" name="__codelineno-319-3"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-319-4" name="__codelineno-319-4"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">};</span>
<a id="__codelineno-319-5" name="__codelineno-319-5"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">};</span>
<a id="__codelineno-319-6" name="__codelineno-319-6"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">z</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">add</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">);</span>
<a id="__codelineno-319-7" name="__codelineno-319-7"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-319-8" name="__codelineno-319-8"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>当然，我们也可以使用 <code>#pragma once</code> 来防止头文件被多次包含。</p>
<div class="highlight"><table class="highlighttable"><tr><th class="filename" colspan="2"><span class="filename">add.h（使用 #pragma once）</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-320-1">1</a></span>
<span class="normal"><a href="#__codelineno-320-2">2</a></span>
<span class="normal"><a href="#__codelineno-320-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-320-1" name="__codelineno-320-1"></a><span class="cp">#pragma once</span>
<a id="__codelineno-320-2" name="__codelineno-320-2"></a>
<a id="__codelineno-320-3" name="__codelineno-320-3"></a><span class="kt">int</span><span class="w"> </span><span class="nf">add</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">y</span><span class="p">);</span>
</code></pre></div></td></tr></table></div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>由于 <code>#pragma once</code> 不是由 C++ 标准定义的，因此某些编译器可能不会实现它，使用 <code>#ifndef</code>、<code>#define</code>、<code>#endif</code> 是更加通用的做法。但对于 modern C++ 编译器来说，<code>#pragma once</code> 是一个更加简洁的选择。</p>
</div>
<h3 id="_92">输入输出<a class="headerlink" href="#_92" title="Permanent link">¶</a></h3>
<div class="admonition tip">
<p class="admonition-title"><code>std::endl</code> vs <code>'\n'</code></p>
<ul>
<li><code>std::endl</code> 实际上会完成两件事：输出一个换行符并刷新输出缓冲区</li>
<li><code>'\n'</code> 只会输出一个换行符。</li>
</ul>
<p>由于刷新缓冲区是一个相对耗时的操作，因此在大多数情况下，我们应该使用 <code>'\n'</code> 而不是 <code>std::endl</code>。</p>
</div>
<div class="admonition note">
<p class="admonition-title">副作用</p>
<p><code>std::cout &lt;&lt; "Hello " &lt;&lt; "world!"</code> 的副作用是输出 <code>"Hello world!"</code>，它实际上相当于 <code>(std::cout &lt;&lt; "Hello ") &lt;&lt; "world!"</code>，括号内的返回值是 <code>std::cout</code>，因此可以连续使用 <code>&lt;&lt;</code> 运算符，先输出 <code>"Hello "</code>，再输出 <code>"world!"</code>。</p>
</div>
<div class="admonition note">
<p class="admonition-title">布尔变量</p>
<div class="tabbed-set tabbed-alternate" data-tabs="8:2"><input checked="checked" id="__tabbed_8_1" name="__tabbed_8" type="radio"><input id="__tabbed_8_2" name="__tabbed_8" type="radio"><div class="tabbed-labels"><label for="__tabbed_8_1">输出</label><label for="__tabbed_8_2">输入</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<p><code>std::cout</code> 会将 <code>true</code> 输出为 <code>1</code>，将 <code>false</code> 输出为 <code>0</code>。
例如
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-321-1">1</a></span>
<span class="normal"><a href="#__codelineno-321-2">2</a></span>
<span class="normal"><a href="#__codelineno-321-3">3</a></span>
<span class="normal"><a href="#__codelineno-321-4">4</a></span>
<span class="normal"><a href="#__codelineno-321-5">5</a></span>
<span class="normal"><a href="#__codelineno-321-6">6</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-321-1" name="__codelineno-321-1"></a><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="nb">true</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="sc">'\n'</span><span class="p">;</span><span class="w">  </span><span class="c1">// true evaluates to 1</span>
<a id="__codelineno-321-2" name="__codelineno-321-2"></a><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="o">!</span><span class="nb">true</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="sc">'\n'</span><span class="p">;</span><span class="w"> </span><span class="c1">// !true evaluates to 0</span>
<a id="__codelineno-321-3" name="__codelineno-321-3"></a>
<a id="__codelineno-321-4" name="__codelineno-321-4"></a><span class="kt">bool</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="p">{</span><span class="nb">false</span><span class="p">};</span>
<a id="__codelineno-321-5" name="__codelineno-321-5"></a><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="sc">'\n'</span><span class="p">;</span><span class="w">     </span><span class="c1">// b is false, which evaluates to 0</span>
<a id="__codelineno-321-6" name="__codelineno-321-6"></a><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="o">!</span><span class="n">b</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="sc">'\n'</span><span class="p">;</span><span class="w">    </span><span class="c1">// !b is true, which evaluates to 1</span>
</code></pre></div></td></tr></table></div>
输出结果为
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-322-1">1</a></span>
<span class="normal"><a href="#__codelineno-322-2">2</a></span>
<span class="normal"><a href="#__codelineno-322-3">3</a></span>
<span class="normal"><a href="#__codelineno-322-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-322-1" name="__codelineno-322-1"></a>1
<a id="__codelineno-322-2" name="__codelineno-322-2"></a>0
<a id="__codelineno-322-3" name="__codelineno-322-3"></a>0
<a id="__codelineno-322-4" name="__codelineno-322-4"></a>1
</code></pre></div></td></tr></table></div></p>
<p>如果我们想要输出 <code>true</code> 或 <code>false</code>，我们可以使用 <code>std::boolalpha</code> 操纵符。
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-323-1">1</a></span>
<span class="normal"><a href="#__codelineno-323-2">2</a></span>
<span class="normal"><a href="#__codelineno-323-3">3</a></span>
<span class="normal"><a href="#__codelineno-323-4">4</a></span>
<span class="normal"><a href="#__codelineno-323-5">5</a></span>
<span class="normal"><a href="#__codelineno-323-6">6</a></span>
<span class="normal"><a href="#__codelineno-323-7">7</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-323-1" name="__codelineno-323-1"></a><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="nb">true</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="sc">'\n'</span><span class="p">;</span>
<a id="__codelineno-323-2" name="__codelineno-323-2"></a><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="nb">false</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="sc">'\n'</span><span class="p">;</span>
<a id="__codelineno-323-3" name="__codelineno-323-3"></a>
<a id="__codelineno-323-4" name="__codelineno-323-4"></a><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">boolalpha</span><span class="p">;</span><span class="w"> </span><span class="c1">// print bools as true or false</span>
<a id="__codelineno-323-5" name="__codelineno-323-5"></a>
<a id="__codelineno-323-6" name="__codelineno-323-6"></a><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="nb">true</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="sc">'\n'</span><span class="p">;</span>
<a id="__codelineno-323-7" name="__codelineno-323-7"></a><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="nb">false</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="sc">'\n'</span><span class="p">;</span>
</code></pre></div></td></tr></table></div>
输出结果为
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-324-1">1</a></span>
<span class="normal"><a href="#__codelineno-324-2">2</a></span>
<span class="normal"><a href="#__codelineno-324-3">3</a></span>
<span class="normal"><a href="#__codelineno-324-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-324-1" name="__codelineno-324-1"></a>1
<a id="__codelineno-324-2" name="__codelineno-324-2"></a>0
<a id="__codelineno-324-3" name="__codelineno-324-3"></a>true
<a id="__codelineno-324-4" name="__codelineno-324-4"></a>false
</code></pre></div></td></tr></table></div>
我们也可以用 <code>std::noboolalpha</code> 操纵符来恢复默认的输出格式。</p>
</div>
<div class="tabbed-block">
<p>通常而言，我们只能用 <code>std::cin</code> 给 <code>b</code> 输入 <code>1</code> 或 <code>0</code> 来读取布尔值，其他的输入（包括其他数字和字符）会导致输入的失败，使得变量 <code>b</code> 被设置为 <code>false</code>，并且报错。</p>
<p>但我们也可以使用 <code>std::boolalpha</code> 操纵符来读取 <code>true</code> 或 <code>false</code>。
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-325-1">1</a></span>
<span class="normal"><a href="#__codelineno-325-2">2</a></span>
<span class="normal"><a href="#__codelineno-325-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-325-1" name="__codelineno-325-1"></a><span class="kt">bool</span><span class="w"> </span><span class="n">b</span><span class="p">{};</span>
<a id="__codelineno-325-2" name="__codelineno-325-2"></a><span class="n">std</span><span class="o">::</span><span class="n">cin</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">boolalpha</span><span class="p">;</span>
<a id="__codelineno-325-3" name="__codelineno-325-3"></a><span class="n">std</span><span class="o">::</span><span class="n">cin</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">b</span><span class="p">;</span>
</code></pre></div></td></tr></table></div></p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>对 <code>std::cin</code> 使用 <code>std::boolalpha</code> 后会使得它只接受小写的 <code>false</code> 和 <code>true</code>，而不接受任何其他输入（包括大写字母的变体和任何数字）。</p>
</div>
</div>
</div>
</input></input></div>
</div>
<div class="admonition note">
<p class="admonition-title">提取空白字符</p>
<p>直接使用 <code>std::cin</code> 提取字符会忽略前导和数据之间的空白字符，</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-326-1">1</a></span>
<span class="normal"><a href="#__codelineno-326-2">2</a></span>
<span class="normal"><a href="#__codelineno-326-3">3</a></span>
<span class="normal"><a href="#__codelineno-326-4">4</a></span>
<span class="normal"><a href="#__codelineno-326-5">5</a></span>
<span class="normal"><a href="#__codelineno-326-6">6</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-326-1" name="__codelineno-326-1"></a><span class="kt">char</span><span class="w"> </span><span class="n">ch</span><span class="p">{};</span>
<a id="__codelineno-326-2" name="__codelineno-326-2"></a><span class="n">std</span><span class="o">::</span><span class="n">cin</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">ch</span><span class="p">;</span><span class="w"> </span><span class="c1">// extracts a, leaves " b\n" in stream</span>
<a id="__codelineno-326-3" name="__codelineno-326-3"></a><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"You entered: "</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">ch</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="sc">'\n'</span><span class="p">;</span>
<a id="__codelineno-326-4" name="__codelineno-326-4"></a>
<a id="__codelineno-326-5" name="__codelineno-326-5"></a><span class="n">std</span><span class="o">::</span><span class="n">cin</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">ch</span><span class="p">;</span><span class="w"> </span><span class="c1">// skips leading whitespace (the space), extracts b, leaves "\n" in stream</span>
<a id="__codelineno-326-6" name="__codelineno-326-6"></a><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"You entered: "</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">ch</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="sc">'\n'</span><span class="p">;</span>
</code></pre></div></td></tr></table></div>
<p>输入流为 <code>a b</code>，输出结果为</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-327-1">1</a></span>
<span class="normal"><a href="#__codelineno-327-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-327-1" name="__codelineno-327-1"></a>You entered: a
<a id="__codelineno-327-2" name="__codelineno-327-2"></a>You entered: b
</code></pre></div></td></tr></table></div>
<p>如果我们想要把空白字符也提取到 <code>ch</code> 中，我们可以使用 <code>std::cin.get(ch)</code>。</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-328-1">1</a></span>
<span class="normal"><a href="#__codelineno-328-2">2</a></span>
<span class="normal"><a href="#__codelineno-328-3">3</a></span>
<span class="normal"><a href="#__codelineno-328-4">4</a></span>
<span class="normal"><a href="#__codelineno-328-5">5</a></span>
<span class="normal"><a href="#__codelineno-328-6">6</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-328-1" name="__codelineno-328-1"></a><span class="kt">char</span><span class="w"> </span><span class="n">ch</span><span class="p">{};</span>
<a id="__codelineno-328-2" name="__codelineno-328-2"></a><span class="n">std</span><span class="o">::</span><span class="n">cin</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">ch</span><span class="p">);</span><span class="w"> </span><span class="c1">// extracts a, leaves " b\n" in stream</span>
<a id="__codelineno-328-3" name="__codelineno-328-3"></a><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"You entered: "</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">ch</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="sc">'\n'</span><span class="p">;</span>
<a id="__codelineno-328-4" name="__codelineno-328-4"></a>
<a id="__codelineno-328-5" name="__codelineno-328-5"></a><span class="n">std</span><span class="o">::</span><span class="n">cin</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">ch</span><span class="p">);</span><span class="w"> </span><span class="c1">// extracts space, leaves "b\n" in stream</span>
<a id="__codelineno-328-6" name="__codelineno-328-6"></a><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"You entered: "</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">ch</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="sc">'\n'</span><span class="p">;</span>
</code></pre></div></td></tr></table></div>
<p>输入流不变，输出结果为</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-329-1">1</a></span>
<span class="normal"><a href="#__codelineno-329-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-329-1" name="__codelineno-329-1"></a>You entered: a
<a id="__codelineno-329-2" name="__codelineno-329-2"></a>You entered:  
</code></pre></div></td></tr></table></div>
</div>
<h3 id="_93">逻辑异或<a class="headerlink" href="#_93" title="Permanent link">¶</a></h3>
<p>在 C++ 中并没有提供逻辑异或的运算符（<code>^</code> 是按位异或），但我们可以使用 <code>!=</code> 来实现逻辑异或，比如 <code>a</code> 逻辑异或 <code>b</code> 可以写成 <code>a != b</code>。</p>
<ul>
<li><code>a != b</code> 等价于 <code>a xor b</code></li>
<li><code>a != b != c</code> 等价于 <code>a xor b xor c</code></li>
</ul>
<p>但是这里要求 <code>a</code>、<code>b</code> 和 <code>c</code> 都是布尔值，如果我们要进行非布尔值的异或运算，我们可以用 <code>static_cast&lt;bool&gt;</code> 来将它们转换为布尔值，但是其实还有更简单的方法：<del>（这么写的原因自己体会吧懒得解释了）</del></p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-330-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-330-1" name="__codelineno-330-1"></a><span class="o">!!</span><span class="n">a</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="o">!!</span><span class="n">b</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="o">!!</span><span class="n">c</span>
</code></pre></div></td></tr></table></div>
<h3 id="if-constexpr-statement">if constexpr statement<a class="headerlink" href="#if-constexpr-statement" title="Permanent link">¶</a></h3>
<p>在 C++17 中添加了 <code>if constexpr</code> 语句，它和普通的 if 语句的不同之处在于它要求条件表达式是一个常量表达式（在编译时就能确定布尔值），因此可以实现编译时对条件分支语句进行优化：</p>
<ul>
<li>当常量表达式的值是 true 时，编译器会把整个 if-else 块替换为 true 分支的代码</li>
<li>
<p>当常量表达式的值是 false 时</p>
<ul>
<li>如果有 false 分支（else case），编译器会把整个 if-else 块替换为 false 分支的代码</li>
<li>如果没有 false 分支，编译器会把整个 if-else 块替换为空语句</li>
</ul>
</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-331-1">1</a></span>
<span class="normal"><a href="#__codelineno-331-2">2</a></span>
<span class="normal"><a href="#__codelineno-331-3">3</a></span>
<span class="normal"><a href="#__codelineno-331-4">4</a></span>
<span class="normal"><a href="#__codelineno-331-5">5</a></span>
<span class="normal"><a href="#__codelineno-331-6">6</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-331-1" name="__codelineno-331-1"></a><span class="k">constexpr</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">gravity</span><span class="p">{</span><span class="w"> </span><span class="mf">9.8</span><span class="w"> </span><span class="p">};</span>
<a id="__codelineno-331-2" name="__codelineno-331-2"></a>
<a id="__codelineno-331-3" name="__codelineno-331-3"></a><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">gravity</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mf">9.8</span><span class="p">)</span><span class="w"> </span><span class="c1">// constant expression, always true</span>
<a id="__codelineno-331-4" name="__codelineno-331-4"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"Gravity is normal.</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span><span class="w">   </span><span class="c1">// will always be executed</span>
<a id="__codelineno-331-5" name="__codelineno-331-5"></a><span class="k">else</span>
<a id="__codelineno-331-6" name="__codelineno-331-6"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"We are not on Earth.</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span><span class="w"> </span><span class="c1">// will never be executed</span>
</code></pre></div></td></tr></table></div>
<p>上面的例子会被优化为</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-332-1">1</a></span>
<span class="normal"><a href="#__codelineno-332-2">2</a></span>
<span class="normal"><a href="#__codelineno-332-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-332-1" name="__codelineno-332-1"></a><span class="k">constexpr</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">gravity</span><span class="p">{</span><span class="w"> </span><span class="mf">9.8</span><span class="w"> </span><span class="p">};</span>
<a id="__codelineno-332-2" name="__codelineno-332-2"></a>
<a id="__codelineno-332-3" name="__codelineno-332-3"></a><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"Gravity is normal.</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
</code></pre></div></td></tr></table></div>
<h3 id="assert">assert<a class="headerlink" href="#assert" title="Permanent link">¶</a></h3>
<ul>
<li>通过 <code>#include &lt;cassert&gt;</code> 来使用 <code>assert</code> 宏</li>
<li>当 assert 语句的计算结果为 false 时，程序将会停止执行</li>
<li>
<p>可以通过一个小技巧来使得 assert 语句更具描述性：添加一个由 <code>&amp;&amp;</code> 连接的字符串字面量</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-333-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-333-1" name="__codelineno-333-1"></a><span class="n">assert</span><span class="p">(</span><span class="n">found</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="s">"Car could not be found in database"</span><span class="p">);</span>
</code></pre></div></td></tr></table></div>
<p>当 assert failed 时，这个字符串也会出现在输出中，帮助我们更好地理解程序发生错误的原因</p>
</li>
</ul>
<p>除了常规的 assert 之外，C++ 还提供了另一种类型的 assert 方式：<code>static_assert</code>，它是在编译时检查的，而不是在运行时检查的。格式为</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-334-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-334-1" name="__codelineno-334-1"></a><span class="k">static_assert</span><span class="p">(</span><span class="n">condition</span><span class="p">,</span><span class="w"> </span><span class="n">diagnostic_message</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<p>例如</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-335-1">1</a></span>
<span class="normal"><a href="#__codelineno-335-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-335-1" name="__codelineno-335-1"></a><span class="k">static_assert</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="kt">long</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">8</span><span class="p">,</span><span class="w"> </span><span class="s">"long must be 8 bytes"</span><span class="p">);</span>
<a id="__codelineno-335-2" name="__codelineno-335-2"></a><span class="k">static_assert</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="s">"int must be at least 4 bytes"</span><span class="p">);</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>由于 <code>static_assert</code> 是在编译时计算的，因此 condition 必须是常量表达式</li>
<li><code>static_assert</code> 可以放置在代码文件中的任何位置（甚至在全局命名空间中）</li>
<li>在 C++17 之前，diagnostic_message 必须作为第二个参数提供；从 C++17 开始，如果省略了 diagnostic_message，编译器会自动生成一个默认的错误消息</li>
</ul>
<h3 id="for-each-loop">for-each loop<a class="headerlink" href="#for-each-loop" title="Permanent link">¶</a></h3>
<p>在 C++ 中，除了我们常用的 for 循环之外，还有一种基于范围的 for 循环（range-based for loop），也称为 for-each 循环，它可以用来遍历容器中的元素。</p>
<p>基于范围的 for 循环的语法结构如下</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-336-1">1</a></span>
<span class="normal"><a href="#__codelineno-336-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-336-1" name="__codelineno-336-1"></a><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">element_declaration</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">array_object</span><span class="p">)</span>
<a id="__codelineno-336-2" name="__codelineno-336-2"></a><span class="w">   </span><span class="n">statement</span><span class="p">;</span>
</code></pre></div></td></tr></table></div>
<p>在这里，<code>element_declaration</code> 是一个新的变量，用于存储数组中的每个元素，<code>array_object</code> 是一个数组或容器，<code>statement</code> 是要执行的语句。在这个循环体中 <code>array_object</code> 的每一个元素都将被迭代，每一次迭代，当前元素的值都会被赋给 <code>element_declaration</code>，然后执行 <code>statement</code>。</p>
<details class="example" open="open">
<summary>Example</summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-337-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-337-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-337-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-337-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-337-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-337-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-337-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-337-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-337-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-337-10">10</a></span>
<span class="normal"><a href="#__codelineno-337-11">11</a></span>
<span class="normal"><a href="#__codelineno-337-12">12</a></span>
<span class="normal"><a href="#__codelineno-337-13">13</a></span>
<span class="normal"><a href="#__codelineno-337-14">14</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-337-1" name="__codelineno-337-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span>
<a id="__codelineno-337-2" name="__codelineno-337-2"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;vector&gt;</span>
<a id="__codelineno-337-3" name="__codelineno-337-3"></a>
<a id="__codelineno-337-4" name="__codelineno-337-4"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span>
<a id="__codelineno-337-5" name="__codelineno-337-5"></a><span class="p">{</span>
<a id="__codelineno-337-6" name="__codelineno-337-6"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="w"> </span><span class="n">fibonacci</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="mi">8</span><span class="p">,</span><span class="w"> </span><span class="mi">13</span><span class="p">,</span><span class="w"> </span><span class="mi">21</span><span class="p">,</span><span class="w"> </span><span class="mi">34</span><span class="p">,</span><span class="w"> </span><span class="mi">55</span><span class="p">,</span><span class="w"> </span><span class="mi">89</span><span class="w"> </span><span class="p">};</span>
<a id="__codelineno-337-7" name="__codelineno-337-7"></a>
<a id="__codelineno-337-8" name="__codelineno-337-8"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">num</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">fibonacci</span><span class="p">)</span><span class="w"> </span>
<a id="__codelineno-337-9" name="__codelineno-337-9"></a><span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">num</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="sc">' '</span><span class="p">;</span><span class="w"> </span>
<a id="__codelineno-337-10" name="__codelineno-337-10"></a>
<a id="__codelineno-337-11" name="__codelineno-337-11"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="sc">'\n'</span><span class="p">;</span>
<a id="__codelineno-337-12" name="__codelineno-337-12"></a>
<a id="__codelineno-337-13" name="__codelineno-337-13"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-337-14" name="__codelineno-337-14"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
</details>
<ul>
<li>从上面这个例子我们可以注意到，我们不需要知道容器的大小，也不需要使用下标来访问容器中的元素</li>
<li>如果需要遍历的容器没有元素，那么 for-each 循环体将不会执行</li>
</ul>
<p>因为一般而言 <code>element_declaration</code> 应当具有与数组元素相同的类型（以防止出现奇怪的类型转换），我们可以在这里使用 <code>auto</code> 关键字来自动推导它的类型，比如</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-338-1">1</a></span>
<span class="normal"><a href="#__codelineno-338-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-338-1" name="__codelineno-338-1"></a><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">auto</span><span class="w"> </span><span class="n">num</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">fibonacci</span><span class="p">)</span>
<a id="__codelineno-338-2" name="__codelineno-338-2"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">num</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="sc">' '</span><span class="p">;</span>
</code></pre></div></td></tr></table></div>
<p>而当容器中的元素在复制时的开销比较大时，我们可以改为使用 <code>const auto&amp;</code> 来避免复制</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-339-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-339-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-339-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-339-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-339-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-339-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-339-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-339-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-339-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-339-10">10</a></span>
<span class="normal"><a href="#__codelineno-339-11">11</a></span>
<span class="normal"><a href="#__codelineno-339-12">12</a></span>
<span class="normal"><a href="#__codelineno-339-13">13</a></span>
<span class="normal"><a href="#__codelineno-339-14">14</a></span>
<span class="normal"><a href="#__codelineno-339-15">15</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-339-1" name="__codelineno-339-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span>
<a id="__codelineno-339-2" name="__codelineno-339-2"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;string&gt;</span>
<a id="__codelineno-339-3" name="__codelineno-339-3"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;vector&gt;</span>
<a id="__codelineno-339-4" name="__codelineno-339-4"></a>
<a id="__codelineno-339-5" name="__codelineno-339-5"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span>
<a id="__codelineno-339-6" name="__codelineno-339-6"></a><span class="p">{</span>
<a id="__codelineno-339-7" name="__codelineno-339-7"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span><span class="w"> </span><span class="n">words</span><span class="p">{</span><span class="w"> </span><span class="s">"peter"</span><span class="p">,</span><span class="w"> </span><span class="s">"likes"</span><span class="p">,</span><span class="w"> </span><span class="s">"frozen"</span><span class="p">,</span><span class="w"> </span><span class="s">"yogurt"</span><span class="w"> </span><span class="p">};</span>
<a id="__codelineno-339-8" name="__codelineno-339-8"></a>
<a id="__codelineno-339-9" name="__codelineno-339-9"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="o">&amp;</span><span class="w"> </span><span class="n">word</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">words</span><span class="p">)</span><span class="w"> </span><span class="c1">// word is now a const reference</span>
<a id="__codelineno-339-10" name="__codelineno-339-10"></a><span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">word</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="sc">' '</span><span class="p">;</span>
<a id="__codelineno-339-11" name="__codelineno-339-11"></a>
<a id="__codelineno-339-12" name="__codelineno-339-12"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="sc">'\n'</span><span class="p">;</span>
<a id="__codelineno-339-13" name="__codelineno-339-13"></a>
<a id="__codelineno-339-14" name="__codelineno-339-14"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-339-15" name="__codelineno-339-15"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>如果这里的引用不是 const 的，那么我们也可以在这个循环体中修改容器中的元素。</p>
<ul>
<li>当我们希望得到一个可修改的副本时，使用 <code>auto</code>。</li>
<li>当我们希望修改容器中的元素时，使用 <code>auto&amp;</code>。</li>
<li>当我们希望避免复制时（只查看元素而不修改），使用 <code>const auto&amp;</code>。</li>
</ul>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>由于 for-each 循环是基于范围的，因此它只能用于支持迭代器的容器，比如<code>std::vector</code>、<code>std::list</code>、<code>std::set</code>、<code>std::map</code> 等，但它也可用于 C 风格数组（不能用于退化为指针的数组）。</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-340-1">1</a></span>
<span class="normal"><a href="#__codelineno-340-2">2</a></span>
<span class="normal"><a href="#__codelineno-340-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-340-1" name="__codelineno-340-1"></a><span class="kt">int</span><span class="w"> </span><span class="n">array</span><span class="p">[]</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="p">};</span>
<a id="__codelineno-340-2" name="__codelineno-340-2"></a><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">num</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">array</span><span class="p">)</span>
<a id="__codelineno-340-3" name="__codelineno-340-3"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">num</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="sc">' '</span><span class="p">;</span>
</code></pre></div></td></tr></table></div>
</div>
<div class="admonition extra">
<p class="admonition-title">Extra</p>
<p>上面我们使用的 for-each 循环只能进行正序迭代，从 C++20 开始，我们可以使用 <code>std::views::reverse</code> 来得到到一个逆序的视图，从而实现逆序迭代。</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-341-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-341-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-341-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-341-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-341-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-341-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-341-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-341-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-341-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-341-10">10</a></span>
<span class="normal"><a href="#__codelineno-341-11">11</a></span>
<span class="normal"><a href="#__codelineno-341-12">12</a></span>
<span class="normal"><a href="#__codelineno-341-13">13</a></span>
<span class="normal"><a href="#__codelineno-341-14">14</a></span>
<span class="normal"><a href="#__codelineno-341-15">15</a></span>
<span class="normal"><a href="#__codelineno-341-16">16</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-341-1" name="__codelineno-341-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span>
<a id="__codelineno-341-2" name="__codelineno-341-2"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;ranges&gt;</span><span class="c1"> // C++20</span>
<a id="__codelineno-341-3" name="__codelineno-341-3"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;string_view&gt;</span>
<a id="__codelineno-341-4" name="__codelineno-341-4"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;vector&gt;</span>
<a id="__codelineno-341-5" name="__codelineno-341-5"></a>
<a id="__codelineno-341-6" name="__codelineno-341-6"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span>
<a id="__codelineno-341-7" name="__codelineno-341-7"></a><span class="p">{</span>
<a id="__codelineno-341-8" name="__codelineno-341-8"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string_view</span><span class="o">&gt;</span><span class="w"> </span><span class="n">words</span><span class="p">{</span><span class="w"> </span><span class="s">"Alex"</span><span class="p">,</span><span class="w"> </span><span class="s">"Bobby"</span><span class="p">,</span><span class="w"> </span><span class="s">"Chad"</span><span class="p">,</span><span class="w"> </span><span class="s">"Dave"</span><span class="w"> </span><span class="p">};</span>
<a id="__codelineno-341-9" name="__codelineno-341-9"></a>
<a id="__codelineno-341-10" name="__codelineno-341-10"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="o">&amp;</span><span class="w"> </span><span class="n">word</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">views</span><span class="o">::</span><span class="n">reverse</span><span class="p">(</span><span class="n">words</span><span class="p">))</span>
<a id="__codelineno-341-11" name="__codelineno-341-11"></a><span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">word</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="sc">' '</span><span class="p">;</span>
<a id="__codelineno-341-12" name="__codelineno-341-12"></a>
<a id="__codelineno-341-13" name="__codelineno-341-13"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="sc">'\n'</span><span class="p">;</span>
<a id="__codelineno-341-14" name="__codelineno-341-14"></a>
<a id="__codelineno-341-15" name="__codelineno-341-15"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-341-16" name="__codelineno-341-16"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>输出结果为</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-342-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-342-1" name="__codelineno-342-1"></a>Dave Chad Bobby Alex
</code></pre></div></td></tr></table></div>
</div>
<h3 id="_94">注释<a class="headerlink" href="#_94" title="Permanent link">¶</a></h3>
<ul>
<li>对于库、文件和函数，通常把注释放在库/文件的顶部，或是紧接在函数上方</li>
<li>
<p>注释用于描述库、程序、函数的功能 </p>
<p>explain what they do</p>
</li>
<li>
<p>有时注释还可用于描述代码如何实现</p>
<p>explain how they do it</p>
</li>
<li>
<p>在具体的语句层面，注释通常用于解释代码的目的和原因，而非代码正在做什么</p>
<p>假如代码很复杂以至于需要解释，那么通常需要重构代码而非添加注释</p>
<p>explain why they do it</p>
</li>
</ul>
<aside class="md-source-file">
<span class="md-source-file__fact">
<span class="md-icon" title="Last update">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1zM12.5 7v5.2l4 2.4-1 1L11 13V7zM11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2z"></path></svg>
</span>
<span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date" title="2026年1月15日 17:20:26 CST">2026年1月15日</span>
</span>
<span class="md-source-file__fact">
<span class="md-icon" title="Created">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M14.47 15.08 11 13V7h1.5v5.25l3.08 1.83c-.41.28-.79.62-1.11 1m-1.39 4.84c-.36.05-.71.08-1.08.08-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8c0 .37-.03.72-.08 1.08.69.1 1.33.32 1.92.64.1-.56.16-1.13.16-1.72 0-5.5-4.5-10-10-10S2 6.5 2 12s4.47 10 10 10c.59 0 1.16-.06 1.72-.16-.32-.59-.54-1.23-.64-1.92M18 15v3h-3v2h3v3h2v-3h3v-2h-3v-3z"></path></svg>
</span>
<span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date" title="2026年1月15日 17:20:26 CST">2026年1月15日</span>
</span>
</aside>
<form class="md-feedback" hidden="" name="feedback">
<fieldset>
<legend class="md-feedback__title">
        Was this page helpful?
      </legend>
<div class="md-feedback__inner">
<div class="md-feedback__list">
<button class="md-feedback__icon md-icon" data-md-value="1" title="This page was helpful" type="submit">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M5 9v12H1V9zm4 12a2 2 0 0 1-2-2V9c0-.55.22-1.05.59-1.41L14.17 1l1.06 1.06c.27.27.44.64.44 1.05l-.03.32L14.69 8H21a2 2 0 0 1 2 2v2c0 .26-.05.5-.14.73l-3.02 7.05C19.54 20.5 18.83 21 18 21zm0-2h9.03L21 12v-2h-8.79l1.13-5.32L9 9.03z"></path></svg>
</button>
<button class="md-feedback__icon md-icon" data-md-value="0" title="This page could be improved" type="submit">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 15V3h4v12zM15 3a2 2 0 0 1 2 2v10c0 .55-.22 1.05-.59 1.41L9.83 23l-1.06-1.06c-.27-.27-.44-.64-.44-1.06l.03-.31.95-4.57H3a2 2 0 0 1-2-2v-2c0-.26.05-.5.14-.73l3.02-7.05C4.46 3.5 5.17 3 6 3zm0 2H5.97L3 12v2h8.78l-1.13 5.32L15 14.97z"></path></svg>
</button>
</div>
<div class="md-feedback__note">
<div data-md-value="1" hidden="">
              
              
                
              
              
              
                
                
              
              Thanks for your feedback!
            </div>
<div data-md-value="0" hidden="">
              
              
                
              
              
              
                
                
              
              Thanks for your feedback! Help me improve this page by using our <a href="https://github.com/xestray/xestray.github.io/issues" rel="noopener" target="_blank">feedback form</a>.
            </div>
</div>
</div>
</fieldset>
</form>
<h2 id="__comments">Comments</h2>
<script async="" crossorigin="anonymous" data-category="Announcements" data-category-id="DIC_kwDOMQYCss4Cghqg" data-emit-metadata="0" data-input-position="bottom" data-lang="zh-CN" data-mapping="pathname" data-reactions-enabled="1" data-repo="xestray/xestray.github.io" data-repo-id="R_kgDOMQYCsg" data-strict="0" data-theme="preferred_color_scheme" src="https://giscus.app/client.js">
</script>
<!-- Synchronize Giscus theme with palette -->
<script>
    var giscus = document.querySelector("script[src*=giscus]")

    /* Set palette on initial load */
    var palette = __md_get("__palette")
    if (palette && typeof palette.color === "object") {
      var theme = palette.color.scheme === "slate" ? "dark" : "light"
      giscus.setAttribute("data-theme", theme) 
    }

    /* Register event handlers after documented loaded */
    document.addEventListener("DOMContentLoaded", function() {
      var ref = document.querySelector("[data-md-component=palette]")
      ref.addEventListener("change", function() {
        var palette = __md_get("__palette")
        if (palette && typeof palette.color === "object") {
          var theme = palette.color.scheme === "slate" ? "dark" : "light"

          /* Instruct Giscus to change theme */
          var frame = document.querySelector(".giscus-frame")
          frame.contentWindow.postMessage(
            { giscus: { setConfig: { theme } } },
            "https://giscus.app"
          )
        }
      })
    })
  </script>
</article>
</div>
<script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
</div>
<button class="md-top md-icon" data-md-component="top" hidden="" type="button">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"></path></svg>
  Back to top
</button>
</main>
<footer class="md-footer">
<nav aria-label="Footer" class="md-footer__inner md-grid">
<a aria-label="Previous: Programing Languages" class="md-footer__link md-footer__link--prev" href="../../">
<div class="md-footer__button md-icon">
<svg viewbox="0 0 256 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M9.4 233.4c-12.5 12.5-12.5 32.8 0 45.3l160 160c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L77.3 256l137.3-137.4c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-160 160z"></path></svg>
</div>
<div class="md-footer__title">
<span class="md-footer__direction">
                Previous
              </span>
<div class="md-ellipsis">
                Programing Languages
              </div>
</div>
</a>
<a aria-label="Next: 高级数据结构与算法分析" class="md-footer__link md-footer__link--next" href="../../../ADS/">
<div class="md-footer__title">
<span class="md-footer__direction">
                Next
              </span>
<div class="md-ellipsis">
                高级数据结构与算法分析
              </div>
</div>
<div class="md-footer__button md-icon">
<svg viewbox="0 0 256 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M247.1 233.4c12.5 12.5 12.5 32.8 0 45.3l-160 160c-12.5 12.5-32.8 12.5-45.3 0s-12.5-32.8 0-45.3L179.2 256 41.9 118.6c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0l160 160z"></path></svg>
</div>
</a>
</nav>
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-copyright">
<div class="md-copyright__highlight">
      Copyright © 2025 <a href="https://github.com/xestray" target="_blank">xestray</a>
</div>
</div>
</div>
</div>
</footer>
</div>
<div class="md-dialog" data-md-component="dialog">
<div class="md-dialog__inner md-typeset"></div>
</div>
<script id="__config" type="application/json">{"annotate": null, "base": "../../../..", "features": ["announce.dismiss", "content.code.annotate", "content.code.copy", "content.code.select", "content.tabs.link", "content.tooltips", "navigation.footer", "navigation.indexes", "navigation.path", "navigation.tabs", "navigation.top", "navigation.tracking", "search.highlight", "search.share", "search.suggest", "toc.follow"], "search": "../../../../assets/javascripts/workers/search.2c215733.min.js", "tags": {"Default": "default-tag", "Hardware": "hardware-tag", "Software": "software-tag"}, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
<script src="../../../../assets/javascripts/bundle.79ae519e.min.js"></script>
<script src="../../../../js/print-site.js"></script>
<script src="../../../../javascripts/katex.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.7/katex.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.7/contrib/auto-render.min.js"></script>
<script src="../../../../javascripts/toc.js"></script>
<script type="module">import mermaid from "https://unpkg.com/mermaid@10.4.0/dist/mermaid.esm.min.mjs";
window.mermaidConfig = {default: {
    startOnLoad: false
}};</script></body>
</html>